window.miniqyboot=true;window.QYCOMPILED=true;
var qyboot_config='{"mt":"F2DEJV","pt":"dep","modrelease":["modjsall.js"],"modrelmt":["F2DEJV"]}';
!function(){function o(o,t){null==o&&(o={});if(!t)return o;var e=typeof t;if("object"!=e)return o;for(var n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);return o}var t={debug:window.g_qyboot_debug,version:"v1.3",qyboot_config:qyboot_config,mergeObj:o};window.qyboot=o(window.qyboot,t)}();!function(){function matchVersion(){var o=qyboot.getLSItem("QYSYSVER");if(o!=qyboot.version){qyboot.clearLS();qyboot.setLSItem("QYSYSVER",qyboot.version)}}function applyUpdates(){for(var o,t,e=window.localStorage.length,n=0;e>n;n++){o=window.localStorage.key(n);var r=/QYFU\/(.+)/.exec(o);if(r){t=qyboot.getLSItem(o);window.localStorage.removeItem(o);qyboot.setLSItem(r[1],t)}}}function loadBoot(o,t){if(qyboot.isqyc(o)){console.log(t+" enc");qyboot.qyload(o)}else{if(qyboot.isxor(o)){o=qyboot.dexor(o);console.log(t+" x")}else console.log(t+" notenc");qyboot.debug?qyboot.evalClean(o+"\n//@ sourceURL="+t,t):qyboot.evalClean_wrap(o,t)}}function outdateMsg(o){return o+" is using old format.please deploy it force update"}function preloadBoot(o,t){var e=JSON.parse(qyboot.qyboot_config),n=qyboot.getFromLS(qyboot.PROJ(o));qyboot.preloadProjByConfig(o,e,n,t)}function using_boot(o,t){preloadBoot(o,function(e){for(var n=e.config,r=qyboot.getReleaseFiles(n,o),a=r.length,s=0;a>s;s++){var i=r[s],d=o+"/"+i,l=getFromLS(d,!0);if(null==l){l=qyboot.getRemoteFile(d);loadBoot(l,d)}else try{loadBoot(l,d)}catch(u){l=qyboot.getRemoteFile(d);loadBoot(l,d)}}if(window.miniqyboot){qyboot.baseLoaded=!0;qyboot.preloaded=!0;qyboot.tryRunReadyFuns()}else t()})}function bootLoadedCallback(){var o=SelfModName(),t=qyboot.getPrefix()+o;qyboot.is_webapp=window.g_qyboot_path?!1:""!=o&&!/^qiyun\/website\//.test(o);var e,n=defaultProjs;if(qyboot.is_webapp||window.forbidPreload){var r=qyboot.analyzePath(t);if("proj"==r.type)n=n.concat([r.path]);else if(/\/(main|login)$/.test(o)){e=r.path;n=n.concat([o])}else n=n.concat([[r.path]])}else n=n.concat(staticToLoad);var a=window.g_projsToPreload?window.g_projsToPreload.concat(n):n;qyboot.preload(a,function(){console.log("after preload");if(qyboot.is_webapp){o.match(/\/qybase$/)||qyboot.initShowMessage();"http"==qyboot.getProto()&&qyboot.tryCreateGuest();using_webapp(o);o.match(/\/qybase$/)&&qyboot.initShowMessage();qyboot.initUpdateReminder()}e&&qyboot.preload([[e]],function(){})});qyboot.ready(qyboot.removeLoadingImg)}qyboot.evalClean=function(code,file){file||(file="");try{return eval(code)}catch(e){throw e}};qyboot.evalClean_wrap=function(o,t){t||(t="");try{new Function(o)();return}catch(e){throw e}};var FSPrefix="QYFI",FSContent="QYFC",posRegex=/^(debug|beta|public)\/(.*)/;qyboot.mapPath=function(o,t){if(!t){t=o;o="deployed"}var e=posRegex.exec(t);if(e){o=e[1];t=e[2]}return{PositionType:o,Path:t}};qyboot.getLocalStoragePath=function(o,t,e){if(!t){t=o;o="deployed"}return[e?FSContent:FSPrefix,o,t].join("/")};var getLsPath=qyboot.getLsPath=function(o){var t=qyboot.mapPath(o),e=qyboot.getLocalStoragePath(t.PositionType,t.Path,!0);return e};qyboot.showQuota=function(o){var t=0==o?navigator.webkitTemporaryStorage:navigator.webkitPersistentStorage;t&&t.queryUsageAndQuota?t.queryUsageAndQuota(function(o,t){console.log("Used quota: "+o+", remaining quota: "+t)},function(o){console.log("Error",o)}):console.log("not webkit based platform")};var askingForQuota=!1,cxo=function(o){if(void 0===o)return void 0;if(null===o)return null;for(var t=o.length,e="",n=0;t>n;n++)e+=String.fromCharCode(155^o.charCodeAt(n));return e};qyboot.getLSItem=function(o){return cxo(window.localStorage.getItem(o))};qyboot.setLSItem=function(o,t){t=cxo(t);try{window.localStorage.setItem(o,t);return!0}catch(e){qyboot.gcLS();try{window.localStorage.setItem(o,t);if(askingForQuota||!navigator.webkitPersistentStorage)return!1;askingForQuota=!0;navigator.webkitPersistentStorage.requestQuota(4294967296,function(o){console.log("persistent quota is set to "+o)});return!1}catch(e){return!1}}};var saveToLS=qyboot.saveToLS=function(o,t){var e=getLsPath(o),n="string"==typeof t?t:JSON.stringify(t);qyboot.setLSItem(e,n)},getFromLS=qyboot.getFromLS=function(o,t){var e=getLsPath(o),n=qyboot.getLSItem(e);if(t){/.css$/.test(o)&&(n=cxo(n));return n}if(!n)return void 0;try{return JSON.parse(n)}catch(r){window.localStorage.removeItem(o);return void 0}},removeFromLS=qyboot.removeFromLS=function(o){var t=getLsPath(o);window.localStorage.removeItem(t)};qyboot.clearLS=function(){for(var o=window.localStorage.length,t=[],e=0;o>e;e++){var n=window.localStorage.key(e);/^QYF/.test(n)&&t.push(n)}o=t.length;for(e=0;o>e;e++)window.localStorage.removeItem(t[e]);console.log("clearLS done");return o};qyboot.gcLS=function(){for(var o=window.localStorage.length,t=/(^QYFC\/(debug|beta|public|deployed)\/)|(^QYFI\/)/,e=[],n=0;o>n;n++){var r=window.localStorage.key(n);t.test(r)&&e.push(r)}o=e.length;for(n=0;o>n;n++)window.localStorage.removeItem(e[n]);console.log("gcLS done");return o};matchVersion();applyUpdates();qyboot.randUrl=function(o){return o+"?rand="+Math.floor(1e4*Math.random())};qyboot.getPathUrl=function(o){var t=/^debug\//.test(o)?"/"+o:qyboot.getBaseURIHttp()+o;return t};qyboot.getRemoteFile=function(o){var t=new XMLHttpRequest;t.open("GET",qyboot.randUrl(qyboot.getBaseURI()+o),!1);t.send(null);if(4==t.readyState&&200==t.status)return t.responseText;console.log("getting "+o+" failed.");return null};qyboot.getRemoteFile_async=function(o,t){var e=new XMLHttpRequest;e.open("GET",qyboot.randUrl(qyboot.getBaseURI()+o),!0);e.onreadystatechange=function(){if(4==e.readyState){e.onreadystatechange=function(){};200==e.status?t(o,e.responseText):t(o,null)}};e.send(null)};qyboot.isqyc=function(o){return 4==o.charCodeAt(0)&&1==o.charCodeAt(1)};qyboot.isxor=function(o){return 8==o.charCodeAt(0)&&16==o.charCodeAt(1)};qyboot.dexor=function(o){for(var t="",e=o.length,n=4;e>n;n++)t+=String.fromCharCode(185^o.charCodeAt(n));return t};qyboot.PROJ=function(o){return o+"/proj.config"};qyboot.getReleaseFiles=function(o,t){if(!o)throw t+" config is null";if(!o.mt)throw outdateMsg(t);return o.modrelease||o.webapprelease?o.modrelease?o.webapprelease?o.modrelease.concat(o.webapprelease):o.modrelease:o.webapprelease:[]};qyboot.getReleaseMts=function(o){return o.modrelmt||o.webapprelmt?o.modrelmt?o.webapprelmt?o.modrelmt.concat(o.webapprelmt):o.modrelmt:o.webapprelmt:[]};qyboot.makeMap=function(o,t){var e={};if(!o)return e;for(var n=qyboot.getReleaseFiles(o,t),r=qyboot.getReleaseMts(o,t),a=n.length,s=0;a>s;s++)e[n[s]]=r[s];return e};var baseURI,baseURIHttp,baseURIHttps,domainApp,hostName,hostPort,debugMode,proto,prefix,cookiesuffix,hostAddress,httpsHostAddress,httpHostAddress,uriRegex=/((http[s]?):\/\/([^/:]+)(:([0-9]+))?\/)((debug|beta|public)\/)?/i;qyboot.getHostName=function(){return hostName||(qyboot.getBaseURI(),hostName)};qyboot.getHostAddress=function(){return hostAddress||(qyboot.getBaseURI(),hostAddress)};qyboot.getHttpsHostAddress=function(){return httpsHostAddress||(qyboot.getBaseURI(),httpsHostAddress)};qyboot.getBaseURIHttp=function(){return baseURIHttp||(qyboot.getBaseURI(),baseURIHttp)};qyboot.getBaseURIHttps=function(){return baseURIHttps||(qyboot.getBaseURI(),baseURIHttps)};qyboot.getHttpHostAddress=function(){return httpHostAddress||(qyboot.getBaseURI(),httpHostAddress)};qyboot.getCookieSuffix=function(){return cookiesuffix||(qyboot.getBaseURI(),cookiesuffix)};qyboot.getProto=function(){return proto||(qyboot.getBaseURI(),proto)};qyboot.getDebugMode=function(){return debugMode||(qyboot.getBaseURI(),debugMode)};qyboot.getPrefix=function(){return prefix||(qyboot.getBaseURI(),prefix)};qyboot.getBaseURI=function(){if(baseURI)return baseURI;var o=window.g_qyboot_path||window.qyProjUrl||decodeURI(window.location.href),t=o.indexOf("?");t>=0&&(o=o.substr(0,t));var e=uriRegex.exec(o);if(!e)return o;baseURI=e[1];proto=e[2];cookiesuffix="http"==proto?"h":"";hostName=e[3];hostPort=e[5];hostAddress=hostName+(hostPort?":"+hostPort:"");httpsHostAddress="https"==proto?hostAddress:hostName+(hostPort?":4443":"");httpHostAddress="http"==proto?hostAddress:hostName+(hostPort?":8080":"");baseURIHttps="https"==proto?baseURI:"https://"+httpsHostAddress+"/";baseURIHttp="http"==proto?baseURI:"http://"+httpHostAddress+"/";prefix=e[6]||"";debugMode="debug/"==prefix?"debug/":"";var n=o.length;if(baseURI.length>=n)domainApp="";else{var r=o.substring(e[0].length),a=r.split("/"),s=a[a.length-1];(""==s||s.indexOf(".")>=0)&&a.pop();domainApp=a.join("/")}return baseURI};qyboot.getDomainApp=function(){return domainApp||(qyboot.getBaseURI(),domainApp)};qyboot.initToLoad=function(o){for(var t={items:{}},e=0,n=0;n<o.length;n++)if(!t.items[o[n]]){t.items[o[n]]={status:"toload"};e++}t.total=t.remaining=e;return t};var preloadFiles=function(o,t){function e(o,e){if(null==e)n.items[o].status="failed";else{n.items[o].status="loaded";n.items[o].content=e}0==--n.remaining&&t(n)}if(o&&0!=o.length){var n=qyboot.initToLoad(o);for(var r in n.items)qyboot.getRemoteFile_async(r,function(o,t){e(o,t)})}else t({items:{}})},bootProj=(qyboot.debug?"debug/":"")+"qiyun/qyboot";qyboot.preloadProjByConfig=function(o,t,e,n){if(e&&e.mt==t.mt)n({proj:o,config:t,status:"exist"});else{var r=qyboot.makeMap(e,o),a=qyboot.makeMap(t,o),s=[];for(var i in a)r[i]!=a[i]&&s.push(o+"/"+i);preloadFiles(s,function(e){for(var r in e.items){var a=e.items[r];"loaded"==a.status&&qyboot.saveToLS(r,a.content)}qyboot.saveToLS(qyboot.PROJ(o),t);n({proj:o,config:t,status:"updated"})})}};!function(){function o(){e=!0;r()}var t=[],e=!1;qyboot.preloaded=window.QYCOMPILED?!0:!1;var n=!1,r=qyboot.tryRunReadyFuns=function(){if(e&&qyboot.preloaded)for(var o=t.shift();o;){o();o=t.shift()}};qyboot.ready=function(r){if(e&&qyboot.preloaded)r();else{t.push(r);if("complete"!==document.readyState){if(!n){window.addEventListener?window.addEventListener("load",o,!1):window.attachEvent&&window.attachEvent("onload",o);n=!0}}else o()}}}();var defaultProjs=["qiyun/qybase","qiyun/qyutil_sln/qyShowMessage","qiyun/qyutil_sln/qyShowMessage_css"],staticToLoad=["qiyun/qylogin_sln","qiyun/main","qiyun/qyMessenger_sln",["qiyun/qyutil_sln",["qyDragModule","qyUpdateReminder","qyTabs","qyTabs_css","qyButton","qyButton_css"]]];window.QYCOMPILED?window.miniqyboot&&(qyboot.baseLoaded=!0):using_boot(bootProj,bootLoadedCallback)}();
!function(){qyboot.set_export_desc=function(e,o){o||(o=qyboot);for(var t in e)e.hasOwnProperty(t)&&(o[t]=e[t].value);o.exports_desc=qyboot.mergeObj(o.exports_desc,e)}}();!function(){var e=[];qyboot.pushShowMsgFun=function(o){e.push(o)};qyboot.popShowMsgFun=function(){var o=e.length;o>1&&e.pop()};var o;qyboot.initShowMessage=function(){if(!o&&using){var e=using("qiyun/qyutil_sln/qyShowMessage");if(e&&e.qyShowMessage){o=new e.qyShowMessage({});qyboot.showMsgObj=o;if(window.g_qy_DESKTOP){var t=window.g_qy_DESKTOP.getSize();o.setPosition({x:t.x/2,y:t.y/2})}qyboot.pushShowMsgFun(o.showMessage.closure(o))}}};window.defaultShowMessage=function(e,t,r,n){return o&&o.showMessage(e,t,r,n)};window.showMessage=function(o,t,r,n){return e.length>0&&e[e.length-1](o,t,r,n)};window.clearMessage=function(){o&&o.clearMessage()};window.showQyLogin=function(){qyboot.CurrentUser=null;if(!qyboot.UserPanel){var e=using("qiyun/qylogin_sln/qylogin");qyboot.UserPanel=new e.QYUserPanel({})}}}();!function(){function e(e){return e+"/load.manifest"}function o(e){var o=e.path,t=e.updateFiles;if(t)for(var r=t.length,n=0;r>n;n++)qyboot.saveToLS(o+"/"+t[n].filename,t[n].content);qyboot.saveToLS(o+"/"+e.type+".config",e.newConfig)}function t(e,o){for(var t=0;t<u.length;t++)u[t](e,o);l.push({projPath:e,updateFiles:o})}function r(){if(s)return s;if(!window.Worker){console.log("worker is not supported");return null}console.log("worker is supported");var r=qyboot.debug?"debug/":"",n=qyboot.getBaseURI()+r+"qiyun/qyboot/worker/qyupdate.js";s=new window.Worker(qyboot.randUrl(n));s.addEventListener("message",function(r){var n=r.data;if("updateReady"==n.cmd){for(var s=n.updateFiles?n.updateFiles.length:0,a=new Array(s),i=0;s>i;i++)a[i]=n.updateFiles[i].filename;t(n.path,a);o(n)}else if("loadMnftReady"==n.cmd){var u=e(n.path);qyboot.setLSItem(qyboot.getLsPath(u),n.mnft)}else console.log("from worker:"+JSON.stringify(n))},!1);return s}function n(e,o,t,n){var s=r();if(!s)return!1;s.postMessage({cmd:"update",path:e,type:o,baseURIHttp:qyboot.getBaseURIHttp(),usedProjs:n,oldConfig:t||qyboot.getFromLS(e+"/"+o+".config")});return!0}var s,a,i=function(e,o){var t=o?o.length:0;console.log(t>0?e+" updated(files:"+t+"). Will take effect after restart.":e+" config updated. ")},u=[i],l=[];qyboot.initUpdateReminder=function(){if(!a){a=using("qiyun/qyutil_sln/qyUpdateReminder");qyboot.addUpdateReminder(a.updateReminder)}};qyboot.addUpdateReminder=function(e){if("function"==typeof e){u.push(e);for(var o=0;o<l.length;o++)e(l[o].projPath,l[o].updateFiles)}};qyboot.bgUpdateProj=function(e,o){return n(e,"proj",o)};qyboot.bgUpdateSln=function(e,o,t){return n(e,"sln",o,t)};qyboot.loadManifest=function(o){var t=e(o),n=qyboot.getLSItem(qyboot.getLsPath(t)),s=qyboot.getRemoteFile(t);if(n!=s){var a=r();if(!a)return!1;a.postMessage({cmd:"loadMnft",path:o,oldMnft:n,newMnft:s,baseURIHttp:qyboot.getBaseURIHttp()})}return!0}}();!function(){function e(e,o,t){t?qyboot.preloadProjByConfig(e,t,null,o):qyboot.getRemoteFile_async(qyboot.PROJ(e),function(t,r){if(null!=r){var n=JSON.parse(r);qyboot.preloadProjByConfig(e,n,null,o)}else o({proj:e,status:"failed"})})}function o(){qyboot.preloaded=!0;l();qyboot.tryRunReadyFuns()}function t(t){if(!p[t.path]){p[t.path]=t;c++;if(t.config)r(t.config);else{d++;e(t.path,function(e){t.status=e.status;t.config=e.config;t.config&&r(t.config);0==--d&&o()})}}}function r(e){if(e&&e.deps)for(var o=0;o<e.deps.length;o++)u(e.deps[o])}function n(e){d++;qyboot.getRemoteFile_async(qyboot.SLN(e.path),function(t,n){if(null==n)"failed"==e.status;else{qyboot.saveToLS(t,n);var s=JSON.parse(n);e.config=s;e.status="loaded";r(s)}a(e);0==--d&&o()})}function s(e){var o=[];if("sln_all"==e.type){if(!e.config)return[];for(var t=0;t<e.config.projs.length;t++){var r=e.path+"/"+e.config.projs[t].path;e.projsLoaded[r]||qyboot.getFromLS(qyboot.PROJ(r))||o.push(r)}}else{for(t=0;t<e.projsToLoad.length;t++){r=e.projsToLoad[t];e.projsLoaded[r]||o.push(r)}e.projsToLoad=[]}return o}function a(t){for(var n=s(t),a=0;a<n.length;a++){var i=n[a],u=qyboot.getProjConfigFromSlnConfig(t.config,i);u&&r(u);d++;e(i,function(e){t.projsLoaded[e.proj]=e;0==--d&&o()},u)}}function i(e){if(p[e.path]){var o=p[e.path];if("toload"==o.status)"sln_all"==e.type?o.type="sln_all":e.projsToLoad.length>0&&(o.projsToLoad=o.projsToLoad.concat(e.projsToLoad));else{if("sln_all"==o.type)return;if("sln_all"==e.type){o.type="sln_all";a(o)}else if(e.projsToLoad.length>0){o.projsToLoad=o.projsToLoad.concat(e.projsToLoad);a(o)}}}else{p[e.path]=e;if(e.config){r(e.config);a(e)}else n(e)}}function u(e){var o=qyboot.analyzePath(e);if(o)if(qyboot.is_webapp)switch(o.type){case"proj":t(o);return;case"sln_proj":case"sln_all":i(o);return}else{if(o.config)return;switch(o.type){case"proj":qyboot.bgUpdateProj(o.path);return;case"sln_proj":case"sln_all":qyboot.bgUpdateSln(o.path,null,"sln_all"==o.type?"all":o.projsToLoad);return}}}var l,p={},c=0,d=0;qyboot.analyzePath=function(e){if(e instanceof Array){var o=e[0],t=qyboot.getFromLS(qyboot.SLN(o));if(!e[1])return{type:"sln_all",path:o,config:t,status:t?"exist":"toload",projsLoaded:{}};for(var r=e[1],n={type:"sln_proj",path:o,config:t,status:t?"exist":"toload",projsLoaded:{},projsToLoad:[]},s=0;s<r.length;s++){var a=o+"/"+r[s];qyboot.getFromLS(qyboot.PROJ(a))||n.projsToLoad.push(a)}return n}if(!e||e.split("/").length<2)return null;var i=qyboot.dirname(e),u=qyboot.dirname(i);if(u&&"debug"!=u&&"beta"!=u&&"public"!=u){t=qyboot.getFromLS(qyboot.SLN(i));var l=qyboot.getFromLS(qyboot.PROJ(e));return{type:"sln_proj",path:i,config:t,status:t?"exist":"toload",projsLoaded:{},projsToLoad:l?[]:[e]}}if(/_sln$/.test(e)){t=qyboot.getFromLS(qyboot.SLN(e));return{type:"sln_all",path:e,config:t,status:t?"exist":"toload",projsLoaded:{}}}return{type:"proj",path:e,config:qyboot.getFromLS(qyboot.PROJ(e)),status:t?"exist":"toload"}};qyboot.preload=function(e,t){l=t;for(var r=0;r<e.length;r++)u(e[r]);0==d&&o()}}();!function(){function e(e){if(e.origin==g){var o=e.data.msg,t=e.data.data,r=b[o];if(r)for(var n=0;n<r.length;n++)r[n](t)}}function o(){var e="";for(var o in q){var t=q[o];t&&t.msg&&(e+=t.msg+"\n")}return e}var t=qyboot.setCookie=function(e,o,t){var r="";if(t){var n=new Date;n.setTime(n.getTime()+24*t*60*60*1e3);r="; expires="+n.toGMTString()}document.cookie=e+"="+escape(o)+r+";path=/"},r=function(e,o,t){var r=new Date;r.setTime(r.getTime()+1e3*t);var n="; expires="+r.toGMTString();document.cookie=e+"="+escape(o)+n+";path=/"},n=qyboot.eraseCookie=function(e){t(e,"",-1)},s=(qyboot.getCookie=function(e){var o=s();return e in o?o[e]:null},qyboot.getCookies=function(){var e,o,t,r=document.cookie.split(";"),n=r.length,s={};for(e=0;n>e;e++){o=r[e].substr(0,r[e].indexOf("="));t=r[e].substr(r[e].indexOf("=")+1);o=o.replace(/^\s+|\s+$/g,"");s[o]=unescape(t)}return s}),a="qyrememberaccount",i="qyuseremail",u="qyusertype",l="qyd"+qyboot.getCookieSuffix(),p="qyu"+qyboot.getCookieSuffix(),c="qys"+qyboot.getCookieSuffix(),d="qycv";qyboot.setCaptcha=function(e){r(d,e,60)};qyboot.saveEmail=function(e){if(e){qyboot.setLSItem(i,e);return qyremote.saveEmail(e)}window.localStorage.removeItem(i)};qyboot.getEmail=function(){return qyboot.getLSItem(i)};qyboot.removeEmail=function(){window.localStorage.removeItem(i)};qyboot.saveType=function(e){qyboot.setLSItem(u,e)};qyboot.getType=function(){return qyboot.getLSItem(u)};qyboot.removeType=function(){window.localStorage.removeItem(u)};qyboot.rememberAccount=function(e){e?qyboot.setLSItem(a,"rem"):window.localStorage.removeItem(a)};var y=qyboot.eraseSessionId=function(){n(c)};qyboot.eraseUserId=function(){n(l);n(p);y()};qyboot.getCurrentUser=function(e){if(qyboot.CurrentUser){if(!e)return qyboot.CurrentUser;if(qyboot.CurrentUser.verified)return qyboot.CurrentUser}var o=s(),t={logindomain:o[l],userid:o[p],sessionid:o[c],email:qyboot.getEmail(),type:qyboot.getType(),rememberAccount:qyboot.getLSItem(a)?!0:!1,verified:!1};if(e&&t.logindomain&&t.userid){var r=qyremote.verifySession();if(r.success&&0!=r.result){t.verified=!0;t.type=r.result;qyboot.saveType(t.type);"qiyun"==t.logindomain&&qyboot.addTrustedDomain(t.userid)}else{y();t.verified=!1}}qyboot.CurrentUser=t;return t};var f=navigator.userAgent;qyboot.is_opera=/opera/i.test(f);qyboot.is_webkit=!qyboot.is_opera&&/webkit/i.test(f);qyboot.is_mobile=qyboot.is_webkit&&/mobile/i.test(f);qyboot.is_ios=qyboot.is_webkit&&qyboot.is_mobile&&/(ipod|iphone|ipad)/i.test(f);qyboot.is_ie=/msie/i.test(f)&&!qyboot.is_opera&&!/mac_powerpc/i.test(f);qyboot.is_ie5=qyboot.is_ie&&/msie 5\.[^5]/i.test(f);qyboot.is_ie6=qyboot.is_ie&&/msie 6/i.test(f);qyboot.is_ie7=qyboot.is_ie&&/msie 7/i.test(f);qyboot.is_ie8=qyboot.is_ie&&/msie 8/i.test(f);qyboot.ie_box_model=qyboot.is_ie&&document.compatMode&&"BackCompat"==document.compatMode;qyboot.is_mac_ie=/msie.*mac/i.test(f);qyboot.is_khtml=/Konqueror|Safari|KHTML/i.test(f);qyboot.is_safari=/Safari/i.test(f);qyboot.is_safari3=qyboot.is_safari&&/Version\/3/i.test(f);qyboot.is_konqueror=qyboot.is_khtml&&!qyboot.is_safari3;qyboot.is_gecko=/gecko/i.test(f)&&!qyboot.is_khtml&&!qyboot.is_opera&&!qyboot.is_ie;qyboot.is_chrome=/Chrome/i.test(f);qyboot.is_w3=!qyboot.is_ie,qyboot.is_macintosh=/Macintosh/i.test(f);var m={},g=qyboot.getBaseURI().replace(/\/$/,"");qyboot.postMessage=function(e,o,t){var r=m[e];r&&r.postMessage&&r.postMessage({msg:o,data:t},g)};var b={};qyboot.addMsgHandler=function(e,o){b[e]?b[e].push(o):b[e]=[o]};qyboot.removeMsgHandler=function(e,o){if(o){if(b[e]){var t=b[e],r=t.indexOf(o);r>=0&&t.splice(r,1)}}else e?delete b[e]:b={}};window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent&&window.attachEvent("onmessage",e);qyboot.openWindow=function(e,o){o&&m[o]&&qyboot.is_gecko&&m[o].close();var t=window.open(e,o);m[o]=t;return t};var q={};qyboot.cancelConfirmLeave=function(e){null!=e||(e="default");delete q[e]};qyboot.confirmLeave=function(e,o){if(null==o){o=e;e="default"}q[e]&&q[e].msg?q[e].msg+="\n"+o:q[e]={msg:o}};window.onbeforeunload=function(e){e||(e=window.event);var t=o();if(""==t)return null;e.cancelBubble=!0;e.returnValue=t;if(e.stopPropagation){e.stopPropagation();e.preventDefault()}return t};var h=!0;qyboot.confirm_logout=function(e){h=e};window.onunload=function(){return}}();!function(){function e(e,o){return{synctime:o||qyboot.getCurrentUTCTime(),modified:!1,patches:null,encrypted:!e}}function o(e){return{content:e,synctime:qyboot.getCurrentUTCTime(),modified:!1}}qyboot.getCurrentUTCTime=function(){var e=new Date,o=e.getUTCFullYear(),t=e.getUTCMonth()+1,r=e.getUTCDate(),n=e.getUTCHours(),s=e.getUTCMinutes(),a=e.getUTCSeconds();return[o,t,r,n,s,a]};var t=qyboot.getTimeTuple=function(e){return"string"==typeof e?e:qyboot.Bert.tuple(qyboot.Bert.tuple(e[0],e[1],e[2]),qyboot.Bert.tuple(e[3],e[4],e[5]))},r=qyboot.getItem=function(e,o,t){var r=qyboot.getLocalStoragePath(e,o,t),n=qyboot.getLSItem(r);if(!n)return n;if(t)return n;try{return JSON.parse(n)}catch(s){window.localStorage.removeItem(r);return void 0}},n=qyboot.setItem=function(e,o,t,r){var n=qyboot.getLocalStoragePath(o,t,r),s=r?e:JSON.stringify(e);qyboot.setLSItem(n,s);return!0};qyboot.removeItem=function(e,o,t){var r=qyboot.getLocalStoragePath(e,o,t);window.localStorage.removeItem(r);return!0};qyboot.clearModule=function(e){for(var o=new RegExp("/(dev|deployed|debug|trash|beta)/"+e,"i"),t=window.localStorage.length,r=new Array,n=0;t>n;n++){var s=window.localStorage.key(n);o.test(s)&&r.push(s)}var a=r.length;for(n=0;a>n;n++){s=r[n];window.localStorage.removeItem(s)}return a};qyboot.saveFileItem=function(o,t,r,s){n(r,o,t,!0,s);var a=qyremote.uploadFile(o,t,r);if(a.success){var i=a.result,u=e(s,i);n(u,o,t);return i}throw"upload file to "+o+" "+t+"failed"};var s=qyboot.getFileItem=function(o,t,s,a){var i=qyboot.mapPath(o,t);o=i.PositionType;t=i.Path;var u=r(o,t,s);if(void 0!=u)return u;var l,p;if("deployed"==o)l=qyboot.getRemoteFile(t);else if("dev"==o){var c=qyremote.downloadFileWithMT(o,t);if(!c.success)throw"downloading file failed:"+c.result;p=c.result.substring(0,6);l=c.result.substring(6)}else l=qyboot.getRemoteFile(o+"/"+t);u=e(a,p);n(u,o,t);n(l,o,t,!0,a);return s?l:u},a=qyboot.updateFolderItem=function(e,t){var r=qyboot.mapPath(e,t);e=r.PositionType;t=r.Path;var s=qyremote.expandFolder(e,t);if(s.success){var a=o(s.result);n(a,e,t);return a}throw"expanding folder failed with "+s.result};qyboot.getFolderItem=function(e,o){var t=qyboot.mapPath(e,o);e=t.PositionType;o=t.Path;var n=r(e,o);return n?n:a(e,o)};qyboot.updateFileItem=function(o,a,i,u){var l=qyboot.mapPath(o,a);o=l.PositionType;a=l.Path;var p=r(o,a,i),c=r(o,a);if(!p||!c){qyboot.removeItem(o,a,i);p=s(o,a,i,u);return{updated:!0,item:p}}if(!window.navigator.onLine)return{updated:!1,item:p};var d=c.synctime,y=qyremote.downloadIfOldWithMT(o,a,t(d));if(y.success){if("//%%not_modified%%"==y.result)return{updated:!1,item:p};var f=y.result.substring(0,6),m=y.result.substring(6);p=e(u,f);n(p,o,a);n(m,o,a,!0,u);return{updated:!0,item:i?m:p}}console.info("update file item failed with "+y.result);console.info("using local version");return{updated:!1,item:p}}}();!function(){var e="QYLOCALE",o=qyboot.getDefaultLocaleName=function(){var o=window.localStorage.getItem(e);if(o)return o;var t=navigator.language&&r(navigator.language);return t||"en-US"},t={English:"en-US","en-US":"en-US",en_US:"en-US","英文":"en-US",Chinese:"zh-CN","zh-CN":"zh-CN",zh_CN:"zh-CN","中文":"zh-CN"},r=qyboot.mapLocaleName=function(e){return t[e]},n=o();qyboot.switchLocale=function(o){var t=r(o);if(n==t)return!1;n=t;window.localStorage.setItem(e,t);return!0};qyboot.clearDefaultLocaleName=function(){var o=window.localStorage.getItem(e);window.localStorage.removeItem(e);return o};var s=qyboot.getCurrentLocaleName=function(){return n};qyboot.qyLocale=function(){var e={};this.addLocale=function(o,t){e[o]=o in e?qyboot.mergeObj(e[o],t):t};this.get=function(o){var t=e[s()];if(!t)return o;var r=t[o];if(!r)return o;if("function"==typeof r&&arguments.length>1){var n=Array.prototype.slice.call(arguments,1);return r.apply(this,n)}return r}};window.DEFINE_LOCALE=function(e,o){var t=qyboot.getCurrentNameSpace();t.Locale||(t.Locale=new qyboot.qyLocale);t.Locale.addLocale(r(e),o)};qyboot.addBootLocale=function(e,o){qyboot.Locale||(qyboot.Locale=new qyboot.qyLocale);qyboot.Locale.addLocale(r(e),o)};qyboot.getSystemTime=function(e){var o=new Date;if(!e){var t=qyremote.getSystemTime();t.success&&t.result&&o.setTime(1e9*t.result[0]+1e3*t.result[1]+t.result[2]/1e3)}return o}}();!function(){function e(e){var o,t=new XMLHttpRequest;o=e&&e.url?e.url:qyboot.getBaseURI()+"qyrpc";e&&e.extend&&(o+="/"+e.extend);e&&e.query&&(o+=(e.isJson?"/?json=":"/?args=")+e.query);var r=e&&e.action||"POST",n=e&&e.async||!1;t.open(r,o,n);return t}function o(e){return escape(e).replace(/\+/g,"%2B").replace(/%20/g,"+").replace(/\*/g,"%2A").replace(/\//g,"%2F").replace(/@/g,"%40")}function t(t,r,n,s,u){defaultShowMessage(qyboot.Locale.get("loading..."),"Busy");n||(n=[]);var l=o(a(r,n,t.domainApp,s)),p=e({query:l,isJson:s});p.setRequestHeader("Content-Type","text/plain;charset=UTF-8");t.overrideMimeType&&p.overrideMimeType(t.overrideMimeType);p.send(u);clearMessage();if(4==p.readyState){var c,d=200==p.status;if(d&&t.return_plain)c=p.responseText;else{var y=i(p.responseText,s);c=y?y.result:null}var f={status:p.status,readyState:p.readyState,success:d,result:c};d||"please login first"!=c||showQyLogin();return f}return{success:!1,result:"readyState is not success",readyState:p.readyState,state:p.status}}function r(t,r,n,s,u,l){defaultShowMessage(qyboot.Locale.get("loading..."),"Busy");s||(s=[]);var p=o(a(n,s,r.domainApp,u)),c=e({query:p,async:!0,isJson:u});c.setRequestHeader("Content-Type","text/plain;charset=UTF-8");r.overrideMimeType&&c.overrideMimeType(r.overrideMimeType);c.onreadystatechange=function(){if(4==c.readyState){clearMessage();c.onreadystatechange=function(){};var e=200==c.status,o=e&&r.return_plain?c.responseText:i(c.responseText,u).result,n={status:c.status,readyState:c.readyState,success:e,result:o};e||"please login first"!=o||showQyLogin();t(n)}};c.send(l)}function n(e,o,r){var n;if(o.with_content){n=function(){var n=arguments.length,s=arguments[n-1];"string"==typeof s||s instanceof File||(s=r?l+JSON.stringify(s):qyboot.Bert.encode(s));var a=Array.prototype.slice.call(arguments,0,n-1);return t(o,e,a,r,s)};return n}n=function(){var n=Array.prototype.slice.call(arguments,0);return t(o,e,n,r)};return n}function s(e,o,t){var n;if(o.with_content){n=function(){if("function"==typeof arguments[0]){var n=arguments[0],s=arguments.length,a=arguments[s-1];"string"==typeof a||a instanceof File||(a=t?l+JSON.stringify(a):qyboot.Bert.encode(a));var i=Array.prototype.slice.call(arguments,1,s-1);r(n,o,e,i,t,a)}else{s=arguments.length;n=arguments[s-1];if("function"!=typeof n)throw"the last argument should be a function";a=arguments[s-2];"string"==typeof a||a instanceof File||(a=t?l+JSON.stringify(a):qyboot.Bert.encode(a));i=Array.prototype.slice.call(arguments,0,s-2);r(n,o,e,i,t,a)}};return n}n=function(){if("function"==typeof arguments[0]){var n=arguments[0],s=Array.prototype.slice.call(arguments,1);r(n,o,e,s,t)}else{var a=arguments.length;n=arguments[a-1];if("function"!=typeof n)throw"the last argument should be a function";s=Array.prototype.slice.call(arguments,0,a-1);r(n,o,e,s,t)}};return n}var a=qyboot.g_encode=function(e,o,t,r){var n={m:e,a:o},s=t?t:"qiyun/main";"qiyun/main"!=s&&(n.da=s);var a=r?JSON.stringify(n):qyboot.Bert.encode(n);return a},i=qyboot.g_decode=function(e,o){var t;if(!o){t=qyboot.Bert.decode(e);t.result=qyboot.Bert.g_decode(t.result);return t}try{t=JSON.parse(e);return t}catch(r){console.log("decode failed "+r);return null}},u={downloadFile:{params:"(PositionType,Path)",return_plain:!0,returns:"ok"},downloadBin:{remote:"downloadFile",params:"(PositionType,Path)",return_plain:!0,overrideMimeType:"text/plain; charset=x-user-defined",returns:"ok"},downloadFileWithMT:{params:"(PositionType,Path)",return_plain:!0,returns:"ok"},downloadIfOld:{params:"(PositionType,Path,DateTimeTuple)",return_plain:!0,returns:'if success, means downloads a new file. with result="//%%not_modified%%" means not changed'},downloadIfOldWithMT:{params:"(PositionType,Path,DateTimeTuple)",return_plain:!0,returns:'if success, means downloads a new file. with result="//%%not_modified%%" means not changed'},getConfig:{params:"(PositionType,projPath,numstr)",return_plain:!0},getUserConfig:{},updateUserConfig:{},pushProj:{},getFolderMTs:{},getFolderHashes:{},addProjToProjsJs:{},getSystemTime:{},getWeiXinSignature:{},pullProj:{},reportIssue:{},reportIssueWithImg:{with_content:!0},updateIssue:{},saveAppUserData:{with_content:!0},getAppUserData:{return_plain:!0},syncFolder:{},syncUser:{params:"()"},syncDeploy:{params:"(path)"},uploadFile:{params:"(PositionType,Path,Content)",with_content:!0,returns:"mt"},copyFile:{params:"(SourcePos,SourcePath,TargetPos,TargetPath)",returns:"ok"},applyTheme:{params:"(ProjPath,ThemeFile)",returns:"ok"},copyFolder:{params:"(SourcePos,SourcePath,TargetPos,TargetPath)",returns:"ok"},moveFile:{params:"(SourcePos,SourcePath,TargetPos,TargetPath)",returns:"ok"},makeFolder:{params:"(PositionType,Path)",returns:"ok"},expandFolder:{params:"(PositionType,Path)",returns:"{files:[list of filenames],folders:[list of folders]"},remove:{help:"delete either file or folder. if PositionType is dev, it will be \n                 moved to trash. Other types will be removed directly.",params:"(PositionType,Path)",returns:"ok"},rename:{help:"rename either file or folder.",params:"(PositionType,SourcePath,NewName)",returns:"ok"},clearAllTrash:{params:"()",returns:"ok"},createSln:{params:"(Path)",returns:"ok"},forkSln:{help:"fork solution",params:"(SourcePath,Targetpath)",returns:"Msg"},syncSln:{help:"if sourcepath has new projects, fork them into the targetpath",params:"(SourcePath,Targetpath)",returns:"ok"},getSlnDetails:{help:"get project details in solution",params:"(SlnPath)",returns:"[{proj,result}...]"},getProjDetails:{help:"get project details",params:"(ProjPath)",returns:"[{proj,result}...]"},listSlnDiff:{help:"get project details in both sourcepath and targetpath",params:"(SourcePath,Targetpath)",returns:"[[{proj,result}..],[{proj,result}]]"},listProjDiff:{help:"get project details in both sourcepath and targetpath",params:"(SourcePath,Targetpath)",returns:"[[{proj,result}..],[{proj,result}]]"},pushSln:{help:"push sln",params:"(SourceSlnPath,TargetSlnPath)",returns:"[Msgs]"},pushProj:{help:"push proj",params:"(SourceProjPath,TargetProjPath)",returns:"Msg"},deploySln:{help:"OptionObj can be\nTargetPath:Path to hold the deploy, default is SourcePath\nPositionType:'deployed or debug', default is 'deployed'\nUglify:'none,uglify or uglify_compress' default is none for debug, uglify_compress for deployed\nForceUpdate:'true or false' default is false.",params:"(SourcePath,OptionObj)",returns:"ok"},getProjTemplates:{params:"()",returns:"[proj template names]"},createProj:{params:"(ProjType,Path)",returns:"ok"},createProjsJs:{params:"()",returns:"ok"},createSite:{params:"(Path,SiteHtml,InitVC)",returns:"ok"},createProjWithSln:{params:"(SlnPath,ProjType,ProjName)",returns:"ok"},initVersionControl:{params:"(Path)",returns:"Msg"},deployProj:{params:"(SourcePath,OptionObj)",returns:"ok"},compileRpc:{params:"(SourcePath)",returns:"ok"},createRpcFile:{params:"(user/proj/rpc/file.extension)",returns:"timestamp"},packForDeploy:{params:"(proj path)",returns:"path to download"},packProj:{},packSln:{},createPack:{},uploadProj:{with_content:!0},uploadSln:{with_content:!0},compileDps:{params:"(SourcePath)",returns:"ok"},syncRedirectProj:{params:"(ProjPath1,ProjPath2,OptionObj)",returns:"ok"},forkProj:{params:"(ForkedPath,ForkToPath)",returns:"Msg"},createRedirectProj:{params:"(ForkedPath,ForkToPath)",returns:"Msg"},addProjToWeb:{help:"add proj to projs.config and to hgweb",params:"(Path)",returns:"ok"},removeProjFromWeb:{help:"remove proj from projs.config and from hgweb",params:"(Path)",returns:"ok"},updateProj:{help:"update project to revision. if no RevisionInt update to latest revision",params:"(Path,RevisionInt)",returns:"Msg"},getProjStatus:{help:"get project status on server. if no change msg is empty",params:"(Path)",returns:"Msg"},getProjDiff:{help:"get project diff",params:"(Path,[Rev1,Rev2])",returns:"Msg"},getProjRevision:{help:"get project revision on server.",params:"(Path)",returns:"Revison"},getProjLog:{help:'Revision is either "tip" or a number. returns at most 20 changesets from Revision',params:"(path,Revision)",return_plain:!0,returns:"log"},revertFiles:{help:"revert changes on server.",params:"(Path[,Files])",returns:"Msg"},commitProj:{help:"commit changes on server.",params:"(Path,CommitMsg[,ModifiedFiles,ToAddFiles,ToRemoveFiles])",returns:"Msg"},getAccessableProjs:{params:"(AccessedUserId)"},getHgPassword:{help:"get hg password in email",params:"()",returns:"Msg"},resetHgPassword:{help:"reset and get hg password in email",params:"()",returns:"Msg"},getUserDBs:{params:"(PositionType,UserId)"},isDBCreated:{params:"(PositionType,Path)"},initDB:{params:"(PositionType,Path,InitSqlScript)",with_content:!0},initMainDB:{help:"init userid/main db for user management. It will create user table with userid, password and dasessionid",params:"()"},pauseDB:{params:"(PositionType,Path)"},copyDB:{params:"(SrcPositionType,SrcPath,DestPositionType,DestPath)"},resumeDB:{params:"(PositionType,Path)"},dropDB:{params:"(PositionType,Path)"},attachDB:{params:"(SrcPos,SrcPath,DestPos,DestPath,DBName)"},detachDB:{params:"(Pos,Path,DBName)"},getSchema:{params:"(PositionType,Path)"},execSql:{params:"(PositionType,Path,SqlScript)",with_content:!0},getTotalCount:{},verifySession:{params:"()",help:"verify whether the session is valid"},createCaptcha:{params:"()"},verifyCaptcha:{params:"()"},login:{params:"(domain,userid,password)",returns:"object of user information",help:"if success, a seesion id is set through cookie."},createGuest:{params:"()",returns:"object of user information"},logout:{params:"()",returns:"true/false"},checkDomainExists:{params:"domainname",returns:"true/false"},checkUserNameAvailable:{params:"(userid)",returns:"true/false"},checkEmailAddressAvailable:{params:"(emailaddress)",returns:"true/false"},checkEmailAddressActivated:{params:"(emailaddress)",returns:"true/false"},registerUser:{params:"([email,]userid,password)",returns:"true/false",need_captcha:!0},createUser:{params:"([Userid,password,email)",returns:"ok"},getAllUsers:{returns:"[user1,user2...]"},changePassword:{params:"(oldPassword,newPassowrd)",returns:"ok"},activateUser:{params:"(email)",returns:"ok"},resetPassword:{params:"(userid)",returns:"ok",need_captcha:!0},saveEmail:{params:"emailAddress",returns:"ok"},getModConnectedUsers:{}},l=String.fromCharCode(11)+String.fromCharCode(20)+String.fromCharCode(4)+String.fromCharCode(1);qyboot.set_rpc_commands=function(e,o){if(!o){o=e;e=qyboot}"remote"in e||(e.remote={});"remote_async"in e||(e.remote_async={});"json_remote"in e||(e.json_remote={});"json_remote_async"in e||(e.json_remote_async={});for(var t in o){var r=o[t],a=r.remote||t;/^postContent_/.test(a)&&(r.with_content=!0);e.json_remote[t]=n(a,r,!0);e.json_remote_async[t]=s(a,r,!0);e.remote[t]=e.json_remote[t];e.remote_async[t]=e.json_remote_async[t]}e.rpc_commands_desc=qyboot.mergeObj(e.rpc_commands_desc,o)};qyboot.set_rpc_commands(qyboot,u)}();!function(){function e(e,o){var t=qyboot.SLN(e),r=qyboot.getLatestConfigFile(t);if(!r||!r.content)return qyboot.updateProj(o);try{var n=JSON.parse(r.content);qyboot.g_Updated[e]=n;qyboot.saveToLS(t,r.content);var s=qyboot.getProjConfigFromSlnConfig(n,o);return qyboot.updateProjByConfig(null,s,o)}catch(a){return qyboot.updateProj(o)}}function o(e,o,t){e=/^\//.test(e)?e.substr(1):qyboot.getNameToUse(e);if(!window.QYCOMPILED&&!qyboot.isTrustedDomain(e)){var r=qyboot.getDomain(e);if(!qyboot.isTrustedDomain(r)){if(!confirm(qyboot.Locale.get("confirm_using_code")(e)))throw qyboot.Locale.get("stop using code from ")+e;qyboot.addTrustedDomain(confirm(qyboot.Locale.get("confirm_adding_trusted_user")(r))?r:e)}}console.info("using "+(t?"webapp ":"")+e);var n=qyboot.getModule(e);if(n)return o?o(n.modexports):n.modexports;var s=null,a=null;s=qyboot.qyUpdateProj(e);if(!s){console.info("no "+e);return null}if(o)qyboot.addOneModule(e,s,a,!0,o,t);else try{var i=qyboot.addOneModule(e,s,a,!0,o,t);return i}catch(u){var l=e+"/proj.config";qyboot.removeItem("deployed",l,!0);throw u}}qyboot.filename=function(e){return e.substring(e.lastIndexOf("/")+1)};qyboot.dirname=function(e){return e.substring(0,e.lastIndexOf("/"))};qyboot.getProjConfigFromSlnConfig=function(e,o){if(!e||!e.projs)return null;for(var t=e.projs,r=t.length,n=qyboot.filename(o),s=0;r>s;s++)if(t[s].path==n)return t[s];return null};qyboot.SLN=function(e){return e+"/sln.config"};qyboot.getLatestConfigFile=function(e,o){if(!o){var t=qyboot.getRemoteFile(e);return t?{updated:!0,content:t}:!1}var r=qyboot.mapPath(e),n=qyremote.downloadIfOld(r.PositionType,r.Path,o);if(n.success)return"//%%not_modified%%"==n.result?{updated:!1}:{updated:!0,content:n.result};console.log("download "+e+" failed.");return!1};qyboot.g_Updated={};var t=(qyboot.updateProj=function(e){if(qyboot.g_Updated[e])return qyboot.g_Updated[e];var o=qyboot.PROJ(e),r=qyboot.getFromLS(o);if(r&&!window.navigator.onLine){qyboot.g_Updated[e]=r;return r}if(r){var n=qyboot.mapPath(e);if("qiyun/qyboot"!=n.Path&&"debug"!=n.PositionType&&"beta"!=n.PositionType){qyboot.bgUpdateProj(e);qyboot.g_Updated[e]=r;return r}}var s=r&&r.mt,a=qyboot.getLatestConfigFile(o,s);if(!a||!a.updated){qyboot.g_Updated[e]=r;return r}var i=a.content;if(!i){qyboot.g_Updated[e]=r;return r}var u=JSON.parse(i);return t(r,u,e)},qyboot.updateProjByConfig=function(e,o,t){qyboot.g_Updated[t]=o;if(e&&e.mt==o.mt)return e;for(var r=qyboot.makeMap(e,t),n=qyboot.makeMap(o,t),s=qyboot.getReleaseFiles(o,t),a=s.length,i=qyboot.getReleaseMts(o,t),u=0;a>u;u++){var l=s[u],p=i[u];if(r[l]!=p){var c=t+"/"+l,d=qyboot.getRemoteFile(c);null!=d&&qyboot.saveToLS(c,d)}}if(e){s=qyboot.getReleaseFiles(e,t),a=s.length;i=qyboot.getReleaseMts(e,t);for(u=0;a>u;u++){l=s[u];p=i[u];if(!n[l]){c=t+"/"+l;qyboot.removeFromLS(c)}}}qyboot.saveToLS(qyboot.PROJ(t),o);return o});qyboot.qyUpdateSlnProjs=function(e){for(var o=qyboot.dirname(e),t=qyboot.getSlnUsedProjs(o),r=0;r<t.length;r++){var n=t[r];qyboot.updateProj(n)}qyboot.g_Updated[o]=!0;return qyboot.updateProj(e)};qyboot.qyUpdateProj=function(o){if("127.0.0.1"==qyboot.getHostName())return qyboot.updateProj(o);var t=qyboot.mapPath(o);if("debug"==t.PositionType||"beta"==t.PositionType||"qiyun/qyboot"==t.Path)return qyboot.updateProj(o);if(o in qyboot.g_Updated)return qyboot.g_Updated[o];var r=qyboot.dirname(o),n=qyboot.dirname(r);if(!n||"debug"==n||"beta"==n||"public"==n)return qyboot.updateProj(o);if(r in qyboot.g_Updated)return qyboot.updateProj(o);var s=qyboot.getFromLS(qyboot.SLN(r));if(!s)return e(r,o);qyboot.g_Updated[r]=s;var a=qyboot.getSlnUsedProjs(r),i=a.length;qyboot.bgUpdateSln(r,s,a);for(var u=0;i>u;u++){var l=a[u];qyboot.g_Updated[l]=qyboot.getFromLS(qyboot.PROJ(l))}return o in qyboot.g_Updated?qyboot.g_Updated[o]:qyboot.updateProj(o);var t};qyboot.getSlnUsedProjs=function(e){for(var o,t=qyboot.getLsPath(e),r=new RegExp("^"+t+"/([^/]+)/proj.config$"),n=window.localStorage.length,s=[],a=0;n>a;a++){o=window.localStorage.key(a);var i=r.exec(o);i&&i[1]&&s.push(e+"/"+i[1])}return s};var r={qiyun:!0};qyboot.addTrustedDomain=function(e){r[e]=!0};qyboot.isTrustedDomain=function(e){if(e in r)return!0;var o=qyboot.getCurrentUser();return"qiyun"==o.logindomain?o.userid==e:!1};qyboot.getNameToUse=function(e){var o=qyboot.mapPath(e);if("deployed"==o.PositionType){var t=qyboot.getPrefix();qyboot.getDomainApp()==e&&(e=t+e)}return e};window.using=o}();!function(){qyboot.fc="return qyboot.qyapply(arguments.callee,arguments,this)"}();!function(){function e(e,o){qyboot.setWebapp(e);var t=using(e,o,!0);return t}function o(e){var o=[],t=0,r=e.length;for(t=0;r>t;t++)e[t]&&o.push(e[t]);return o}function t(e,t){for(var r=o(e.split("/")),n=o(t.split("/"));n.length>0&&".."==n[0];){n.shift();r.pop()}var s=r.concat(n).join("/");return s}function r(e,o){return n("../"+e,o)}function n(e,o){var t=qyboot.getCurrentNSName();return s(t,e,o)}function s(e,o,r){var n=t(e,o);return using(n,r)}function a(e){var o=qyboot.getCurrentNSName();if(!o)return null;var t=o.replace(/_css$/,"");return using(t,e)}function i(e){var o=qyboot.getCurrentNSName();if(!o)return null;var t=o+"_css";return using(t,e)}function u(e){var o=qyboot.getCurrentNSName();if(!o)return null;var t=o.split("/");t.pop();t.push(t[t.length-1].replace(/_sln(.)*/,"_sln")+"_css");var r=t.join("/");return using(r,e)}function l(e,o,t){return using("public/"+e,o,t)}function p(e,o,t){return using("debug/"+e,o,t)}function c(e){return d("../"+e)}function d(e){var o=qyboot.getCurrentNSName(),r=t(o,e);return y(r)}function y(e){e=/^\//.test(e)?e.substr(1):qyboot.getNameToUse(e);console.info("using_rpc "+e);var o=P(e);if(o)return o.modexports;var t=e+"/@rpc";o=P(t);if(o)return o.modexports;var r=qyboot.getRemoteFile(e+"/proj.config");if(null==r)throw e+"not found";for(var n=JSON.parse(r).modrelease,s="",a=0;a<n.length;a++){var i=n[a];if(/^rpc\//.test(i)){var u=qyboot.getRemoteFile(e+"/"+i);u&&(s+="\n"+u)}}var l=s;qyboot.pushNSName(t);qyboot.pushJsName(_);try{q(t,_,l)}catch(p){console.error("using_rpc "+e+" with error:"+p)}qyboot.popJsName();qyboot.popNSName();return w[t].modexports}function f(e,o){if(o){var t=0,r=o.length;for(t=0;r>t;t++)s(e,"../"+o[t])}}function m(){var e,o=[],t=arguments.length;for(e=0;t>e;e++)arguments[e]&&(o=o.concat(arguments[e]));return o}function g(e,o,t){var r=o.length,n=0;qyboot.pushNSName(e);for(var s=0;r>s;s++){var a=o[s],i=e+"/"+a;!function(s){qyboot.getRemoteFile_async(i,function(i,u){try{var l=i,p=fileItem();setItem(p,"deployed",l);setItem(u,"deployed",l,!0,p.encrypted);if(n==s){for(;r>n&&p;){h(e,a);a=o[++n];p=getItem("deployed",e+"/"+a)}if(n==r){var c=using(e);t(c);qyboot.popNSName()}}}catch(d){
qyboot.removeItem("deployed",e+"/proj.config",!0);throw d}})}(s)}}function b(e){var o=document.createElement("script");o.type="text/javascript";o.src=e;"undefined"!=typeof o&&document.getElementsByTagName("head")[0].appendChild(o)}function q(e,o,t){if(t){var r=e+"/"+o;try{if(qyboot.isqyc(t)){S(o+" enc");qyboot.qyload(t)}else{qyboot.isxor(t)&&(t=qyboot.dexor(t));if(/^debug\//.test(e)){S(o+" dbg");qyboot.evalClean(t+"\n//@ sourceURL="+r,r)}else{S(o);qyboot.evalClean_wrap(t,r)}}}catch(n){throw n}S(o+" done")}}function h(e,o,t){if(!o){o=e;e=qyboot.getCurrentNSName()}var r=P(e);if(!r){r=using(e);if(!r)return null}if(o in r.jsfileObjs)return r.jsfileObjs[o].exports;qyboot.pushJsName(o);if(t){r.jsfileObjs[o]={exports:{}};var n=qyboot.getBaseURI()+e+"/";b(n+o)}else{var s=e+"/"+o,a=qyboot.mapPath(s),i=qyboot.getFileItem(a.PositionType,a.Path,!0);r.jsfileObjs[o]={exports:{}};try{q(e,o,i)}catch(u){qyboot.removeFromLS(s);i=qyboot.getFileItem(a.PositionType,a.Path,!0);console.log("reload "+s);try{q(e,o,i)}catch(u){console.error(s+" with error:"+u);showMessage(s+" error:"+u)}}}qyboot.popJsName();return r.jsfileObjs[o].exports}function v(){var e=qyboot.getDomainApp();if("http"==qyboot.getProto())return e;""==e?e="qiyun/main":e.indexOf("/")<0&&(e+="/main");return e}var w=qyboot.g_Modules={},P=(qyboot.g_CssFiles={},qyboot.getModule=function(e){return e in w?w[e]:null});qyboot.getDomain=function(e){var o=qyboot.mapPath(e),t=o.Path.split("/")[0];return t};qyboot.setWebapp=function(e){var o=qyboot.getDomain(e);qyboot.addTrustedDomain(o);var t=/^(debug|beta)\//.exec(qyboot.getPrefix());window.document.title=(t?t[0]:"")+qyboot.filename(e)};qyboot.namespace_relative_using=s;window.using_root_slncss=function(e,o){var t=qyboot.getCurrentNSName();if(!t)return null;var r=qyboot.mapPath(t),n=r.Path.split("/");n.pop();n[0]="deployed"==r.PositionType?o:r.PositionType+"/"+e;var s=n.pop();n.push(s.replace(/_sln(.)*/,"_sln")+"_css");var a=n.join("/");return using(a)};window.using_qy_slncss=function(){return using_root_slncss("shbzhumg_qiyun/qycss","qiyun/qycss")};window.using_root_projcss=function(e,o){var t=qyboot.getCurrentNSName();if(!t)return null;var r=qyboot.mapPath(t),n=r.Path.split("/");n[0]="deployed"==r.PositionType?o:r.PositionType+"/"+e;var s=n.pop();n.push(s.replace(/(_dev)?$/,"_css"));var a=n.join("/");return using(a)};window.using_qy_projcss=function(){return using_root_projcss("shbzhumg_qiyun/qycss","qiyun/qycss")};var _="proj.rpc.client.js",S=qyboot.qydebug=qyboot.debug?function(e){console.log(e)}:function(){},j=qyboot.createDeployList=function(e,o){for(var t=["cssfiles","locales","rpcclient","jsfiles"],r=[],n=t.length,s=0;n>s;s++)r=m(r,e[o+t[s]]);return r};qyboot.addOneModule=function(e,o,t,r,n,s){f(e,o.modinsidedeps);var a=/^debug\//.test(e),i=!a&&o.moddeploy?o.moddeploy:j(o,"mod"),u=!a&&o.webappdeploy?o.webappdeploy:j(o,"webapp"),l=o.modrelease,p=o.webapprelease;l||(l=i);p||(p=u);if(s){f(e,o.webappinsidedeps);l=l.concat(p)}if(r||!n){qyboot.pushNSName(e,s);var c,d,y=l.length;for(d=0;y>d;d++){c=l[d];c.filename&&(c=c.filename);/.css$/.test(c)?qyboot.addCssFile(e,c,t,r):/.js$/.test(c)&&h(e,c,t,r)}qyboot.popNSName();return w[e].modexports}g(e,o.modjsfiles,n)};var T=qyboot.exports_desc={require:{value:h,params:"(modName,jsfile)",returns:"exportObj",help:"get exports from jsfile."},using:{value:using,params:"(modName)",returns:"modexportObj",help:"load module and all depending modules"},getModules:{value:function(){return w},params:"()",returns:"[modobjs]",help:"get all loaded modules"}};qyboot.set_export_desc(T);window.using=using;window.using_public=l;window.using_debug=p;window.using_webapp=e;window.using_rpc=y;window.inside_using=r;window.inside_using_css=i;window.inside_using_code=a;window.inside_using_slncss=u;window.inside_using_rpc=c;window.relative_using=n;window.relative_using_rpc=d;window.qyjsonremote=qyboot.json_remote;window.qyjsonremote_async=qyboot.json_remote_async;window.qybertremote=qyboot.remote;window.qybertremote_async=qyboot.remote_async;window.qyremote=qyjsonremote;window.qyremote_async=qyjsonremote_async;window.qyremote.rpc_commands_desc=qyboot.rpc_commands_desc;window.SelfModName=v}();!function(){function e(){var e=t.length;return e>0?t[e-1]:null}var o,t=[];qyboot.pushNameSpace=function(e){if(e instanceof Object){var r=t.push(e);o=e;return r}};qyboot.popNameSpace=function(){var r=t.pop();o=e();return r};qyboot.getCurrentNameSpace=function(){return o};qyboot.getCurrentModName=function(){return o?o.modName:null};var r=[],n=[];qyboot.addModObjToGlobal=function(e){var o={modName:e,modexports:s(e),jsfileObjs:{},cssfiles:{}};qyboot.g_Modules[e]=o;return o};qyboot.pushNSName=function(e,o){r.push(e);var t=qyboot.addModObjToGlobal(e);o&&(window.SelfMod=t.modexports)};qyboot.getCurrentNSName=function(){return 0==r.length?qyboot.getPrefix()+SelfModName():r[r.length-1]};qyboot.popNSName=function(){r.pop()};qyboot.pushJsName=function(e){n.push(e)};qyboot.getCurrentJsName=function(){return 0==n.legth?null:n[n.length-1]};qyboot.popJsName=function(){n.pop()};var s=function(e){var o={modName:e,Locale:new qyboot.qyLocale,inside_using:function(o,t){return qyboot.namespace_relative_using(e,"../"+o,t)},relative_using:function(o,t){return qyboot.namespace_relative_using(e,o,t)},confirmLeave:function(o){return o?qyboot.confirmLeave(e,o):qyboot.cancelConfirmLeave(e)},addRemoteFun:function(e){var o={};o[e]={};qyboot.set_rpc_commands(this,o)}};o.ws_onReply=function(e){o.ws_Result=e};o.ws_onError=function(e){console.log("websocket error:"+JSON.stringify(e));o.ws_Result=e};return o}}();!function(){function e(){var e="http"==qyboot.getProto()?"ws":"wss";this.beforeOpenMsg=[];this.wsAddress=e+"://"+qyboot.getHostAddress()+"/qyws/qiyun/main";var t=window.WebSocket||window.MozWebSocket;if(t){this.websocket=new t(this.wsAddress);this.websocket.onopen=this.onopen.bind(this);this.websocket.onclose=this.onclose.bind(this);this.websocket.onmessage=this.onmessage.bind(this);this.websocket.onerror=this.onerror.bind(this);this.connectedUsers={};var r=this;this.addEventListener("connected",function(e){e=o(e);e==r.userName||r.connectedUsers[e]?r.connectedUsers[e]++:r.connectedUsers[e]=1});this.addEventListener("closed",function(e){e=o(e);e!=r.userName&&r.connectedUsers[e]&&(--r.connectedUsers[e]||delete r.connectedUsers[e])})}else console.log("websocket is not supported in this browser.")}function o(e){return e&&e.replace(/^qiyun\//,"")}window.QyWebSocket=e;e.prototype.getConnectedUsers=function(){var e=[];for(var o in this.connectedUsers)this.connectedUsers[o]&&e.push(o);return e};e.prototype.connect=function(e){this.userName=qyboot.getCurrentUser().userid;this.domainApp=e||qyboot.getDomainApp();var t=qyremote.getModConnectedUsers(this.domainApp);if(t.success)for(var r=t.result,n=0;n<r.length;n++){var s=o(r[n]);s!=this.userName&&(this.connectedUsers[s]?this.connectedUsers[s]++:this.connectedUsers[s]=1)}this.send_Internal("connect");this.dispatchEvent("connect")};e.prototype.sendMsg=function(e,o,t){o?o instanceof Array||(o=[o]):o=[];t||(t="*ALL*");o.unshift(e,t);this.send_Internal("send",o)};e.prototype.send_Internal=function(e,o){if(this.websocket){o?o instanceof Array||(o=[o]):o=[];o.unshift(this.domainApp||qyboot.getDomainApp());var t={method:e,args:o},r=JSON.stringify(t);1==this.websocket.readyState?this.websocket.send(r):beforeOpenMsg.push(r)}};e.prototype.close=function(){this.websocket&&this.websocket.close()};e.prototype.onopen=function(){console.log("websocket opened");this.dispatchEvent("open");if(this.websocket){for(var e=0;e<this.beforeOpenMsg.length;e++)this.websocket.send(this.beforeOpenMsg[e]);this.beforeOpenMsg=[]}};e.prototype.onmessage=function(e){if(e.data){var o=JSON.parse(e.data);this.from=o.from;this.dispatchEvent(o.method||o.m,o.args||o.a)}};e.prototype.onclose=function(){this.dispatchEvent("close");this.websocket=null;console.log("websocket closed")};e.prototype.onerror=function(e){console.log("websocket error:",e)};e.prototype.addEventListener=function(e,o){this.eventHandlers||(this.eventHandlers={});this.eventHandlers[e]||(this.eventHandlers[e]=[]);var t=this.eventHandlers[e];t.indexOf(o)<0&&t.push(o)};e.prototype.dispatchEvent=function(e,o){if(this.eventHandlers&&this.eventHandlers[e])for(var t=this.eventHandlers[e],r=0;r<t.length;r++)t[r].apply(this,o)}}();!function(){qyboot.addCssFile=function(e,o){var t=e+"/"+o;if(!(t in qyboot.g_CssFiles)){qyboot.debug&&qyboot.qydebug(o);var r=qyboot.mapPath(t),n=qyboot.getFileItem(r.PositionType,r.Path,!0);qyboot.addCssFileContent(e+"/"+o,n);qyboot.g_CssFiles[t]=e;qyboot.qydebug(o+" done")}};qyboot.addCssFileContent=function(e,o){if(!o)return null;var t=qyboot.getBaseURI()+e;t=t.substring(0,t.lastIndexOf("/")+1);var r=o.replace(/url\("([^/])/g,'url("'+t+"$1");r=r.replace(/url\('([^/])/g,"url('"+t+"$1");r=r.replace(/url\(([^'"/][^'")]+)\)/g,"url('"+t+"$1')");r="/*"+e+"*/\n"+r;var n=document.createElement("style");n.type="text/css";if(n.styleSheet)n.styleSheet.cssText=r;else{var s=document.createTextNode(r);n.appendChild(s)}var a=document.getElementsByTagName("head")[0];a.appendChild(n);return n};qyboot.applyCss=function(e,o){qyboot.addCssFileContent(e,o)}}();!function(){function e(e){return e.match(/\/qybase$/)?!0:!1}qyboot.isqybase=function(o){return o&&o.modName?e(o.modName):!1};qyboot.forbidLoadDefaultBase=function(){qyboot.baseLoaded=!0};window.DEFINE_NAMESPACE=function(){var o,t,r,n=!1;switch(arguments.length){case 1:r=arguments[0];break;case 2:o=arguments[0];r=arguments[1];n=!0;break;case 3:o=arguments[0];t=arguments[1];r=arguments[2];n=!0;break;default:return null}if(n)qyboot.pushNSName(o);else{var s=qyboot.getCurrentNSName();s&&(o=s)}if(!t){var a=qyboot.getCurrentJsName();a&&(t=a)}if(!qyboot.baseLoaded){e(o)||using("qiyun/qybase");qyboot.baseLoaded=!0}var i=qyboot.getModule(o)||qyboot.addModObjToGlobal(o),u=i.modexports;i.jsfileObjs[t]={exports:u};qyboot.pushNameSpace(u);r(u);n&&qyboot.popNSName();return qyboot.popNameSpace()}}();!function(){function e(e){var o=qyboot.getCurrentUser();return o&&o.userid?o.userid+"/"+e.replace(/\//,"_")+".config":null}qyboot.getServerFilePath=function(e){return qyboot.getBaseURI()+"file/"+qyboot.getPrefix()+SelfModName()+"/"+e};qyboot.getUserProjs=function(e){if(!e){var o=qyboot.getCurrentUser();if(!o||!o.userid)return null;e=o.userid}var t=qyboot.updateFileItem("dev",e+"/projs.js",!0);return t&&t.item?JSON.parse(t.item):null};qyboot.getUserProjsByType=function(e,o){var t=[],r=qyboot.getUserProjs(e);if(!r||!r.projs)return t;for(var n in r.projs){var s=r.projs[n];if(s.type==o){var a=s;a.path=n;t.push(a)}}return t};qyboot.getUserSites=function(e){return qyboot.getUserProjsByType(e,"site")};qyboot.getUserFormApps=function(e){return qyboot.getUserProjsByType(e,"form")};qyboot.getUserDataBeans=function(e){return qyboot.getUserProjsByType(e,"databean")};qyboot.getUserFreeForms=function(e){return qyboot.getUserProjsByType(e,"freeform")};qyboot.getPreference=function(o){var t=e(o);if(!t)return null;try{var r=qyboot.getFileItem("dev",t,!0);return r?JSON.parse(r):{}}catch(n){return{}}};qyboot.savePreference=function(o,t){var r=e(o);if(!r)return null;var n=JSON.stringify(t);return qyboot.saveFileItem("dev",r,n,!0)}}();!function(){function e(){console.log("websocket opened");for(var e=0;e<l.length;e++)i.send(l[e]);l=[]}function o(){for(var e in u){var o=u[e];o.onWsClose&&o.onWsClose()}u={};i=null;console.log("websocket closed")}function t(e){if(e.data){var o=JSON.parse(e.data);if(o.domainApp&&o.method){var t=u[o.domainApp];t&&t[o.method]&&t[o.method].apply(t,o.args)}}}function r(){console.log("websocket closed")}function n(){if(i)return i;if(!p){console.log("websocket is not supported in this browser.");return null}var n="http"==qyboot.getProto()?"ws":"wss",s=n+"://"+qyboot.getHostAddress()+"/qyws/qiyun/main";i=new p(s);i.onopen=e;i.onclose=o;i.onmessage=t;i.onerror=r;return i}function s(e,o){var t=qyboot.getCurrentNSName();return function(){if(!u[e]&&"ws_Connect"!=o)throw"need to call ws_Connect first.";var r=Array.prototype.slice.call(arguments,0),n={method:o,args:r,domainApp:e||"qiyun/main"},s=JSON.stringify(n);qyboot.sendToWs(s);var a=qyboot.getModule(t);a&&a.modexports&&(a.modexports.ws_Result=void 0);"ws_Connect"==o?a&&a.modexports&&(u[e]=a.modexports):"ws_Disconnect"==o&&delete u[e]}}function a(e){e&&(e.parentNode?e.parentNode.removeChild(e):e.style&&(e.style.disply="none"))}var i,u={},l=[],p=window.WebSocket||window.MozWebSocket;qyboot.closeWebSocket=function(){i&&i.close()};qyboot.sendToWs=function(e){(i||n())&&(1==i.readyState?i.send(e):l.push(e))};qyboot.set_ws_remote_commands=function(e,o){if(!o){o=e;e=qyboot}for(var t in o){var r=o[t],n=r.domainApp||"qiyun/main";e[t]=s(n,t)}e.ws_remote_commands_desc=qyboot.mergeObj(e.ws_remote_commands_desc,o)};qyboot.tryCreateGuest=function(){if("https"!=qyboot.getProto()){var e=qyboot.getCurrentUser();if(e.userid&&"qiyun"==e.logindomain)/^Guest_/.test(e.userid)&&qyremote.login("qiyun",e.userid,e.userid);else{qyremote.createGuest();qyboot.rememberAccount(!0)}}};qyboot.removeLoadingImg=function(){var e="QYIDE_Desktop_loading";a(document.getElementById(e));for(var o=document.getElementsByClassName?document.getElementsByClassName(e):[],t=0;t<o.length;t++)a(o[t])};var c={};c.addDependency=function(e,o,t){return goog?goog.addDependency(c.getDepPath(e),o,t):null};c.getDepPath=function(e){return"../../../../"+qyboot.getDebugMode()+qyboot.getDomainApp()+"/"+e};window.qycloud=c}();
!function(){qyboot.addBootLocale("en_US",{confirm_logout:function(o){return"You still log in to "+o+". Do you like to logout now?"},confirm_using_code:function(o){return"Using code from "+o+". Are you sure to continue?\nWarning: using code from untrusted user will be dangerous. "},confirm_adding_trusted_user:function(o){return"Add "+o+" to trusted users?"}});qyboot.addBootLocale("zh_CN",{"loading...":"加载中...",confirm_logout:function(o){return"你仍登录在 "+o+"。现在退出？"},confirm_using_code:function(o){return"将使用 "+o+" 的代码。 确认继续?\n警告：使用不被信任的用户代码将会带来危害。"},"stop using code from ":"停止使用",confirm_adding_trusted_user:function(o){return"把 "+o+" 加为受信任用户？"}})}();
!function(e,t){"use strict";function n(){if(!i.READY){T.determineEventTypes();E.each(i.gestures,function(e){M.register(e)});T.onTouch(i.DOCUMENT,d,M.detect);T.onTouch(i.DOCUMENT,f,M.detect);i.READY=!0}}var i=function y(e,t){return new y.Instance(e,t||{})};i.VERSION="1.1.3";i.defaults={behavior:{userSelect:"none",touchAction:"pan-y",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};i.DOCUMENT=document;i.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled;i.HAS_TOUCHEVENTS="ontouchstart"in e;i.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent);i.NO_MOUSEEVENTS=i.HAS_TOUCHEVENTS&&i.IS_MOBILE||i.HAS_POINTEREVENTS;i.CALCULATE_INTERVAL=25;var r={},a=i.DIRECTION_DOWN="down",o=i.DIRECTION_LEFT="left",s=i.DIRECTION_UP="up",c=i.DIRECTION_RIGHT="right",u=i.POINTER_MOUSE="mouse",l=i.POINTER_TOUCH="touch",h=i.POINTER_PEN="pen",p=i.EVENT_START="start",d=i.EVENT_MOVE="move",f=i.EVENT_END="end",g=i.EVENT_RELEASE="release",v=i.EVENT_TOUCH="touch";i.READY=!1;i.plugins=i.plugins||{};i.gestures=i.gestures||{};var E=i.utils={extend:function(e,n,i){for(var r in n)!n.hasOwnProperty(r)||e[r]!==t&&i||(e[r]=n[r]);return e},on:function(e,t,n){e.addEventListener(t,n,!1)},off:function(e,t,n){e.removeEventListener(t,n,!1)},each:function(e,n,i){var r,a;if("forEach"in e)e.forEach(n,i);else if(e.length!==t){for(r=0,a=e.length;a>r;r++)if(n.call(i,e[r],r,e)===!1)return}else for(r in e)if(e.hasOwnProperty(r)&&n.call(i,e[r],r,e)===!1)return},inStr:function(e,t){return e.indexOf(t)>-1},inArray:function(e,t){if(e.indexOf){var n=e.indexOf(t);return-1===n?!1:n}for(var i=0,r=e.length;r>i;i++)if(e[i]===t)return i;return!1},toArray:function(e){return Array.prototype.slice.call(e,0)},hasParent:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(e){var t=[],n=[],i=[],r=[],a=Math.min,o=Math.max;if(1===e.length)return{pageX:e[0].pageX,pageY:e[0].pageY,clientX:e[0].clientX,clientY:e[0].clientY};E.each(e,function(e){t.push(e.pageX);n.push(e.pageY);i.push(e.clientX);r.push(e.clientY)});return{pageX:(a.apply(Math,t)+o.apply(Math,t))/2,pageY:(a.apply(Math,n)+o.apply(Math,n))/2,clientX:(a.apply(Math,i)+o.apply(Math,i))/2,clientY:(a.apply(Math,r)+o.apply(Math,r))/2}},getVelocity:function(e,t,n){return{x:Math.abs(t/e)||0,y:Math.abs(n/e)||0}},getAngle:function(e,t){var n=t.clientX-e.clientX,i=t.clientY-e.clientY;return 180*Math.atan2(i,n)/Math.PI},getDirection:function(e,t){var n=Math.abs(e.clientX-t.clientX),i=Math.abs(e.clientY-t.clientY);return n>=i?e.clientX-t.clientX>0?o:c:e.clientY-t.clientY>0?s:a},getDistance:function(e,t){var n=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(n*n+i*i)},getScale:function(e,t){return e.length>=2&&t.length>=2?this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1]):1},getRotation:function(e,t){return e.length>=2&&t.length>=2?this.getAngle(t[1],t[0])-this.getAngle(e[1],e[0]):0},isVertical:function(e){return e==s||e==a},setPrefixedCss:function(e,t,n,i){var r=["","Webkit","Moz","O","ms"];t=E.toCamelCase(t);for(var a=0;a<r.length;a++){var o=t;r[a]&&(o=r[a]+o.slice(0,1).toUpperCase()+o.slice(1));if(o in e.style){e.style[o]=(null==i||i)&&n||"";break}}},toggleBehavior:function(e,t,n){if(t&&e&&e.style){E.each(t,function(t,i){E.setPrefixedCss(e,i,t,n)});var i=n&&function(){return!1};"none"==t.userSelect&&(e.onselectstart=i);"none"==t.userDrag&&(e.ondragstart=i)}},toCamelCase:function(e){return e.replace(/[_-]([a-z])/g,function(e){return e[1].toUpperCase()})}},T=i.event={preventMouseEvents:!1,started:!1,shouldDetect:!1,on:function(e,t,n,i){var r=t.split(" ");E.each(r,function(t){E.on(e,t,n);i&&i(t)})},off:function(e,t,n,i){var r=t.split(" ");E.each(r,function(t){E.off(e,t,n);i&&i(t)})},onTouch:function(e,t,n){var a=this,o=function(r){r.event?r=r.event.event_||r.event:r.originalEvent&&(r=r.originalEvent);var o=r.type||"";o=o.toLowerCase();var s,c=i.HAS_POINTEREVENTS,u=E.inStr(o,"mouse");if(!u||!a.preventMouseEvents){if(u&&t==p&&0===r.button){a.preventMouseEvents=!1;a.shouldDetect=!0}else if(c&&t==p)a.shouldDetect=1===r.buttons||m.matchType(l,r);else if(!u&&t==p){a.preventMouseEvents=!0;a.shouldDetect=!0}c&&t!=f&&m.updatePointer(t,r);a.shouldDetect&&(s=a.doDetect.call(a,r,t,e,n));if(s==f){a.preventMouseEvents=!1;a.shouldDetect=!1;m.reset()}c&&t==f&&m.updatePointer(t,r)}};this.on(e,r[t],o);return o},doDetect:function(e,t,n,i){var r=this.getTouchList(e,t),a=r.length,o=t,s=r.trigger,c=a;if(t==p)s=v;else if(t==f){s=g;c=r.length-(e.changedTouches?e.changedTouches.length:1)}c>0&&this.started&&(o=d);this.started=!0;var u=this.collectEventData(n,o,r,e);t!=f&&i.call(M,u);if(s){u.changedLength=c;u.eventType=s;i.call(M,u);u.eventType=o;delete u.changedLength}if(o==f){i.call(M,u);this.started=!1}return o},determineEventTypes:function(){var t;t=i.HAS_POINTEREVENTS?e.PointerEvent?["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]:["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]:i.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"];r[p]=t[0];r[d]=t[1];r[f]=t[2];return r},getTouchList:function(e,t){if(i.HAS_POINTEREVENTS)return m.getTouchList();if(e.touches){if(t==d)return e.touches;var n=[],r=[].concat(E.toArray(e.touches),E.toArray(e.changedTouches)),a=[];E.each(r,function(e){E.inArray(n,e.identifier)===!1&&a.push(e);n.push(e.identifier)});return a}e.identifier=1;return[e]},collectEventData:function(e,t,n,i){var r=l;E.inStr(i.type,"mouse")||m.matchType(u,i)?r=u:m.matchType(h,i)&&(r=h);return{center:E.getCenter(n),timeStamp:Date.now(),target:i.target,touches:n,eventType:t,pointerType:r,srcEvent:i,preventDefault:function(){var e=this.srcEvent;e.preventManipulation&&e.preventManipulation();e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return M.stopDetect()}}}},m=i.PointerEvent={pointers:{},getTouchList:function(){var e=[];E.each(this.pointers,function(t){e.push(t)});return e},updatePointer:function(e,t){if(e==f)delete this.pointers[t.pointerId];else{t.identifier=t.pointerId;this.pointers[t.pointerId]=t}},matchType:function(e,t){if(!t.pointerType)return!1;var n=t.pointerType,i={};i[u]=n===(t.MSPOINTER_TYPE_MOUSE||u);i[l]=n===(t.MSPOINTER_TYPE_TOUCH||l);i[h]=n===(t.MSPOINTER_TYPE_PEN||h);return i[e]},reset:function(){this.pointers={}}},M=i.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(e,t){if(!this.current){this.stopped=!1;this.current={inst:e,startEvent:E.extend({},t),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""};this.detect(t)}},detect:function(e){if(this.current&&!this.stopped){e=this.extendEventData(e);var t=this.current.inst,n=t.options;E.each(this.gestures,function(i){!this.stopped&&t.enabled&&n[i.name]&&i.handler.call(i,e,t)},this);this.current&&(this.current.lastEvent=e);e.eventType==f&&this.stopDetect();return e}},stopDetect:function(){this.previous=E.extend({},this.current);this.current=null;this.stopped=!0},getCalculatedData:function(e,t,n,r,a){var o=this.current,s=!1,c=o.lastCalcEvent,u=o.lastCalcData;if(c&&e.timeStamp-c.timeStamp>i.CALCULATE_INTERVAL){t=c.center;n=e.timeStamp-c.timeStamp;r=e.center.clientX-c.center.clientX;a=e.center.clientY-c.center.clientY;s=!0}(e.eventType==v||e.eventType==g)&&(o.futureCalcEvent=e);if(!o.lastCalcEvent||s){u.velocity=E.getVelocity(n,r,a);u.angle=E.getAngle(t,e.center);u.direction=E.getDirection(t,e.center);o.lastCalcEvent=o.futureCalcEvent||e;o.futureCalcEvent=e}e.velocityX=u.velocity.x;e.velocityY=u.velocity.y;e.interimAngle=u.angle;e.interimDirection=u.direction},extendEventData:function(e){var t=this.current,n=t.startEvent,i=t.lastEvent||n;if(e.eventType==v||e.eventType==g){n.touches=[];E.each(e.touches,function(e){n.touches.push({clientX:e.clientX,clientY:e.clientY})})}var r=e.timeStamp-n.timeStamp,a=e.center.clientX-n.center.clientX,o=e.center.clientY-n.center.clientY;this.getCalculatedData(e,i.center,r,a,o);E.extend(e,{startEvent:n,deltaTime:r,deltaX:a,deltaY:o,distance:E.getDistance(n.center,e.center),angle:E.getAngle(n.center,e.center),direction:E.getDirection(n.center,e.center),scale:E.getScale(n.touches,e.touches),rotation:E.getRotation(n.touches,e.touches)});return e},register:function(e){var n=e.defaults||{};n[e.name]===t&&(n[e.name]=!0);E.extend(i.defaults,n,!0);e.index=e.index||1e3;this.gestures.push(e);this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0});return this.gestures}};i.Instance=function(e,t){var r=this;n();this.element=e;this.enabled=!0;E.each(t,function(e,n){delete t[n];t[E.toCamelCase(n)]=e});this.options=E.extend(E.extend({},i.defaults),t||{});this.options.behavior&&E.toggleBehavior(this.element,this.options.behavior,!0);this.eventStartHandler=T.onTouch(e,p,function(e){r.enabled&&e.eventType==p?M.startDetect(r,e):e.eventType==v&&M.detect(e)});this.eventHandlers=[]};i.Instance.prototype={on:function(e,t){var n=this;T.on(n.element,e,t,function(e){n.eventHandlers.push({gesture:e,handler:t})});return n},off:function(e,t){var n=this;T.off(n.element,e,t,function(e){var i=E.inArray({gesture:e,handler:t});i!==!1&&n.eventHandlers.splice(i,1)});return n},trigger:function(e,t){t||(t={});var n=i.DOCUMENT.createEvent("Event");n.initEvent(e,!0,!0);n.gesture=t;var r=this.element;E.hasParent(t.target,r)&&(r=t.target);r.dispatchEvent(n);return this},enable:function(e){this.enabled=e;return this},dispose:function(){var e,t;E.toggleBehavior(this.element,this.options.behavior,!1);for(e=-1;t=this.eventHandlers[++e];)E.off(this.element,t.gesture,t.handler);this.eventHandlers=[];T.off(this.element,r[p],this.eventStartHandler);return null}};!function(e){function t(t,i){var r=M.current;if(!(i.options.dragMaxTouches>0&&t.touches.length>i.options.dragMaxTouches))switch(t.eventType){case p:n=!1;break;case d:if(t.distance<i.options.dragMinDistance&&r.name!=e)return;var u=r.startEvent.center;if(r.name!=e){r.name=e;if(i.options.dragDistanceCorrection&&t.distance>0){var l=Math.abs(i.options.dragMinDistance/t.distance);u.pageX+=t.deltaX*l;u.pageY+=t.deltaY*l;u.clientX+=t.deltaX*l;u.clientY+=t.deltaY*l;t=M.extendEventData(t)}}(r.lastEvent.dragLockToAxis||i.options.dragLockToAxis&&i.options.dragLockMinDistance<=t.distance)&&(t.dragLockToAxis=!0);var h=r.lastEvent.direction;t.dragLockToAxis&&h!==t.direction&&(t.direction=E.isVertical(h)?t.deltaY<0?s:a:t.deltaX<0?o:c);if(!n){i.trigger(e+"start",t);n=!0}i.trigger(e,t);i.trigger(e+t.direction,t);var v=E.isVertical(t.direction);(i.options.dragBlockVertical&&v||i.options.dragBlockHorizontal&&!v)&&t.preventDefault();break;case g:if(n&&t.changedLength<=i.options.dragMaxTouches){i.trigger(e+"end",t);n=!1}break;case f:n=!1}}var n=!1;i.gestures.Drag={name:e,index:50,handler:t,defaults:{dragMinDistance:10,dragDistanceCorrection:!0,dragMaxTouches:1,dragBlockHorizontal:!1,dragBlockVertical:!1,dragLockToAxis:!1,dragLockMinDistance:25}}}("drag");i.gestures.Gesture={name:"gesture",index:1337,handler:function(e,t){t.trigger(this.name,e)}};!function(e){function t(t,i){var r=i.options,a=M.current;switch(t.eventType){case p:clearTimeout(n);a.name=e;n=setTimeout(function(){a&&a.name==e&&i.trigger(e,t)},r.holdTimeout);break;case d:t.distance>r.holdThreshold&&clearTimeout(n);break;case g:clearTimeout(n)}}var n;i.gestures.Hold={name:e,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:t}}("hold");i.gestures.Release={name:"release",index:1/0,handler:function(e,t){e.eventType==g&&t.trigger(this.name,e)}};i.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:.6,swipeVelocityY:.6},handler:function(e,t){if(e.eventType==g){var n=e.touches.length,i=t.options;if(n<i.swipeMinTouches||n>i.swipeMaxTouches)return;if(e.velocityX>i.swipeVelocityX||e.velocityY>i.swipeVelocityY){t.trigger(this.name,e);t.trigger(this.name+e.direction,e)}}}};!function(e){function t(t,i){var r,a,o=i.options,s=M.current,c=M.previous;switch(t.eventType){case p:n=!1;break;case d:n=n||t.distance>o.tapMaxDistance;break;case f:if(!E.inStr(t.srcEvent.type,"cancel")&&t.deltaTime<o.tapMaxTime&&!n){r=c&&c.lastEvent&&t.timeStamp-c.lastEvent.timeStamp;a=!1;if(c&&c.name==e&&r&&r<o.doubleTapInterval&&t.distance<o.doubleTapDistance){i.trigger("doubletap",t);a=!0}if(!a||o.tapAlways){s.name=e;i.trigger(s.name,t)}}}}var n=!1;i.gestures.Tap={name:e,index:100,handler:t,defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!0,doubleTapDistance:20,doubleTapInterval:300}}}("tap");i.gestures.Touch={name:"touch",index:-1/0,defaults:{preventDefault:!1,preventMouse:!1},handler:function(e,t){if(t.options.preventMouse&&e.pointerType==u)e.stopDetect();else{t.options.preventDefault&&e.preventDefault();e.eventType==v&&t.trigger("touch",e)}}};!function(e){function t(t,i){switch(t.eventType){case p:n=!1;break;case d:if(t.touches.length<2)return;var r=Math.abs(1-t.scale),a=Math.abs(t.rotation);if(r<i.options.transformMinScale&&a<i.options.transformMinRotation)return;M.current.name=e;if(!n){i.trigger(e+"start",t);n=!0}i.trigger(e,t);a>i.options.transformMinRotation&&i.trigger("rotate",t);if(r>i.options.transformMinScale){i.trigger("pinch",t);i.trigger("pinch"+(t.scale<1?"in":"out"),t)}break;case g:if(n&&t.changedLength<2){i.trigger(e+"end",t);n=!1}}}var n=!1;i.gestures.Transform={name:e,index:45,defaults:{transformMinScale:.01,transformMinRotation:1},handler:t}}("transform");"function"==typeof define&&define.amd?define(function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:e.Hammer=i}(window);
!function(){var e={},o=null,n=!0,r=!1;try{"undefined"!=typeof AudioContext?o=new AudioContext:"undefined"!=typeof webkitAudioContext?o=new webkitAudioContext:n=!1}catch(t){n=!1}if(!n)if("undefined"!=typeof Audio)try{new Audio}catch(t){r=!0}else r=!0;console.log("usingWebAudio "+n);if(n){var i="undefined"==typeof o.createGain?o.createGainNode():o.createGain();i.gain.value=1;i.connect(o.destination)}var u=function(){this._volume=1;this._muted=!1;this.usingWebAudio=n;this.noAudio=r;this._howls=[]};u.prototype={volume:function(e){var o=this;e=parseFloat(e);if(e>=0&&1>=e){o._volume=e;n&&(i.gain.value=e);for(var r in o._howls)if(o._howls.hasOwnProperty(r)&&o._howls[r]._webAudio===!1)for(var t=0;t<o._howls[r]._audioNode.length;t++)o._howls[r]._audioNode[t].volume=o._howls[r]._volume*o._volume;return o}return n?i.gain.value:o._volume},mute:function(){this._setMuted(!0);return this},unmute:function(){this._setMuted(!1);return this},_setMuted:function(e){var o=this;if(e!=o._muted){o._muted=e;n&&(i.gain.value=e?0:o._volume);for(var r in o._howls)if(o._howls.hasOwnProperty(r)&&o._howls[r]._webAudio===!1)for(var t=0;t<o._howls[r]._audioNode.length;t++)o._howls[r]._audioNode[t].muted=e}}};var a=new u,d=null;if(!r){d=new Audio;var l={mp3:!!d.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!d.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")};console.log(l);window.audioCodecs=l}var f=function(e){var o=this;o._autoplay=e.autoplay||!1;o._buffer=e.buffer||!1;o._duration=e.duration||0;o._format=e.format||null;o._loop=e.loop||!1;o._loaded=!1;o._sprite=e.sprite||{};o._src=e.src||"";o._pos3d=e.pos3d||[0,0,-.5];o._volume=void 0!==e.volume?e.volume:1;o._urls=e.urls||[];o._rate=e.rate||1;o._model=e.model||null;o._onload=[e.onload||function(){}];o._onloaderror=[e.onloaderror||function(){}];o._onend=[e.onend||function(){}];o._onpause=[e.onpause||function(){}];o._onplay=[e.onplay||function(){}];o._onendTimer=[];o._webAudio=n&&!o._buffer;o._audioNode=[];o._webAudio&&o._setupAudioNode();a._howls.push(o);o.load()};f.prototype={load:function(){var o=this,n=null;if(!r){for(var t=0;t<o._urls.length;t++){var i,d;if(o._format)i=o._format;else{d=o._urls[t].toLowerCase().split("?")[0];i=d.match(/.+\.([^?]+)(\?|$)/);i=i&&i.length>=2?i:d.match(/data\:audio\/([^?]+);/);if(!i){o.on("loaderror");return}i=i[1]}if(l[i]){n=o._urls[t];break}}if(!n){if(!(o._urls.length>0)){o.on("loaderror");return}n=o._urls[o._urls.length-1]}o._src=n;if(o._webAudio)_(o,n);else{var f=new Audio;f.addEventListener("error",function(){f.error&&4===f.error.code&&(u.noAudio=!0);o.on("loaderror",{type:f.error?f.error.code:0})},!1);o._audioNode.push(f);f.src=n;f._pos=0;f.preload="auto";f.volume=a._muted?0:o._volume*a.volume();e[n]=o;var s=function(){o._duration=Math.ceil(10*f.duration)/10;0===Object.getOwnPropertyNames(o._sprite).length&&(o._sprite={_default:[0,1e3*o._duration]});if(!o._loaded){o._loaded=!0;o.on("load")}o._autoplay&&o.play();f.removeEventListener("canplaythrough",s,!1)};f.addEventListener("canplaythrough",s,!1);f.load()}return o}o.on("loaderror")},urls:function(e){var o=this;if(e){o.stop();o._urls="string"==typeof e?[e]:e;o._loaded=!1;o.load();return o}return o._urls},play:function(e,n){var r=this;"function"==typeof e&&(n=e);e&&"function"!=typeof e||(e="_default");if(!r._loaded){r.on("load",function(){r.play(e,n)});return r}if(!r._sprite[e]){"function"==typeof n&&n();return r}r._inactiveNode(function(t){t._sprite=e;var i=t._pos>0?t._pos:r._sprite[e][0]/1e3,u=0;if(r._webAudio){u=r._sprite[e][1]/1e3-t._pos;t._pos>0&&(i=r._sprite[e][0]/1e3+i)}else u=r._sprite[e][1]/1e3-(i-r._sprite[e][0]/1e3);var d,l=!(!r._loop&&!r._sprite[e][2]),f="string"==typeof n?n:Math.round(Date.now()*Math.random())+"";!function(){var o={id:f,sprite:e,loop:l};d=setTimeout(function(){!r._webAudio&&l&&r.stop(o.id).play(e,o.id);if(r._webAudio&&!l){r._nodeById(o.id).paused=!0;r._nodeById(o.id)._pos=0}r._webAudio||l||r.stop(o.id);r.on("end",f)},1e3*u);r._onendTimer.push({timer:d,id:o.id})}();if(r._webAudio){var _=r._sprite[e][0]/1e3,s=r._sprite[e][1]/1e3;t.id=f;t.paused=!1;p(r,[l,_,s],f);r._playStart=o.currentTime;t.gain.value=r._volume;"undefined"==typeof t.bufferSource.start?t.bufferSource.noteGrainOn(0,i,u):t.bufferSource.start(0,i,u)}else{if(4!==t.readyState&&(t.readyState||!navigator.isCocoonJS)){r._clearEndTimer(f);!function(){var o=r,i=e,u=n,a=t,d=function(){o.play(i,u);a.removeEventListener("canplaythrough",d,!1)};a.addEventListener("canplaythrough",d,!1)}();return r}t.readyState=4;t.id=f;t.currentTime=i;t.muted=a._muted||t.muted;t.volume=r._volume*a.volume();setTimeout(function(){t.play()},0)}r.on("play");"function"==typeof n&&n(f);return r});return r},pause:function(e){var o=this;if(!o._loaded){o.on("play",function(){o.pause(e)});return o}o._clearEndTimer(e);var n=e?o._nodeById(e):o._activeNode();if(n){n._pos=o.pos(null,e);if(o._webAudio){if(!n.bufferSource||n.paused)return o;n.paused=!0;"undefined"==typeof n.bufferSource.stop?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else n.pause()}o.on("pause");return o},stop:function(e){var o=this;if(!o._loaded){o.on("play",function(){o.stop(e)});return o}o._clearEndTimer(e);var n=e?o._nodeById(e):o._activeNode();if(n){n._pos=0;if(o._webAudio){if(!n.bufferSource||n.paused)return o;n.paused=!0;"undefined"==typeof n.bufferSource.stop?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else if(!isNaN(n.duration)){n.pause();n.currentTime=0}}return o},mute:function(e){var o=this;if(!o._loaded){o.on("play",function(){o.mute(e)});return o}var n=e?o._nodeById(e):o._activeNode();n&&(o._webAudio?n.gain.value=0:n.muted=!0);return o},unmute:function(e){var o=this;if(!o._loaded){o.on("play",function(){o.unmute(e)});return o}var n=e?o._nodeById(e):o._activeNode();n&&(o._webAudio?n.gain.value=o._volume:n.muted=!1);return o},volume:function(e,o){var n=this;e=parseFloat(e);if(e>=0&&1>=e){n._volume=e;if(!n._loaded){n.on("play",function(){n.volume(e,o)});return n}var r=o?n._nodeById(o):n._activeNode();r&&(n._webAudio?r.gain.value=e:r.volume=e*a.volume());return n}return n._volume},loop:function(e){var o=this;if("boolean"==typeof e){o._loop=e;return o}return o._loop},sprite:function(e){var o=this;if("object"==typeof e){o._sprite=e;return o}return o._sprite},pos:function(e,n){var r=this;if(!r._loaded){r.on("load",function(){r.pos(e)});return"number"==typeof e?r:r._pos||0}e=parseFloat(e);var t=n?r._nodeById(n):r._activeNode();if(t){if(e>=0){r.pause(n);t._pos=e;r.play(t._sprite,n);return r}return r._webAudio?t._pos+(o.currentTime-r._playStart):t.currentTime}if(e>=0)return r;for(var i=0;i<r._audioNode.length;i++)if(r._audioNode[i].paused&&4===r._audioNode[i].readyState)return r._webAudio?r._audioNode[i]._pos:r._audioNode[i].currentTime},pos3d:function(e,o,n,r){var t=this;o="undefined"!=typeof o&&o?o:0;n="undefined"!=typeof n&&n?n:-.5;if(!t._loaded){t.on("play",function(){t.pos3d(e,o,n,r)});return t}if(!(e>=0||0>e))return t._pos3d;if(t._webAudio){var i=r?t._nodeById(r):t._activeNode();if(i){t._pos3d=[e,o,n];i.panner.setPosition(e,o,n);i.panner.panningModel=t._model||"HRTF"}}return t},fade:function(e,o,n,r,t){var i=this,u=Math.abs(e-o),a=e>o?"down":"up",d=u/.01,l=n/d;if(!i._loaded){i.on("load",function(){i.fade(e,o,n,r,t)});return i}i.volume(e,t);for(var f=1;d>=f;f++)!function(){var e=i._volume+("up"===a?.01:-.01)*f,n=Math.round(1e3*e)/1e3,u=o;setTimeout(function(){i.volume(n,t);n===u&&r&&r()},l*f)}()},fadeIn:function(e,o,n){return this.volume(0).play().fade(0,e,o,n)},fadeOut:function(e,o,n,r){var t=this;return t.fade(t._volume,e,o,function(){n&&n();t.pause(r);t.on("end")},r)},_nodeById:function(e){for(var o=this,n=o._audioNode[0],r=0;r<o._audioNode.length;r++)if(o._audioNode[r].id===e){n=o._audioNode[r];break}return n},_activeNode:function(){for(var e=this,o=null,n=0;n<e._audioNode.length;n++)if(!e._audioNode[n].paused){o=e._audioNode[n];break}e._drainPool();return o},_inactiveNode:function(e){for(var o=this,n=null,r=0;r<o._audioNode.length;r++)if(o._audioNode[r].paused&&4===o._audioNode[r].readyState){e(o._audioNode[r]);n=!0;break}o._drainPool();if(!n){var t;if(o._webAudio){t=o._setupAudioNode();e(t)}else{o.load();t=o._audioNode[o._audioNode.length-1];var i=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",u=function(){t.removeEventListener(i,u,!1);e(t)};t.addEventListener(i,u,!1)}}},_drainPool:function(){var e,o=this,n=0;for(e=0;e<o._audioNode.length;e++)o._audioNode[e].paused&&n++;for(e=o._audioNode.length-1;e>=0&&!(5>=n);e--)if(o._audioNode[e].paused){o._webAudio&&o._audioNode[e].disconnect(0);n--;o._audioNode.splice(e,1)}},_clearEndTimer:function(e){for(var o=this,n=0,r=0;r<o._onendTimer.length;r++)if(o._onendTimer[r].id===e){n=r;break}var t=o._onendTimer[n];if(t){clearTimeout(t.timer);o._onendTimer.splice(n,1)}},_setupAudioNode:function(){var e=this,n=e._audioNode,r=e._audioNode.length;n[r]="undefined"==typeof o.createGain?o.createGainNode():o.createGain();n[r].gain.value=e._volume;n[r].paused=!0;n[r]._pos=0;n[r].readyState=4;n[r].connect(i);n[r].panner=o.createPanner();n[r].panner.panningModel=e._model||"equalpower";n[r].panner.setPosition(e._pos3d[0],e._pos3d[1],e._pos3d[2]);n[r].panner.connect(n[r]);return n[r]},on:function(e,o){var n=this,r=n["_on"+e];if("function"==typeof o)r.push(o);else for(var t=0;t<r.length;t++)o?r[t].call(n,o):r[t].call(n);return n},off:function(e,o){for(var n=this,r=n["_on"+e],t=o.toString(),i=0;i<r.length;i++)if(t===r[i].toString()){r.splice(i,1);break}return n},unload:function(){for(var o=this,n=o._audioNode,r=0;r<o._audioNode.length;r++){n[r].paused||o.stop(n[r].id);o._webAudio?n[r].disconnect(0):n[r].src=""}for(r=0;r<o._onendTimer.length;r++)clearTimeout(o._onendTimer[r].timer);var t=a._howls.indexOf(o);null!==t&&t>=0&&a._howls.splice(t,1);delete e[o._src];o=null}};if(n)var _=function(n,r){if(r in e){n._duration=e[r].duration;s(n)}else{var t=new XMLHttpRequest;t.open("GET",r,!0);t.responseType="arraybuffer";t.onload=function(){o.decodeAudioData(t.response,function(o){if(o){e[r]=o;s(n,o)}},function(){n.on("loaderror")})};t.onerror=function(){console.log("loading sound error");if(n._webAudio){n._buffer=!0;n._webAudio=!1;n._audioNode=[];delete n._gainNode;n.load()}};try{t.send()}catch(i){console.log("loading sound error:",r);t.onerror()}}},s=function(e,o){e._duration=o?o.duration:e._duration;0===Object.getOwnPropertyNames(e._sprite).length&&(e._sprite={_default:[0,1e3*e._duration]});if(!e._loaded){e._loaded=!0;e.on("load")}e._autoplay&&e.play()},p=function(n,r,t){var i=n._nodeById(t);i.bufferSource=o.createBufferSource();i.bufferSource.buffer=e[n._src];i.bufferSource.connect(i.panner);i.bufferSource.loop=r[0];if(r[0]){i.bufferSource.loopStart=r[1];i.bufferSource.loopEnd=r[1]+r[2]}i.bufferSource.playbackRate.value=n._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:a,Howl:f}});if("undefined"!=typeof exports){exports.Howler=a;exports.Howl=f}if("undefined"!=typeof window){window.Howler=a;window.Howl=f}}();
var Box2D={};Box2D.MIN_VALUE=Number.MIN_VALUE||1e-100;!function(){function t(t,i){i||(i=1);var e,n,s,r,a,m=t.length,l=[];for(e=0;m>e;e++)l.push(new b2Vec2(t[e].x*i,t[e].y*i));r=o(l);m=r.length;var c=new Array(m);for(e=0;m>e;e++){t=[];l=r[e];s=l.length;for(n=0;s>n;n++)t.push(new b2Vec2(l[n].x/i,l[n].y/i));a=new b2PolygonShape;a.SetAsVector(t);c[e]=a}return c}function i(t){var i,o,e,s,r,a,l,c=t.length,h=0,_=!1;for(i=0;c>i;i++){s=c-1>i?i+1:0;r=i>0?i-1:c-1;l=!1;for(o=0;c>o;o++)if(o!=i&&o!=s){if(!l){a=m(t[i].x,t[i].y,t[s].x,t[s].y,t[o].x,t[o].y);a>0&&(l=!0)}if(o!=r){e=c-1>o?o+1:0;n(t[i].x,t[i].y,t[s].x,t[s].y,t[o].x,t[o].y,t[e].x,t[e].y)&&(h=1)}}l||(_=!0)}_&&(h=1==h?3:2);return h}function o(t){var i,o,n,a,c,h,_,p,y,u,x,f,d,b,v,D,B,C,g,A,w,S,M,V,I,G,J=[],L=[];L.push(t);for(;L.length;){i=L[0];n=i.length;G=!0;for(o=0;n>o;o++){u=o;x=n-1>o?o+1:o+1-n;f=n-2>o?o+2:o+2-n;d=i[u];b=i[x];v=i[f];c=m(d.x,d.y,b.x,b.y,v.x,v.y);if(0>c){G=!1;y=Number.MAX_VALUE;for(a=0;n>a;a++)if(a!=u&&a!=x){D=a;B=n-1>a?a+1:0;C=i[D];g=i[B];V=e(d.x,d.y,b.x,b.y,C.x,C.y,g.x,g.y);if(V){_=b.x-V.x;p=b.y-V.y;h=_*_+p*p;if(y>h){w=D;A=B;I=V;y=h}}}y==Number.MAX_VALUE&&l();S=[];M=[];D=w;B=A;C=i[D];g=i[B];r(I.x,I.y,g.x,g.y)||S.push(I);r(I.x,I.y,C.x,C.y)||M.push(I);w=-1;A=u;for(;;){if(A==B){(0>w||w>=n)&&l();s(g.x,g.y,i[w].x,i[w].y,d.x,d.y)||S.push(i[A]);break}S.push(i[A]);w=A;0>A-1?A=n-1:A--}S=S.reverse();w=-1;A=x;for(;;){if(A==D){(0>w||w>=n)&&l();A!=D||s(C.x,C.y,i[w].x,i[w].y,b.x,b.y)||M.push(i[A]);break}M.push(i[A]);w=A;A+1>n-1?A=0:A++}L.push(S,M);L.shift();break}}G&&J.push(L.shift())}return J}function e(t,i,o,e,n,r,a,m){var l,c=n-t,h=r-i,_=o-t,p=e-i,y=a-n,u=m-r,x=p*y-_*u;l=(y*h-u*c)/x;var f=t+l*_,d=i+l*p,b=s(o,e,t,i,f,d),v=s(f,d,n,r,a,m);return b&&v?new b2Vec2(f,d):null}function n(t,i,o,e,n,r,a,m){var l,c=n-t,h=r-i,_=o-t,p=e-i,y=a-n,u=m-r,x=p*y-_*u;l=(y*h-u*c)/x;var f=t+l*_,d=i+l*p,b=s(f,d,t,i,o,e),v=s(f,d,n,r,a,m);return b&&v?new b2Vec2(f,d):null}function s(t,i,o,e,n,s){var r=o+.1>=t&&t>=n-.1||t>=o-.1&&n+.1>=t,m=e+.1>=i&&i>=s-.1||i>=e-.1&&s+.1>=i;return r&&m&&a(t,i,o,e,n,s)}function r(t,i,o,e){var n=o>=t?o-t:t-o,s=e>=i?e-i:i-e;return.1>n&&.1>s}function a(t,i,o,e,n,s){if(n-o>.1||o-n>.1){var r=(s-e)/(n-o),a=r*(t-o)+e,m=a>i?a-i:i-a;return.1>m}return.1>t-o||.1>o-t}function m(t,i,o,e,n,s){return t*e+o*s+n*i-i*o-e*n-s*t}function l(){throw"A problem has occurred. Use the Validate() method to see where the problem is."}window.qyengine||(window.qyengine={});qyengine.separateShape=t;qyengine.validateShape=i}();!function(t,i){function o(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(t,i,o){o.get instanceof Function&&t.__defineGetter__(i,o.get);o.set instanceof Function&&t.__defineSetter__(i,o.set)});t.inherit=function(t,i){var e=t;o.prototype=i.prototype;t.prototype=new o;t.prototype.constructor=e};t.generateCallback=function(t,i){return function(){i.apply(t,arguments)}};t.NVector=function(t){t===i&&(t=0);for(var o=new Array(t||0),e=0;t>e;++e)o[e]=0;return o};t.is=function(t,o){return null===t?!1:o instanceof Function&&t instanceof o?!0:t.constructor.__implements!=i&&t.constructor.__implements[o]?!0:!1};t.parseUInt=function(t){return Math.abs(parseInt(t))}}(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;"undefined"==typeof Box2D&&(Box2D={});"undefined"==typeof Box2D.Collision&&(Box2D.Collision={});"undefined"==typeof Box2D.Collision.Shapes&&(Box2D.Collision.Shapes={});"undefined"==typeof Box2D.Common&&(Box2D.Common={});"undefined"==typeof Box2D.Common.Math&&(Box2D.Common.Math={});"undefined"==typeof Box2D.Dynamics&&(Box2D.Dynamics={});"undefined"==typeof Box2D.Dynamics.Contacts&&(Box2D.Dynamics.Contacts={});"undefined"==typeof Box2D.Dynamics.Controllers&&(Box2D.Dynamics.Controllers={});"undefined"==typeof Box2D.Dynamics.Joints&&(Box2D.Dynamics.Joints={});!function(){function t(){t.b2AABB.apply(this,arguments)}function i(){i.b2Bound.apply(this,arguments)}function o(){o.b2BoundValues.apply(this,arguments);this.constructor===o&&this.b2BoundValues.apply(this,arguments)}function e(){e.b2Collision.apply(this,arguments)}function n(){n.b2ContactID.apply(this,arguments);this.constructor===n&&this.b2ContactID.apply(this,arguments)}function s(){s.b2ContactPoint.apply(this,arguments)}function r(){r.b2Distance.apply(this,arguments)}function a(){a.b2DistanceInput.apply(this,arguments)}function m(){m.b2DistanceOutput.apply(this,arguments)}function l(){l.b2DistanceProxy.apply(this,arguments)}function c(){c.b2DynamicTree.apply(this,arguments);this.constructor===c&&this.b2DynamicTree.apply(this,arguments)}function h(){h.b2DynamicTreeBroadPhase.apply(this,arguments)}function _(){_.b2DynamicTreeNode.apply(this,arguments)}function p(){p.b2DynamicTreePair.apply(this,arguments)}function y(){y.b2Manifold.apply(this,arguments);this.constructor===y&&this.b2Manifold.apply(this,arguments)}function u(){u.b2ManifoldPoint.apply(this,arguments);this.constructor===u&&this.b2ManifoldPoint.apply(this,arguments)}function x(){x.b2Point.apply(this,arguments)}function f(){f.b2RayCastInput.apply(this,arguments);this.constructor===f&&this.b2RayCastInput.apply(this,arguments)}function d(){d.b2RayCastOutput.apply(this,arguments)}function b(){b.b2Segment.apply(this,arguments)}function v(){v.b2SeparationFunction.apply(this,arguments)}function D(){D.b2Simplex.apply(this,arguments);this.constructor===D&&this.b2Simplex.apply(this,arguments)}function B(){B.b2SimplexCache.apply(this,arguments)}function C(){C.b2SimplexVertex.apply(this,arguments)}function g(){g.b2TimeOfImpact.apply(this,arguments)}function A(){A.b2TOIInput.apply(this,arguments)}function w(){w.b2WorldManifold.apply(this,arguments);this.constructor===w&&this.b2WorldManifold.apply(this,arguments)}function S(){S.ClipVertex.apply(this,arguments)}function M(){M.Features.apply(this,arguments)}function V(){V.b2CircleShape.apply(this,arguments);this.constructor===V&&this.b2CircleShape.apply(this,arguments)}function I(){I.b2EdgeChainDef.apply(this,arguments);this.constructor===I&&this.b2EdgeChainDef.apply(this,arguments)}function G(){G.b2EdgeShape.apply(this,arguments);this.constructor===G&&this.b2EdgeShape.apply(this,arguments)}function J(){J.b2MassData.apply(this,arguments)}function L(){L.b2PolygonShape.apply(this,arguments);this.constructor===L&&this.b2PolygonShape.apply(this,arguments)}function F(){F.b2Shape.apply(this,arguments);this.constructor===F&&this.b2Shape.apply(this,arguments)}function P(){P.b2Color.apply(this,arguments);this.constructor===P&&this.b2Color.apply(this,arguments)}function R(){R.b2Settings.apply(this,arguments)}function T(){T.b2Mat22.apply(this,arguments);this.constructor===T&&this.b2Mat22.apply(this,arguments)}function k(){k.b2Mat33.apply(this,arguments);this.constructor===k&&this.b2Mat33.apply(this,arguments)}function z(){z.b2Math.apply(this,arguments)}function E(){E.b2Sweep.apply(this,arguments)}function N(){N.b2Transform.apply(this,arguments);this.constructor===N&&this.b2Transform.apply(this,arguments)}function j(){j.b2Vec2.apply(this,arguments);this.constructor===j&&this.b2Vec2.apply(this,arguments)}function q(){q.b2Vec3.apply(this,arguments);this.constructor===q&&this.b2Vec3.apply(this,arguments)}function U(){U.b2Body.apply(this,arguments);this.constructor===U&&this.b2Body.apply(this,arguments)}function O(){O.b2BodyDef.apply(this,arguments);this.constructor===O&&this.b2BodyDef.apply(this,arguments)}function W(){W.b2ContactFilter.apply(this,arguments)}function K(){K.b2ContactImpulse.apply(this,arguments)}function X(){X.b2ContactListener.apply(this,arguments)}function Z(){Z.b2ContactManager.apply(this,arguments);this.constructor===Z&&this.b2ContactManager.apply(this,arguments)}function H(){H.b2DebugDraw.apply(this,arguments);this.constructor===H&&this.b2DebugDraw.apply(this,arguments)}function Y(){Y.b2DestructionListener.apply(this,arguments)}function Q(){Q.b2FilterData.apply(this,arguments)}function $(){$.b2Fixture.apply(this,arguments);this.constructor===$&&this.b2Fixture.apply(this,arguments)}function ti(){ti.b2FixtureDef.apply(this,arguments);this.constructor===ti&&this.b2FixtureDef.apply(this,arguments)}function ii(){ii.b2Island.apply(this,arguments);this.constructor===ii&&this.b2Island.apply(this,arguments)}function oi(){oi.b2TimeStep.apply(this,arguments)}function ei(){ei.b2World.apply(this,arguments);this.constructor===ei&&this.b2World.apply(this,arguments)}function ni(){ni.b2CircleContact.apply(this,arguments)}function si(){si.b2Contact.apply(this,arguments);this.constructor===si&&this.b2Contact.apply(this,arguments)}function ri(){ri.b2ContactConstraint.apply(this,arguments);this.constructor===ri&&this.b2ContactConstraint.apply(this,arguments)}function ai(){ai.b2ContactConstraintPoint.apply(this,arguments)}function mi(){mi.b2ContactEdge.apply(this,arguments)}function li(){li.b2ContactFactory.apply(this,arguments);this.constructor===li&&this.b2ContactFactory.apply(this,arguments)}function ci(){ci.b2ContactRegister.apply(this,arguments)}function hi(){hi.b2ContactResult.apply(this,arguments)}function _i(){_i.b2ContactSolver.apply(this,arguments);this.constructor===_i&&this.b2ContactSolver.apply(this,arguments)}function pi(){pi.b2EdgeAndCircleContact.apply(this,arguments)}function yi(){yi.b2NullContact.apply(this,arguments);this.constructor===yi&&this.b2NullContact.apply(this,arguments)}function ui(){ui.b2PolyAndCircleContact.apply(this,arguments)}function xi(){xi.b2PolyAndEdgeContact.apply(this,arguments)}function fi(){fi.b2PolygonContact.apply(this,arguments)}function di(){di.b2PositionSolverManifold.apply(this,arguments);this.constructor===di&&this.b2PositionSolverManifold.apply(this,arguments)}function bi(){bi.b2BuoyancyController.apply(this,arguments)}function vi(){vi.b2ConstantAccelController.apply(this,arguments)}function Di(){Di.b2ConstantForceController.apply(this,arguments)}function Bi(){Bi.b2Controller.apply(this,arguments)}function Ci(){Ci.b2ControllerEdge.apply(this,arguments)}function gi(){gi.b2GravityController.apply(this,arguments)}function Ai(){Ai.b2TensorDampingController.apply(this,arguments)}function wi(){wi.b2DistanceJoint.apply(this,arguments);this.constructor===wi&&this.b2DistanceJoint.apply(this,arguments)}function Si(){Si.b2DistanceJointDef.apply(this,arguments);this.constructor===Si&&this.b2DistanceJointDef.apply(this,arguments)}function Mi(){Mi.b2RopeJoint.apply(this,arguments);this.constructor===Mi&&this.b2RopeJoint.apply(this,arguments)}function Vi(){Vi.b2RopeJointDef.apply(this,arguments);this.constructor===Vi&&this.b2RopeJointDef.apply(this,arguments)}function Ii(){Ii.b2FrictionJoint.apply(this,arguments);this.constructor===Ii&&this.b2FrictionJoint.apply(this,arguments)}function Gi(){Gi.b2FrictionJointDef.apply(this,arguments);this.constructor===Gi&&this.b2FrictionJointDef.apply(this,arguments)}function Ji(){Ji.b2GearJoint.apply(this,arguments);this.constructor===Ji&&this.b2GearJoint.apply(this,arguments)}function Li(){Li.b2GearJointDef.apply(this,arguments);this.constructor===Li&&this.b2GearJointDef.apply(this,arguments)}function Fi(){Fi.b2Jacobian.apply(this,arguments)}function Pi(){Pi.b2Joint.apply(this,arguments);this.constructor===Pi&&this.b2Joint.apply(this,arguments)}function Ri(){Ri.b2JointDef.apply(this,arguments);this.constructor===Ri&&this.b2JointDef.apply(this,arguments)}function Ti(){Ti.b2JointEdge.apply(this,arguments)}function ki(){ki.b2LineJoint.apply(this,arguments);this.constructor===ki&&this.b2LineJoint.apply(this,arguments)}function zi(){zi.b2LineJointDef.apply(this,arguments);this.constructor===zi&&this.b2LineJointDef.apply(this,arguments)}function Ei(){Ei.b2MouseJoint.apply(this,arguments);this.constructor===Ei&&this.b2MouseJoint.apply(this,arguments)}function Ni(){Ni.b2MouseJointDef.apply(this,arguments);this.constructor===Ni&&this.b2MouseJointDef.apply(this,arguments)}function ji(){ji.b2PrismaticJoint.apply(this,arguments);this.constructor===ji&&this.b2PrismaticJoint.apply(this,arguments)}function qi(){qi.b2PrismaticJointDef.apply(this,arguments);this.constructor===qi&&this.b2PrismaticJointDef.apply(this,arguments)}function Ui(){Ui.b2PulleyJoint.apply(this,arguments);this.constructor===Ui&&this.b2PulleyJoint.apply(this,arguments)}function Oi(){Oi.b2PulleyJointDef.apply(this,arguments);this.constructor===Oi&&this.b2PulleyJointDef.apply(this,arguments)}function Wi(){Wi.b2RevoluteJoint.apply(this,arguments);this.constructor===Wi&&this.b2RevoluteJoint.apply(this,arguments)}function Ki(){Ki.b2RevoluteJointDef.apply(this,arguments);this.constructor===Ki&&this.b2RevoluteJointDef.apply(this,arguments)}function Xi(){Xi.b2WeldJoint.apply(this,arguments);this.constructor===Xi&&this.b2WeldJoint.apply(this,arguments)}function Zi(){Zi.b2WeldJointDef.apply(this,arguments);this.constructor===Zi&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";Box2D.Collision.b2AABB=t;Box2D.Collision.b2Bound=i;Box2D.Collision.b2BoundValues=o;Box2D.Collision.b2Collision=e;Box2D.Collision.b2ContactID=n;Box2D.Collision.b2ContactPoint=s;Box2D.Collision.b2Distance=r;Box2D.Collision.b2DistanceInput=a;Box2D.Collision.b2DistanceOutput=m;Box2D.Collision.b2DistanceProxy=l;Box2D.Collision.b2DynamicTree=c;Box2D.Collision.b2DynamicTreeBroadPhase=h;Box2D.Collision.b2DynamicTreeNode=_;Box2D.Collision.b2DynamicTreePair=p;Box2D.Collision.b2Manifold=y;Box2D.Collision.b2ManifoldPoint=u;Box2D.Collision.b2Point=x;Box2D.Collision.b2RayCastInput=f;Box2D.Collision.b2RayCastOutput=d;Box2D.Collision.b2Segment=b;Box2D.Collision.b2SeparationFunction=v;Box2D.Collision.b2Simplex=D;Box2D.Collision.b2SimplexCache=B;Box2D.Collision.b2SimplexVertex=C;Box2D.Collision.b2TimeOfImpact=g;Box2D.Collision.b2TOIInput=A;Box2D.Collision.b2WorldManifold=w;Box2D.Collision.ClipVertex=S;Box2D.Collision.Features=M;Box2D.Collision.Shapes.b2CircleShape=V;Box2D.Collision.Shapes.b2EdgeChainDef=I;Box2D.Collision.Shapes.b2EdgeShape=G;Box2D.Collision.Shapes.b2MassData=J;Box2D.Collision.Shapes.b2PolygonShape=L;Box2D.Collision.Shapes.b2Shape=F;Box2D.Common.b2internal="Box2D.Common.b2internal";Box2D.Common.b2Color=P;Box2D.Common.b2Settings=R;Box2D.Common.Math.b2Mat22=T;Box2D.Common.Math.b2Mat33=k;Box2D.Common.Math.b2Math=z;Box2D.Common.Math.b2Sweep=E;Box2D.Common.Math.b2Transform=N;Box2D.Common.Math.b2Vec2=j;Box2D.Common.Math.b2Vec3=q;Box2D.Dynamics.b2Body=U;Box2D.Dynamics.b2BodyDef=O;Box2D.Dynamics.b2ContactFilter=W;Box2D.Dynamics.b2ContactImpulse=K;Box2D.Dynamics.b2ContactListener=X;Box2D.Dynamics.b2ContactManager=Z;Box2D.Dynamics.b2DebugDraw=H;Box2D.Dynamics.b2DestructionListener=Y;Box2D.Dynamics.b2FilterData=Q;Box2D.Dynamics.b2Fixture=$;Box2D.Dynamics.b2FixtureDef=ti;Box2D.Dynamics.b2Island=ii;Box2D.Dynamics.b2TimeStep=oi;Box2D.Dynamics.b2World=ei;Box2D.Dynamics.Contacts.b2CircleContact=ni;Box2D.Dynamics.Contacts.b2Contact=si;Box2D.Dynamics.Contacts.b2ContactConstraint=ri;Box2D.Dynamics.Contacts.b2ContactConstraintPoint=ai;Box2D.Dynamics.Contacts.b2ContactEdge=mi;Box2D.Dynamics.Contacts.b2ContactFactory=li;Box2D.Dynamics.Contacts.b2ContactRegister=ci;Box2D.Dynamics.Contacts.b2ContactResult=hi;Box2D.Dynamics.Contacts.b2ContactSolver=_i;Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=pi;Box2D.Dynamics.Contacts.b2NullContact=yi;Box2D.Dynamics.Contacts.b2PolyAndCircleContact=ui;Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=xi;Box2D.Dynamics.Contacts.b2PolygonContact=fi;Box2D.Dynamics.Contacts.b2PositionSolverManifold=di;Box2D.Dynamics.Controllers.b2BuoyancyController=bi;Box2D.Dynamics.Controllers.b2ConstantAccelController=vi;Box2D.Dynamics.Controllers.b2ConstantForceController=Di;Box2D.Dynamics.Controllers.b2Controller=Bi;Box2D.Dynamics.Controllers.b2ControllerEdge=Ci;Box2D.Dynamics.Controllers.b2GravityController=gi;Box2D.Dynamics.Controllers.b2TensorDampingController=Ai;Box2D.Dynamics.Joints.b2DistanceJoint=wi;Box2D.Dynamics.Joints.b2DistanceJointDef=Si;Box2D.Dynamics.Joints.b2RopeJoint=Mi;Box2D.Dynamics.Joints.b2RopeJointDef=Vi;Box2D.Dynamics.Joints.b2FrictionJoint=Ii;Box2D.Dynamics.Joints.b2FrictionJointDef=Gi;Box2D.Dynamics.Joints.b2GearJoint=Ji;Box2D.Dynamics.Joints.b2GearJointDef=Li;Box2D.Dynamics.Joints.b2Jacobian=Fi;Box2D.Dynamics.Joints.b2Joint=Pi;Box2D.Dynamics.Joints.b2JointDef=Ri;Box2D.Dynamics.Joints.b2JointEdge=Ti;Box2D.Dynamics.Joints.b2LineJoint=ki;Box2D.Dynamics.Joints.b2LineJointDef=zi;Box2D.Dynamics.Joints.b2MouseJoint=Ei;Box2D.Dynamics.Joints.b2MouseJointDef=Ni;Box2D.Dynamics.Joints.b2PrismaticJoint=ji;Box2D.Dynamics.Joints.b2PrismaticJointDef=qi;Box2D.Dynamics.Joints.b2PulleyJoint=Ui;Box2D.Dynamics.Joints.b2PulleyJointDef=Oi;Box2D.Dynamics.Joints.b2RevoluteJoint=Wi;Box2D.Dynamics.Joints.b2RevoluteJointDef=Ki;Box2D.Dynamics.Joints.b2WeldJoint=Xi;Box2D.Dynamics.Joints.b2WeldJointDef=Zi}();Box2D.postDefs=[];!function(){var t=Box2D.Collision.Shapes.b2CircleShape,i=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),o=Box2D.Collision.Shapes.b2Shape,e=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),n=(Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),s=Box2D.Common.Math.b2Sweep,r=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,m=(Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB),l=Box2D.Collision.b2Bound,c=Box2D.Collision.b2BoundValues,h=Box2D.Collision.b2Collision,_=Box2D.Collision.b2ContactID,p=Box2D.Collision.b2ContactPoint,y=Box2D.Collision.b2Distance,u=Box2D.Collision.b2DistanceInput,x=Box2D.Collision.b2DistanceOutput,f=Box2D.Collision.b2DistanceProxy,d=Box2D.Collision.b2DynamicTree,b=Box2D.Collision.b2DynamicTreeBroadPhase,v=Box2D.Collision.b2DynamicTreeNode,D=Box2D.Collision.b2DynamicTreePair,B=Box2D.Collision.b2Manifold,C=Box2D.Collision.b2ManifoldPoint,g=Box2D.Collision.b2Point,A=Box2D.Collision.b2RayCastInput,w=Box2D.Collision.b2RayCastOutput,S=Box2D.Collision.b2Segment,M=Box2D.Collision.b2SeparationFunction,V=Box2D.Collision.b2Simplex,I=Box2D.Collision.b2SimplexCache,G=Box2D.Collision.b2SimplexVertex,J=Box2D.Collision.b2TimeOfImpact,L=Box2D.Collision.b2TOIInput,F=Box2D.Collision.b2WorldManifold,P=Box2D.Collision.ClipVertex,R=Box2D.Collision.Features,T=Box2D.Collision.IBroadPhase;m.b2AABB=function(){this.lowerBound=new a;this.upperBound=new a};m.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x,i=this.upperBound.y-this.lowerBound.y,o=t>=0&&i>=0;o=o&&this.lowerBound.IsValid()&&this.upperBound.IsValid();return o};m.prototype.GetCenter=function(){return new a((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};m.prototype.GetExtents=function(){return new a((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};m.prototype.Contains=function(t){var i=!0;i=i&&this.lowerBound.x<=t.lowerBound.x;i=i&&this.lowerBound.y<=t.lowerBound.y;i=i&&t.upperBound.x<=this.upperBound.x;i=i&&t.upperBound.y<=this.upperBound.y;return i};m.prototype.RayCast=function(t,i){var o=-Number.MAX_VALUE,e=Number.MAX_VALUE,n=i.p1.x,s=i.p1.y,r=i.p2.x-i.p1.x,a=i.p2.y-i.p1.y,m=Math.abs(r),l=Math.abs(a),c=t.normal,h=0,_=0,p=0,y=0,u=0;if(m<Box2D.MIN_VALUE){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else{h=1/r;_=(this.lowerBound.x-n)*h;p=(this.upperBound.x-n)*h;u=-1;if(_>p){y=_;_=p;p=y;u=1}if(_>o){c.x=u;c.y=0;o=_}e=Math.min(e,p);if(o>e)return!1}if(l<Box2D.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{h=1/a;_=(this.lowerBound.y-s)*h;p=(this.upperBound.y-s)*h;u=-1;if(_>p){y=_;_=p;p=y;u=1}if(_>o){c.y=u;c.x=0;o=_}e=Math.min(e,p);if(o>e)return!1}t.fraction=o;return!0};m.prototype.TestOverlap=function(t){var i=t.lowerBound.x-this.upperBound.x,o=t.lowerBound.y-this.upperBound.y,e=this.lowerBound.x-t.upperBound.x,n=this.lowerBound.y-t.upperBound.y;return i>0||o>0?!1:e>0||n>0?!1:!0};m.Combine=function(t,i){var o=new m;o.Combine(t,i);return o};m.prototype.Combine=function(t,i){this.lowerBound.x=Math.min(t.lowerBound.x,i.lowerBound.x);this.lowerBound.y=Math.min(t.lowerBound.y,i.lowerBound.y);this.upperBound.x=Math.max(t.upperBound.x,i.upperBound.x);this.upperBound.y=Math.max(t.upperBound.y,i.upperBound.y)};l.b2Bound=function(){};l.prototype.IsLower=function(){return 0==(1&this.value)};l.prototype.IsUpper=function(){return 1==(1&this.value)};l.prototype.Swap=function(t){var i=this.value,o=this.proxy,e=this.stabbingCount;this.value=t.value;this.proxy=t.proxy;this.stabbingCount=t.stabbingCount;t.value=i;t.proxy=o;t.stabbingCount=e};c.b2BoundValues=function(){};c.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};h.b2Collision=function(){};h.ClipSegmentToLine=function(t,i,o,e){void 0===e&&(e=0);var n,s=0;n=i[0];var r=n.v;n=i[1];var a=n.v,m=o.x*r.x+o.y*r.y-e,l=o.x*a.x+o.y*a.y-e;0>=m&&t[s++].Set(i[0]);0>=l&&t[s++].Set(i[1]);if(0>m*l){var c=m/(m-l);n=t[s];var h=n.v;h.x=r.x+c*(a.x-r.x);h.y=r.y+c*(a.y-r.y);n=t[s];var _;if(m>0){_=i[0];n.id=_.id}else{_=i[1];n.id=_.id}++s}return s};h.EdgeSeparation=function(t,i,o,e,n){void 0===o&&(o=0);var s,r,a=(parseInt(t.m_vertexCount),t.m_vertices),m=t.m_normals,l=parseInt(e.m_vertexCount),c=e.m_vertices;s=i.R;r=m[o];var h=s.col1.x*r.x+s.col2.x*r.y,_=s.col1.y*r.x+s.col2.y*r.y;s=n.R;for(var p=s.col1.x*h+s.col1.y*_,y=s.col2.x*h+s.col2.y*_,u=0,x=Number.MAX_VALUE,f=0;l>f;++f){r=c[f];var d=r.x*p+r.y*y;if(x>d){x=d;u=f}}r=a[o];s=i.R;var b=i.position.x+(s.col1.x*r.x+s.col2.x*r.y),v=i.position.y+(s.col1.y*r.x+s.col2.y*r.y);r=c[u];s=n.R;var D=n.position.x+(s.col1.x*r.x+s.col2.x*r.y),B=n.position.y+(s.col1.y*r.x+s.col2.y*r.y);D-=b;B-=v;var C=D*h+B*_;return C};h.FindMaxSeparation=function(t,i,o,e,n){var s,r,a=parseInt(i.m_vertexCount),m=i.m_normals;r=n.R;s=e.m_centroid;var l=n.position.x+(r.col1.x*s.x+r.col2.x*s.y),c=n.position.y+(r.col1.y*s.x+r.col2.y*s.y);r=o.R;s=i.m_centroid;l-=o.position.x+(r.col1.x*s.x+r.col2.x*s.y);c-=o.position.y+(r.col1.y*s.x+r.col2.y*s.y);for(var _=l*o.R.col1.x+c*o.R.col1.y,p=l*o.R.col2.x+c*o.R.col2.y,y=0,u=-Number.MAX_VALUE,x=0;a>x;++x){s=m[x];var f=s.x*_+s.y*p;if(f>u){u=f;y=x}}var d=h.EdgeSeparation(i,o,y,e,n),b=parseInt(y-1>=0?y-1:a-1),v=h.EdgeSeparation(i,o,b,e,n),D=parseInt(a>y+1?y+1:0),B=h.EdgeSeparation(i,o,D,e,n),C=0,g=0,A=0;if(v>d&&v>B){A=-1;C=b;g=v}else{if(!(B>d)){t[0]=y;return d}A=1;C=D;g=B}for(;;){y=-1==A?C-1>=0?C-1:a-1:a>C+1?C+1:0;d=h.EdgeSeparation(i,o,y,e,n);if(!(d>g))break;C=y;g=d}t[0]=C;return g};h.FindIncidentEdge=function(t,i,o,e,n,s){void 0===e&&(e=0);var r,a,m=(parseInt(i.m_vertexCount),i.m_normals),l=parseInt(n.m_vertexCount),c=n.m_vertices,h=n.m_normals;r=o.R;a=m[e];var _=r.col1.x*a.x+r.col2.x*a.y,p=r.col1.y*a.x+r.col2.y*a.y;r=s.R;var y=r.col1.x*_+r.col1.y*p;p=r.col2.x*_+r.col2.y*p;_=y;for(var u=0,x=Number.MAX_VALUE,f=0;l>f;++f){a=h[f];var d=_*a.x+p*a.y;if(x>d){x=d;u=f}}var b,v=parseInt(u),D=parseInt(l>v+1?v+1:0);b=t[0];a=c[v];r=s.R;b.v.x=s.position.x+(r.col1.x*a.x+r.col2.x*a.y);b.v.y=s.position.y+(r.col1.y*a.x+r.col2.y*a.y);b.id.features.referenceEdge=e;b.id.features.incidentEdge=v;b.id.features.incidentVertex=0;b=t[1];a=c[D];r=s.R;b.v.x=s.position.x+(r.col1.x*a.x+r.col2.x*a.y);b.v.y=s.position.y+(r.col1.y*a.x+r.col2.y*a.y);b.id.features.referenceEdge=e;b.id.features.incidentEdge=D;b.id.features.incidentVertex=1};h.MakeClipPointVector=function(){var t=new Vector(2);t[0]=new P;t[1]=new P;return t};h.CollidePolygons=function(t,i,o,n,s){var r;t.m_pointCount=0;var a=i.m_radius+n.m_radius,m=0;h.s_edgeAO[0]=m;var l=h.FindMaxSeparation(h.s_edgeAO,i,o,n,s);m=h.s_edgeAO[0];if(!(l>a)){var c=0;h.s_edgeBO[0]=c;var _=h.FindMaxSeparation(h.s_edgeBO,n,s,i,o);c=h.s_edgeBO[0];if(!(_>a)){var p,y,u,x,f,d=0,b=0,v=.98,D=.001;if(_>v*l+D){p=n;y=i;u=s;x=o;d=c;t.m_type=B.e_faceB;b=1}else{p=i;y=n;u=o;x=s;d=m;t.m_type=B.e_faceA;b=0}var C=h.s_incidentEdge;h.FindIncidentEdge(C,p,u,d,y,x);var g,A=parseInt(p.m_vertexCount),w=p.m_vertices,S=w[d];g=A>d+1?w[parseInt(d+1)]:w[0];var M=h.s_localTangent;M.Set(g.x-S.x,g.y-S.y);M.Normalize();var V=h.s_localNormal;V.x=M.y;V.y=-M.x;var I=h.s_planePoint;I.Set(.5*(S.x+g.x),.5*(S.y+g.y));var G=h.s_tangent;f=u.R;G.x=f.col1.x*M.x+f.col2.x*M.y;G.y=f.col1.y*M.x+f.col2.y*M.y;var J=h.s_tangent2;J.x=-G.x;J.y=-G.y;var L=h.s_normal;L.x=G.y;L.y=-G.x;var F=h.s_v11,P=h.s_v12;F.x=u.position.x+(f.col1.x*S.x+f.col2.x*S.y);F.y=u.position.y+(f.col1.y*S.x+f.col2.y*S.y);P.x=u.position.x+(f.col1.x*g.x+f.col2.x*g.y);P.y=u.position.y+(f.col1.y*g.x+f.col2.y*g.y);var R=L.x*F.x+L.y*F.y,T=-G.x*F.x-G.y*F.y+a,k=G.x*P.x+G.y*P.y+a,z=h.s_clipPoints1,E=h.s_clipPoints2,N=0;N=h.ClipSegmentToLine(z,C,J,T);if(!(2>N)){N=h.ClipSegmentToLine(E,z,G,k);if(!(2>N)){t.m_localPlaneNormal.SetV(V);t.m_localPoint.SetV(I);for(var j=0,q=0;q<e.b2_maxManifoldPoints;++q){r=E[q];var U=L.x*r.v.x+L.y*r.v.y-R;if(a>=U){var O=t.m_points[j];f=x.R;var W=r.v.x-x.position.x,K=r.v.y-x.position.y;O.m_localPoint.x=W*f.col1.x+K*f.col1.y;O.m_localPoint.y=W*f.col2.x+K*f.col2.y;O.m_id.Set(r.id);O.m_id.features.flip=b;++j}}t.m_pointCount=j}}}}};h.CollideCircles=function(t,i,o,e,n){t.m_pointCount=0;var s,r;s=o.R;r=i.m_p;var a=o.position.x+(s.col1.x*r.x+s.col2.x*r.y),m=o.position.y+(s.col1.y*r.x+s.col2.y*r.y);s=n.R;r=e.m_p;var l=n.position.x+(s.col1.x*r.x+s.col2.x*r.y),c=n.position.y+(s.col1.y*r.x+s.col2.y*r.y),h=l-a,_=c-m,p=h*h+_*_,y=i.m_radius+e.m_radius;if(!(p>y*y)){t.m_type=B.e_circles;t.m_localPoint.SetV(i.m_p);t.m_localPlaneNormal.SetZero();t.m_pointCount=1;t.m_points[0].m_localPoint.SetV(e.m_p);t.m_points[0].m_id.key=0}};h.CollidePolygonAndCircle=function(t,i,o,e,n){t.m_pointCount=0;var s,r,a=0,m=0;r=n.R;s=e.m_p;var l=n.position.x+(r.col1.x*s.x+r.col2.x*s.y),c=n.position.y+(r.col1.y*s.x+r.col2.y*s.y);a=l-o.position.x;m=c-o.position.y;r=o.R;for(var h=a*r.col1.x+m*r.col1.y,_=a*r.col2.x+m*r.col2.y,p=0,y=-Number.MAX_VALUE,u=i.m_radius+e.m_radius,x=parseInt(i.m_vertexCount),f=i.m_vertices,d=i.m_normals,b=0;x>b;++b){s=f[b];a=h-s.x;m=_-s.y;s=d[b];var v=s.x*a+s.y*m;if(v>u)return;if(v>y){y=v;p=b}}var D=parseInt(p),C=parseInt(x>D+1?D+1:0),g=f[D],A=f[C];if(y<Box2D.MIN_VALUE){t.m_pointCount=1;t.m_type=B.e_faceA;t.m_localPlaneNormal.SetV(d[p]);t.m_localPoint.x=.5*(g.x+A.x);t.m_localPoint.y=.5*(g.y+A.y);t.m_points[0].m_localPoint.SetV(e.m_p);t.m_points[0].m_id.key=0}else{var w=(h-g.x)*(A.x-g.x)+(_-g.y)*(A.y-g.y),S=(h-A.x)*(g.x-A.x)+(_-A.y)*(g.y-A.y);if(0>=w){if((h-g.x)*(h-g.x)+(_-g.y)*(_-g.y)>u*u)return;t.m_pointCount=1;t.m_type=B.e_faceA;t.m_localPlaneNormal.x=h-g.x;t.m_localPlaneNormal.y=_-g.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(g);t.m_points[0].m_localPoint.SetV(e.m_p);t.m_points[0].m_id.key=0}else if(0>=S){if((h-A.x)*(h-A.x)+(_-A.y)*(_-A.y)>u*u)return;t.m_pointCount=1;t.m_type=B.e_faceA;t.m_localPlaneNormal.x=h-A.x;t.m_localPlaneNormal.y=_-A.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(A);t.m_points[0].m_localPoint.SetV(e.m_p);t.m_points[0].m_id.key=0}else{var M=.5*(g.x+A.x),V=.5*(g.y+A.y);y=(h-M)*d[D].x+(_-V)*d[D].y;if(y>u)return;t.m_pointCount=1;t.m_type=B.e_faceA;t.m_localPlaneNormal.x=d[D].x;t.m_localPlaneNormal.y=d[D].y;t.m_localPlaneNormal.Normalize();t.m_localPoint.Set(M,V);t.m_points[0].m_localPoint.SetV(e.m_p);t.m_points[0].m_id.key=0}}};h.TestOverlap=function(t,i){var o=i.lowerBound,e=t.upperBound,n=o.x-e.x,s=o.y-e.y;o=t.lowerBound;e=i.upperBound;var r=o.x-e.x,a=o.y-e.y;return n>0||s>0?!1:r>0||a>0?!1:!0};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=h.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=h.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=h.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new a;Box2D.Collision.b2Collision.s_localNormal=new a;Box2D.Collision.b2Collision.s_planePoint=new a;Box2D.Collision.b2Collision.s_normal=new a;Box2D.Collision.b2Collision.s_tangent=new a;Box2D.Collision.b2Collision.s_tangent2=new a;Box2D.Collision.b2Collision.s_v11=new a;Box2D.Collision.b2Collision.s_v12=new a;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new a;Box2D.Collision.b2Collision.b2_nullFeature=255});_.b2ContactID=function(){this.features=new R};_.prototype.b2ContactID=function(){this.features._m_id=this};_.prototype.Set=function(t){this.key=t._key};_.prototype.Copy=function(){var t=new _;t.key=this.key;return t};Object.defineProperty(_.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}});Object.defineProperty(_.prototype,"key",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0);this._key=t;this.features._referenceEdge=255&this._key;this.features._incidentEdge=(65280&this._key)>>8&255;this.features._incidentVertex=(16711680&this._key)>>16&255;this.features._flip=(4278190080&this._key)>>24&255}});p.b2ContactPoint=function(){this.position=new a;this.velocity=new a;this.normal=new a;this.id=new _};y.b2Distance=function(){};y.Distance=function(t,i,o){++y.b2_gjkCalls;var s=o.proxyA,r=o.proxyB,m=o.transformA,l=o.transformB,c=y.s_simplex;c.ReadCache(i,s,m,r,l);for(var h,_=c.m_vertices,p=20,u=y.s_saveA,x=y.s_saveB,f=0,d=c.GetClosestPoint(),b=d.LengthSquared(),v=b,D=0,B=0;p>B;){f=c.m_count;for(D=0;f>D;D++){u[D]=_[D].indexA;x[D]=_[D].indexB}switch(c.m_count){case 1:break;case 2:c.Solve2();break;case 3:c.Solve3();break;default:e.b2Assert(!1)}if(3==c.m_count)break;h=c.GetClosestPoint();v=h.LengthSquared();b=v;var C=c.GetSearchDirection();if(C.LengthSquared()<Box2D.MIN_VALUE*Box2D.MIN_VALUE)break;var g=_[c.m_count];g.indexA=s.GetSupport(n.MulTMV(m.R,C.GetNegative()));g.wA=n.MulX(m,s.GetVertex(g.indexA));g.indexB=r.GetSupport(n.MulTMV(l.R,C));g.wB=n.MulX(l,r.GetVertex(g.indexB));g.w=n.SubtractVV(g.wB,g.wA);++B;++y.b2_gjkIters;var A=!1;for(D=0;f>D;D++)if(g.indexA==u[D]&&g.indexB==x[D]){A=!0;break}if(A)break;++c.m_count}y.b2_gjkMaxIters=n.Max(y.b2_gjkMaxIters,B);c.GetWitnessPoints(t.pointA,t.pointB);t.distance=n.SubtractVV(t.pointA,t.pointB).Length();t.iterations=B;c.WriteCache(i);if(o.useRadii){var w=s.m_radius,S=r.m_radius;if(t.distance>w+S&&t.distance>Box2D.MIN_VALUE){t.distance-=w+S;var M=n.SubtractVV(t.pointB,t.pointA);M.Normalize();t.pointA.x+=w*M.x;t.pointA.y+=w*M.y;t.pointB.x-=S*M.x;t.pointB.y-=S*M.y}else{h=new a;h.x=.5*(t.pointA.x+t.pointB.x);h.y=.5*(t.pointA.y+t.pointB.y);t.pointA.x=t.pointB.x=h.x;t.pointA.y=t.pointB.y=h.y;t.distance=0}}};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new V;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});u.b2DistanceInput=function(){};x.b2DistanceOutput=function(){this.pointA=new a;this.pointB=new a};f.b2DistanceProxy=function(){};f.prototype.Set=function(n){switch(n.GetType()){case o.e_circleShape:var s=n instanceof t?n:null;this.m_vertices=new Vector(1,!0);this.m_vertices[0]=s.m_p;this.m_count=1;this.m_radius=s.m_radius;break;case o.e_polygonShape:var r=n instanceof i?n:null;this.m_vertices=r.m_vertices;this.m_count=r.m_vertexCount;this.m_radius=r.m_radius;break;default:e.b2Assert(!1)}};f.prototype.GetSupport=function(t){for(var i=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,e=1;e<this.m_count;++e){var n=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;if(n>o){i=e;o=n}}return i};f.prototype.GetSupportVertex=function(t){for(var i=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,e=1;e<this.m_count;++e){var n=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;if(n>o){i=e;o=n}}return this.m_vertices[i]};f.prototype.GetVertexCount=function(){return this.m_count};f.prototype.GetVertex=function(t){void 0===t&&(t=0);e.b2Assert(t>=0&&t<this.m_count);return this.m_vertices[t]};d.b2DynamicTree=function(){};d.prototype.b2DynamicTree=function(){this.m_root=null;this.m_freeList=null;this.m_path=0;this.m_insertionCount=0};d.prototype.CreateProxy=function(t,i){var o=this.AllocateNode(),n=e.b2_aabbExtension,s=e.b2_aabbExtension;o.aabb.lowerBound.x=t.lowerBound.x-n;
o.aabb.lowerBound.y=t.lowerBound.y-s;o.aabb.upperBound.x=t.upperBound.x+n;o.aabb.upperBound.y=t.upperBound.y+s;o.userData=i;this.InsertLeaf(o);return o};d.prototype.DestroyProxy=function(t){this.RemoveLeaf(t);this.FreeNode(t)};d.prototype.MoveProxy=function(t,i,o){e.b2Assert(t.IsLeaf());if(t.aabb.Contains(i))return!1;this.RemoveLeaf(t);var n=e.b2_aabbExtension+e.b2_aabbMultiplier*(o.x>0?o.x:-o.x),s=e.b2_aabbExtension+e.b2_aabbMultiplier*(o.y>0?o.y:-o.y);t.aabb.lowerBound.x=i.lowerBound.x-n;t.aabb.lowerBound.y=i.lowerBound.y-s;t.aabb.upperBound.x=i.upperBound.x+n;t.aabb.upperBound.y=i.upperBound.y+s;this.InsertLeaf(t);return!0};d.prototype.Rebalance=function(t){void 0===t&&(t=0);if(null!=this.m_root)for(var i=0;t>i;i++){for(var o=this.m_root,e=0;0==o.IsLeaf();){o=this.m_path>>e&1?o.child2:o.child1;e=e+1&31}++this.m_path;this.RemoveLeaf(o);this.InsertLeaf(o)}};d.prototype.GetFatAABB=function(t){return t.aabb};d.prototype.GetUserData=function(t){return t.userData};d.prototype.Query=function(t,i){if(null!=this.m_root){var o=new Vector,e=0;o[e++]=this.m_root;for(;e>0;){var n=o[--e];if(n.aabb.TestOverlap(i))if(n.IsLeaf()){var s=t(n);if(!s)return}else{o[e++]=n.child1;o[e++]=n.child2}}}};d.prototype.RayCast=function(t,i){if(null!=this.m_root){var o=i.p1,e=i.p2,s=n.SubtractVV(o,e);s.Normalize();var r=n.CrossFV(1,s),a=n.AbsV(r),l=i.maxFraction,c=new m,h=0,_=0;h=o.x+l*(e.x-o.x);_=o.y+l*(e.y-o.y);c.lowerBound.x=Math.min(o.x,h);c.lowerBound.y=Math.min(o.y,_);c.upperBound.x=Math.max(o.x,h);c.upperBound.y=Math.max(o.y,_);var p=new Vector,y=0;p[y++]=this.m_root;for(;y>0;){var u=p[--y];if(0!=u.aabb.TestOverlap(c)){var x=u.aabb.GetCenter(),f=u.aabb.GetExtents(),d=Math.abs(r.x*(o.x-x.x)+r.y*(o.y-x.y))-a.x*f.x-a.y*f.y;if(!(d>0))if(u.IsLeaf()){var b=new A;b.p1=i.p1;b.p2=i.p2;b.maxFraction=i.maxFraction;l=t(b,u);if(0==l)return;if(l>0){h=o.x+l*(e.x-o.x);_=o.y+l*(e.y-o.y);c.lowerBound.x=Math.min(o.x,h);c.lowerBound.y=Math.min(o.y,_);c.upperBound.x=Math.max(o.x,h);c.upperBound.y=Math.max(o.y,_)}}else{p[y++]=u.child1;p[y++]=u.child2}}}}};d.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;this.m_freeList=t.parent;t.parent=null;t.child1=null;t.child2=null;return t}return new v};d.prototype.FreeNode=function(t){t.parent=this.m_freeList;this.m_freeList=t};d.prototype.InsertLeaf=function(t){++this.m_insertionCount;if(null!=this.m_root){var i=t.aabb.GetCenter(),o=this.m_root;if(0==o.IsLeaf())do{var e=o.child1,n=o.child2,s=Math.abs((e.aabb.lowerBound.x+e.aabb.upperBound.x)/2-i.x)+Math.abs((e.aabb.lowerBound.y+e.aabb.upperBound.y)/2-i.y),r=Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-i.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-i.y);o=r>s?e:n}while(0==o.IsLeaf());var a=o.parent,m=this.AllocateNode();m.parent=a;m.userData=null;m.aabb.Combine(t.aabb,o.aabb);if(a){o.parent.child1==o?a.child1=m:a.child2=m;m.child1=o;m.child2=t;o.parent=m;t.parent=m;do{if(a.aabb.Contains(m.aabb))break;a.aabb.Combine(a.child1.aabb,a.child2.aabb);m=a;a=a.parent}while(a)}else{m.child1=o;m.child2=t;o.parent=m;t.parent=m;this.m_root=m}}else{this.m_root=t;this.m_root.parent=null}};d.prototype.RemoveLeaf=function(t){if(t!=this.m_root){var i,o=t.parent,e=o.parent;i=o.child1==t?o.child2:o.child1;if(e){e.child1==o?e.child1=i:e.child2=i;i.parent=e;this.FreeNode(o);for(;e;){var n=e.aabb;e.aabb=m.Combine(e.child1.aabb,e.child2.aabb);if(n.Contains(e.aabb))break;e=e.parent}}else{this.m_root=i;i.parent=null;this.FreeNode(o)}}else this.m_root=null};b.b2DynamicTreeBroadPhase=function(){this.m_tree=new d;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};b.prototype.CreateProxy=function(t,i){var o=this.m_tree.CreateProxy(t,i);++this.m_proxyCount;this.BufferMove(o);return o};b.prototype.DestroyProxy=function(t){this.UnBufferMove(t);--this.m_proxyCount;this.m_tree.DestroyProxy(t)};b.prototype.MoveProxy=function(t,i,o){var e=this.m_tree.MoveProxy(t,i,o);e&&this.BufferMove(t)};b.prototype.TestOverlap=function(t,i){var o=this.m_tree.GetFatAABB(t),e=this.m_tree.GetFatAABB(i);return o.TestOverlap(e)};b.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)};b.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)};b.prototype.GetProxyCount=function(){return this.m_proxyCount};b.prototype.UpdatePairs=function(t){function i(t){if(t==e)return!0;o.m_pairCount==o.m_pairBuffer.length&&(o.m_pairBuffer[o.m_pairCount]=new D);var i=o.m_pairBuffer[o.m_pairCount];i.proxyA=e>t?t:e;i.proxyB=t>=e?t:e;++o.m_pairCount;return!0}var o=this;o.m_pairCount=0;var e,n=0;for(n=0;n<o.m_moveBuffer.length;++n){e=o.m_moveBuffer[n];var s=o.m_tree.GetFatAABB(e);o.m_tree.Query(i,s)}o.m_moveBuffer.length=0;for(var n=0;n<o.m_pairCount;){var r=o.m_pairBuffer[n],a=o.m_tree.GetUserData(r.proxyA),m=o.m_tree.GetUserData(r.proxyB);t(a,m);++n;for(;n<o.m_pairCount;){var l=o.m_pairBuffer[n];if(l.proxyA!=r.proxyA||l.proxyB!=r.proxyB)break;++n}}};b.prototype.Query=function(t,i){this.m_tree.Query(t,i)};b.prototype.RayCast=function(t,i){this.m_tree.RayCast(t,i)};b.prototype.Validate=function(){};b.prototype.Rebalance=function(t){void 0===t&&(t=0);this.m_tree.Rebalance(t)};b.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t};b.prototype.UnBufferMove=function(t){var i=parseInt(this.m_moveBuffer.indexOf(t));this.m_moveBuffer.splice(i,1)};b.prototype.ComparePairs=function(){return 0};b.__implements={};b.__implements[T]=!0;v.b2DynamicTreeNode=function(){this.aabb=new m};v.prototype.IsLeaf=function(){return null==this.child1};D.b2DynamicTreePair=function(){};B.b2Manifold=function(){this.m_pointCount=0};B.prototype.b2Manifold=function(){this.m_points=new Vector(e.b2_maxManifoldPoints);for(var t=0;t<e.b2_maxManifoldPoints;t++)this.m_points[t]=new C;this.m_localPlaneNormal=new a;this.m_localPoint=new a};B.prototype.Reset=function(){for(var t=0;t<e.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof C?this.m_points[t]:null).Reset();this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_type=0;this.m_pointCount=0};B.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var i=0;i<e.b2_maxManifoldPoints;i++)(this.m_points[i]instanceof C?this.m_points[i]:null).Set(t.m_points[i]);this.m_localPlaneNormal.SetV(t.m_localPlaneNormal);this.m_localPoint.SetV(t.m_localPoint);this.m_type=t.m_type};B.prototype.Copy=function(){var t=new B;t.Set(this);return t};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});C.b2ManifoldPoint=function(){this.m_localPoint=new a;this.m_id=new _};C.prototype.b2ManifoldPoint=function(){this.Reset()};C.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_normalImpulse=0;this.m_tangentImpulse=0;this.m_id.key=0};C.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint);this.m_normalImpulse=t.m_normalImpulse;this.m_tangentImpulse=t.m_tangentImpulse;this.m_id.Set(t.m_id)};g.b2Point=function(){this.p=new a};g.prototype.Support=function(t,i,o){void 0===i&&(i=0);void 0===o&&(o=0);return this.p};g.prototype.GetFirstVertex=function(){return this.p};A.b2RayCastInput=function(){this.p1=new a;this.p2=new a};A.prototype.b2RayCastInput=function(t,i,o){void 0===t&&(t=null);void 0===i&&(i=null);void 0===o&&(o=1);t&&this.p1.SetV(t);i&&this.p2.SetV(i);this.maxFraction=o};w.b2RayCastOutput=function(){this.normal=new a};S.b2Segment=function(){this.p1=new a;this.p2=new a};S.prototype.TestSegment=function(t,i,o,e){void 0===e&&(e=0);var n=o.p1,s=o.p2.x-n.x,r=o.p2.y-n.y,a=this.p2.x-this.p1.x,m=this.p2.y-this.p1.y,l=m,c=-a,h=100*Box2D.MIN_VALUE,_=-(s*l+r*c);if(_>h){var p=n.x-this.p1.x,y=n.y-this.p1.y,u=p*l+y*c;if(u>=0&&e*_>=u){var x=-s*y+r*p;if(x>=-h*_&&_*(1+h)>=x){u/=_;var f=Math.sqrt(l*l+c*c);l/=f;c/=f;t[0]=u;i.Set(l,c);return!0}}}return!1};S.prototype.Extend=function(t){this.ExtendForward(t);this.ExtendBackward(t)};S.prototype.ExtendForward=function(t){var i=this.p2.x-this.p1.x,o=this.p2.y-this.p1.y,e=Math.min(i>0?(t.upperBound.x-this.p1.x)/i:0>i?(t.lowerBound.x-this.p1.x)/i:Number.POSITIVE_INFINITY,o>0?(t.upperBound.y-this.p1.y)/o:0>o?(t.lowerBound.y-this.p1.y)/o:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+i*e;this.p2.y=this.p1.y+o*e};S.prototype.ExtendBackward=function(t){var i=-this.p2.x+this.p1.x,o=-this.p2.y+this.p1.y,e=Math.min(i>0?(t.upperBound.x-this.p2.x)/i:0>i?(t.lowerBound.x-this.p2.x)/i:Number.POSITIVE_INFINITY,o>0?(t.upperBound.y-this.p2.y)/o:0>o?(t.lowerBound.y-this.p2.y)/o:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+i*e;this.p1.y=this.p2.y+o*e};M.b2SeparationFunction=function(){this.m_localPoint=new a;this.m_axis=new a};M.prototype.Initialize=function(t,i,o,s,r){this.m_proxyA=i;this.m_proxyB=s;var m=parseInt(t.count);e.b2Assert(m>0&&3>m);var l,c,h,_,p,y,u,x,f=0,d=0,b=0,v=0,D=0,B=0,C=0,g=0;if(1==m){this.m_type=M.e_points;l=this.m_proxyA.GetVertex(t.indexA[0]);_=this.m_proxyB.GetVertex(t.indexB[0]);x=l;u=o.R;f=o.position.x+(u.col1.x*x.x+u.col2.x*x.y);d=o.position.y+(u.col1.y*x.x+u.col2.y*x.y);x=_;u=r.R;b=r.position.x+(u.col1.x*x.x+u.col2.x*x.y);v=r.position.y+(u.col1.y*x.x+u.col2.y*x.y);this.m_axis.x=b-f;this.m_axis.y=v-d;this.m_axis.Normalize()}else if(t.indexB[0]==t.indexB[1]){this.m_type=M.e_faceA;c=this.m_proxyA.GetVertex(t.indexA[0]);h=this.m_proxyA.GetVertex(t.indexA[1]);_=this.m_proxyB.GetVertex(t.indexB[0]);this.m_localPoint.x=.5*(c.x+h.x);this.m_localPoint.y=.5*(c.y+h.y);this.m_axis=n.CrossVF(n.SubtractVV(h,c),1);this.m_axis.Normalize();x=this.m_axis;u=o.R;D=u.col1.x*x.x+u.col2.x*x.y;B=u.col1.y*x.x+u.col2.y*x.y;x=this.m_localPoint;u=o.R;f=o.position.x+(u.col1.x*x.x+u.col2.x*x.y);d=o.position.y+(u.col1.y*x.x+u.col2.y*x.y);x=_;u=r.R;b=r.position.x+(u.col1.x*x.x+u.col2.x*x.y);v=r.position.y+(u.col1.y*x.x+u.col2.y*x.y);C=(b-f)*D+(v-d)*B;0>C&&this.m_axis.NegativeSelf()}else if(t.indexA[0]==t.indexA[0]){this.m_type=M.e_faceB;p=this.m_proxyB.GetVertex(t.indexB[0]);y=this.m_proxyB.GetVertex(t.indexB[1]);l=this.m_proxyA.GetVertex(t.indexA[0]);this.m_localPoint.x=.5*(p.x+y.x);this.m_localPoint.y=.5*(p.y+y.y);this.m_axis=n.CrossVF(n.SubtractVV(y,p),1);this.m_axis.Normalize();x=this.m_axis;u=r.R;D=u.col1.x*x.x+u.col2.x*x.y;B=u.col1.y*x.x+u.col2.y*x.y;x=this.m_localPoint;u=r.R;b=r.position.x+(u.col1.x*x.x+u.col2.x*x.y);v=r.position.y+(u.col1.y*x.x+u.col2.y*x.y);x=l;u=o.R;f=o.position.x+(u.col1.x*x.x+u.col2.x*x.y);d=o.position.y+(u.col1.y*x.x+u.col2.y*x.y);C=(f-b)*D+(d-v)*B;0>C&&this.m_axis.NegativeSelf()}else{c=this.m_proxyA.GetVertex(t.indexA[0]);h=this.m_proxyA.GetVertex(t.indexA[1]);p=this.m_proxyB.GetVertex(t.indexB[0]);y=this.m_proxyB.GetVertex(t.indexB[1]);var A=(n.MulX(o,l),n.MulMV(o.R,n.SubtractVV(h,c))),w=(n.MulX(r,_),n.MulMV(r.R,n.SubtractVV(y,p))),S=A.x*A.x+A.y*A.y,V=w.x*w.x+w.y*w.y,I=n.SubtractVV(w,A),G=A.x*I.x+A.y*I.y,J=w.x*I.x+w.y*I.y,L=A.x*w.x+A.y*w.y,F=S*V-L*L;C=0;0!=F&&(C=n.Clamp((L*J-G*V)/F,0,1));var P=(L*C+J)/V;if(0>P){P=0;C=n.Clamp((L-G)/S,0,1)}l=new a;l.x=c.x+C*(h.x-c.x);l.y=c.y+C*(h.y-c.y);_=new a;_.x=p.x+C*(y.x-p.x);_.y=p.y+C*(y.y-p.y);if(0==C||1==C){this.m_type=M.e_faceB;this.m_axis=n.CrossVF(n.SubtractVV(y,p),1);this.m_axis.Normalize();this.m_localPoint=_;x=this.m_axis;u=r.R;D=u.col1.x*x.x+u.col2.x*x.y;B=u.col1.y*x.x+u.col2.y*x.y;x=this.m_localPoint;u=r.R;b=r.position.x+(u.col1.x*x.x+u.col2.x*x.y);v=r.position.y+(u.col1.y*x.x+u.col2.y*x.y);x=l;u=o.R;f=o.position.x+(u.col1.x*x.x+u.col2.x*x.y);d=o.position.y+(u.col1.y*x.x+u.col2.y*x.y);g=(f-b)*D+(d-v)*B;0>C&&this.m_axis.NegativeSelf()}else{this.m_type=M.e_faceA;this.m_axis=n.CrossVF(n.SubtractVV(h,c),1);this.m_localPoint=l;x=this.m_axis;u=o.R;D=u.col1.x*x.x+u.col2.x*x.y;B=u.col1.y*x.x+u.col2.y*x.y;x=this.m_localPoint;u=o.R;f=o.position.x+(u.col1.x*x.x+u.col2.x*x.y);d=o.position.y+(u.col1.y*x.x+u.col2.y*x.y);x=_;u=r.R;b=r.position.x+(u.col1.x*x.x+u.col2.x*x.y);v=r.position.y+(u.col1.y*x.x+u.col2.y*x.y);g=(b-f)*D+(v-d)*B;0>C&&this.m_axis.NegativeSelf()}}};M.prototype.Evaluate=function(t,i){var o,s,r,a,m,l,c,h=0;switch(this.m_type){case M.e_points:o=n.MulTMV(t.R,this.m_axis);s=n.MulTMV(i.R,this.m_axis.GetNegative());r=this.m_proxyA.GetSupportVertex(o);a=this.m_proxyB.GetSupportVertex(s);m=n.MulX(t,r);l=n.MulX(i,a);h=(l.x-m.x)*this.m_axis.x+(l.y-m.y)*this.m_axis.y;return h;case M.e_faceA:c=n.MulMV(t.R,this.m_axis);m=n.MulX(t,this.m_localPoint);s=n.MulTMV(i.R,c.GetNegative());a=this.m_proxyB.GetSupportVertex(s);l=n.MulX(i,a);h=(l.x-m.x)*c.x+(l.y-m.y)*c.y;return h;case M.e_faceB:c=n.MulMV(i.R,this.m_axis);l=n.MulX(i,this.m_localPoint);o=n.MulTMV(t.R,c.GetNegative());r=this.m_proxyA.GetSupportVertex(o);m=n.MulX(t,r);h=(m.x-l.x)*c.x+(m.y-l.y)*c.y;return h;default:e.b2Assert(!1);return 0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4});V.b2Simplex=function(){this.m_v1=new G;this.m_v2=new G;this.m_v3=new G;this.m_vertices=new Vector(3)};V.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};V.prototype.ReadCache=function(t,i,o,s,r){e.b2Assert(0<=t.count&&t.count<=3);var a,m;this.m_count=t.count;for(var l=this.m_vertices,c=0;c<this.m_count;c++){var h=l[c];h.indexA=t.indexA[c];h.indexB=t.indexB[c];a=i.GetVertex(h.indexA);m=s.GetVertex(h.indexB);h.wA=n.MulX(o,a);h.wB=n.MulX(r,m);h.w=n.SubtractVV(h.wB,h.wA);h.a=0}if(this.m_count>1){var _=t.metric,p=this.GetMetric();(.5*_>p||p>2*_||p<Box2D.MIN_VALUE)&&(this.m_count=0)}if(0==this.m_count){h=l[0];h.indexA=0;h.indexB=0;a=i.GetVertex(0);m=s.GetVertex(0);h.wA=n.MulX(o,a);h.wB=n.MulX(r,m);h.w=n.SubtractVV(h.wB,h.wA);this.m_count=1}};V.prototype.WriteCache=function(t){t.metric=this.GetMetric();t.count=Box2D.parseUInt(this.m_count);for(var i=this.m_vertices,o=0;o<this.m_count;o++){t.indexA[o]=Box2D.parseUInt(i[o].indexA);t.indexB[o]=Box2D.parseUInt(i[o].indexB)}};V.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var t=n.SubtractVV(this.m_v2.w,this.m_v1.w),i=n.CrossVV(t,this.m_v1.w.GetNegative());return i>0?n.CrossFV(1,t):n.CrossVF(t,1);default:e.b2Assert(!1);return new a}};V.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:e.b2Assert(!1);return new a;case 1:return this.m_v1.w;case 2:return new a(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:e.b2Assert(!1);return new a}};V.prototype.GetWitnessPoints=function(t,i){switch(this.m_count){case 0:e.b2Assert(!1);break;case 1:t.SetV(this.m_v1.wA);i.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;i.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;i.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:i.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;i.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:e.b2Assert(!1)}};V.prototype.GetMetric=function(){switch(this.m_count){case 0:e.b2Assert(!1);return 0;case 1:return 0;case 2:return n.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return n.CrossVV(n.SubtractVV(this.m_v2.w,this.m_v1.w),n.SubtractVV(this.m_v3.w,this.m_v1.w));default:e.b2Assert(!1);return 0}};V.prototype.Solve2=function(){var t=this.m_v1.w,i=this.m_v2.w,o=n.SubtractVV(i,t),e=-(t.x*o.x+t.y*o.y);if(0>=e){this.m_v1.a=1;this.m_count=1}else{var s=i.x*o.x+i.y*o.y;if(0>=s){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2)}else{var r=1/(s+e);this.m_v1.a=s*r;this.m_v2.a=e*r;this.m_count=2}}};V.prototype.Solve3=function(){var t=this.m_v1.w,i=this.m_v2.w,o=this.m_v3.w,e=n.SubtractVV(i,t),s=n.Dot(t,e),r=n.Dot(i,e),a=r,m=-s,l=n.SubtractVV(o,t),c=n.Dot(t,l),h=n.Dot(o,l),_=h,p=-c,y=n.SubtractVV(o,i),u=n.Dot(i,y),x=n.Dot(o,y),f=x,d=-u,b=n.CrossVV(e,l),v=b*n.CrossVV(i,o),D=b*n.CrossVV(o,t),B=b*n.CrossVV(t,i);if(0>=m&&0>=p){this.m_v1.a=1;this.m_count=1}else if(a>0&&m>0&&0>=B){var C=1/(a+m);this.m_v1.a=a*C;this.m_v2.a=m*C;this.m_count=2}else if(_>0&&p>0&&0>=D){var g=1/(_+p);this.m_v1.a=_*g;this.m_v3.a=p*g;this.m_count=2;this.m_v2.Set(this.m_v3)}else if(0>=a&&0>=d){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2)}else if(0>=_&&0>=f){this.m_v3.a=1;this.m_count=1;this.m_v1.Set(this.m_v3)}else if(f>0&&d>0&&0>=v){var A=1/(f+d);this.m_v2.a=f*A;this.m_v3.a=d*A;this.m_count=2;this.m_v1.Set(this.m_v3)}else{var w=1/(v+D+B);this.m_v1.a=v*w;this.m_v2.a=D*w;this.m_v3.a=B*w;this.m_count=3}};I.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};G.b2SimplexVertex=function(){};G.prototype.Set=function(t){this.wA.SetV(t.wA);this.wB.SetV(t.wB);this.w.SetV(t.w);this.a=t.a;this.indexA=t.indexA;this.indexB=t.indexB};J.b2TimeOfImpact=function(){};J.TimeOfImpact=function(t){++J.b2_toiCalls;var i=t.proxyA,o=t.proxyB,s=t.sweepA,r=t.sweepB;e.b2Assert(s.t0==r.t0);e.b2Assert(1-s.t0>Box2D.MIN_VALUE);var a=i.m_radius+o.m_radius,m=t.tolerance,l=0,c=1e3,h=0,_=0;J.s_cache.count=0;J.s_distanceInput.useRadii=!1;for(;;){s.GetTransform(J.s_xfA,l);r.GetTransform(J.s_xfB,l);J.s_distanceInput.proxyA=i;J.s_distanceInput.proxyB=o;J.s_distanceInput.transformA=J.s_xfA;J.s_distanceInput.transformB=J.s_xfB;y.Distance(J.s_distanceOutput,J.s_cache,J.s_distanceInput);if(J.s_distanceOutput.distance<=0){l=1;break}J.s_fcn.Initialize(J.s_cache,i,J.s_xfA,o,J.s_xfB);var p=J.s_fcn.Evaluate(J.s_xfA,J.s_xfB);if(0>=p){l=1;break}0==h&&(_=p>a?n.Max(a-m,.75*a):n.Max(p-m,.02*a));if(.5*m>p-_){if(0==h){l=1;break}break}var u=l,x=l,f=1,d=p;s.GetTransform(J.s_xfA,f);r.GetTransform(J.s_xfB,f);var b=J.s_fcn.Evaluate(J.s_xfA,J.s_xfB);if(b>=_){l=1;break}for(var v=0;;){var D=0;D=1&v?x+(_-d)*(f-x)/(b-d):.5*(x+f);s.GetTransform(J.s_xfA,D);r.GetTransform(J.s_xfB,D);var B=J.s_fcn.Evaluate(J.s_xfA,J.s_xfB);if(n.Abs(B-_)<.025*m){u=D;break}if(B>_){x=D;d=B}else{f=D;b=B}++v;++J.b2_toiRootIters;if(50==v)break}J.b2_toiMaxRootIters=n.Max(J.b2_toiMaxRootIters,v);if(u<(1+100*Box2D.MIN_VALUE)*l)break;l=u;h++;++J.b2_toiIters;if(h==c)break}J.b2_toiMaxIters=n.Max(J.b2_toiMaxIters,h);return l};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new I;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new u;Box2D.Collision.b2TimeOfImpact.s_xfA=new r;Box2D.Collision.b2TimeOfImpact.s_xfB=new r;Box2D.Collision.b2TimeOfImpact.s_fcn=new M;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new x});L.b2TOIInput=function(){this.proxyA=new f;this.proxyB=new f;this.sweepA=new s;this.sweepB=new s};F.b2WorldManifold=function(){this.m_normal=new a};F.prototype.b2WorldManifold=function(){this.m_points=new Vector(e.b2_maxManifoldPoints);for(var t=0;t<e.b2_maxManifoldPoints;t++)this.m_points[t]=new a};F.prototype.Initialize=function(t,i,o,e,n){void 0===o&&(o=0);void 0===n&&(n=0);if(0!=t.m_pointCount){var s,r,a=0,m=0,l=0,c=0,h=0,_=0,p=0;switch(t.m_type){case B.e_circles:r=i.R;s=t.m_localPoint;var y=i.position.x+r.col1.x*s.x+r.col2.x*s.y,u=i.position.y+r.col1.y*s.x+r.col2.y*s.y;r=e.R;s=t.m_points[0].m_localPoint;var x=e.position.x+r.col1.x*s.x+r.col2.x*s.y,f=e.position.y+r.col1.y*s.x+r.col2.y*s.y,d=x-y,b=f-u,v=d*d+b*b;if(v>Box2D.MIN_VALUE*Box2D.MIN_VALUE){var D=Math.sqrt(v);this.m_normal.x=d/D;this.m_normal.y=b/D}else{this.m_normal.x=1;this.m_normal.y=0}var C=y+o*this.m_normal.x,g=u+o*this.m_normal.y,A=x-n*this.m_normal.x,w=f-n*this.m_normal.y;this.m_points[0].x=.5*(C+A);this.m_points[0].y=.5*(g+w);break;case B.e_faceA:r=i.R;s=t.m_localPlaneNormal;m=r.col1.x*s.x+r.col2.x*s.y;l=r.col1.y*s.x+r.col2.y*s.y;r=i.R;s=t.m_localPoint;c=i.position.x+r.col1.x*s.x+r.col2.x*s.y;h=i.position.y+r.col1.y*s.x+r.col2.y*s.y;this.m_normal.x=m;this.m_normal.y=l;for(a=0;a<t.m_pointCount;a++){r=e.R;s=t.m_points[a].m_localPoint;_=e.position.x+r.col1.x*s.x+r.col2.x*s.y;p=e.position.y+r.col1.y*s.x+r.col2.y*s.y;this.m_points[a].x=_+.5*(o-(_-c)*m-(p-h)*l-n)*m;this.m_points[a].y=p+.5*(o-(_-c)*m-(p-h)*l-n)*l}break;case B.e_faceB:r=e.R;s=t.m_localPlaneNormal;m=r.col1.x*s.x+r.col2.x*s.y;l=r.col1.y*s.x+r.col2.y*s.y;r=e.R;s=t.m_localPoint;c=e.position.x+r.col1.x*s.x+r.col2.x*s.y;h=e.position.y+r.col1.y*s.x+r.col2.y*s.y;this.m_normal.x=-m;this.m_normal.y=-l;for(a=0;a<t.m_pointCount;a++){r=i.R;s=t.m_points[a].m_localPoint;_=i.position.x+r.col1.x*s.x+r.col2.x*s.y;p=i.position.y+r.col1.y*s.x+r.col2.y*s.y;this.m_points[a].x=_+.5*(n-(_-c)*m-(p-h)*l-o)*m;this.m_points[a].y=p+.5*(n-(_-c)*m-(p-h)*l-o)*l}}}};P.ClipVertex=function(){this.v=new a;this.id=new _};P.prototype.Set=function(t){this.v.SetV(t.v);this.id.Set(t.id)};R.Features=function(){};Object.defineProperty(R.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}});Object.defineProperty(R.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0);this._referenceEdge=t;this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}});Object.defineProperty(R.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}});Object.defineProperty(R.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0);this._incidentEdge=t;this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280}});Object.defineProperty(R.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}});Object.defineProperty(R.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0);this._incidentVertex=t;this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680}});Object.defineProperty(R.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}});Object.defineProperty(R.prototype,"flip",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0);this._flip=t;this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080}})}();!function(){{var t=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),i=Box2D.Collision.Shapes.b2CircleShape,o=Box2D.Collision.Shapes.b2EdgeChainDef,e=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2MassData,s=Box2D.Collision.Shapes.b2PolygonShape,r=Box2D.Collision.Shapes.b2Shape,a=Box2D.Common.Math.b2Mat22,m=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),l=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform),c=Box2D.Common.Math.b2Vec2,h=(Box2D.Common.Math.b2Vec3,Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance),_=Box2D.Collision.b2DistanceInput,p=Box2D.Collision.b2DistanceOutput,y=Box2D.Collision.b2DistanceProxy,u=(Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache);Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase}Box2D.inherit(i,Box2D.Collision.Shapes.b2Shape);i.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;i.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new c};i.prototype.Copy=function(){var t=new i;t.Set(this);return t};i.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,i)){var o=t instanceof i?t:null;this.m_p.SetV(o.m_p)}};i.prototype.TestPoint=function(t,i){var o=t.R,e=t.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y),n=t.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y);e=i.x-e;n=i.y-n;return e*e+n*n<=this.m_radius*this.m_radius};i.prototype.RayCast=function(t,i,o){var e=o.R,n=o.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),s=o.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y),r=i.p1.x-n,a=i.p1.y-s,m=r*r+a*a-this.m_radius*this.m_radius,l=i.p2.x-i.p1.x,c=i.p2.y-i.p1.y,h=r*l+a*c,_=l*l+c*c,p=h*h-_*m;if(0>p||_<Box2D.MIN_VALUE)return!1;var y=-(h+Math.sqrt(p));if(y>=0&&y<=i.maxFraction*_){y/=_;t.fraction=y;t.normal.x=r+y*l;t.normal.y=a+y*c;t.normal.Normalize();return!0}return!1};i.prototype.ComputeAABB=function(t,i){var o=i.R,e=i.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y),n=i.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y);t.lowerBound.Set(e-this.m_radius,n-this.m_radius);t.upperBound.Set(e+this.m_radius,n+this.m_radius)};i.prototype.ComputeMass=function(i,o){void 0===o&&(o=0);i.mass=o*t.b2_pi*this.m_radius*this.m_radius;i.center.SetV(this.m_p);i.I=i.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};i.prototype.ComputeSubmergedArea=function(t,i,o,e){void 0===i&&(i=0);var n=m.MulX(o,this.m_p),s=-(m.Dot(t,n)-i);if(s<-this.m_radius+Box2D.MIN_VALUE)return 0;if(s>this.m_radius){e.SetV(n);return Math.PI*this.m_radius*this.m_radius}var r=this.m_radius*this.m_radius,a=s*s,l=r*(Math.asin(s/this.m_radius)+Math.PI/2)+s*Math.sqrt(r-a),c=-2/3*Math.pow(r-a,1.5)/l;e.x=n.x+t.x*c;e.y=n.y+t.y*c;return l};i.prototype.GetLocalPosition=function(){return this.m_p};i.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)};i.prototype.GetRadius=function(){return this.m_radius};i.prototype.SetRadius=function(t){void 0===t&&(t=0);this.m_radius=t};i.prototype.b2CircleShape=function(t){void 0===t&&(t=0);this.__super.b2Shape.call(this);this.m_type=r.e_circleShape;this.m_radius=t};o.b2EdgeChainDef=function(){};o.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=!0;this.vertices=[]};Box2D.inherit(e,Box2D.Collision.Shapes.b2Shape);e.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;e.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new c;this.m_v1=new c;this.m_v2=new c;this.m_coreV1=new c;this.m_coreV2=new c;this.m_normal=new c;this.m_direction=new c;this.m_cornerDir1=new c;this.m_cornerDir2=new c};e.prototype.TestPoint=function(){return!1};e.prototype.RayCast=function(t,i,o){var e,n=i.p2.x-i.p1.x,s=i.p2.y-i.p1.y;e=o.R;var r=o.position.x+(e.col1.x*this.m_v1.x+e.col2.x*this.m_v1.y),a=o.position.y+(e.col1.y*this.m_v1.x+e.col2.y*this.m_v1.y),m=o.position.y+(e.col1.y*this.m_v2.x+e.col2.y*this.m_v2.y)-a,l=-(o.position.x+(e.col1.x*this.m_v2.x+e.col2.x*this.m_v2.y)-r),c=100*Box2D.MIN_VALUE,h=-(n*m+s*l);if(h>c){var _=i.p1.x-r,p=i.p1.y-a,y=_*m+p*l;if(y>=0&&y<=i.maxFraction*h){var u=-n*p+s*_;if(u>=-c*h&&h*(1+c)>=u){y/=h;t.fraction=y;var x=Math.sqrt(m*m+l*l);t.normal.x=m/x;t.normal.y=l/x;return!0}}}return!1};e.prototype.ComputeAABB=function(t,i){var o=i.R,e=i.position.x+(o.col1.x*this.m_v1.x+o.col2.x*this.m_v1.y),n=i.position.y+(o.col1.y*this.m_v1.x+o.col2.y*this.m_v1.y),s=i.position.x+(o.col1.x*this.m_v2.x+o.col2.x*this.m_v2.y),r=i.position.y+(o.col1.y*this.m_v2.x+o.col2.y*this.m_v2.y);if(s>e){t.lowerBound.x=e;t.upperBound.x=s}else{t.lowerBound.x=s;t.upperBound.x=e}if(r>n){t.lowerBound.y=n;t.upperBound.y=r}else{t.lowerBound.y=r;t.upperBound.y=n}};e.prototype.ComputeMass=function(t,i){void 0===i&&(i=0);t.mass=0;t.center.SetV(this.m_v1);t.I=0};e.prototype.ComputeSubmergedArea=function(t,i,o,e){void 0===i&&(i=0);var n=new c(t.x*i,t.y*i),s=m.MulX(o,this.m_v1),r=m.MulX(o,this.m_v2),a=m.Dot(t,s)-i,l=m.Dot(t,r)-i;if(a>0){if(l>0)return 0;s.x=-l/(a-l)*s.x+a/(a-l)*r.x;s.y=-l/(a-l)*s.y+a/(a-l)*r.y}else if(l>0){r.x=-l/(a-l)*s.x+a/(a-l)*r.x;r.y=-l/(a-l)*s.y+a/(a-l)*r.y}e.x=(n.x+s.x+r.x)/3;e.y=(n.y+s.y+r.y)/3;return.5*((s.x-n.x)*(r.y-n.y)-(s.y-n.y)*(r.x-n.x))};e.prototype.GetLength=function(){return this.m_length};e.prototype.GetVertex1=function(){return this.m_v1};e.prototype.GetVertex2=function(){return this.m_v2};e.prototype.GetCoreVertex1=function(){return this.m_coreV1};e.prototype.GetCoreVertex2=function(){return this.m_coreV2};e.prototype.GetNormalVector=function(){return this.m_normal};e.prototype.GetDirectionVector=function(){return this.m_direction};e.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};e.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};e.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};e.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};e.prototype.GetFirstVertex=function(t){var i=t.R;return new c(t.position.x+(i.col1.x*this.m_coreV1.x+i.col2.x*this.m_coreV1.y),t.position.y+(i.col1.y*this.m_coreV1.x+i.col2.y*this.m_coreV1.y))};e.prototype.GetNextEdge=function(){return this.m_nextEdge};e.prototype.GetPrevEdge=function(){return this.m_prevEdge};e.prototype.Support=function(t,i,o){void 0===i&&(i=0);void 0===o&&(o=0);var e=t.R,n=t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),s=t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y),r=t.position.x+(e.col1.x*this.m_coreV2.x+e.col2.x*this.m_coreV2.y),a=t.position.y+(e.col1.y*this.m_coreV2.x+e.col2.y*this.m_coreV2.y);if(n*i+s*o>r*i+a*o){this.s_supportVec.x=n;this.s_supportVec.y=s}else{this.s_supportVec.x=r;this.s_supportVec.y=a}return this.s_supportVec};e.prototype.b2EdgeShape=function(i,o){this.__super.b2Shape.call(this);this.m_type=r.e_edgeShape;this.m_prevEdge=null;this.m_nextEdge=null;this.m_v1=i;this.m_v2=o;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-t.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-t.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-t.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-t.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};e.prototype.SetPrevEdge=function(t,i,o,e){this.m_prevEdge=t;this.m_coreV1=i;this.m_cornerDir1=o;this.m_cornerConvex1=e};e.prototype.SetNextEdge=function(t,i,o,e){this.m_nextEdge=t;this.m_coreV2=i;this.m_cornerDir2=o;this.m_cornerConvex2=e};n.b2MassData=function(){this.mass=0;this.center=new c(0,0);this.I=0};Box2D.inherit(s,Box2D.Collision.Shapes.b2Shape);s.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;s.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};s.prototype.Copy=function(){var t=new s;t.Set(this);return t};s.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,s)){var i=t instanceof s?t:null;this.m_centroid.SetV(i.m_centroid);this.m_vertexCount=i.m_vertexCount;this.Reserve(this.m_vertexCount);for(var o=0;o<this.m_vertexCount;o++){this.m_vertices[o].SetV(i.m_vertices[o]);this.m_normals[o].SetV(i.m_normals[o])}}};s.prototype.SetAsArray=function(t,i){void 0===i&&(i=0);var o,e=new Vector,n=0;for(n=0;n<t.length;++n){o=t[n];e.push(o)}this.SetAsVector(e,i)};s.AsArray=function(t,i){void 0===i&&(i=0);var o=new s;o.SetAsArray(t,i);return o};s.prototype.SetAsVector=function(i,o){void 0===o&&(o=0);0==o&&(o=i.length);t.b2Assert(o>=2);this.m_vertexCount=o;this.Reserve(o);var e=0;for(e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(i[e]);for(e=0;e<this.m_vertexCount;++e){var n=parseInt(e),r=parseInt(e+1<this.m_vertexCount?e+1:0),a=m.SubtractVV(this.m_vertices[r],this.m_vertices[n]);t.b2Assert(a.LengthSquared()>Box2D.MIN_VALUE);
this.m_normals[e].SetV(m.CrossVF(a,1));this.m_normals[e].Normalize()}this.m_centroid=s.ComputeCentroid(this.m_vertices,this.m_vertexCount)};s.AsVector=function(t,i){void 0===i&&(i=0);var o=new s;o.SetAsVector(t,i);return o};s.prototype.SetAsBox=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-t,-i);this.m_vertices[1].Set(t,-i);this.m_vertices[2].Set(t,i);this.m_vertices[3].Set(-t,i);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};s.AsBox=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);var o=new s;o.SetAsBox(t,i);return o};s.prototype.SetAsOrientedBox=function(t,i,o,e){void 0===t&&(t=0);void 0===i&&(i=0);void 0===o&&(o=null);void 0===e&&(e=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-t,-i);this.m_vertices[1].Set(t,-i);this.m_vertices[2].Set(t,i);this.m_vertices[3].Set(-t,i);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=o;var n=new l;n.position=o;n.R.Set(e);for(var s=0;s<this.m_vertexCount;++s){this.m_vertices[s]=m.MulX(n,this.m_vertices[s]);this.m_normals[s]=m.MulMV(n.R,this.m_normals[s])}};s.AsOrientedBox=function(t,i,o,e){void 0===t&&(t=0);void 0===i&&(i=0);void 0===o&&(o=null);void 0===e&&(e=0);var n=new s;n.SetAsOrientedBox(t,i,o,e);return n};s.prototype.SetAsEdge=function(t,i){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(t);this.m_vertices[1].SetV(i);this.m_centroid.x=.5*(t.x+i.x);this.m_centroid.y=.5*(t.y+i.y);this.m_normals[0]=m.CrossVF(m.SubtractVV(i,t),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};s.AsEdge=function(t,i){var o=new s;o.SetAsEdge(t,i);return o};s.prototype.TestPoint=function(t,i){for(var o,e=t.R,n=i.x-t.position.x,s=i.y-t.position.y,r=n*e.col1.x+s*e.col1.y,a=n*e.col2.x+s*e.col2.y,m=0;m<this.m_vertexCount;++m){o=this.m_vertices[m];n=r-o.x;s=a-o.y;o=this.m_normals[m];var l=o.x*n+o.y*s;if(l>0)return!1}return!0};s.prototype.RayCast=function(t,i,o){var e,n,s=0,r=i.maxFraction,a=0,m=0;a=i.p1.x-o.position.x;m=i.p1.y-o.position.y;e=o.R;var l=a*e.col1.x+m*e.col1.y,c=a*e.col2.x+m*e.col2.y;a=i.p2.x-o.position.x;m=i.p2.y-o.position.y;e=o.R;for(var h=a*e.col1.x+m*e.col1.y,_=a*e.col2.x+m*e.col2.y,p=h-l,y=_-c,u=parseInt(-1),x=0;x<this.m_vertexCount;++x){n=this.m_vertices[x];a=n.x-l;m=n.y-c;n=this.m_normals[x];var f=n.x*a+n.y*m,d=n.x*p+n.y*y;if(0==d){if(0>f)return!1}else if(0>d&&s*d>f){s=f/d;u=x}else d>0&&r*d>f&&(r=f/d);if(r<s-Box2D.MIN_VALUE)return!1}if(u>=0){t.fraction=s;e=o.R;n=this.m_normals[u];t.normal.x=e.col1.x*n.x+e.col2.x*n.y;t.normal.y=e.col1.y*n.x+e.col2.y*n.y;return!0}return!1};s.prototype.ComputeAABB=function(t,i){for(var o=i.R,e=this.m_vertices[0],n=i.position.x+(o.col1.x*e.x+o.col2.x*e.y),s=i.position.y+(o.col1.y*e.x+o.col2.y*e.y),r=n,a=s,m=1;m<this.m_vertexCount;++m){e=this.m_vertices[m];var l=i.position.x+(o.col1.x*e.x+o.col2.x*e.y),c=i.position.y+(o.col1.y*e.x+o.col2.y*e.y);n=l>n?n:l;s=c>s?s:c;r=r>l?r:l;a=a>c?a:c}t.lowerBound.x=n-this.m_radius;t.lowerBound.y=s-this.m_radius;t.upperBound.x=r+this.m_radius;t.upperBound.y=a+this.m_radius};s.prototype.ComputeMass=function(t,i){void 0===i&&(i=0);if(2!=this.m_vertexCount){for(var o=0,e=0,n=0,s=0,r=0,a=0,m=1/3,l=0;l<this.m_vertexCount;++l){var c=this.m_vertices[l],h=l+1<this.m_vertexCount?this.m_vertices[parseInt(l+1)]:this.m_vertices[0],_=c.x-r,p=c.y-a,y=h.x-r,u=h.y-a,x=_*u-p*y,f=.5*x;n+=f;o+=f*m*(r+c.x+h.x);e+=f*m*(a+c.y+h.y);var d=r,b=a,v=_,D=p,B=y,C=u,g=m*(.25*(v*v+B*v+B*B)+(d*v+d*B))+.5*d*d,A=m*(.25*(D*D+C*D+C*C)+(b*D+b*C))+.5*b*b;s+=x*(g+A)}t.mass=i*n;o*=1/n;e*=1/n;t.center.Set(o,e);t.I=i*s}else{t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x);t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y);t.mass=0;t.I=0}};s.prototype.ComputeSubmergedArea=function(t,i,o,e){void 0===i&&(i=0);var s=m.MulTMV(o.R,t),r=i-m.Dot(t,o.position),a=new Vector_a2j_Number,l=0,h=parseInt(-1),_=parseInt(-1),p=!1,y=0;for(y=0;y<this.m_vertexCount;++y){a[y]=m.Dot(s,this.m_vertices[y])-r;var u=a[y]<-Box2D.MIN_VALUE;if(y>0)if(u){if(!p){h=y-1;l++}}else if(p){_=y-1;l++}p=u}switch(l){case 0:if(p){var x=new n;this.ComputeMass(x,1);e.SetV(m.MulX(o,x.center));return x.mass}return 0;case 1:-1==h?h=this.m_vertexCount-1:_=this.m_vertexCount-1}var f,d=parseInt((h+1)%this.m_vertexCount),b=parseInt((_+1)%this.m_vertexCount),v=(0-a[h])/(a[d]-a[h]),D=(0-a[_])/(a[b]-a[_]),B=new c(this.m_vertices[h].x*(1-v)+this.m_vertices[d].x*v,this.m_vertices[h].y*(1-v)+this.m_vertices[d].y*v),C=new c(this.m_vertices[_].x*(1-D)+this.m_vertices[b].x*D,this.m_vertices[_].y*(1-D)+this.m_vertices[b].y*D),g=0,A=new c,w=this.m_vertices[d];y=d;for(;y!=b;){y=(y+1)%this.m_vertexCount;f=y==b?C:this.m_vertices[y];var S=.5*((w.x-B.x)*(f.y-B.y)-(w.y-B.y)*(f.x-B.x));g+=S;A.x+=S*(B.x+w.x+f.x)/3;A.y+=S*(B.y+w.y+f.y)/3;w=f}A.Multiply(1/g);e.SetV(m.MulX(o,A));return g};s.prototype.GetVertexCount=function(){return this.m_vertexCount};s.prototype.GetVertices=function(){return this.m_vertices};s.prototype.GetNormals=function(){return this.m_normals};s.prototype.GetSupport=function(t){for(var i=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,e=1;e<this.m_vertexCount;++e){var n=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;if(n>o){i=e;o=n}}return i};s.prototype.GetSupportVertex=function(t){for(var i=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,e=1;e<this.m_vertexCount;++e){var n=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;if(n>o){i=e;o=n}}return this.m_vertices[i]};s.prototype.Validate=function(){return!1};s.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=r.e_polygonShape;this.m_centroid=new c;this.m_vertices=new Vector;this.m_normals=new Vector};s.prototype.Reserve=function(t){void 0===t&&(t=0);for(var i=parseInt(this.m_vertices.length);t>i;i++){this.m_vertices[i]=new c;this.m_normals[i]=new c}};s.ComputeCentroid=function(t,i){void 0===i&&(i=0);for(var o=new c,e=0,n=0,s=0,r=1/3,a=0;i>a;++a){var m=t[a],l=i>a+1?t[parseInt(a+1)]:t[0],h=m.x-n,_=m.y-s,p=l.x-n,y=l.y-s,u=h*y-_*p,x=.5*u;e+=x;o.x+=x*r*(n+m.x+l.x);o.y+=x*r*(s+m.y+l.y)}o.x*=1/e;o.y*=1/e;return o};s.ComputeOBB=function(t,i,o){void 0===o&&(o=0);var e=0,n=new Vector(o+1);for(e=0;o>e;++e)n[e]=i[e];n[o]=n[0];var s=Number.MAX_VALUE;for(e=1;o>=e;++e){var r=n[parseInt(e-1)],a=n[e].x-r.x,m=n[e].y-r.y,l=Math.sqrt(a*a+m*m);a/=l;m/=l;for(var c=-m,h=a,_=Number.MAX_VALUE,p=Number.MAX_VALUE,y=-Number.MAX_VALUE,u=-Number.MAX_VALUE,x=0;o>x;++x){var f=n[x].x-r.x,d=n[x].y-r.y,b=a*f+m*d,v=c*f+h*d;_>b&&(_=b);p>v&&(p=v);b>y&&(y=b);v>u&&(u=v)}var D=(y-_)*(u-p);if(.95*s>D){s=D;t.R.col1.x=a;t.R.col1.y=m;t.R.col2.x=c;t.R.col2.y=h;var B=.5*(_+y),C=.5*(p+u),g=t.R;t.center.x=r.x+(g.col1.x*B+g.col2.x*C);t.center.y=r.y+(g.col1.y*B+g.col2.y*C);t.extents.x=.5*(y-_);t.extents.y=.5*(u-p)}}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new a});r.b2Shape=function(){};r.prototype.Copy=function(){return null};r.prototype.Set=function(t){this.m_radius=t.m_radius};r.prototype.GetType=function(){return this.m_type};r.prototype.TestPoint=function(){return!1};r.prototype.RayCast=function(){return!1};r.prototype.ComputeAABB=function(){};r.prototype.ComputeMass=function(t,i){void 0===i&&(i=0)};r.prototype.ComputeSubmergedArea=function(t,i){void 0===i&&(i=0);return 0};r.TestOverlap=function(t,i,o,e){var n=new _;n.proxyA=new y;n.proxyA.Set(t);n.proxyB=new y;n.proxyB.Set(o);n.transformA=i;n.transformB=e;n.useRadii=!0;var s=new u;s.count=0;var r=new p;h.Distance(r,s,n);return r.distance<10*Box2D.MIN_VALUE};r.prototype.b2Shape=function(){this.m_type=r.e_unknownShape;this.m_radius=t.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}();!function(){{var t=Box2D.Common.b2Color,i=(Box2D.Common.b2internal,Box2D.Common.b2Settings),o=(Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math);Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2,Box2D.Common.Math.b2Vec3}t.b2Color=function(){this._r=0;this._g=0;this._b=0};t.prototype.b2Color=function(t,i,e){void 0===t&&(t=0);void 0===i&&(i=0);void 0===e&&(e=0);this._r=Box2D.parseUInt(255*o.Clamp(t,0,1));this._g=Box2D.parseUInt(255*o.Clamp(i,0,1));this._b=Box2D.parseUInt(255*o.Clamp(e,0,1))};t.prototype.Set=function(t,i,e){void 0===t&&(t=0);void 0===i&&(i=0);void 0===e&&(e=0);this._r=Box2D.parseUInt(255*o.Clamp(t,0,1));this._g=Box2D.parseUInt(255*o.Clamp(i,0,1));this._b=Box2D.parseUInt(255*o.Clamp(e,0,1))};Object.defineProperty(t.prototype,"r",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0);this._r=Box2D.parseUInt(255*o.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"g",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0);this._g=Box2D.parseUInt(255*o.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"b",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0);this._b=Box2D.parseUInt(255*o.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}});i.b2Settings=function(){};i.b2MixFriction=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);return Math.sqrt(t*i)};i.b2MixRestitution=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);return t>i?t:i};i.b2Assert=function(t){if(!t)throw"Assertion Failed"};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*i.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*i.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*i.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*i.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=20;Box2D.Common.b2Settings.b2_maxTranslationSquared=i.b2_maxTranslation*i.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=1.5*i.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=i.b2_maxRotation*i.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=.2;Box2D.Common.b2Settings.b2_timeToSleep=.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*i.b2_pi})}();!function(){var t=(Box2D.Collision.b2AABB,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings,Box2D.Common.Math.b2Mat22),i=Box2D.Common.Math.b2Mat33,o=Box2D.Common.Math.b2Math,e=Box2D.Common.Math.b2Sweep,n=Box2D.Common.Math.b2Transform,s=Box2D.Common.Math.b2Vec2,r=Box2D.Common.Math.b2Vec3;t.b2Mat22=function(){this.col1=new s;this.col2=new s};t.prototype.b2Mat22=function(){this.SetIdentity()};t.FromAngle=function(i){void 0===i&&(i=0);var o=new t;o.Set(i);return o};t.FromVV=function(i,o){var e=new t;e.SetVV(i,o);return e};t.prototype.Set=function(t){void 0===t&&(t=0);var i=Math.cos(t),o=Math.sin(t);this.col1.x=i;this.col2.x=-o;this.col1.y=o;this.col2.y=i};t.prototype.SetVV=function(t,i){this.col1.SetV(t);this.col2.SetV(i)};t.prototype.Copy=function(){var i=new t;i.SetM(this);return i};t.prototype.SetM=function(t){this.col1.SetV(t.col1);this.col2.SetV(t.col2)};t.prototype.AddM=function(t){this.col1.x+=t.col1.x;this.col1.y+=t.col1.y;this.col2.x+=t.col2.x;this.col2.y+=t.col2.y};t.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};t.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};t.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};t.prototype.GetInverse=function(t){var i=this.col1.x,o=this.col2.x,e=this.col1.y,n=this.col2.y,s=i*n-o*e;0!=s&&(s=1/s);t.col1.x=s*n;t.col2.x=-s*o;t.col1.y=-s*e;t.col2.y=s*i;return t};t.prototype.Solve=function(t,i,o){void 0===i&&(i=0);void 0===o&&(o=0);var e=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=e*r-n*s;0!=a&&(a=1/a);t.x=a*(r*i-n*o);t.y=a*(e*o-s*i);return t};t.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};i.b2Mat33=function(){this.col1=new r;this.col2=new r;this.col3=new r};i.prototype.b2Mat33=function(t,i,o){void 0===t&&(t=null);void 0===i&&(i=null);void 0===o&&(o=null);if(t||i||o){this.col1.SetV(t);this.col2.SetV(i);this.col3.SetV(o)}else{this.col1.SetZero();this.col2.SetZero();this.col3.SetZero()}};i.prototype.SetVVV=function(t,i,o){this.col1.SetV(t);this.col2.SetV(i);this.col3.SetV(o)};i.prototype.Copy=function(){return new i(this.col1,this.col2,this.col3)};i.prototype.SetM=function(t){this.col1.SetV(t.col1);this.col2.SetV(t.col2);this.col3.SetV(t.col3)};i.prototype.AddM=function(t){this.col1.x+=t.col1.x;this.col1.y+=t.col1.y;this.col1.z+=t.col1.z;this.col2.x+=t.col2.x;this.col2.y+=t.col2.y;this.col2.z+=t.col2.z;this.col3.x+=t.col3.x;this.col3.y+=t.col3.y;this.col3.z+=t.col3.z};i.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};i.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};i.prototype.Solve22=function(t,i,o){void 0===i&&(i=0);void 0===o&&(o=0);var e=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=e*r-n*s;0!=a&&(a=1/a);t.x=a*(r*i-n*o);t.y=a*(e*o-s*i);return t};i.prototype.Solve33=function(t,i,o,e){void 0===i&&(i=0);void 0===o&&(o=0);void 0===e&&(e=0);var n=this.col1.x,s=this.col1.y,r=this.col1.z,a=this.col2.x,m=this.col2.y,l=this.col2.z,c=this.col3.x,h=this.col3.y,_=this.col3.z,p=n*(m*_-l*h)+s*(l*c-a*_)+r*(a*h-m*c);0!=p&&(p=1/p);t.x=p*(i*(m*_-l*h)+o*(l*c-a*_)+e*(a*h-m*c));t.y=p*(n*(o*_-e*h)+s*(e*c-i*_)+r*(i*h-o*c));t.z=p*(n*(m*e-l*o)+s*(l*i-a*e)+r*(a*o-m*i));return t};o.b2Math=function(){};o.IsValid=function(t){void 0===t&&(t=0);return isFinite(t)};o.Dot=function(t,i){return t.x*i.x+t.y*i.y};o.CrossVV=function(t,i){return t.x*i.y-t.y*i.x};o.CrossVF=function(t,i){void 0===i&&(i=0);var o=new s(i*t.y,-i*t.x);return o};o.CrossFV=function(t,i){void 0===t&&(t=0);var o=new s(-t*i.y,t*i.x);return o};o.MulMV=function(t,i){var o=new s(t.col1.x*i.x+t.col2.x*i.y,t.col1.y*i.x+t.col2.y*i.y);return o};o.MulTMV=function(t,i){var e=new s(o.Dot(i,t.col1),o.Dot(i,t.col2));return e};o.MulX=function(t,i){var e=o.MulMV(t.R,i);e.x+=t.position.x;e.y+=t.position.y;return e};o.MulXT=function(t,i){var e=o.SubtractVV(i,t.position),n=e.x*t.R.col1.x+e.y*t.R.col1.y;e.y=e.x*t.R.col2.x+e.y*t.R.col2.y;e.x=n;return e};o.AddVV=function(t,i){var o=new s(t.x+i.x,t.y+i.y);return o};o.SubtractVV=function(t,i){var o=new s(t.x-i.x,t.y-i.y);return o};o.Distance=function(t,i){var o=t.x-i.x,e=t.y-i.y;return Math.sqrt(o*o+e*e)};o.DistanceSquared=function(t,i){var o=t.x-i.x,e=t.y-i.y;return o*o+e*e};o.MulFV=function(t,i){void 0===t&&(t=0);var o=new s(t*i.x,t*i.y);return o};o.AddMM=function(i,e){var n=t.FromVV(o.AddVV(i.col1,e.col1),o.AddVV(i.col2,e.col2));return n};o.MulMM=function(i,e){var n=t.FromVV(o.MulMV(i,e.col1),o.MulMV(i,e.col2));return n};o.MulTMM=function(i,e){var n=new s(o.Dot(i.col1,e.col1),o.Dot(i.col2,e.col1)),r=new s(o.Dot(i.col1,e.col2),o.Dot(i.col2,e.col2)),a=t.FromVV(n,r);return a};o.Abs=function(t){void 0===t&&(t=0);return t>0?t:-t};o.AbsV=function(t){var i=new s(o.Abs(t.x),o.Abs(t.y));return i};o.AbsM=function(i){var e=t.FromVV(o.AbsV(i.col1),o.AbsV(i.col2));return e};o.Min=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);return i>t?t:i};o.MinV=function(t,i){var e=new s(o.Min(t.x,i.x),o.Min(t.y,i.y));return e};o.Max=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);return t>i?t:i};o.MaxV=function(t,i){var e=new s(o.Max(t.x,i.x),o.Max(t.y,i.y));return e};o.Clamp=function(t,i,o){void 0===t&&(t=0);void 0===i&&(i=0);void 0===o&&(o=0);return i>t?i:t>o?o:t};o.ClampV=function(t,i,e){return o.MaxV(i,o.MinV(t,e))};o.Swap=function(t,i){var o=t[0];t[0]=i[0];i[0]=o};o.Random=function(){return 2*Math.random()-1};o.RandomRange=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);var o=Math.random();o=(i-t)*o+t;return o};o.NextPowerOfTwo=function(t){void 0===t&&(t=0);t|=t>>1&2147483647;t|=t>>2&1073741823;t|=t>>4&268435455;t|=t>>8&16777215;t|=t>>16&65535;return t+1};o.IsPowerOfTwo=function(t){void 0===t&&(t=0);var i=t>0&&0==(t&t-1);return i};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new s(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=t.FromVV(new s(1,0),new s(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new n(o.b2Vec2_zero,o.b2Mat22_identity)});e.b2Sweep=function(){this.localCenter=new s;this.c0=new s;this.c=new s};e.prototype.Set=function(t){this.localCenter.SetV(t.localCenter);this.c0.SetV(t.c0);this.c.SetV(t.c);this.a0=t.a0;this.a=t.a;this.t0=t.t0};e.prototype.Copy=function(){var t=new e;t.localCenter.SetV(this.localCenter);t.c0.SetV(this.c0);t.c.SetV(this.c);t.a0=this.a0;t.a=this.a;t.t0=this.t0;return t};e.prototype.GetTransform=function(t,i){void 0===i&&(i=0);t.position.x=(1-i)*this.c0.x+i*this.c.x;t.position.y=(1-i)*this.c0.y+i*this.c.y;var o=(1-i)*this.a0+i*this.a;t.R.Set(o);var e=t.R;t.position.x-=e.col1.x*this.localCenter.x+e.col2.x*this.localCenter.y;t.position.y-=e.col1.y*this.localCenter.x+e.col2.y*this.localCenter.y};e.prototype.Advance=function(t){void 0===t&&(t=0);if(this.t0<t&&1-this.t0>Box2D.MIN_VALUE){var i=(t-this.t0)/(1-this.t0);this.c0.x=(1-i)*this.c0.x+i*this.c.x;this.c0.y=(1-i)*this.c0.y+i*this.c.y;this.a0=(1-i)*this.a0+i*this.a;this.t0=t}};n.b2Transform=function(){this.position=new s;this.R=new t};n.prototype.b2Transform=function(t,i){void 0===t&&(t=null);void 0===i&&(i=null);if(t){this.position.SetV(t);this.R.SetM(i)}};n.prototype.Initialize=function(t,i){this.position.SetV(t);this.R.SetM(i)};n.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};n.prototype.Set=function(t){this.position.SetV(t.position);this.R.SetM(t.R)};n.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};s.b2Vec2=function(){};s.prototype.b2Vec2=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);this.x=t;this.y=i};s.prototype.SetZero=function(){this.x=0;this.y=0};s.prototype.Set=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);this.x=t;this.y=i};s.prototype.SetV=function(t){this.x=t.x;this.y=t.y};s.prototype.GetNegative=function(){return new s(-this.x,-this.y)};s.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};s.Make=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);return new s(t,i)};s.prototype.Copy=function(){return new s(this.x,this.y)};s.prototype.Add=function(t){this.x+=t.x;this.y+=t.y};s.prototype.Subtract=function(t){this.x-=t.x;this.y-=t.y};s.prototype.Multiply=function(t){void 0===t&&(t=0);this.x*=t;this.y*=t};s.prototype.MulM=function(t){var i=this.x;this.x=t.col1.x*i+t.col2.x*this.y;this.y=t.col1.y*i+t.col2.y*this.y};s.prototype.MulTM=function(t){var i=o.Dot(this,t.col1);this.y=o.Dot(this,t.col2);this.x=i};s.prototype.CrossVF=function(t){void 0===t&&(t=0);var i=this.x;this.x=t*this.y;this.y=-t*i};s.prototype.CrossFV=function(t){void 0===t&&(t=0);var i=this.x;this.x=-t*this.y;this.y=t*i};s.prototype.MinV=function(t){this.x=this.x<t.x?this.x:t.x;this.y=this.y<t.y?this.y:t.y};s.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x;this.y=this.y>t.y?this.y:t.y};s.prototype.Abs=function(){this.x<0&&(this.x=-this.x);this.y<0&&(this.y=-this.y)};s.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};s.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};s.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t<Box2D.MIN_VALUE)return 0;var i=1/t;this.x*=i;this.y*=i;return t};s.prototype.IsValid=function(){return o.IsValid(this.x)&&o.IsValid(this.y)};r.b2Vec3=function(){};r.prototype.b2Vec3=function(t,i,o){void 0===t&&(t=0);void 0===i&&(i=0);void 0===o&&(o=0);this.x=t;this.y=i;this.z=o};r.prototype.SetZero=function(){this.x=this.y=this.z=0};r.prototype.Set=function(t,i,o){void 0===t&&(t=0);void 0===i&&(i=0);void 0===o&&(o=0);this.x=t;this.y=i;this.z=o};r.prototype.SetV=function(t){this.x=t.x;this.y=t.y;this.z=t.z};r.prototype.GetNegative=function(){return new r(-this.x,-this.y,-this.z)};r.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};r.prototype.Copy=function(){return new r(this.x,this.y,this.z)};r.prototype.Add=function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z};r.prototype.Subtract=function(t){this.x-=t.x;this.y-=t.y;this.z-=t.z};r.prototype.Multiply=function(t){void 0===t&&(t=0);this.x*=t;this.y*=t;this.z*=t}}();!function(){{var t=(Box2D.Dynamics.Controllers.b2ControllerEdge,Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),i=Box2D.Common.Math.b2Sweep,o=Box2D.Common.Math.b2Transform,e=Box2D.Common.Math.b2Vec2,n=(Box2D.Common.Math.b2Vec3,Box2D.Common.b2Color),s=(Box2D.Common.b2internal,Box2D.Common.b2Settings),r=Box2D.Collision.b2AABB,a=(Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint),m=(Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase),l=(Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput),c=Box2D.Collision.b2RayCastOutput,h=(Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase,Box2D.Collision.Shapes.b2CircleShape),_=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape),p=Box2D.Collision.Shapes.b2MassData,y=Box2D.Collision.Shapes.b2PolygonShape,u=Box2D.Collision.Shapes.b2Shape,x=Box2D.Dynamics.b2Body,f=Box2D.Dynamics.b2BodyDef,d=Box2D.Dynamics.b2ContactFilter,b=Box2D.Dynamics.b2ContactImpulse,v=Box2D.Dynamics.b2ContactListener,D=Box2D.Dynamics.b2ContactManager,B=Box2D.Dynamics.b2DebugDraw,C=Box2D.Dynamics.b2DestructionListener,g=Box2D.Dynamics.b2FilterData,A=Box2D.Dynamics.b2Fixture,w=Box2D.Dynamics.b2FixtureDef,S=Box2D.Dynamics.b2Island,M=Box2D.Dynamics.b2TimeStep,V=Box2D.Dynamics.b2World,I=(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),G=(Box2D.Dynamics.Contacts.b2ContactConstraint,Box2D.Dynamics.Contacts.b2ContactConstraintPoint,Box2D.Dynamics.Contacts.b2ContactEdge,Box2D.Dynamics.Contacts.b2ContactFactory),J=(Box2D.Dynamics.Contacts.b2ContactRegister,Box2D.Dynamics.Contacts.b2ContactResult,Box2D.Dynamics.Contacts.b2ContactSolver),L=(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2NullContact,Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2PositionSolverManifold,Box2D.Dynamics.Controllers.b2Controller,Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2RopeJoint,Box2D.Dynamics.Joints.b2RopeJointDef,Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2Jacobian,Box2D.Dynamics.Joints.b2Joint),F=(Box2D.Dynamics.Joints.b2JointDef,Box2D.Dynamics.Joints.b2JointEdge,Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2MouseJoint,Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2PulleyJoint);Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2WeldJointDef}x.b2Body=function(){this.m_xf=new o;this.m_sweep=new i;this.m_linearVelocity=new e;this.m_force=new e};x.prototype.connectEdges=function(i,o,e){void 0===e&&(e=0);var n=Math.atan2(o.GetDirectionVector().y,o.GetDirectionVector().x),r=Math.tan(.5*(n-e)),a=t.MulFV(r,o.GetDirectionVector());a=t.SubtractVV(a,o.GetNormalVector());a=t.MulFV(s.b2_toiSlop,a);a=t.AddVV(a,o.GetVertex1());var m=t.AddVV(i.GetDirectionVector(),o.GetDirectionVector());m.Normalize();var l=t.Dot(i.GetDirectionVector(),o.GetNormalVector())>0;i.SetNextEdge(o,a,m,l);o.SetPrevEdge(i,a,m,l);return n};x.prototype.CreateFixture=function(t){if(1==this.m_world.IsLocked())return null;var i=new A;i.Create(this,this.m_xf,t);if(this.m_flags&x.e_activeFlag){var o=this.m_world.m_contactManager.m_broadPhase;i.CreateProxy(o,this.m_xf)}i.m_next=this.m_fixtureList;this.m_fixtureList=i;++this.m_fixtureCount;i.m_body=this;i.m_density>0&&this.ResetMassData();this.m_world.m_flags|=V.e_newFixture;return i};x.prototype.CreateFixture2=function(t,i){void 0===i&&(i=0);var o=new w;o.shape=t;o.density=i;return this.CreateFixture(o)};x.prototype.DestroyFixture=function(t){if(1!=this.m_world.IsLocked()){for(var i=this.m_fixtureList,o=null,e=!1;null!=i;){if(i==t){o?o.m_next=t.m_next:this.m_fixtureList=t.m_next;e=!0;break}o=i;i=i.m_next}for(var n=this.m_contactList;n;){var s=n.contact;n=n.next;var r=s.GetFixtureA(),a=s.GetFixtureB();(t==r||t==a)&&this.m_world.m_contactManager.Destroy(s)}if(this.m_flags&x.e_activeFlag){var m=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxy(m)}t.Destroy();t.m_body=null;t.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};x.prototype.SetPositionAndAngle=function(t,i){void 0===i&&(i=0);var o;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(i);this.m_xf.position.SetV(t);var e=this.m_xf.R,n=this.m_sweep.localCenter;this.m_sweep.c.x=e.col1.x*n.x+e.col2.x*n.y;this.m_sweep.c.y=e.col1.y*n.x+e.col2.y*n.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=i;var s=this.m_world.m_contactManager.m_broadPhase;for(o=this.m_fixtureList;o;o=o.m_next)o.Synchronize(s,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}};x.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())};x.prototype.GetTransform=function(){return this.m_xf};x.prototype.GetPosition=function(){return this.m_xf.position};x.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())};x.prototype.GetAngle=function(){return this.m_sweep.a};x.prototype.SetAngle=function(t){void 0===t&&(t=0);this.SetPositionAndAngle(this.GetPosition(),t)};x.prototype.GetWorldCenter=function(){return this.m_sweep.c};x.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};x.prototype.SetLinearVelocity=function(t){this.m_type!=x.b2_staticBody&&this.m_linearVelocity.SetV(t)};x.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};x.prototype.SetAngularVelocity=function(t){void 0===t&&(t=0);this.m_type!=x.b2_staticBody&&(this.m_angularVelocity=t)};x.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};x.prototype.GetDefinition=function(){var t=new f;t.type=this.GetType();t.allowSleep=(this.m_flags&x.e_allowSleepFlag)==x.e_allowSleepFlag;t.angle=this.GetAngle();t.angularDamping=this.m_angularDamping;t.gravityScale=this.m_gravityScale;t.angularVelocity=this.m_angularVelocity;t.fixedRotation=(this.m_flags&x.e_fixedRotationFlag)==x.e_fixedRotationFlag;t.bullet=(this.m_flags&x.e_bulletFlag)==x.e_bulletFlag;t.awake=(this.m_flags&x.e_awakeFlag)==x.e_awakeFlag;t.linearDamping=this.m_linearDamping;t.linearVelocity.SetV(this.GetLinearVelocity());t.position=this.GetPosition();t.userData=this.GetUserData();return t};x.prototype.ApplyForce=function(t,i){if(this.m_type==x.b2_dynamicBody){0==this.IsAwake()&&this.SetAwake(!0);this.m_force.x+=t.x;this.m_force.y+=t.y;this.m_torque+=(i.x-this.m_sweep.c.x)*t.y-(i.y-this.m_sweep.c.y)*t.x}};x.prototype.ApplyTorque=function(t){void 0===t&&(t=0);if(this.m_type==x.b2_dynamicBody){0==this.IsAwake()&&this.SetAwake(!0);this.m_torque+=t}};x.prototype.ApplyImpulse=function(t,i){if(this.m_type==x.b2_dynamicBody){0==this.IsAwake()&&this.SetAwake(!0);this.m_linearVelocity.x+=this.m_invMass*t.x;this.m_linearVelocity.y+=this.m_invMass*t.y;this.m_angularVelocity+=this.m_invI*((i.x-this.m_sweep.c.x)*t.y-(i.y-this.m_sweep.c.y)*t.x)}};x.prototype.Split=function(i){for(var o,e=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),s=this.GetWorldCenter(),r=this,a=this.m_world.CreateBody(this.GetDefinition()),m=r.m_fixtureList;m;)if(i(m)){var l=m.m_next;o?o.m_next=l:r.m_fixtureList=l;r.m_fixtureCount--;m.m_next=a.m_fixtureList;a.m_fixtureList=m;a.m_fixtureCount++;m.m_body=a;m=l}else{o=m;m=m.m_next}r.ResetMassData();a.ResetMassData();var c=r.GetWorldCenter(),h=a.GetWorldCenter(),_=t.AddVV(e,t.CrossFV(n,t.SubtractVV(c,s))),p=t.AddVV(e,t.CrossFV(n,t.SubtractVV(h,s)));r.SetLinearVelocity(_);a.SetLinearVelocity(p);r.SetAngularVelocity(n);a.SetAngularVelocity(n);r.SynchronizeFixtures();a.SynchronizeFixtures();return a};x.prototype.Merge=function(t){var i;for(i=t.m_fixtureList;i;){var o=i.m_next;t.m_fixtureCount--;i.m_next=this.m_fixtureList;this.m_fixtureList=i;this.m_fixtureCount++;i.m_body=n;i=o}e.m_fixtureCount=0;{var e=this,n=t;e.GetWorldCenter(),n.GetWorldCenter(),e.GetLinearVelocity().Copy(),n.GetLinearVelocity().Copy(),e.GetAngularVelocity(),n.GetAngularVelocity()}e.ResetMassData();this.SynchronizeFixtures()};x.prototype.GetMass=function(){return this.m_mass};x.prototype.GetInertia=function(){return this.m_I};x.prototype.GetMassData=function(t){t.mass=this.m_mass;t.I=this.m_I;t.center.SetV(this.m_sweep.localCenter)};x.prototype.SetMassData=function(i){s.b2Assert(0==this.m_world.IsLocked());if(1!=this.m_world.IsLocked()&&this.m_type==x.b2_dynamicBody){this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_mass=i.mass;this.m_mass<=0&&(this.m_mass=1);this.m_invMass=1/this.m_mass;if(i.I>0&&0==(this.m_flags&x.e_fixedRotationFlag)){this.m_I=i.I-this.m_mass*(i.center.x*i.center.x+i.center.y*i.center.y);this.m_invI=1/this.m_I}var o=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(i.center);this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-o.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-o.x)}};x.prototype.ResetMassData=function(){this.m_mass=0;this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_sweep.localCenter.SetZero();if(this.m_type!=x.b2_staticBody&&this.m_type!=x.b2_kinematicBody){for(var i=e.Make(0,0),o=this.m_fixtureList;o;o=o.m_next)if(0!=o.m_density){var n=o.GetMassData();this.m_mass+=n.mass;i.x+=n.center.x*n.mass;i.y+=n.center.y*n.mass;this.m_I+=n.I}if(this.m_mass>0){this.m_invMass=1/this.m_mass;i.x*=this.m_invMass;i.y*=this.m_invMass}else{this.m_mass=1;this.m_invMass=1}if(this.m_I>0&&0==(this.m_flags&x.e_fixedRotationFlag)){this.m_I-=this.m_mass*(i.x*i.x+i.y*i.y);this.m_I*=this.m_inertiaScale;s.b2Assert(this.m_I>0);this.m_invI=1/this.m_I}else{this.m_I=0;this.m_invI=0}var r=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(i);this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-r.y);
this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-r.x)}};x.prototype.GetWorldPoint=function(t){var i=this.m_xf.R,o=new e(i.col1.x*t.x+i.col2.x*t.y,i.col1.y*t.x+i.col2.y*t.y);o.x+=this.m_xf.position.x;o.y+=this.m_xf.position.y;return o};x.prototype.GetWorldVector=function(i){return t.MulMV(this.m_xf.R,i)};x.prototype.GetLocalPoint=function(i){return t.MulXT(this.m_xf,i)};x.prototype.GetLocalVector=function(i){return t.MulTMV(this.m_xf.R,i)};x.prototype.GetLinearVelocityFromWorldPoint=function(t){return new e(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))};x.prototype.GetLinearVelocityFromLocalPoint=function(t){var i=this.m_xf.R,o=new e(i.col1.x*t.x+i.col2.x*t.y,i.col1.y*t.x+i.col2.y*t.y);o.x+=this.m_xf.position.x;o.y+=this.m_xf.position.y;return new e(this.m_linearVelocity.x-this.m_angularVelocity*(o.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(o.x-this.m_sweep.c.x))};x.prototype.GetLinearDamping=function(){return this.m_linearDamping};x.prototype.SetLinearDamping=function(t){void 0===t&&(t=0);this.m_linearDamping=t};x.prototype.GetAngularDamping=function(){return this.m_angularDamping};x.prototype.SetAngularDamping=function(t){void 0===t&&(t=0);this.m_angularDamping=t};x.prototype.GetGravityScale=function(){return this.m_gravityScale};x.prototype.SetGravityScale=function(t){void 0===t&&(t=1);this.m_gravityScale=t};x.prototype.SetType=function(t){void 0===t&&(t=0);if(this.m_type!=t){this.m_type=t;this.ResetMassData();if(this.m_type==x.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0}this.SetAwake(!0);this.m_force.SetZero();this.m_torque=0;for(var i=this.m_contactList;i;i=i.next)i.contact.FlagForFiltering()}};x.prototype.GetType=function(){return this.m_type};x.prototype.SetBullet=function(t){t?this.m_flags|=x.e_bulletFlag:this.m_flags&=~x.e_bulletFlag};x.prototype.IsBullet=function(){return(this.m_flags&x.e_bulletFlag)==x.e_bulletFlag};x.prototype.SetSleepingAllowed=function(t){if(t)this.m_flags|=x.e_allowSleepFlag;else{this.m_flags&=~x.e_allowSleepFlag;this.SetAwake(!0)}};x.prototype.SetAwake=function(t){if(t){this.qyobj&&!this.IsAwake()&&this.qyobj.dispatchEvent("wakeup");this.m_flags|=x.e_awakeFlag;this.m_sleepTime=0}else{this.qyobj&&this.IsAwake()&&this.qyobj.dispatchEvent("sleep");this.m_flags&=~x.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0}};x.prototype.IsAwake=function(){return(this.m_flags&x.e_awakeFlag)==x.e_awakeFlag};x.prototype.SetFixedRotation=function(t){t?this.m_flags|=x.e_fixedRotationFlag:this.m_flags&=~x.e_fixedRotationFlag;this.ResetMassData()};x.prototype.IsFixedRotation=function(){return(this.m_flags&x.e_fixedRotationFlag)==x.e_fixedRotationFlag};x.prototype.SetActive=function(t){if(t!=this.IsActive()){var i,o;if(t){this.m_flags|=x.e_activeFlag;i=this.m_world.m_contactManager.m_broadPhase;for(o=this.m_fixtureList;o;o=o.m_next)o.CreateProxy(i,this.m_xf)}else{this.m_flags&=~x.e_activeFlag;i=this.m_world.m_contactManager.m_broadPhase;for(o=this.m_fixtureList;o;o=o.m_next)o.DestroyProxy(i);for(var e=this.m_contactList;e;){var n=e;e=e.next;this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}}};x.prototype.IsActive=function(){return(this.m_flags&x.e_activeFlag)==x.e_activeFlag};x.prototype.IsSleepingAllowed=function(){return(this.m_flags&x.e_allowSleepFlag)==x.e_allowSleepFlag};x.prototype.GetFixtureList=function(){return this.m_fixtureList};x.prototype.GetJointList=function(){return this.m_jointList};x.prototype.GetControllerList=function(){return this.m_controllerList};x.prototype.GetContactList=function(){return this.m_contactList};x.prototype.GetNext=function(){return this.m_next};x.prototype.GetUserData=function(){return this.m_userData};x.prototype.SetUserData=function(t){this.m_userData=t};x.prototype.GetWorld=function(){return this.m_world};x.prototype.b2Body=function(t,i){this.m_flags=0;t.bullet&&(this.m_flags|=x.e_bulletFlag);t.fixedRotation&&(this.m_flags|=x.e_fixedRotationFlag);t.allowSleep&&(this.m_flags|=x.e_allowSleepFlag);t.awake&&(this.m_flags|=x.e_awakeFlag);t.active&&(this.m_flags|=x.e_activeFlag);this.m_world=i;this.m_xf.position.SetV(t.position);this.m_xf.R.Set(t.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=t.angle;var o=this.m_xf.R,e=this.m_sweep.localCenter;this.m_sweep.c.x=o.col1.x*e.x+o.col2.x*e.y;this.m_sweep.c.y=o.col1.y*e.x+o.col2.y*e.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_jointList=null;this.m_controllerList=null;this.m_contactList=null;this.m_controllerCount=0;this.m_prev=null;this.m_next=null;this.m_linearVelocity.SetV(t.linearVelocity);this.m_angularVelocity=t.angularVelocity;this.m_linearDamping=t.linearDamping;this.m_angularDamping=t.angularDamping;this.m_gravityScale=t.gravityScale;this.m_force.Set(0,0);this.m_torque=0;this.m_sleepTime=0;this.m_type=t.type;if(this.m_type==x.b2_dynamicBody){this.m_mass=1;this.m_invMass=1}else{this.m_mass=0;this.m_invMass=0}this.m_I=0;this.m_invI=0;this.m_inertiaScale=t.inertiaScale;this.m_userData=t.userData;this.m_fixtureList=null;this.m_fixtureCount=0};x.prototype.SynchronizeFixtures=function(){var t=x.s_xf1;t.R.Set(this.m_sweep.a0);var i=t.R,o=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(i.col1.x*o.x+i.col2.x*o.y);t.position.y=this.m_sweep.c0.y-(i.col1.y*o.x+i.col2.y*o.y);var e,n=this.m_world.m_contactManager.m_broadPhase;for(e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(n,t,this.m_xf)};x.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R,i=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*i.x+t.col2.x*i.y);this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*i.x+t.col2.y*i.y)};x.prototype.ShouldCollide=function(t){if(this.m_type!=x.b2_dynamicBody&&t.m_type!=x.b2_dynamicBody)return!1;for(var i=this.m_jointList;i;i=i.next)if(i.other==t&&0==i.joint.m_collideConnected)return!1;return!0};x.prototype.Advance=function(t){void 0===t&&(t=0);this.m_sweep.Advance(t);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new o;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});f.b2BodyDef=function(){this.position=new e;this.linearVelocity=new e};f.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularVelocity=0;this.linearDamping=0;this.angularDamping=0;this.gravityScale=1;this.allowSleep=!0;this.awake=!0;this.fixedRotation=!1;this.bullet=!1;this.type=x.b2_staticBody;this.active=!0;this.inertiaScale=1};d.b2ContactFilter=function(){};d.prototype.ShouldCollide=function(t,i){var o=t.GetFilterData(),e=i.GetFilterData();if(o.groupIndex==e.groupIndex&&0!=o.groupIndex)return o.groupIndex>0;var n=0!=(o.maskBits&e.categoryBits)&&0!=(o.categoryBits&e.maskBits);return n};d.prototype.RayCollide=function(t,i){return t?this.ShouldCollide(t instanceof A?t:null,i):!0};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new d});b.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(s.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(s.b2_maxManifoldPoints)};v.b2ContactListener=function(){};v.prototype.BeginContact=function(){};v.prototype.EndContact=function(){};v.prototype.PreSolve=function(){};v.prototype.PostSolve=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new v});D.b2ContactManager=function(){};D.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=d.b2_defaultFilter;this.m_contactListener=v.b2_defaultListener;this.m_contactFactory=new G(this.m_allocator);this.m_broadPhase=new m};D.prototype.AddPair=function(t,i){var o=t instanceof A?t:null,e=i instanceof A?i:null,n=o.GetBody(),s=e.GetBody();if(n!=s){for(var r=s.GetContactList();r;){if(r.other==n){var a=r.contact.GetFixtureA(),m=r.contact.GetFixtureB();if(a==o&&m==e)return;if(a==e&&m==o)return}r=r.next}if(0!=s.ShouldCollide(n)&&0!=this.m_contactFilter.ShouldCollide(o,e)){var l=this.m_contactFactory.Create(o,e);o=l.GetFixtureA();e=l.GetFixtureB();n=o.m_body;s=e.m_body;l.m_prev=null;l.m_next=this.m_world.m_contactList;null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=l);this.m_world.m_contactList=l;l.m_nodeA.contact=l;l.m_nodeA.other=s;l.m_nodeA.prev=null;l.m_nodeA.next=n.m_contactList;null!=n.m_contactList&&(n.m_contactList.prev=l.m_nodeA);n.m_contactList=l.m_nodeA;l.m_nodeB.contact=l;l.m_nodeB.other=n;l.m_nodeB.prev=null;l.m_nodeB.next=s.m_contactList;null!=s.m_contactList&&(s.m_contactList.prev=l.m_nodeB);s.m_contactList=l.m_nodeB;++this.m_world.m_contactCount}}};D.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};D.prototype.Destroy=function(t){var i=t.GetFixtureA(),o=t.GetFixtureB(),e=i.GetBody(),n=o.GetBody();t.IsTouching()&&this.m_contactListener.EndContact(t);t.m_prev&&(t.m_prev.m_next=t.m_next);t.m_next&&(t.m_next.m_prev=t.m_prev);t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next);t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next);t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev);t.m_nodeA==e.m_contactList&&(e.m_contactList=t.m_nodeA.next);t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next);t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev);t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next);this.m_contactFactory.Destroy(t);--this.m_contactCount};D.prototype.Collide=function(){for(var t=this.m_world.m_contactList;t;){var i=t.GetFixtureA(),o=t.GetFixtureB(),e=i.GetBody(),n=o.GetBody();if(0!=e.IsAwake()||0!=n.IsAwake()){if(t.m_flags&I.e_filterFlag){if(0==n.ShouldCollide(e)){var s=t;t=s.GetNext();this.Destroy(s);continue}if(0==this.m_contactFilter.ShouldCollide(i,o)){s=t;t=s.GetNext();this.Destroy(s);continue}t.m_flags&=~I.e_filterFlag}var r=i.m_proxy,a=o.m_proxy,m=this.m_broadPhase.TestOverlap(r,a);if(0!=m){t.Update(this.m_contactListener);t=t.GetNext()}else{s=t;t=s.GetNext();this.Destroy(s)}}else t=t.GetNext()}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new a});B.b2DebugDraw=function(){};B.prototype.b2DebugDraw=function(){};B.prototype.SetFlags=function(t){void 0===t&&(t=0)};B.prototype.GetFlags=function(){};B.prototype.AppendFlags=function(t){void 0===t&&(t=0)};B.prototype.ClearFlags=function(t){void 0===t&&(t=0)};B.prototype.SetSprite=function(){};B.prototype.GetSprite=function(){};B.prototype.SetDrawScale=function(t){void 0===t&&(t=0)};B.prototype.GetDrawScale=function(){};B.prototype.SetLineThickness=function(t){void 0===t&&(t=0)};B.prototype.GetLineThickness=function(){};B.prototype.SetAlpha=function(t){void 0===t&&(t=0)};B.prototype.GetAlpha=function(){};B.prototype.SetFillAlpha=function(t){void 0===t&&(t=0)};B.prototype.GetFillAlpha=function(){};B.prototype.SetXFormScale=function(t){void 0===t&&(t=0)};B.prototype.GetXFormScale=function(){};B.prototype.DrawPolygon=function(t,i){void 0===i&&(i=0)};B.prototype.DrawSolidPolygon=function(t,i){void 0===i&&(i=0)};B.prototype.DrawCircle=function(t,i){void 0===i&&(i=0)};B.prototype.DrawSolidCircle=function(t,i){void 0===i&&(i=0)};B.prototype.DrawSegment=function(){};B.prototype.DrawTransform=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});C.b2DestructionListener=function(){};C.prototype.SayGoodbyeJoint=function(){};C.prototype.SayGoodbyeFixture=function(){};g.b2FilterData=function(){this.categoryBits=1;this.maskBits=4294967295;this.groupIndex=0};g.prototype.Copy=function(){var t=new g;t.categoryBits=this.categoryBits;t.maskBits=this.maskBits;t.groupIndex=this.groupIndex;return t};A.b2Fixture=function(){this.m_filter=new g};A.prototype.GetType=function(){return this.m_shape.GetType()};A.prototype.GetShape=function(){return this.m_shape};A.prototype.SetSensor=function(t){if(this.m_isSensor!=t){this.m_isSensor=t;if(null!=this.m_body)for(var i=this.m_body.GetContactList();i;){var o=i.contact,e=o.GetFixtureA(),n=o.GetFixtureB();(e==this||n==this)&&o.SetSensor(e.IsSensor()||n.IsSensor());i=i.next}}};A.prototype.IsSensor=function(){return this.m_isSensor};A.prototype.SetFilterData=function(t){this.m_filter=t.Copy();if(!this.m_body)for(var i=this.m_body.GetContactList();i;){var o=i.contact,e=o.GetFixtureA(),n=o.GetFixtureB();(e==this||n==this)&&o.FlagForFiltering();i=i.next}};A.prototype.GetFilterData=function(){return this.m_filter.Copy()};A.prototype.GetBody=function(){return this.m_body};A.prototype.GetNext=function(){return this.m_next};A.prototype.GetUserData=function(){return this.m_userData};A.prototype.SetUserData=function(t){this.m_userData=t};A.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)};A.prototype.RayCast=function(t,i){return this.m_shape.RayCast(t,i,this.m_body.GetTransform())};A.prototype.GetMassData=function(t){void 0===t&&(t=null);null==t&&(t=new p);this.m_shape.ComputeMass(t,this.m_density);return t};A.prototype.SetDensity=function(t){void 0===t&&(t=0);this.m_density=t};A.prototype.GetDensity=function(){return this.m_density};A.prototype.GetFriction=function(){return this.m_friction};A.prototype.SetFriction=function(t){void 0===t&&(t=0);this.m_friction=t};A.prototype.GetRestitution=function(){return this.m_restitution};A.prototype.SetRestitution=function(t){void 0===t&&(t=0);this.m_restitution=t};A.prototype.GetAABB=function(){return this.m_aabb};A.prototype.b2Fixture=function(){this.m_aabb=new r;this.m_userData=null;this.m_body=null;this.m_next=null;this.m_shape=null;this.m_density=0;this.m_friction=0;this.m_restitution=0};A.prototype.Create=function(t,i,o){this.m_userData=o.userData;this.m_friction=o.friction;this.m_restitution=o.restitution;this.m_body=t;this.m_next=null;this.m_filter=o.filter.Copy();this.m_isSensor=o.isSensor;this.m_shape=o.shape.Copy();this.m_density=o.density};A.prototype.Destroy=function(){this.m_shape=null};A.prototype.CreateProxy=function(t,i){this.m_shape.ComputeAABB(this.m_aabb,i);this.m_proxy=t.CreateProxy(this.m_aabb,this)};A.prototype.DestroyProxy=function(t){if(null!=this.m_proxy){t.DestroyProxy(this.m_proxy);this.m_proxy=null}};A.prototype.Synchronize=function(i,o,e){if(this.m_proxy){var n=new r,s=new r;this.m_shape.ComputeAABB(n,o);this.m_shape.ComputeAABB(s,e);this.m_aabb.Combine(n,s);var a=t.SubtractVV(e.position,o.position);i.MoveProxy(this.m_proxy,this.m_aabb,a)}};w.b2FixtureDef=function(){this.filter=new g};w.prototype.b2FixtureDef=function(){this.shape=null;this.userData=null;this.friction=.2;this.restitution=0;this.density=0;this.filter.categoryBits=1;this.filter.maskBits=4294967295;this.filter.groupIndex=0;this.isSensor=!1};S.b2Island=function(){};S.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};S.prototype.Initialize=function(t,i,o,e,n,s){void 0===t&&(t=0);void 0===i&&(i=0);void 0===o&&(o=0);var r=0;this.m_bodyCapacity=t;this.m_contactCapacity=i;this.m_jointCapacity=o;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_allocator=e;this.m_listener=n;this.m_contactSolver=s;for(r=this.m_bodies.length;t>r;r++)this.m_bodies[r]=null;for(r=this.m_contacts.length;i>r;r++)this.m_contacts[r]=null;for(r=this.m_joints.length;o>r;r++)this.m_joints[r]=null};S.prototype.Clear=function(){this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0};S.prototype.Solve=function(i,o,e){var n,r,a=0,m=0;for(a=0;a<this.m_bodyCount;++a){n=this.m_bodies[a];if(n.GetType()==x.b2_dynamicBody){n.m_linearVelocity.x+=i.dt*(n.m_gravityScale*o.x+n.m_invMass*n.m_force.x);n.m_linearVelocity.y+=i.dt*(n.m_gravityScale*o.y+n.m_invMass*n.m_force.y);n.m_angularVelocity+=i.dt*n.m_invI*n.m_torque;n.m_linearVelocity.Multiply(t.Clamp(1-i.dt*n.m_linearDamping,0,1));n.m_angularVelocity*=t.Clamp(1-i.dt*n.m_angularDamping,0,1)}}this.m_contactSolver.Initialize(i,this.m_contacts,this.m_contactCount,this.m_allocator);var l=this.m_contactSolver;l.InitVelocityConstraints(i);for(a=0;a<this.m_jointCount;++a){r=this.m_joints[a];r.InitVelocityConstraints(i)}for(a=0;a<i.velocityIterations;++a){for(m=0;m<this.m_jointCount;++m){r=this.m_joints[m];r.SolveVelocityConstraints(i)}l.SolveVelocityConstraints()}for(a=0;a<this.m_jointCount;++a){r=this.m_joints[a];r.FinalizeVelocityConstraints()}l.FinalizeVelocityConstraints();for(a=0;a<this.m_bodyCount;++a){n=this.m_bodies[a];if(n.GetType()!=x.b2_staticBody){var c=i.dt*n.m_linearVelocity.x,h=i.dt*n.m_linearVelocity.y;if(c*c+h*h>s.b2_maxTranslationSquared){n.m_linearVelocity.Normalize();n.m_linearVelocity.x*=s.b2_maxTranslation*i.inv_dt;n.m_linearVelocity.y*=s.b2_maxTranslation*i.inv_dt}var _=i.dt*n.m_angularVelocity;_*_>s.b2_maxRotationSquared&&(n.m_angularVelocity=n.m_angularVelocity<0?-s.b2_maxRotation*i.inv_dt:s.b2_maxRotation*i.inv_dt);n.m_sweep.c0.SetV(n.m_sweep.c);n.m_sweep.a0=n.m_sweep.a;n.m_sweep.c.x+=i.dt*n.m_linearVelocity.x;n.m_sweep.c.y+=i.dt*n.m_linearVelocity.y;n.m_sweep.a+=i.dt*n.m_angularVelocity;n.SynchronizeTransform()}}for(a=0;a<i.positionIterations;++a){var p=l.SolvePositionConstraints(s.b2_contactBaumgarte),y=!0;for(m=0;m<this.m_jointCount;++m){r=this.m_joints[m];var u=r.SolvePositionConstraints(s.b2_contactBaumgarte);y=y&&u}if(p&&y)break}this.Report(l.m_constraints);if(e){var f=Number.MAX_VALUE,d=s.b2_linearSleepTolerance*s.b2_linearSleepTolerance,b=s.b2_angularSleepTolerance*s.b2_angularSleepTolerance;for(a=0;a<this.m_bodyCount;++a){n=this.m_bodies[a];if(n.GetType()!=x.b2_staticBody){if(0==(n.m_flags&x.e_allowSleepFlag)){n.m_sleepTime=0;f=0}if(0==(n.m_flags&x.e_allowSleepFlag)||n.m_angularVelocity*n.m_angularVelocity>b||t.Dot(n.m_linearVelocity,n.m_linearVelocity)>d){n.m_sleepTime=0;f=0}else{n.m_sleepTime+=i.dt;f=t.Min(f,n.m_sleepTime)}}}if(f>=s.b2_timeToSleep)for(a=0;a<this.m_bodyCount;++a){n=this.m_bodies[a];n.SetAwake(!1)}}};S.prototype.SolveTOI=function(t){var i=0,o=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var e=this.m_contactSolver;for(i=0;i<this.m_jointCount;++i)this.m_joints[i].InitVelocityConstraints(t);for(i=0;i<t.velocityIterations;++i){e.SolveVelocityConstraints();for(o=0;o<this.m_jointCount;++o)this.m_joints[o].SolveVelocityConstraints(t)}for(i=0;i<this.m_bodyCount;++i){var n=this.m_bodies[i];if(n.GetType()!=x.b2_staticBody){var r=t.dt*n.m_linearVelocity.x,a=t.dt*n.m_linearVelocity.y;if(r*r+a*a>s.b2_maxTranslationSquared){n.m_linearVelocity.Normalize();n.m_linearVelocity.x*=s.b2_maxTranslation*t.inv_dt;n.m_linearVelocity.y*=s.b2_maxTranslation*t.inv_dt}var m=t.dt*n.m_angularVelocity;m*m>s.b2_maxRotationSquared&&(n.m_angularVelocity=n.m_angularVelocity<0?-s.b2_maxRotation*t.inv_dt:s.b2_maxRotation*t.inv_dt);n.m_sweep.c0.SetV(n.m_sweep.c);n.m_sweep.a0=n.m_sweep.a;n.m_sweep.c.x+=t.dt*n.m_linearVelocity.x;n.m_sweep.c.y+=t.dt*n.m_linearVelocity.y;n.m_sweep.a+=t.dt*n.m_angularVelocity;n.SynchronizeTransform()}}var l=.75;for(i=0;i<t.positionIterations;++i){var c=e.SolvePositionConstraints(l),h=!0;for(o=0;o<this.m_jointCount;++o){var _=this.m_joints[o].SolvePositionConstraints(s.b2_contactBaumgarte);h=h&&_}if(c&&h)break}this.Report(e.m_constraints)};S.prototype.Report=function(t){if(null!=this.m_listener)for(var i=0;i<this.m_contactCount;++i){for(var o=this.m_contacts[i],e=t[i],n=0;n<e.pointCount;++n){S.s_impulse.normalImpulses[n]=e.points[n].normalImpulse;S.s_impulse.tangentImpulses[n]=e.points[n].tangentImpulse}this.m_listener.PostSolve(o,S.s_impulse)}};S.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=t};S.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t};S.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new b});M.b2TimeStep=function(){};M.prototype.Set=function(t){this.dt=t.dt;this.inv_dt=t.inv_dt;this.positionIterations=t.positionIterations;this.velocityIterations=t.velocityIterations;this.warmStarting=t.warmStarting};V.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new D;this.m_contactSolver=new J;this.m_island=new S};V.prototype.b2World=function(t,i){this.m_destructionListener=null;this.m_debugDraw=null;this.m_bodyList=null;this.m_contactList=null;this.m_jointList=null;this.m_controllerList=null;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_controllerCount=0;V.m_warmStarting=!0;V.m_continuousPhysics=!0;this.m_allowSleep=i;this.m_gravity=t;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var o=new f;this.m_groundBody=this.CreateBody(o)};V.prototype.SetDestructionListener=function(t){this.m_destructionListener=t};V.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t};V.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t};V.prototype.SetDebugDraw=function(t){this.m_debugDraw=t};V.prototype.SetBroadPhase=function(t){var i=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var o=this.m_bodyList;o;o=o.m_next)for(var e=o.m_fixtureList;e;e=e.m_next)e.m_proxy=t.CreateProxy(i.GetFatAABB(e.m_proxy),e)};V.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};V.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};V.prototype.CreateBody=function(t){if(1==this.IsLocked())return null;var i=new x(t,this);i.m_prev=null;i.m_next=this.m_bodyList;this.m_bodyList&&(this.m_bodyList.m_prev=i);this.m_bodyList=i;++this.m_bodyCount;return i};V.prototype.DestroyBody=function(t){if(1!=this.IsLocked()){for(var i=t.m_jointList;i;){var o=i;i=i.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(o.joint);this.DestroyJoint(o.joint)}for(var e=t.m_controllerList;e;){var n=e;e=e.nextController;n.controller.RemoveBody(t)}for(var s=t.m_contactList;s;){var r=s;s=s.next;this.m_contactManager.Destroy(r.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var m=a;a=a.m_next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(m);m.DestroyProxy(this.m_contactManager.m_broadPhase);m.Destroy()}t.m_fixtureList=null;t.m_fixtureCount=0;t.m_prev&&(t.m_prev.m_next=t.m_next);t.m_next&&(t.m_next.m_prev=t.m_prev);t==this.m_bodyList&&(this.m_bodyList=t.m_next);--this.m_bodyCount}};V.prototype.CreateJoint=function(t){var i=L.Create(t,null);i.m_prev=null;i.m_next=this.m_jointList;this.m_jointList&&(this.m_jointList.m_prev=i);this.m_jointList=i;++this.m_jointCount;i.m_edgeA.joint=i;i.m_edgeA.other=i.m_bodyB;i.m_edgeA.prev=null;i.m_edgeA.next=i.m_bodyA.m_jointList;i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA);i.m_bodyA.m_jointList=i.m_edgeA;i.m_edgeB.joint=i;i.m_edgeB.other=i.m_bodyA;i.m_edgeB.prev=null;i.m_edgeB.next=i.m_bodyB.m_jointList;i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB);i.m_bodyB.m_jointList=i.m_edgeB;var o=t.bodyA,e=t.bodyB;if(0==t.collideConnected)for(var n=e.GetContactList();n;){n.other==o&&n.contact.FlagForFiltering();n=n.next}return i};V.prototype.DestroyJoint=function(t){var i=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next);t.m_next&&(t.m_next.m_prev=t.m_prev);t==this.m_jointList&&(this.m_jointList=t.m_next);var o=t.m_bodyA,e=t.m_bodyB;o.SetAwake(!0);e.SetAwake(!0);t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next);t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev);t.m_edgeA==o.m_jointList&&(o.m_jointList=t.m_edgeA.next);t.m_edgeA.prev=null;t.m_edgeA.next=null;t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next);t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev);t.m_edgeB==e.m_jointList&&(e.m_jointList=t.m_edgeB.next);t.m_edgeB.prev=null;t.m_edgeB.next=null;L.Destroy(t,null);--this.m_jointCount;if(0==i)for(var n=e.GetContactList();n;){n.other==o&&n.contact.FlagForFiltering();n=n.next}};V.prototype.AddController=function(t){t.m_next=this.m_controllerList;t.m_prev=null;this.m_controllerList=t;t.m_world=this;this.m_controllerCount++;return t};V.prototype.RemoveController=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next);t.m_next&&(t.m_next.m_prev=t.m_prev);this.m_controllerList==t&&(this.m_controllerList=t.m_next);this.m_controllerCount--};V.prototype.CreateController=function(t){if(t.m_world!=this)throw new Error("Controller can only be a member of one world");t.m_next=this.m_controllerList;t.m_prev=null;this.m_controllerList&&(this.m_controllerList.m_prev=t);this.m_controllerList=t;++this.m_controllerCount;t.m_world=this;return t};V.prototype.DestroyController=function(t){t.Clear();t.m_next&&(t.m_next.m_prev=t.m_prev);t.m_prev&&(t.m_prev.m_next=t.m_next);t==this.m_controllerList&&(this.m_controllerList=t.m_next);--this.m_controllerCount};V.prototype.SetWarmStarting=function(t){V.m_warmStarting=t};V.prototype.SetContinuousPhysics=function(t){V.m_continuousPhysics=t};V.prototype.GetBodyCount=function(){return this.m_bodyCount};V.prototype.GetJointCount=function(){return this.m_jointCount};V.prototype.GetContactCount=function(){return this.m_contactCount};V.prototype.SetGravity=function(t){this.m_gravity=t};V.prototype.GetGravity=function(){return this.m_gravity};V.prototype.GetGroundBody=function(){return this.m_groundBody};V.prototype.Step=function(t,i,o){void 0===t&&(t=0);void 0===i&&(i=0);void 0===o&&(o=0);if(this.m_flags&V.e_newFixture){this.m_contactManager.FindNewContacts();this.m_flags&=~V.e_newFixture}this.m_flags|=V.e_locked;var e=V.s_timestep2;e.dt=t;e.velocityIterations=i;e.positionIterations=o;e.inv_dt=t>0?1/t:0;e.dtRatio=this.m_inv_dt0*t;e.warmStarting=V.m_warmStarting;this.m_contactManager.Collide();e.dt>0&&this.Solve(e);V.m_continuousPhysics&&e.dt>0&&this.SolveTOI(e);e.dt>0&&(this.m_inv_dt0=e.inv_dt);this.m_flags&=~V.e_locked};V.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next){t.m_force.SetZero();t.m_torque=0}};V.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var t,i,o,s,a,m,l=this.m_debugDraw.GetFlags(),c=(new e,new e,new e,new r,new r,[new e,new e,new e,new e]),h=new n(0,0,0);if(l&B.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next){m=t.m_xf;for(i=t.GetFixtureList();i;i=i.m_next){o=i.GetShape();if(0==t.IsActive()){h.Set(.5,.5,.3);this.DrawShape(o,m,h)}else if(t.GetType()==x.b2_staticBody){h.Set(.5,.9,.5);this.DrawShape(o,m,h)}else if(t.GetType()==x.b2_kinematicBody){h.Set(.5,.5,.9);this.DrawShape(o,m,h)}else if(0==t.IsAwake()){h.Set(.6,.6,.6);this.DrawShape(o,m,h)}else{h.Set(.9,.7,.7);this.DrawShape(o,m,h)}}}if(l&B.e_jointBit)for(s=this.m_jointList;s;s=s.m_next)this.DrawJoint(s);if(l&B.e_controllerBit)for(var _=this.m_controllerList;_;_=_.m_next)_.Draw(this.m_debugDraw);if(l&B.e_pairBit){h.Set(.3,.9,.9);for(var p=this.m_contactManager.m_contactList;p;p=p.GetNext()){var y=p.GetFixtureA(),u=p.GetFixtureB(),f=y.GetAABB().GetCenter(),d=u.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(f,d,h)}}if(l&B.e_aabbBit){a=this.m_contactManager.m_broadPhase;c=[new e,new e,new e,new e];for(t=this.m_bodyList;t;t=t.GetNext())if(0!=t.IsActive())for(i=t.GetFixtureList();i;i=i.GetNext()){var b=a.GetFatAABB(i.m_proxy);c[0].Set(b.lowerBound.x,b.lowerBound.y);c[1].Set(b.upperBound.x,b.lowerBound.y);c[2].Set(b.upperBound.x,b.upperBound.y);c[3].Set(b.lowerBound.x,b.upperBound.y);this.m_debugDraw.DrawPolygon(c,4,h)}}if(l&B.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next){m=V.s_xf;m.R=t.m_xf.R;m.position=t.GetWorldCenter();this.m_debugDraw.DrawTransform(m)}}};V.prototype.QueryAABB=function(t,i){function o(i){return t(n.GetUserData(i))}var e=this,n=e.m_contactManager.m_broadPhase;n.Query(o,i)};V.prototype.QueryShape=function(t,i,e){function n(o){var n=a.GetUserData(o)instanceof A?a.GetUserData(o):null;return u.TestOverlap(i,e,n.GetShape(),n.GetBody().GetTransform())?t(n):!0}var s=this;void 0===e&&(e=null);if(null==e){e=new o;e.SetIdentity()}var a=s.m_contactManager.m_broadPhase,m=new r;i.ComputeAABB(m,e);a.Query(n,m)};V.prototype.QueryPoint=function(t,i){function o(o){var e=n.GetUserData(o)instanceof A?n.GetUserData(o):null;return e.TestPoint(i)?t(e):!0}var e=this,n=e.m_contactManager.m_broadPhase,a=new r;a.lowerBound.Set(i.x-s.b2_linearSlop,i.y-s.b2_linearSlop);a.upperBound.Set(i.x+s.b2_linearSlop,i.y+s.b2_linearSlop);n.Query(o,a)};V.prototype.RayCast=function(t,i,o){function n(n,s){var m=r.GetUserData(s),l=m instanceof A?m:null,c=l.RayCast(a,n);if(c){var h=a.fraction,_=new e((1-h)*i.x+h*o.x,(1-h)*i.y+h*o.y);return t(l,_,a.normal,h)}return n.maxFraction}var s=this,r=s.m_contactManager.m_broadPhase,a=new c,m=new l(i,o);r.RayCast(n,m)};V.prototype.RayCastOne=function(t,i){function o(t,i,o,n){void 0===n&&(n=0);e=t;return n}var e,n=this;n.RayCast(o,t,i);return e};V.prototype.RayCastAll=function(t,i){function o(t,i,o,e){void 0===e&&(e=0);n[n.length]=t;return 1}var e=this,n=new Vector;e.RayCast(o,t,i);return n};V.prototype.GetBodyList=function(){return this.m_bodyList};V.prototype.GetJointList=function(){return this.m_jointList};V.prototype.GetContactList=function(){return this.m_contactList};V.prototype.IsLocked=function(){return(this.m_flags&V.e_locked)>0};V.prototype.Solve=function(t){for(var i,o=this.m_controllerList;o;o=o.m_next)o.Step(t);var e=this.m_island;e.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~x.e_islandFlag;for(var n=this.m_contactList;n;n=n.m_next)n.m_flags&=~I.e_islandFlag;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(var r=(parseInt(this.m_bodyCount),this.s_stack),a=this.m_bodyList;a;a=a.m_next)if(!(a.m_flags&x.e_islandFlag)&&0!=a.IsAwake()&&0!=a.IsActive()&&a.GetType()!=x.b2_staticBody){e.Clear();var m=0;r[m++]=a;a.m_flags|=x.e_islandFlag;for(;m>0;){i=r[--m];e.AddBody(i);0==i.IsAwake()&&i.SetAwake(!0);if(i.GetType()!=x.b2_staticBody){for(var l,c=i.m_contactList;c;c=c.next)if(!(c.contact.m_flags&I.e_islandFlag)&&1!=c.contact.IsSensor()&&0!=c.contact.IsEnabled()&&0!=c.contact.IsTouching()){e.AddContact(c.contact);c.contact.m_flags|=I.e_islandFlag;l=c.other;if(!(l.m_flags&x.e_islandFlag)){r[m++]=l;l.m_flags|=x.e_islandFlag}}for(var h=i.m_jointList;h;h=h.next)if(1!=h.joint.m_islandFlag){l=h.other;if(0!=l.IsActive()){e.AddJoint(h.joint);h.joint.m_islandFlag=!0;if(!(l.m_flags&x.e_islandFlag)){r[m++]=l;l.m_flags|=x.e_islandFlag}}}}}e.Solve(t,this.m_gravity,this.m_allowSleep);for(var _=0;_<e.m_bodyCount;++_){i=e.m_bodies[_];i.GetType()==x.b2_staticBody&&(i.m_flags&=~x.e_islandFlag)}}for(_=0;_<r.length&&r[_];++_)r[_]=null;for(i=this.m_bodyList;i;i=i.m_next)0!=i.IsAwake()&&0!=i.IsActive()&&i.GetType()!=x.b2_staticBody&&i.SynchronizeFixtures();this.m_contactManager.FindNewContacts()};V.prototype.SolveTOI=function(t){var i,o,e,n,r,a,m,l=this.m_island;l.Initialize(this.m_bodyCount,s.b2_maxTOIContactsPerIsland,s.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var c=V.s_queue;for(i=this.m_bodyList;i;i=i.m_next){i.m_flags&=~x.e_islandFlag;i.m_sweep.t0=0}var h;for(h=this.m_contactList;h;h=h.m_next)h.m_flags&=~(I.e_toiFlag|I.e_islandFlag);for(m=this.m_jointList;m;m=m.m_next)m.m_islandFlag=!1;for(;;){var _=null,p=1;for(h=this.m_contactList;h;h=h.m_next)if(1!=h.IsSensor()&&0!=h.IsEnabled()&&0!=h.IsContinuous()){var y=1;if(h.m_flags&I.e_toiFlag)y=h.m_toi;
else{o=h.m_fixtureA;e=h.m_fixtureB;n=o.m_body;r=e.m_body;if(!(n.GetType()==x.b2_dynamicBody&&0!=n.IsAwake()||r.GetType()==x.b2_dynamicBody&&0!=r.IsAwake()))continue;var u=n.m_sweep.t0;if(n.m_sweep.t0<r.m_sweep.t0){u=r.m_sweep.t0;n.m_sweep.Advance(u)}else if(r.m_sweep.t0<n.m_sweep.t0){u=n.m_sweep.t0;r.m_sweep.Advance(u)}y=h.ComputeTOI(n.m_sweep,r.m_sweep);s.b2Assert(y>=0&&1>=y);if(y>0&&1>y){y=(1-y)*u+y;y>1&&(y=1)}h.m_toi=y;h.m_flags|=I.e_toiFlag}if(Box2D.MIN_VALUE<y&&p>y){_=h;p=y}}if(null==_||1-100*Box2D.MIN_VALUE<p)break;o=_.m_fixtureA;e=_.m_fixtureB;n=o.m_body;r=e.m_body;V.s_backupA.Set(n.m_sweep);V.s_backupB.Set(r.m_sweep);n.Advance(p);r.Advance(p);_.Update(this.m_contactManager.m_contactListener);_.m_flags&=~I.e_toiFlag;if(1!=_.IsSensor()&&0!=_.IsEnabled()){if(0!=_.IsTouching()){var f=n;f.GetType()!=x.b2_dynamicBody&&(f=r);l.Clear();var d=0,b=0;c[d+b++]=f;f.m_flags|=x.e_islandFlag;for(;b>0;){i=c[d++];--b;l.AddBody(i);0==i.IsAwake()&&i.SetAwake(!0);if(i.GetType()==x.b2_dynamicBody){for(a=i.m_contactList;a&&l.m_contactCount!=l.m_contactCapacity;a=a.next)if(!(a.contact.m_flags&I.e_islandFlag)&&1!=a.contact.IsSensor()&&0!=a.contact.IsEnabled()&&0!=a.contact.IsTouching()){l.AddContact(a.contact);a.contact.m_flags|=I.e_islandFlag;var v=a.other;if(!(v.m_flags&x.e_islandFlag)){if(v.GetType()!=x.b2_staticBody){v.Advance(p);v.SetAwake(!0)}c[d+b]=v;++b;v.m_flags|=x.e_islandFlag}}for(var D=i.m_jointList;D;D=D.next)if(l.m_jointCount!=l.m_jointCapacity&&1!=D.joint.m_islandFlag){v=D.other;if(0!=v.IsActive()){l.AddJoint(D.joint);D.joint.m_islandFlag=!0;if(!(v.m_flags&x.e_islandFlag)){if(v.GetType()!=x.b2_staticBody){v.Advance(p);v.SetAwake(!0)}c[d+b]=v;++b;v.m_flags|=x.e_islandFlag}}}}}var B=V.s_timestep;B.warmStarting=!1;B.dt=(1-p)*t.dt;B.inv_dt=1/B.dt;B.dtRatio=0;B.velocityIterations=t.velocityIterations;B.positionIterations=t.positionIterations;l.SolveTOI(B);var C=0;for(C=0;C<l.m_bodyCount;++C){i=l.m_bodies[C];i.m_flags&=~x.e_islandFlag;if(0!=i.IsAwake()&&i.GetType()==x.b2_dynamicBody){i.SynchronizeFixtures();for(a=i.m_contactList;a;a=a.next)a.contact.m_flags&=~I.e_toiFlag}}for(C=0;C<l.m_contactCount;++C){h=l.m_contacts[C];h.m_flags&=~(I.e_toiFlag|I.e_islandFlag)}for(C=0;C<l.m_jointCount;++C){m=l.m_joints[C];m.m_islandFlag=!1}this.m_contactManager.FindNewContacts()}}else{n.m_sweep.Set(V.s_backupA);r.m_sweep.Set(V.s_backupB);n.SynchronizeTransform();r.SynchronizeTransform()}}};V.prototype.DrawJoint=function(t){var i=t.GetBodyA(),o=t.GetBodyB(),e=i.m_xf,n=o.m_xf,s=e.position,r=n.position,a=t.GetAnchorA(),m=t.GetAnchorB(),l=V.s_jointColor;switch(t.m_type){case L.e_ropeJoint:this.m_debugDraw.DrawSegment(a,m,l);break;case L.e_distanceJoint:this.m_debugDraw.DrawSegment(a,m,l);break;case L.e_pulleyJoint:var c=t instanceof F?t:null,h=c.GetGroundAnchorA(),_=c.GetGroundAnchorB();this.m_debugDraw.DrawSegment(h,a,l);this.m_debugDraw.DrawSegment(_,m,l);this.m_debugDraw.DrawSegment(h,_,l);break;case L.e_mouseJoint:this.m_debugDraw.DrawSegment(a,m,l);break;default:i!=this.m_groundBody&&this.m_debugDraw.DrawSegment(s,a,l);this.m_debugDraw.DrawSegment(a,m,l);o!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,m,l)}};V.prototype.DrawShape=function(i,o,e){switch(i.m_type){case u.e_circleShape:var n=i instanceof h?i:null,s=t.MulX(o,n.m_p),r=n.m_radius,a=o.R.col1;this.m_debugDraw.DrawSolidCircle(s,r,a,e);break;case u.e_polygonShape:var m=0,l=i instanceof y?i:null,c=parseInt(l.GetVertexCount()),p=l.GetVertices(),x=new Vector(c);for(m=0;c>m;++m)x[m]=t.MulX(o,p[m]);this.m_debugDraw.DrawSolidPolygon(x,c,e);break;case u.e_edgeShape:var f=i instanceof _?i:null;this.m_debugDraw.DrawSegment(t.MulX(o,f.GetVertex1()),t.MulX(o,f.GetVertex2()),e)}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new M;Box2D.Dynamics.b2World.s_xf=new o;Box2D.Dynamics.b2World.s_backupA=new i;Box2D.Dynamics.b2World.s_backupB=new i;Box2D.Dynamics.b2World.s_timestep=new M;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new n(.5,.8,.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})}();!function(){{var t=Box2D.Collision.Shapes.b2CircleShape,i=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape),o=(Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),e=Box2D.Collision.Shapes.b2Shape,n=Box2D.Dynamics.Contacts.b2CircleContact,s=Box2D.Dynamics.Contacts.b2Contact,r=Box2D.Dynamics.Contacts.b2ContactConstraint,a=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,m=Box2D.Dynamics.Contacts.b2ContactEdge,l=Box2D.Dynamics.Contacts.b2ContactFactory,c=Box2D.Dynamics.Contacts.b2ContactRegister,h=Box2D.Dynamics.Contacts.b2ContactResult,_=Box2D.Dynamics.Contacts.b2ContactSolver,p=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,y=Box2D.Dynamics.Contacts.b2NullContact,u=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,x=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,f=Box2D.Dynamics.Contacts.b2PolygonContact,d=Box2D.Dynamics.Contacts.b2PositionSolverManifold,b=Box2D.Dynamics.b2Body,v=(Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep),D=(Box2D.Dynamics.b2World,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),B=Box2D.Common.Math.b2Mat22,C=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),g=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),A=(Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision),w=Box2D.Collision.b2ContactID,S=(Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold),M=(Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact),V=Box2D.Collision.b2TOIInput,I=Box2D.Collision.b2WorldManifold;Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase}Box2D.inherit(n,Box2D.Dynamics.Contacts.b2Contact);n.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;n.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};n.Create=function(){return new n};n.Destroy=function(){};n.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i)};n.prototype.Evaluate=function(){var i=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody();A.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,i.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,o.m_xf)};s.b2Contact=function(){this.m_nodeA=new m;this.m_nodeB=new m;this.m_manifold=new S;this.m_oldManifold=new S};s.prototype.GetManifold=function(){return this.m_manifold};s.prototype.GetWorldManifold=function(t){var i=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody(),e=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,i.GetTransform(),e.m_radius,o.GetTransform(),n.m_radius)};s.prototype.IsTouching=function(){return(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag};s.prototype.IsContinuous=function(){return(this.m_flags&s.e_continuousFlag)==s.e_continuousFlag};s.prototype.SetSensor=function(t){t?this.m_flags|=s.e_sensorFlag:this.m_flags&=~s.e_sensorFlag};s.prototype.IsSensor=function(){return(this.m_flags&s.e_sensorFlag)==s.e_sensorFlag};s.prototype.SetEnabled=function(t){t?this.m_flags|=s.e_enabledFlag:this.m_flags&=~s.e_enabledFlag};s.prototype.IsEnabled=function(){return(this.m_flags&s.e_enabledFlag)==s.e_enabledFlag};s.prototype.GetNext=function(){return this.m_next};s.prototype.GetFixtureA=function(){return this.m_fixtureA};s.prototype.GetFixtureB=function(){return this.m_fixtureB};s.prototype.FlagForFiltering=function(){this.m_flags|=s.e_filterFlag};s.prototype.b2Contact=function(){};s.prototype.Reset=function(t,i){void 0===t&&(t=null);void 0===i&&(i=null);this.m_flags=s.e_enabledFlag;if(t&&i){(t.IsSensor()||i.IsSensor())&&(this.m_flags|=s.e_sensorFlag);var o=t.GetBody(),e=i.GetBody();(o.GetType()!=b.b2_dynamicBody||o.IsBullet()||e.GetType()!=b.b2_dynamicBody||e.IsBullet())&&(this.m_flags|=s.e_continuousFlag);this.m_fixtureA=t;this.m_fixtureB=i;this.m_manifold.m_pointCount=0;this.m_prev=null;this.m_next=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}else{this.m_fixtureA=null;this.m_fixtureB=null}};s.prototype.Update=function(t){var i=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=i;this.m_flags|=s.e_enabledFlag;var o=!1,n=(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag,r=this.m_fixtureA.m_body,a=this.m_fixtureB.m_body,m=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&s.e_sensorFlag){if(m){var l=this.m_fixtureA.GetShape(),c=this.m_fixtureB.GetShape(),h=r.GetTransform(),_=a.GetTransform();o=e.TestOverlap(l,h,c,_)}this.m_manifold.m_pointCount=0}else{r.GetType()!=b.b2_dynamicBody||r.IsBullet()||a.GetType()!=b.b2_dynamicBody||a.IsBullet()?this.m_flags|=s.e_continuousFlag:this.m_flags&=~s.e_continuousFlag;if(m){this.Evaluate();o=this.m_manifold.m_pointCount>0;for(var p=0;p<this.m_manifold.m_pointCount;++p){var y=this.m_manifold.m_points[p];y.m_normalImpulse=0;y.m_tangentImpulse=0;for(var u=y.m_id,x=0;x<this.m_oldManifold.m_pointCount;++x){var f=this.m_oldManifold.m_points[x];if(f.m_id.key==u.key){y.m_normalImpulse=f.m_normalImpulse;y.m_tangentImpulse=f.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;if(o!=n){r.SetAwake(!0);a.SetAwake(!0)}}o?this.m_flags|=s.e_touchingFlag:this.m_flags&=~s.e_touchingFlag;0==n&&1==o&&t.BeginContact(this);1==n&&0==o&&t.EndContact(this);0==(this.m_flags&s.e_sensorFlag)&&t.PreSolve(this,this.m_oldManifold)};s.prototype.Evaluate=function(){};s.prototype.ComputeTOI=function(t,i){s.s_input.proxyA.Set(this.m_fixtureA.GetShape());s.s_input.proxyB.Set(this.m_fixtureB.GetShape());s.s_input.sweepA=t;s.s_input.sweepB=i;s.s_input.tolerance=D.b2_linearSlop;return M.TimeOfImpact(s.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.b2Contact.s_input=new V});r.b2ContactConstraint=function(){this.localPlaneNormal=new g;this.localPoint=new g;this.normal=new g;this.normalMass=new B;this.K=new B};r.prototype.b2ContactConstraint=function(){this.points=new Vector(D.b2_maxManifoldPoints);for(var t=0;t<D.b2_maxManifoldPoints;t++)this.points[t]=new a};a.b2ContactConstraintPoint=function(){this.localPoint=new g;this.rA=new g;this.rB=new g};m.b2ContactEdge=function(){};l.b2ContactFactory=function(){};l.prototype.b2ContactFactory=function(t){this.m_allocator=t;this.InitializeRegisters()};l.prototype.AddType=function(t,i,o,e){void 0===o&&(o=0);void 0===e&&(e=0);this.m_registers[o][e].createFcn=t;this.m_registers[o][e].destroyFcn=i;this.m_registers[o][e].primary=!0;if(o!=e){this.m_registers[e][o].createFcn=t;this.m_registers[e][o].destroyFcn=i;this.m_registers[e][o].primary=!1}};l.prototype.InitializeRegisters=function(){this.m_registers=new Vector(e.e_shapeTypeCount);for(var t=0;t<e.e_shapeTypeCount;t++){this.m_registers[t]=new Vector(e.e_shapeTypeCount);for(var i=0;i<e.e_shapeTypeCount;i++)this.m_registers[t][i]=new c}this.AddType(n.Create,n.Destroy,e.e_circleShape,e.e_circleShape);this.AddType(u.Create,u.Destroy,e.e_polygonShape,e.e_circleShape);this.AddType(f.Create,f.Destroy,e.e_polygonShape,e.e_polygonShape);this.AddType(p.Create,p.Destroy,e.e_edgeShape,e.e_circleShape);this.AddType(x.Create,x.Destroy,e.e_polygonShape,e.e_edgeShape)};l.prototype.Create=function(t,i){var o,e=parseInt(t.GetType()),n=parseInt(i.GetType()),s=this.m_registers[e][n];if(s.pool){o=s.pool;s.pool=o.m_next;s.poolCount--;o.Reset(t,i);return o}var r=s.createFcn;if(null!=r){if(s.primary){o=r(this.m_allocator);o.Reset(t,i);return o}o=r(this.m_allocator);o.Reset(i,t);return o}return null};l.prototype.Destroy=function(t){if(t.m_manifold.m_pointCount>0){t.m_fixtureA.m_body.SetAwake(!0);t.m_fixtureB.m_body.SetAwake(!0)}var i=parseInt(t.m_fixtureA.GetType()),o=parseInt(t.m_fixtureB.GetType()),e=this.m_registers[i][o];e.poolCount++;t.m_next=e.pool;e.pool=t;var n=e.destroyFcn;n(t,this.m_allocator)};c.b2ContactRegister=function(){};h.b2ContactResult=function(){this.position=new g;this.normal=new g;this.id=new w};_.b2ContactSolver=function(){this.m_step=new v;this.m_constraints=new Vector};_.prototype.b2ContactSolver=function(){};_.prototype.Initialize=function(t,i,o,e){void 0===o&&(o=0);var n;this.m_step.Set(t);this.m_allocator=e;var s=0;this.m_constraintCount=o;for(;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new r;for(s=0;o>s;++s){n=i[s];var a=n.m_fixtureA,m=n.m_fixtureB,l=a.m_shape,c=m.m_shape,h=l.m_radius,p=c.m_radius,y=a.m_body,u=m.m_body,x=n.GetManifold(),f=D.b2MixFriction(a.GetFriction(),m.GetFriction()),d=D.b2MixRestitution(a.GetRestitution(),m.GetRestitution()),b=y.m_linearVelocity.x,v=y.m_linearVelocity.y,B=u.m_linearVelocity.x,C=u.m_linearVelocity.y,g=y.m_angularVelocity,A=u.m_angularVelocity;D.b2Assert(x.m_pointCount>0);_.s_worldManifold.Initialize(x,y.m_xf,h,u.m_xf,p);var w=_.s_worldManifold.m_normal.x,S=_.s_worldManifold.m_normal.y,M=this.m_constraints[s];M.bodyA=y;M.bodyB=u;M.manifold=x;M.normal.x=w;M.normal.y=S;M.pointCount=x.m_pointCount;M.friction=f;M.restitution=d;M.localPlaneNormal.x=x.m_localPlaneNormal.x;M.localPlaneNormal.y=x.m_localPlaneNormal.y;M.localPoint.x=x.m_localPoint.x;M.localPoint.y=x.m_localPoint.y;M.radius=h+p;M.type=x.m_type;for(var V=0;V<M.pointCount;++V){var I=x.m_points[V],G=M.points[V];G.normalImpulse=I.m_normalImpulse;G.tangentImpulse=I.m_tangentImpulse;G.localPoint.SetV(I.m_localPoint);var J=G.rA.x=_.s_worldManifold.m_points[V].x-y.m_sweep.c.x,L=G.rA.y=_.s_worldManifold.m_points[V].y-y.m_sweep.c.y,F=G.rB.x=_.s_worldManifold.m_points[V].x-u.m_sweep.c.x,P=G.rB.y=_.s_worldManifold.m_points[V].y-u.m_sweep.c.y,R=J*S-L*w,T=F*S-P*w;R*=R;T*=T;var k=y.m_invMass+u.m_invMass+y.m_invI*R+u.m_invI*T;G.normalMass=1/k;var z=y.m_mass*y.m_invMass+u.m_mass*u.m_invMass;z+=y.m_mass*y.m_invI*R+u.m_mass*u.m_invI*T;G.equalizedMass=1/z;var E=S,N=-w,j=J*N-L*E,q=F*N-P*E;j*=j;q*=q;var U=y.m_invMass+u.m_invMass+y.m_invI*j+u.m_invI*q;G.tangentMass=1/U;G.velocityBias=0;var O=B+-A*P-b- -g*L,W=C+A*F-v-g*J,K=M.normal.x*O+M.normal.y*W;K<-D.b2_velocityThreshold&&(G.velocityBias+=-M.restitution*K)}if(2==M.pointCount){var X=M.points[0],Z=M.points[1],H=y.m_invMass,Y=y.m_invI,Q=u.m_invMass,$=u.m_invI,ti=X.rA.x*S-X.rA.y*w,ii=X.rB.x*S-X.rB.y*w,oi=Z.rA.x*S-Z.rA.y*w,ei=Z.rB.x*S-Z.rB.y*w,ni=H+Q+Y*ti*ti+$*ii*ii,si=H+Q+Y*oi*oi+$*ei*ei,ri=H+Q+Y*ti*oi+$*ii*ei,ai=100;if(ai*(ni*si-ri*ri)>ni*ni){M.K.col1.Set(ni,ri);M.K.col2.Set(ri,si);M.K.GetInverse(M.normalMass)}else M.pointCount=1}}};_.prototype.InitVelocityConstraints=function(t){for(var i=0;i<this.m_constraintCount;++i){var o=this.m_constraints[i],e=o.bodyA,n=o.bodyB,s=e.m_invMass,r=e.m_invI,a=n.m_invMass,m=n.m_invI,l=o.normal.x,c=o.normal.y,h=c,_=-l,p=0,y=0;if(t.warmStarting){y=o.pointCount;for(p=0;y>p;++p){var u=o.points[p];u.normalImpulse*=t.dtRatio;u.tangentImpulse*=t.dtRatio;var x=u.normalImpulse*l+u.tangentImpulse*h,f=u.normalImpulse*c+u.tangentImpulse*_;e.m_angularVelocity-=r*(u.rA.x*f-u.rA.y*x);e.m_linearVelocity.x-=s*x;e.m_linearVelocity.y-=s*f;n.m_angularVelocity+=m*(u.rB.x*f-u.rB.y*x);n.m_linearVelocity.x+=a*x;n.m_linearVelocity.y+=a*f}}else{y=o.pointCount;for(p=0;y>p;++p){var d=o.points[p];d.normalImpulse=0;d.tangentImpulse=0}}}};_.prototype.SolveVelocityConstraints=function(){for(var t,i,o=0,e=0,n=0,s=0,r=0,a=0,m=0,l=0,c=0,h=0,_=0,p=0,y=0,u=0,x=0,f=0,d=0;d<this.m_constraintCount;++d){var b=this.m_constraints[d],v=b.bodyA,D=b.bodyB,B=v.m_angularVelocity,g=D.m_angularVelocity,A=v.m_linearVelocity,w=D.m_linearVelocity,S=v.m_invMass,M=v.m_invI,V=D.m_invMass,I=D.m_invI,G=b.normal.x,J=b.normal.y,L=J,F=-G,P=b.friction;for(o=0;o<b.pointCount;o++){t=b.points[o];e=w.x-g*t.rB.y-A.x+B*t.rA.y;n=w.y+g*t.rB.x-A.y-B*t.rA.x;r=e*L+n*F;a=t.tangentMass*-r;m=P*t.normalImpulse;l=C.Clamp(t.tangentImpulse+a,-m,m);a=l-t.tangentImpulse;c=a*L;h=a*F;A.x-=S*c;A.y-=S*h;B-=M*(t.rA.x*h-t.rA.y*c);w.x+=V*c;w.y+=V*h;g+=I*(t.rB.x*h-t.rB.y*c);t.tangentImpulse=l}{parseInt(b.pointCount)}if(1==b.pointCount){t=b.points[0];e=w.x+-g*t.rB.y-A.x- -B*t.rA.y;n=w.y+g*t.rB.x-A.y-B*t.rA.x;s=e*G+n*J;a=-t.normalMass*(s-t.velocityBias);l=t.normalImpulse+a;l=l>0?l:0;a=l-t.normalImpulse;c=a*G;h=a*J;A.x-=S*c;A.y-=S*h;B-=M*(t.rA.x*h-t.rA.y*c);w.x+=V*c;w.y+=V*h;g+=I*(t.rB.x*h-t.rB.y*c);t.normalImpulse=l}else{var R=b.points[0],T=b.points[1],k=R.normalImpulse,z=T.normalImpulse,E=w.x-g*R.rB.y-A.x+B*R.rA.y,N=w.y+g*R.rB.x-A.y-B*R.rA.x,j=w.x-g*T.rB.y-A.x+B*T.rA.y,q=w.y+g*T.rB.x-A.y-B*T.rA.x,U=E*G+N*J,O=j*G+q*J,W=U-R.velocityBias,K=O-T.velocityBias;i=b.K;W-=i.col1.x*k+i.col2.x*z;K-=i.col1.y*k+i.col2.y*z;for(;;){i=b.normalMass;var X=-(i.col1.x*W+i.col2.x*K),Z=-(i.col1.y*W+i.col2.y*K);if(X>=0&&Z>=0){_=X-k;p=Z-z;y=_*G;u=_*J;x=p*G;f=p*J;A.x-=S*(y+x);A.y-=S*(u+f);B-=M*(R.rA.x*u-R.rA.y*y+T.rA.x*f-T.rA.y*x);w.x+=V*(y+x);w.y+=V*(u+f);g+=I*(R.rB.x*u-R.rB.y*y+T.rB.x*f-T.rB.y*x);R.normalImpulse=X;T.normalImpulse=Z;break}X=-R.normalMass*W;Z=0;U=0;O=b.K.col1.y*X+K;if(X>=0&&O>=0){_=X-k;p=Z-z;y=_*G;u=_*J;x=p*G;f=p*J;A.x-=S*(y+x);A.y-=S*(u+f);B-=M*(R.rA.x*u-R.rA.y*y+T.rA.x*f-T.rA.y*x);w.x+=V*(y+x);w.y+=V*(u+f);g+=I*(R.rB.x*u-R.rB.y*y+T.rB.x*f-T.rB.y*x);R.normalImpulse=X;T.normalImpulse=Z;break}X=0;Z=-T.normalMass*K;U=b.K.col2.x*Z+W;O=0;if(Z>=0&&U>=0){_=X-k;p=Z-z;y=_*G;u=_*J;x=p*G;f=p*J;A.x-=S*(y+x);A.y-=S*(u+f);B-=M*(R.rA.x*u-R.rA.y*y+T.rA.x*f-T.rA.y*x);w.x+=V*(y+x);w.y+=V*(u+f);g+=I*(R.rB.x*u-R.rB.y*y+T.rB.x*f-T.rB.y*x);R.normalImpulse=X;T.normalImpulse=Z;break}X=0;Z=0;U=W;O=K;if(U>=0&&O>=0){_=X-k;p=Z-z;y=_*G;u=_*J;x=p*G;f=p*J;A.x-=S*(y+x);A.y-=S*(u+f);B-=M*(R.rA.x*u-R.rA.y*y+T.rA.x*f-T.rA.y*x);w.x+=V*(y+x);w.y+=V*(u+f);g+=I*(R.rB.x*u-R.rB.y*y+T.rB.x*f-T.rB.y*x);R.normalImpulse=X;T.normalImpulse=Z;break}break}}v.m_angularVelocity=B;D.m_angularVelocity=g}};_.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t)for(var i=this.m_constraints[t],o=i.manifold,e=0;e<i.pointCount;++e){var n=o.m_points[e],s=i.points[e];n.m_normalImpulse=s.normalImpulse;n.m_tangentImpulse=s.tangentImpulse}};_.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);for(var i=0,o=0;o<this.m_constraintCount;o++){var e=this.m_constraints[o],n=e.bodyA,s=e.bodyB,r=n.m_mass*n.m_invMass,a=n.m_mass*n.m_invI,m=s.m_mass*s.m_invMass,l=s.m_mass*s.m_invI;_.s_psm.Initialize(e);for(var c=_.s_psm.m_normal,h=0;h<e.pointCount;h++){var p=e.points[h],y=_.s_psm.m_points[h],u=_.s_psm.m_separations[h],x=y.x-n.m_sweep.c.x,f=y.y-n.m_sweep.c.y,d=y.x-s.m_sweep.c.x,b=y.y-s.m_sweep.c.y;i=u>i?i:u;var v=C.Clamp(t*(u+D.b2_linearSlop),-D.b2_maxLinearCorrection,0),B=-p.equalizedMass*v,g=B*c.x,A=B*c.y;n.m_sweep.c.x-=r*g;n.m_sweep.c.y-=r*A;n.m_sweep.a-=a*(x*A-f*g);n.SynchronizeTransform();s.m_sweep.c.x+=m*g;s.m_sweep.c.y+=m*A;s.m_sweep.a+=l*(d*A-b*g);s.SynchronizeTransform()}}return i>-1.5*D.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new I;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new d});Box2D.inherit(p,Box2D.Dynamics.Contacts.b2Contact);p.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;p.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};p.Create=function(){return new p};p.Destroy=function(){};p.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i)};p.prototype.Evaluate=function(){var o=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,o.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,e.m_xf)};p.prototype.b2CollideEdgeAndCircle=function(){};Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact);y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;y.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};y.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};y.prototype.Evaluate=function(){};Box2D.inherit(u,Box2D.Dynamics.Contacts.b2Contact);u.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;u.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};u.Create=function(){return new u};u.Destroy=function(){};u.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i);D.b2Assert(t.GetType()==e.e_polygonShape);D.b2Assert(i.GetType()==e.e_circleShape)};u.prototype.Evaluate=function(){var i=this.m_fixtureA.m_body,e=this.m_fixtureB.m_body;A.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof o?this.m_fixtureA.GetShape():null,i.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,e.m_xf)};Box2D.inherit(x,Box2D.Dynamics.Contacts.b2Contact);x.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;x.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};x.Create=function(){return new x};x.Destroy=function(){};x.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i);D.b2Assert(t.GetType()==e.e_polygonShape);D.b2Assert(i.GetType()==e.e_edgeShape)};x.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof o?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,e.m_xf)};x.prototype.b2CollidePolyAndEdge=function(){};Box2D.inherit(f,Box2D.Dynamics.Contacts.b2Contact);f.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;f.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};f.Create=function(){return new f};f.Destroy=function(){};f.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i)};f.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();A.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof o?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof o?this.m_fixtureB.GetShape():null,i.m_xf)};d.b2PositionSolverManifold=function(){};d.prototype.b2PositionSolverManifold=function(){this.m_normal=new g;this.m_separations=new Vector_a2j_Number(D.b2_maxManifoldPoints);this.m_points=new Vector(D.b2_maxManifoldPoints);for(var t=0;t<D.b2_maxManifoldPoints;t++)this.m_points[t]=new g};d.prototype.Initialize=function(t){D.b2Assert(t.pointCount>0);var i,o,e=0,n=0,s=0,r=0,a=0;switch(t.type){case S.e_circles:i=t.bodyA.m_xf.R;o=t.localPoint;var m=t.bodyA.m_xf.position.x+(i.col1.x*o.x+i.col2.x*o.y),l=t.bodyA.m_xf.position.y+(i.col1.y*o.x+i.col2.y*o.y);i=t.bodyB.m_xf.R;o=t.points[0].localPoint;var c=t.bodyB.m_xf.position.x+(i.col1.x*o.x+i.col2.x*o.y),h=t.bodyB.m_xf.position.y+(i.col1.y*o.x+i.col2.y*o.y),_=c-m,p=h-l,y=_*_+p*p;if(y>Box2D.MIN_VALUE*Box2D.MIN_VALUE){var u=Math.sqrt(y);this.m_normal.x=_/u;this.m_normal.y=p/u}else{this.m_normal.x=1;this.m_normal.y=0}this.m_points[0].x=.5*(m+c);this.m_points[0].y=.5*(l+h);this.m_separations[0]=_*this.m_normal.x+p*this.m_normal.y-t.radius;break;case S.e_faceA:i=t.bodyA.m_xf.R;o=t.localPlaneNormal;this.m_normal.x=i.col1.x*o.x+i.col2.x*o.y;this.m_normal.y=i.col1.y*o.x+i.col2.y*o.y;i=t.bodyA.m_xf.R;o=t.localPoint;r=t.bodyA.m_xf.position.x+(i.col1.x*o.x+i.col2.x*o.y);a=t.bodyA.m_xf.position.y+(i.col1.y*o.x+i.col2.y*o.y);i=t.bodyB.m_xf.R;for(e=0;e<t.pointCount;++e){o=t.points[e].localPoint;n=t.bodyB.m_xf.position.x+(i.col1.x*o.x+i.col2.x*o.y);s=t.bodyB.m_xf.position.y+(i.col1.y*o.x+i.col2.y*o.y);this.m_separations[e]=(n-r)*this.m_normal.x+(s-a)*this.m_normal.y-t.radius;this.m_points[e].x=n;this.m_points[e].y=s}break;case S.e_faceB:i=t.bodyB.m_xf.R;o=t.localPlaneNormal;this.m_normal.x=i.col1.x*o.x+i.col2.x*o.y;this.m_normal.y=i.col1.y*o.x+i.col2.y*o.y;i=t.bodyB.m_xf.R;o=t.localPoint;r=t.bodyB.m_xf.position.x+(i.col1.x*o.x+i.col2.x*o.y);a=t.bodyB.m_xf.position.y+(i.col1.y*o.x+i.col2.y*o.y);i=t.bodyA.m_xf.R;for(e=0;e<t.pointCount;++e){o=t.points[e].localPoint;n=t.bodyA.m_xf.position.x+(i.col1.x*o.x+i.col2.x*o.y);s=t.bodyA.m_xf.position.y+(i.col1.y*o.x+i.col2.y*o.y);this.m_separations[e]=(n-r)*this.m_normal.x+(s-a)*this.m_normal.y-t.radius;this.m_points[e].Set(n,s)}this.m_normal.x*=-1;this.m_normal.y*=-1}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new g;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new g})}();!function(){var t=(Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.Common.Math.b2Mat22),i=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),o=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),e=(Box2D.Common.Math.b2Vec3,Box2D.Common.b2Color),n=(Box2D.Common.b2internal,Box2D.Common.b2Settings,Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape,Box2D.Dynamics.Controllers.b2BuoyancyController),s=Box2D.Dynamics.Controllers.b2ConstantAccelController,r=Box2D.Dynamics.Controllers.b2ConstantForceController,a=Box2D.Dynamics.Controllers.b2Controller,m=Box2D.Dynamics.Controllers.b2ControllerEdge,l=Box2D.Dynamics.Controllers.b2GravityController,c=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(n,Box2D.Dynamics.Controllers.b2Controller);n.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;n.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new o(0,-1);this.offset=0;this.density=0;this.velocity=new o(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=null};n.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var t=this.m_bodyList;t;t=t.nextBody){var i=t.body;if(0!=i.IsAwake()){for(var e=new o,n=new o,s=0,r=0,a=i.GetFixtureList();a;a=a.GetNext()){var m=new o,l=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),m);s+=l;e.x+=l*m.x;e.y+=l*m.y;var c=0;c=(this.useDensity,1);r+=l*c;n.x+=l*m.x*c;n.y+=l*m.y*c}e.x/=s;e.y/=s;n.x/=r;n.y/=r;if(!(s<Box2D.MIN_VALUE)){var h=this.gravity.GetNegative();h.Multiply(this.density*s);i.ApplyForce(h,n);var _=i.GetLinearVelocityFromWorldPoint(e);_.Subtract(this.velocity);_.Multiply(-this.linearDrag*s);i.ApplyForce(_,e);i.ApplyTorque(-i.GetInertia()/i.GetMass()*s*i.GetAngularVelocity()*this.angularDrag)}}}}};n.prototype.Draw=function(t){var i=1e3,n=new o,s=new o;n.x=this.normal.x*this.offset+this.normal.y*i;n.y=this.normal.y*this.offset-this.normal.x*i;s.x=this.normal.x*this.offset-this.normal.y*i;s.y=this.normal.y*this.offset+this.normal.x*i;var r=new e(0,0,1);t.DrawSegment(n,s,r)};Box2D.inherit(s,Box2D.Dynamics.Controllers.b2Controller);s.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;s.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new o(0,0)};s.prototype.Step=function(t){for(var i=new o(this.A.x*t.dt,this.A.y*t.dt),e=this.m_bodyList;e;e=e.nextBody){var n=e.body;n.IsAwake()&&n.SetLinearVelocity(new o(n.GetLinearVelocity().x+i.x,n.GetLinearVelocity().y+i.y))}};Box2D.inherit(r,Box2D.Dynamics.Controllers.b2Controller);r.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;r.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new o(0,0)};r.prototype.Step=function(){for(var t=this.m_bodyList;t;t=t.nextBody){var i=t.body;i.IsAwake()&&i.ApplyForce(this.F,i.GetWorldCenter())}};a.b2Controller=function(){};a.prototype.Step=function(){};a.prototype.Draw=function(){};a.prototype.AddBody=function(t){var i=new m;i.controller=this;i.body=t;i.nextBody=this.m_bodyList;i.prevBody=null;this.m_bodyList=i;i.nextBody&&(i.nextBody.prevBody=i);this.m_bodyCount++;i.nextController=t.m_controllerList;i.prevController=null;t.m_controllerList=i;i.nextController&&(i.nextController.prevController=i);t.m_controllerCount++};a.prototype.RemoveBody=function(t){for(var i=t.m_controllerList;i&&i.controller!=this;)i=i.nextController;i.prevBody&&(i.prevBody.nextBody=i.nextBody);i.nextBody&&(i.nextBody.prevBody=i.prevBody);i.nextController&&(i.nextController.prevController=i.prevController);i.prevController&&(i.prevController.nextController=i.nextController);this.m_bodyList==i&&(this.m_bodyList=i.nextBody);t.m_controllerList==i&&(t.m_controllerList=i.nextController);t.m_controllerCount--;this.m_bodyCount--};a.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetWorld=function(){return this.m_world};a.prototype.GetBodyList=function(){return this.m_bodyList};m.b2ControllerEdge=function(){};Box2D.inherit(l,Box2D.Dynamics.Controllers.b2Controller);l.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;l.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=!0};l.prototype.Step=function(){var t=null,i=null,e=null,n=0,s=null,r=null,a=null,m=0,l=0,c=0,h=null;if(this.invSqr)for(t=this.m_bodyList;t;t=t.nextBody){i=t.body;e=i.GetWorldCenter();n=i.GetMass();for(s=this.m_bodyList;s!=t;s=s.nextBody){r=s.body;a=r.GetWorldCenter();m=a.x-e.x;l=a.y-e.y;c=m*m+l*l;if(!(c<Box2D.MIN_VALUE)){h=new o(m,l);h.Multiply(this.G/c/Math.sqrt(c)*n*r.GetMass());i.IsAwake()&&i.ApplyForce(h,e);h.Multiply(-1);r.IsAwake()&&r.ApplyForce(h,a)}}}else for(t=this.m_bodyList;t;t=t.nextBody){i=t.body;e=i.GetWorldCenter();n=i.GetMass();for(s=this.m_bodyList;s!=t;s=s.nextBody){r=s.body;a=r.GetWorldCenter();m=a.x-e.x;l=a.y-e.y;c=m*m+l*l;if(!(c<Box2D.MIN_VALUE)){h=new o(m,l);h.Multiply(this.G/c*n*r.GetMass());i.IsAwake()&&i.ApplyForce(h,e);h.Multiply(-1);r.IsAwake()&&r.ApplyForce(h,a)}}}};Box2D.inherit(c,Box2D.Dynamics.Controllers.b2Controller);c.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;c.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new t;this.maxTimestep=0};c.prototype.SetAxisAligned=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);this.T.col1.x=-t;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-i;this.maxTimestep=t>0||i>0?1/Math.max(t,i):0};c.prototype.Step=function(t){var e=t.dt;if(!(e<=Box2D.MIN_VALUE)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);
for(var n=this.m_bodyList;n;n=n.nextBody){var s=n.body;if(s.IsAwake()){var r=s.GetWorldVector(i.MulMV(this.T,s.GetLocalVector(s.GetLinearVelocity())));s.SetLinearVelocity(new o(s.GetLinearVelocity().x+r.x*e,s.GetLinearVelocity().y+r.y*e))}}}}}();!function(){{var t=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),i=Box2D.Common.Math.b2Mat22,o=Box2D.Common.Math.b2Mat33,e=Box2D.Common.Math.b2Math,n=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),s=Box2D.Common.Math.b2Vec3,r=Box2D.Dynamics.Joints.b2DistanceJoint,a=Box2D.Dynamics.Joints.b2DistanceJointDef,m=Box2D.Dynamics.Joints.b2RopeJoint,l=Box2D.Dynamics.Joints.b2RopeJointDef,c=Box2D.Dynamics.Joints.b2FrictionJoint,h=Box2D.Dynamics.Joints.b2FrictionJointDef,_=Box2D.Dynamics.Joints.b2GearJoint,p=Box2D.Dynamics.Joints.b2GearJointDef,y=Box2D.Dynamics.Joints.b2Jacobian,u=Box2D.Dynamics.Joints.b2Joint,x=Box2D.Dynamics.Joints.b2JointDef,f=Box2D.Dynamics.Joints.b2JointEdge,d=Box2D.Dynamics.Joints.b2LineJoint,b=Box2D.Dynamics.Joints.b2LineJointDef,v=Box2D.Dynamics.Joints.b2MouseJoint,D=Box2D.Dynamics.Joints.b2MouseJointDef,B=Box2D.Dynamics.Joints.b2PrismaticJoint,C=Box2D.Dynamics.Joints.b2PrismaticJointDef,g=Box2D.Dynamics.Joints.b2PulleyJoint,A=Box2D.Dynamics.Joints.b2PulleyJointDef,w=Box2D.Dynamics.Joints.b2RevoluteJoint,S=Box2D.Dynamics.Joints.b2RevoluteJointDef,M=Box2D.Dynamics.Joints.b2WeldJoint,V=Box2D.Dynamics.Joints.b2WeldJointDef;Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World}Box2D.inherit(m,Box2D.Dynamics.Joints.b2Joint);m.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;m.b2RopeJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_u=new n};m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};m.prototype.GetReactionForce=function(t){void 0===t&&(t=0);return new n(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)};m.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);return 0};m.prototype.GetLength=function(){return this.m_length};m.prototype.SetLength=function(t){void 0===t&&(t=0);this.m_length=t};m.prototype.GetFrequency=function(){return this.m_frequencyHz};m.prototype.SetFrequency=function(t){void 0===t&&(t=0);this.m_frequencyHz=t};m.prototype.GetDampingRatio=function(){return this.m_dampingRatio};m.prototype.SetDampingRatio=function(t){void 0===t&&(t=0);this.m_dampingRatio=t};m.prototype.b2RopeJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_impulse=0;this.m_gamma=0;this.m_bias=0;this.m_length=t.length;this.m_maxLength=t.maxLength;this.m_limitState=u.e_inactiveLimit};m.prototype.InitVelocityConstraints=function(i){var o,e=0,n=this.m_bodyA,s=this.m_bodyB;o=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y;e=o.col1.x*r+o.col2.x*a;a=o.col1.y*r+o.col2.y*a;r=e;o=s.m_xf.R;var m=this.m_localAnchor2.x-s.m_sweep.localCenter.x,l=this.m_localAnchor2.y-s.m_sweep.localCenter.y;e=o.col1.x*m+o.col2.x*l;l=o.col1.y*m+o.col2.y*l;m=e;this.m_u.x=s.m_sweep.c.x+m-n.m_sweep.c.x-r;this.m_u.y=s.m_sweep.c.y+l-n.m_sweep.c.y-a;var c=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);this.m_length=c;var h=this.m_length-this.m_maxLength;this.m_limitState=h>0?u.e_atUpperLimit:u.e_inactiveLimit;if(c>t.b2_linearSlop){this.m_u.Multiply(1/c);var _=r*this.m_u.y-a*this.m_u.x,p=m*this.m_u.y-l*this.m_u.x,y=n.m_invMass+n.m_invI*_*_+s.m_invMass+s.m_invI*p*p;this.m_mass=0!=y?1/y:0;if(i.warmStarting){this.m_impulse*=i.dtRatio;var x=this.m_impulse*this.m_u.x,f=this.m_impulse*this.m_u.y;n.m_linearVelocity.x-=n.m_invMass*x;n.m_linearVelocity.y-=n.m_invMass*f;n.m_angularVelocity-=n.m_invI*(r*f-a*x);s.m_linearVelocity.x+=s.m_invMass*x;s.m_linearVelocity.y+=s.m_invMass*f;s.m_angularVelocity+=s.m_invI*(m*f-l*x)}else this.m_impulse=0}else{this.m_u.SetZero();this.m_mass=0;this.m_impulse=0}};m.prototype.SolveVelocityConstraints=function(t){var i,o=0,e=this.m_bodyA,n=this.m_bodyB;i=e.m_xf.R;var s=this.m_localAnchor1.x-e.m_sweep.localCenter.x,r=this.m_localAnchor1.y-e.m_sweep.localCenter.y,a=i.col1.x*s+i.col2.x*r;r=i.col1.y*s+i.col2.y*r;s=a;i=n.m_xf.R;var m=this.m_localAnchor2.x-n.m_sweep.localCenter.x,l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=i.col1.x*m+i.col2.x*l;l=i.col1.y*m+i.col2.y*l;m=a;var c=e.m_linearVelocity.x+-e.m_angularVelocity*r,h=e.m_linearVelocity.y+e.m_angularVelocity*s,_=n.m_linearVelocity.x+-n.m_angularVelocity*l,p=n.m_linearVelocity.y+n.m_angularVelocity*m,y=this.m_length-this.m_maxLength,u=this.m_u.x*(_-c)+this.m_u.y*(p-h);0>y&&(u+=t.inv_dt*y);var x=-this.m_mass*(u+this.m_bias+this.m_gamma*this.m_impulse);o=this.m_impulse;this.m_impulse=Math.min(0,this.m_impulse+x);x=this.m_impulse-o;var f=x*this.m_u.x,d=x*this.m_u.y;e.m_linearVelocity.x-=e.m_invMass*f;e.m_linearVelocity.y-=e.m_invMass*d;e.m_angularVelocity-=e.m_invI*(s*d-r*f);n.m_linearVelocity.x+=n.m_invMass*f;n.m_linearVelocity.y+=n.m_invMass*d;n.m_angularVelocity+=n.m_invI*(m*d-l*f)};m.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var o;if(this.m_frequencyHz>0)return!0;var n=this.m_bodyA,s=this.m_bodyB;o=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y,m=o.col1.x*r+o.col2.x*a;a=o.col1.y*r+o.col2.y*a;r=m;o=s.m_xf.R;var l=this.m_localAnchor2.x-s.m_sweep.localCenter.x,c=this.m_localAnchor2.y-s.m_sweep.localCenter.y;m=o.col1.x*l+o.col2.x*c;c=o.col1.y*l+o.col2.y*c;l=m;var h=s.m_sweep.c.x+l-n.m_sweep.c.x-r,_=s.m_sweep.c.y+c-n.m_sweep.c.y-a,p=Math.sqrt(h*h+_*_);h/=p;_/=p;var y=p-this.m_maxLength;y=e.Clamp(y,0,t.b2_maxLinearCorrection);var u=-this.m_mass*y;this.m_u.Set(h,_);var x=u*this.m_u.x,f=u*this.m_u.y;n.m_sweep.c.x-=n.m_invMass*x;n.m_sweep.c.y-=n.m_invMass*f;n.m_sweep.a-=n.m_invI*(r*f-a*x);s.m_sweep.c.x+=s.m_invMass*x;s.m_sweep.c.y+=s.m_invMass*f;s.m_sweep.a+=s.m_invI*(l*f-c*x);n.SynchronizeTransform();s.SynchronizeTransform();return p-this.m_maxLength<t.b2_linearSlop};Box2D.inherit(l,Box2D.Dynamics.Joints.b2JointDef);l.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;l.b2RopeJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n};l.prototype.b2RopeJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_ropeJoint;this.length=1;this.frequencyHz=0;this.dampingRatio=0};l.prototype.Initialize=function(t,i,o,e){this.bodyA=t;this.bodyB=i;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(e));var n=e.x-o.x,s=e.y-o.y;this.length=Math.sqrt(n*n+s*s);this.frequencyHz=0;this.dampingRatio=0};Box2D.inherit(r,Box2D.Dynamics.Joints.b2Joint);r.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;r.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_u=new n};r.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};r.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};r.prototype.GetReactionForce=function(t){void 0===t&&(t=0);return new n(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)};r.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);return 0};r.prototype.GetLength=function(){return this.m_length};r.prototype.SetLength=function(t){void 0===t&&(t=0);this.m_length=t};r.prototype.GetFrequency=function(){return this.m_frequencyHz};r.prototype.SetFrequency=function(t){void 0===t&&(t=0);this.m_frequencyHz=t};r.prototype.GetDampingRatio=function(){return this.m_dampingRatio};r.prototype.SetDampingRatio=function(t){void 0===t&&(t=0);this.m_dampingRatio=t};r.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_length=t.length;this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_impulse=0;this.m_gamma=0;this.m_bias=0};r.prototype.InitVelocityConstraints=function(i){var o,e=0,n=this.m_bodyA,s=this.m_bodyB;o=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y;e=o.col1.x*r+o.col2.x*a;a=o.col1.y*r+o.col2.y*a;r=e;o=s.m_xf.R;var m=this.m_localAnchor2.x-s.m_sweep.localCenter.x,l=this.m_localAnchor2.y-s.m_sweep.localCenter.y;e=o.col1.x*m+o.col2.x*l;l=o.col1.y*m+o.col2.y*l;m=e;this.m_u.x=s.m_sweep.c.x+m-n.m_sweep.c.x-r;this.m_u.y=s.m_sweep.c.y+l-n.m_sweep.c.y-a;var c=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);c>t.b2_linearSlop?this.m_u.Multiply(1/c):this.m_u.SetZero();var h=r*this.m_u.y-a*this.m_u.x,_=m*this.m_u.y-l*this.m_u.x,p=n.m_invMass+n.m_invI*h*h+s.m_invMass+s.m_invI*_*_;this.m_mass=0!=p?1/p:0;if(this.m_frequencyHz>0){var y=c-this.m_length,u=2*Math.PI*this.m_frequencyHz,x=2*this.m_mass*this.m_dampingRatio*u,f=this.m_mass*u*u;this.m_gamma=i.dt*(x+i.dt*f);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_bias=y*i.dt*f*this.m_gamma;this.m_mass=p+this.m_gamma;this.m_mass=0!=this.m_mass?1/this.m_mass:0}if(i.warmStarting){this.m_impulse*=i.dtRatio;var d=this.m_impulse*this.m_u.x,b=this.m_impulse*this.m_u.y;n.m_linearVelocity.x-=n.m_invMass*d;n.m_linearVelocity.y-=n.m_invMass*b;n.m_angularVelocity-=n.m_invI*(r*b-a*d);s.m_linearVelocity.x+=s.m_invMass*d;s.m_linearVelocity.y+=s.m_invMass*b;s.m_angularVelocity+=s.m_invI*(m*b-l*d)}else this.m_impulse=0};r.prototype.SolveVelocityConstraints=function(){var t,i=this.m_bodyA,o=this.m_bodyB;t=i.m_xf.R;var e=this.m_localAnchor1.x-i.m_sweep.localCenter.x,n=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=t.col1.x*e+t.col2.x*n;n=t.col1.y*e+t.col2.y*n;e=s;t=o.m_xf.R;var r=this.m_localAnchor2.x-o.m_sweep.localCenter.x,a=this.m_localAnchor2.y-o.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a;a=t.col1.y*r+t.col2.y*a;r=s;var m=i.m_linearVelocity.x+-i.m_angularVelocity*n,l=i.m_linearVelocity.y+i.m_angularVelocity*e,c=o.m_linearVelocity.x+-o.m_angularVelocity*a,h=o.m_linearVelocity.y+o.m_angularVelocity*r,_=this.m_u.x*(c-m)+this.m_u.y*(h-l),p=-this.m_mass*(_+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=p;var y=p*this.m_u.x,u=p*this.m_u.y;i.m_linearVelocity.x-=i.m_invMass*y;i.m_linearVelocity.y-=i.m_invMass*u;i.m_angularVelocity-=i.m_invI*(e*u-n*y);o.m_linearVelocity.x+=o.m_invMass*y;o.m_linearVelocity.y+=o.m_invMass*u;o.m_angularVelocity+=o.m_invI*(r*u-a*y)};r.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var o;if(this.m_frequencyHz>0)return!0;var n=this.m_bodyA,s=this.m_bodyB;o=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y,m=o.col1.x*r+o.col2.x*a;a=o.col1.y*r+o.col2.y*a;r=m;o=s.m_xf.R;var l=this.m_localAnchor2.x-s.m_sweep.localCenter.x,c=this.m_localAnchor2.y-s.m_sweep.localCenter.y;m=o.col1.x*l+o.col2.x*c;c=o.col1.y*l+o.col2.y*c;l=m;var h=s.m_sweep.c.x+l-n.m_sweep.c.x-r,_=s.m_sweep.c.y+c-n.m_sweep.c.y-a,p=Math.sqrt(h*h+_*_);h/=p;_/=p;var y=p-this.m_length;y=e.Clamp(y,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);var u=-this.m_mass*y;this.m_u.Set(h,_);var x=u*this.m_u.x,f=u*this.m_u.y;n.m_sweep.c.x-=n.m_invMass*x;n.m_sweep.c.y-=n.m_invMass*f;n.m_sweep.a-=n.m_invI*(r*f-a*x);s.m_sweep.c.x+=s.m_invMass*x;s.m_sweep.c.y+=s.m_invMass*f;s.m_sweep.a+=s.m_invI*(l*f-c*x);n.SynchronizeTransform();s.SynchronizeTransform();return e.Abs(y)<t.b2_linearSlop};Box2D.inherit(a,Box2D.Dynamics.Joints.b2JointDef);a.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;a.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n};a.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_distanceJoint;this.length=1;this.frequencyHz=0;this.dampingRatio=0};a.prototype.Initialize=function(t,i,o,e){this.bodyA=t;this.bodyB=i;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(e));var n=e.x-o.x,s=e.y-o.y;this.length=Math.sqrt(n*n+s*s);this.frequencyHz=0;this.dampingRatio=0};Box2D.inherit(c,Box2D.Dynamics.Joints.b2Joint);c.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;c.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_linearMass=new i;this.m_linearImpulse=new n};c.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};c.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};c.prototype.GetReactionForce=function(t){void 0===t&&(t=0);return new n(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)};c.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);return t*this.m_angularImpulse};c.prototype.SetMaxForce=function(t){void 0===t&&(t=0);this.m_maxForce=t};c.prototype.GetMaxForce=function(){return this.m_maxForce};c.prototype.SetMaxTorque=function(t){void 0===t&&(t=0);this.m_maxTorque=t};c.prototype.GetMaxTorque=function(){return this.m_maxTorque};c.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchorA.SetV(t.localAnchorA);this.m_localAnchorB.SetV(t.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=t.maxForce;this.m_maxTorque=t.maxTorque};c.prototype.InitVelocityConstraints=function(t){var o,e=0,n=this.m_bodyA,s=this.m_bodyB;o=n.m_xf.R;var r=this.m_localAnchorA.x-n.m_sweep.localCenter.x,a=this.m_localAnchorA.y-n.m_sweep.localCenter.y;e=o.col1.x*r+o.col2.x*a;a=o.col1.y*r+o.col2.y*a;r=e;o=s.m_xf.R;var m=this.m_localAnchorB.x-s.m_sweep.localCenter.x,l=this.m_localAnchorB.y-s.m_sweep.localCenter.y;e=o.col1.x*m+o.col2.x*l;l=o.col1.y*m+o.col2.y*l;m=e;var c=n.m_invMass,h=s.m_invMass,_=n.m_invI,p=s.m_invI,y=new i;y.col1.x=c+h;y.col2.x=0;y.col1.y=0;y.col2.y=c+h;y.col1.x+=_*a*a;y.col2.x+=-_*r*a;y.col1.y+=-_*r*a;y.col2.y+=_*r*r;y.col1.x+=p*l*l;y.col2.x+=-p*m*l;y.col1.y+=-p*m*l;y.col2.y+=p*m*m;y.GetInverse(this.m_linearMass);this.m_angularMass=_+p;this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass);if(t.warmStarting){this.m_linearImpulse.x*=t.dtRatio;this.m_linearImpulse.y*=t.dtRatio;this.m_angularImpulse*=t.dtRatio;var u=this.m_linearImpulse;n.m_linearVelocity.x-=c*u.x;n.m_linearVelocity.y-=c*u.y;n.m_angularVelocity-=_*(r*u.y-a*u.x+this.m_angularImpulse);s.m_linearVelocity.x+=h*u.x;s.m_linearVelocity.y+=h*u.y;s.m_angularVelocity+=p*(m*u.y-l*u.x+this.m_angularImpulse)}else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}};c.prototype.SolveVelocityConstraints=function(t){var i,o=0,s=this.m_bodyA,r=this.m_bodyB,a=s.m_linearVelocity,m=s.m_angularVelocity,l=r.m_linearVelocity,c=r.m_angularVelocity,h=s.m_invMass,_=r.m_invMass,p=s.m_invI,y=r.m_invI;i=s.m_xf.R;var u=this.m_localAnchorA.x-s.m_sweep.localCenter.x,x=this.m_localAnchorA.y-s.m_sweep.localCenter.y;o=i.col1.x*u+i.col2.x*x;x=i.col1.y*u+i.col2.y*x;u=o;i=r.m_xf.R;var f=this.m_localAnchorB.x-r.m_sweep.localCenter.x,d=this.m_localAnchorB.y-r.m_sweep.localCenter.y;o=i.col1.x*f+i.col2.x*d;d=i.col1.y*f+i.col2.y*d;f=o;var b=0,v=c-m,D=-this.m_angularMass*v,B=this.m_angularImpulse;b=t.dt*this.m_maxTorque;this.m_angularImpulse=e.Clamp(this.m_angularImpulse+D,-b,b);D=this.m_angularImpulse-B;m-=p*D;c+=y*D;var C=l.x-c*d-a.x+m*x,g=l.y+c*f-a.y-m*u,A=e.MulMV(this.m_linearMass,new n(-C,-g)),w=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(A);b=t.dt*this.m_maxForce;if(this.m_linearImpulse.LengthSquared()>b*b){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(b)}A=e.SubtractVV(this.m_linearImpulse,w);a.x-=h*A.x;a.y-=h*A.y;m-=p*(u*A.y-x*A.x);l.x+=_*A.x;l.y+=_*A.y;c+=y*(f*A.y-d*A.x);s.m_angularVelocity=m;r.m_angularVelocity=c};c.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);return!0};Box2D.inherit(h,Box2D.Dynamics.Joints.b2JointDef);h.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;h.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n};h.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_frictionJoint;this.maxForce=0;this.maxTorque=0};h.prototype.Initialize=function(t,i,o){this.bodyA=t;this.bodyB=i;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o))};Box2D.inherit(_,Box2D.Dynamics.Joints.b2Joint);_.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;_.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new n;this.m_groundAnchor2=new n;this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_J=new y};_.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};_.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};_.prototype.GetReactionForce=function(t){void 0===t&&(t=0);return new n(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)};_.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);var i=this.m_bodyB.m_xf.R,o=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,e=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,n=i.col1.x*o+i.col2.x*e;e=i.col1.y*o+i.col2.y*e;o=n;var s=this.m_impulse*this.m_J.linearB.x,r=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-o*r+e*s)};_.prototype.GetRatio=function(){return this.m_ratio};_.prototype.SetRatio=function(t){void 0===t&&(t=0);this.m_ratio=t};_.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var i=parseInt(t.joint1.m_type),o=parseInt(t.joint2.m_type);this.m_revolute1=null;this.m_prismatic1=null;this.m_revolute2=null;this.m_prismatic2=null;var e=0,n=0;this.m_ground1=t.joint1.GetBodyA();this.m_bodyA=t.joint1.GetBodyB();if(i==u.e_revoluteJoint){this.m_revolute1=t.joint1 instanceof w?t.joint1:null;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);e=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=t.joint1 instanceof B?t.joint1:null;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);e=this.m_prismatic1.GetJointTranslation()}this.m_ground2=t.joint2.GetBodyA();this.m_bodyB=t.joint2.GetBodyB();if(o==u.e_revoluteJoint){this.m_revolute2=t.joint2 instanceof w?t.joint2:null;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);n=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=t.joint2 instanceof B?t.joint2:null;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);n=this.m_prismatic2.GetJointTranslation()}this.m_ratio=t.ratio;this.m_constant=e+this.m_ratio*n;this.m_impulse=0};_.prototype.InitVelocityConstraints=function(t){var i,o,e=this.m_ground1,n=this.m_ground2,s=this.m_bodyA,r=this.m_bodyB,a=0,m=0,l=0,c=0,h=0,_=0,p=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=-1;p+=s.m_invI}else{i=e.m_xf.R;o=this.m_prismatic1.m_localXAxis1;a=i.col1.x*o.x+i.col2.x*o.y;m=i.col1.y*o.x+i.col2.y*o.y;i=s.m_xf.R;l=this.m_localAnchor1.x-s.m_sweep.localCenter.x;c=this.m_localAnchor1.y-s.m_sweep.localCenter.y;_=i.col1.x*l+i.col2.x*c;c=i.col1.y*l+i.col2.y*c;l=_;h=l*m-c*a;this.m_J.linearA.Set(-a,-m);this.m_J.angularA=-h;p+=s.m_invMass+s.m_invI*h*h}if(this.m_revolute2){this.m_J.angularB=-this.m_ratio;p+=this.m_ratio*this.m_ratio*r.m_invI}else{i=n.m_xf.R;o=this.m_prismatic2.m_localXAxis1;a=i.col1.x*o.x+i.col2.x*o.y;m=i.col1.y*o.x+i.col2.y*o.y;i=r.m_xf.R;l=this.m_localAnchor2.x-r.m_sweep.localCenter.x;c=this.m_localAnchor2.y-r.m_sweep.localCenter.y;_=i.col1.x*l+i.col2.x*c;c=i.col1.y*l+i.col2.y*c;l=_;h=l*m-c*a;this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*m);this.m_J.angularB=-this.m_ratio*h;p+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*h*h)}this.m_mass=p>0?1/p:0;if(t.warmStarting){s.m_linearVelocity.x+=s.m_invMass*this.m_impulse*this.m_J.linearA.x;s.m_linearVelocity.y+=s.m_invMass*this.m_impulse*this.m_J.linearA.y;s.m_angularVelocity+=s.m_invI*this.m_impulse*this.m_J.angularA;r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x;r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y;r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB}else this.m_impulse=0};_.prototype.SolveVelocityConstraints=function(){var t=this.m_bodyA,i=this.m_bodyB,o=this.m_J.Compute(t.m_linearVelocity,t.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity),e=-this.m_mass*o;this.m_impulse+=e;t.m_linearVelocity.x+=t.m_invMass*e*this.m_J.linearA.x;t.m_linearVelocity.y+=t.m_invMass*e*this.m_J.linearA.y;t.m_angularVelocity+=t.m_invI*e*this.m_J.angularA;i.m_linearVelocity.x+=i.m_invMass*e*this.m_J.linearB.x;i.m_linearVelocity.y+=i.m_invMass*e*this.m_J.linearB.y;i.m_angularVelocity+=i.m_invI*e*this.m_J.angularB};_.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var o=0,e=this.m_bodyA,n=this.m_bodyB,s=0,r=0;s=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation();r=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var a=this.m_constant-(s+this.m_ratio*r),m=-this.m_mass*a;e.m_sweep.c.x+=e.m_invMass*m*this.m_J.linearA.x;e.m_sweep.c.y+=e.m_invMass*m*this.m_J.linearA.y;e.m_sweep.a+=e.m_invI*m*this.m_J.angularA;n.m_sweep.c.x+=n.m_invMass*m*this.m_J.linearB.x;n.m_sweep.c.y+=n.m_invMass*m*this.m_J.linearB.y;n.m_sweep.a+=n.m_invI*m*this.m_J.angularB;e.SynchronizeTransform();n.SynchronizeTransform();return o<t.b2_linearSlop};Box2D.inherit(p,Box2D.Dynamics.Joints.b2JointDef);p.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;p.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};p.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_gearJoint;this.joint1=null;this.joint2=null;this.ratio=1};y.b2Jacobian=function(){this.linearA=new n;this.linearB=new n};y.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};y.prototype.Set=function(t,i,o,e){void 0===i&&(i=0);void 0===e&&(e=0);this.linearA.SetV(t);this.angularA=i;this.linearB.SetV(o);this.angularB=e};y.prototype.Compute=function(t,i,o,e){void 0===i&&(i=0);void 0===e&&(e=0);return this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*i+(this.linearB.x*o.x+this.linearB.y*o.y)+this.angularB*e};u.b2Joint=function(){this.m_edgeA=new f;this.m_edgeB=new f;this.m_localCenterA=new n;this.m_localCenterB=new n};u.prototype.GetType=function(){return this.m_type};u.prototype.GetAnchorA=function(){return null};u.prototype.GetAnchorB=function(){return null};u.prototype.GetReactionForce=function(t){void 0===t&&(t=0);return null};u.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);return 0};u.prototype.GetBodyA=function(){return this.m_bodyA};u.prototype.GetBodyB=function(){return this.m_bodyB};u.prototype.GetNext=function(){return this.m_next};u.prototype.GetUserData=function(){return this.m_userData};u.prototype.SetUserData=function(t){this.m_userData=t};u.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};u.Create=function(t){var i=null;switch(t.type){case u.e_ropeJoint:i=new m(t instanceof l?t:null);break;case u.e_distanceJoint:i=new r(t instanceof a?t:null);break;case u.e_mouseJoint:i=new v(t instanceof D?t:null);break;case u.e_prismaticJoint:i=new B(t instanceof C?t:null);break;case u.e_revoluteJoint:i=new w(t instanceof S?t:null);break;case u.e_pulleyJoint:i=new g(t instanceof A?t:null);break;case u.e_gearJoint:i=new _(t instanceof p?t:null);break;case u.e_lineJoint:i=new d(t instanceof b?t:null);break;case u.e_weldJoint:i=new M(t instanceof V?t:null);break;case u.e_frictionJoint:i=new c(t instanceof h?t:null)}return i};u.Destroy=function(){};u.prototype.b2Joint=function(i){t.b2Assert(i.bodyA!=i.bodyB);this.m_type=i.type;this.m_prev=null;this.m_next=null;this.m_bodyA=i.bodyA;this.m_bodyB=i.bodyB;this.m_collideConnected=i.collideConnected;this.m_islandFlag=!1;this.m_userData=i.userData};u.prototype.InitVelocityConstraints=function(){};u.prototype.SolveVelocityConstraints=function(){};u.prototype.FinalizeVelocityConstraints=function(){};u.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);return!1};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_ropeJoint=10;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});x.b2JointDef=function(){};x.prototype.b2JointDef=function(){this.type=u.e_unknownJoint;this.userData=null;this.bodyA=null;this.bodyB=null;this.collideConnected=!1};f.b2JointEdge=function(){};Box2D.inherit(d,Box2D.Dynamics.Joints.b2Joint);d.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;d.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_localXAxis1=new n;this.m_localYAxis1=new n;this.m_axis=new n;this.m_perp=new n;this.m_K=new i;this.m_impulse=new n};d.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};d.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};d.prototype.GetReactionForce=function(t){void 0===t&&(t=0);return new n(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};d.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);return t*this.m_impulse.y};d.prototype.GetJointTranslation=function(){var t=this.m_bodyA,i=this.m_bodyB,o=t.GetWorldPoint(this.m_localAnchor1),e=i.GetWorldPoint(this.m_localAnchor2),n=e.x-o.x,s=e.y-o.y,r=t.GetWorldVector(this.m_localXAxis1),a=r.x*n+r.y*s;return a};d.prototype.GetJointSpeed=function(){var t,i=this.m_bodyA,o=this.m_bodyB;t=i.m_xf.R;var e=this.m_localAnchor1.x-i.m_sweep.localCenter.x,n=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=t.col1.x*e+t.col2.x*n;n=t.col1.y*e+t.col2.y*n;e=s;t=o.m_xf.R;var r=this.m_localAnchor2.x-o.m_sweep.localCenter.x,a=this.m_localAnchor2.y-o.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a;a=t.col1.y*r+t.col2.y*a;r=s;var m=i.m_sweep.c.x+e,l=i.m_sweep.c.y+n,c=o.m_sweep.c.x+r,h=o.m_sweep.c.y+a,_=c-m,p=h-l,y=i.GetWorldVector(this.m_localXAxis1),u=i.m_linearVelocity,x=o.m_linearVelocity,f=i.m_angularVelocity,d=o.m_angularVelocity,b=_*-f*y.y+p*f*y.x+(y.x*(x.x+-d*a-u.x- -f*n)+y.y*(x.y+d*r-u.y-f*e));return b};d.prototype.IsLimitEnabled=function(){return this.m_enableLimit};d.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=t};d.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};d.prototype.GetUpperLimit=function(){return this.m_upperTranslation};d.prototype.SetLimits=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=t;this.m_upperTranslation=i};d.prototype.IsMotorEnabled=function(){return this.m_enableMotor};d.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=t};d.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=t};d.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};d.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=t};d.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};d.prototype.GetMotorForce=function(){return this.m_motorImpulse};d.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=u.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};d.prototype.InitVelocityConstraints=function(i){var o,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_localCenterA.SetV(n.GetLocalCenter());this.m_localCenterB.SetV(s.GetLocalCenter());{var a=n.GetTransform();s.GetTransform()}o=n.m_xf.R;var m=this.m_localAnchor1.x-this.m_localCenterA.x,l=this.m_localAnchor1.y-this.m_localCenterA.y;r=o.col1.x*m+o.col2.x*l;l=o.col1.y*m+o.col2.y*l;m=r;o=s.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y;r=o.col1.x*c+o.col2.x*h;h=o.col1.y*c+o.col2.y*h;c=r;var _=s.m_sweep.c.x+c-n.m_sweep.c.x-m,p=s.m_sweep.c.y+h-n.m_sweep.c.y-l;this.m_invMassA=n.m_invMass;this.m_invMassB=s.m_invMass;this.m_invIA=n.m_invI;this.m_invIB=s.m_invI;this.m_axis.SetV(e.MulMV(a.R,this.m_localXAxis1));this.m_a1=(_+m)*this.m_axis.y-(p+l)*this.m_axis.x;this.m_a2=c*this.m_axis.y-h*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Box2D.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(e.MulMV(a.R,this.m_localYAxis1));this.m_s1=(_+m)*this.m_perp.y-(p+l)*this.m_perp.x;this.m_s2=c*this.m_perp.y-h*this.m_perp.x;var y=this.m_invMassA,x=this.m_invMassB,f=this.m_invIA,d=this.m_invIB;this.m_K.col1.x=y+x+f*this.m_s1*this.m_s1+d*this.m_s2*this.m_s2;this.m_K.col1.y=f*this.m_s1*this.m_a1+d*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=y+x+f*this.m_a1*this.m_a1+d*this.m_a2*this.m_a2;if(this.m_enableLimit){var b=this.m_axis.x*_+this.m_axis.y*p;if(e.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop)this.m_limitState=u.e_equalLimits;else if(b<=this.m_lowerTranslation){if(this.m_limitState!=u.e_atLowerLimit){this.m_limitState=u.e_atLowerLimit;this.m_impulse.y=0}}else if(b>=this.m_upperTranslation){if(this.m_limitState!=u.e_atUpperLimit){this.m_limitState=u.e_atUpperLimit;this.m_impulse.y=0}}else{this.m_limitState=u.e_inactiveLimit;this.m_impulse.y=0}}else this.m_limitState=u.e_inactiveLimit;0==this.m_enableMotor&&(this.m_motorImpulse=0);if(i.warmStarting){this.m_impulse.x*=i.dtRatio;this.m_impulse.y*=i.dtRatio;this.m_motorImpulse*=i.dtRatio;var v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,D=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,B=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,C=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;
n.m_linearVelocity.x-=this.m_invMassA*v;n.m_linearVelocity.y-=this.m_invMassA*D;n.m_angularVelocity-=this.m_invIA*B;s.m_linearVelocity.x+=this.m_invMassB*v;s.m_linearVelocity.y+=this.m_invMassB*D;s.m_angularVelocity+=this.m_invIB*C}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};d.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,s=i.m_linearVelocity,r=i.m_angularVelocity,a=o.m_linearVelocity,m=o.m_angularVelocity,l=0,c=0,h=0,_=0;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits){var p=this.m_axis.x*(a.x-s.x)+this.m_axis.y*(a.y-s.y)+this.m_a2*m-this.m_a1*r,y=this.m_motorMass*(this.m_motorSpeed-p),x=this.m_motorImpulse,f=t.dt*this.m_maxMotorForce;this.m_motorImpulse=e.Clamp(this.m_motorImpulse+y,-f,f);y=this.m_motorImpulse-x;l=y*this.m_axis.x;c=y*this.m_axis.y;h=y*this.m_a1;_=y*this.m_a2;s.x-=this.m_invMassA*l;s.y-=this.m_invMassA*c;r-=this.m_invIA*h;a.x+=this.m_invMassB*l;a.y+=this.m_invMassB*c;m+=this.m_invIB*_}var d=this.m_perp.x*(a.x-s.x)+this.m_perp.y*(a.y-s.y)+this.m_s2*m-this.m_s1*r;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var b=this.m_axis.x*(a.x-s.x)+this.m_axis.y*(a.y-s.y)+this.m_a2*m-this.m_a1*r,v=this.m_impulse.Copy(),D=this.m_K.Solve(new n,-d,-b);this.m_impulse.Add(D);this.m_limitState==u.e_atLowerLimit?this.m_impulse.y=e.Max(this.m_impulse.y,0):this.m_limitState==u.e_atUpperLimit&&(this.m_impulse.y=e.Min(this.m_impulse.y,0));var B=-d-(this.m_impulse.y-v.y)*this.m_K.col2.x,C=0;C=0!=this.m_K.col1.x?B/this.m_K.col1.x+v.x:v.x;this.m_impulse.x=C;D.x=this.m_impulse.x-v.x;D.y=this.m_impulse.y-v.y;l=D.x*this.m_perp.x+D.y*this.m_axis.x;c=D.x*this.m_perp.y+D.y*this.m_axis.y;h=D.x*this.m_s1+D.y*this.m_a1;_=D.x*this.m_s2+D.y*this.m_a2;s.x-=this.m_invMassA*l;s.y-=this.m_invMassA*c;r-=this.m_invIA*h;a.x+=this.m_invMassB*l;a.y+=this.m_invMassB*c;m+=this.m_invIB*_}else{var g=0;g=0!=this.m_K.col1.x?-d/this.m_K.col1.x:0;this.m_impulse.x+=g;l=g*this.m_perp.x;c=g*this.m_perp.y;h=g*this.m_s1;_=g*this.m_s2;s.x-=this.m_invMassA*l;s.y-=this.m_invMassA*c;r-=this.m_invIA*h;a.x+=this.m_invMassB*l;a.y+=this.m_invMassB*c;m+=this.m_invIB*_}i.m_linearVelocity.SetV(s);i.m_angularVelocity=r;o.m_linearVelocity.SetV(a);o.m_angularVelocity=m};d.prototype.SolvePositionConstraints=function(o){void 0===o&&(o=0);var s,r=this.m_bodyA,a=this.m_bodyB,m=r.m_sweep.c,l=r.m_sweep.a,c=a.m_sweep.c,h=a.m_sweep.a,_=0,p=0,y=0,u=0,x=0,f=0,d=0,b=!1,v=0,D=i.FromAngle(l),B=i.FromAngle(h);s=D;var C=this.m_localAnchor1.x-this.m_localCenterA.x,g=this.m_localAnchor1.y-this.m_localCenterA.y;_=s.col1.x*C+s.col2.x*g;g=s.col1.y*C+s.col2.y*g;C=_;s=B;var A=this.m_localAnchor2.x-this.m_localCenterB.x,w=this.m_localAnchor2.y-this.m_localCenterB.y;_=s.col1.x*A+s.col2.x*w;w=s.col1.y*A+s.col2.y*w;A=_;var S=c.x+A-m.x-C,M=c.y+w-m.y-g;if(this.m_enableLimit){this.m_axis=e.MulMV(D,this.m_localXAxis1);this.m_a1=(S+C)*this.m_axis.y-(M+g)*this.m_axis.x;this.m_a2=A*this.m_axis.y-w*this.m_axis.x;var V=this.m_axis.x*S+this.m_axis.y*M;if(e.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop){v=e.Clamp(V,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);f=e.Abs(V);b=!0}else if(V<=this.m_lowerTranslation){v=e.Clamp(V-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0);f=this.m_lowerTranslation-V;b=!0}else if(V>=this.m_upperTranslation){v=e.Clamp(V-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection);f=V-this.m_upperTranslation;b=!0}}this.m_perp=e.MulMV(D,this.m_localYAxis1);this.m_s1=(S+C)*this.m_perp.y-(M+g)*this.m_perp.x;this.m_s2=A*this.m_perp.y-w*this.m_perp.x;var I=new n,G=this.m_perp.x*S+this.m_perp.y*M;f=e.Max(f,e.Abs(G));d=0;if(b){p=this.m_invMassA;y=this.m_invMassB;u=this.m_invIA;x=this.m_invIB;this.m_K.col1.x=p+y+u*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2;this.m_K.col1.y=u*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=p+y+u*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2;this.m_K.Solve(I,-G,-v)}else{p=this.m_invMassA;y=this.m_invMassB;u=this.m_invIA;x=this.m_invIB;var J=p+y+u*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,L=0;L=0!=J?-G/J:0;I.x=L;I.y=0}var F=I.x*this.m_perp.x+I.y*this.m_axis.x,P=I.x*this.m_perp.y+I.y*this.m_axis.y,R=I.x*this.m_s1+I.y*this.m_a1,T=I.x*this.m_s2+I.y*this.m_a2;m.x-=this.m_invMassA*F;m.y-=this.m_invMassA*P;l-=this.m_invIA*R;c.x+=this.m_invMassB*F;c.y+=this.m_invMassB*P;h+=this.m_invIB*T;r.m_sweep.a=l;a.m_sweep.a=h;r.SynchronizeTransform();a.SynchronizeTransform();return f<=t.b2_linearSlop&&d<=t.b2_angularSlop};Box2D.inherit(b,Box2D.Dynamics.Joints.b2JointDef);b.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;b.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n;this.localAxisA=new n};b.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=!1;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=!1;this.maxMotorForce=0;this.motorSpeed=0};b.prototype.Initialize=function(t,i,o,e){this.bodyA=t;this.bodyB=i;this.localAnchorA=this.bodyA.GetLocalPoint(o);this.localAnchorB=this.bodyB.GetLocalPoint(o);this.localAxisA=this.bodyA.GetLocalVector(e)};Box2D.inherit(v,Box2D.Dynamics.Joints.b2Joint);v.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;v.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new i;this.K1=new i;this.K2=new i;this.m_localAnchor=new n;this.m_target=new n;this.m_impulse=new n;this.m_mass=new i;this.m_C=new n};v.prototype.GetAnchorA=function(){return this.m_target};v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};v.prototype.GetReactionForce=function(t){void 0===t&&(t=0);return new n(t*this.m_impulse.x,t*this.m_impulse.y)};v.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);return 0};v.prototype.GetTarget=function(){return this.m_target};v.prototype.SetTarget=function(t){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0);this.m_target=t};v.prototype.GetMaxForce=function(){return this.m_maxForce};v.prototype.SetMaxForce=function(t){void 0===t&&(t=0);this.m_maxForce=t};v.prototype.GetFrequency=function(){return this.m_frequencyHz};v.prototype.SetFrequency=function(t){void 0===t&&(t=0);this.m_frequencyHz=t};v.prototype.GetDampingRatio=function(){return this.m_dampingRatio};v.prototype.SetDampingRatio=function(t){void 0===t&&(t=0);this.m_dampingRatio=t};v.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t);this.m_target.SetV(t.target);var i=this.m_target.x-this.m_bodyB.m_xf.position.x,o=this.m_target.y-this.m_bodyB.m_xf.position.y,e=this.m_bodyB.m_xf.R;this.m_localAnchor.x=i*e.col1.x+o*e.col1.y;this.m_localAnchor.y=i*e.col2.x+o*e.col2.y;this.m_maxForce=t.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_beta=0;this.m_gamma=0};v.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyB,o=i.GetMass(),e=2*Math.PI*this.m_frequencyHz,n=2*o*this.m_dampingRatio*e,s=o*e*e;this.m_gamma=t.dt*(n+t.dt*s);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_beta=t.dt*s*this.m_gamma;var r;r=i.m_xf.R;var a=this.m_localAnchor.x-i.m_sweep.localCenter.x,m=this.m_localAnchor.y-i.m_sweep.localCenter.y,l=r.col1.x*a+r.col2.x*m;m=r.col1.y*a+r.col2.y*m;a=l;var c=i.m_invMass,h=i.m_invI;this.K1.col1.x=c;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=c;this.K2.col1.x=h*m*m;this.K2.col2.x=-h*a*m;this.K2.col1.y=-h*a*m;this.K2.col2.y=h*a*a;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=i.m_sweep.c.x+a-this.m_target.x;this.m_C.y=i.m_sweep.c.y+m-this.m_target.y;i.m_angularVelocity*=.98;this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;i.m_linearVelocity.x+=c*this.m_impulse.x;i.m_linearVelocity.y+=c*this.m_impulse.y;i.m_angularVelocity+=h*(a*this.m_impulse.y-m*this.m_impulse.x)};v.prototype.SolveVelocityConstraints=function(t){var i,o=this.m_bodyB,e=0,n=0;i=o.m_xf.R;var s=this.m_localAnchor.x-o.m_sweep.localCenter.x,r=this.m_localAnchor.y-o.m_sweep.localCenter.y;e=i.col1.x*s+i.col2.x*r;r=i.col1.y*s+i.col2.y*r;s=e;var a=o.m_linearVelocity.x+-o.m_angularVelocity*r,m=o.m_linearVelocity.y+o.m_angularVelocity*s;i=this.m_mass;e=a+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;n=m+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var l=-(i.col1.x*e+i.col2.x*n),c=-(i.col1.y*e+i.col2.y*n),h=this.m_impulse.x,_=this.m_impulse.y;this.m_impulse.x+=l;this.m_impulse.y+=c;var p=t.dt*this.m_maxForce;this.m_impulse.LengthSquared()>p*p&&this.m_impulse.Multiply(p/this.m_impulse.Length());l=this.m_impulse.x-h;c=this.m_impulse.y-_;o.m_linearVelocity.x+=o.m_invMass*l;o.m_linearVelocity.y+=o.m_invMass*c;o.m_angularVelocity+=o.m_invI*(s*c-r*l)};v.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);return!0};Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef);D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;D.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new n};D.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(B,Box2D.Dynamics.Joints.b2Joint);B.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;B.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_localXAxis1=new n;this.m_localYAxis1=new n;this.m_axis=new n;this.m_perp=new n;this.m_K=new o;this.m_impulse=new s};B.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};B.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};B.prototype.GetReactionForce=function(t){void 0===t&&(t=0);return new n(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};B.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);return t*this.m_impulse.y};B.prototype.GetJointTranslation=function(){var t=this.m_bodyA,i=this.m_bodyB,o=t.GetWorldPoint(this.m_localAnchor1),e=i.GetWorldPoint(this.m_localAnchor2),n=e.x-o.x,s=e.y-o.y,r=t.GetWorldVector(this.m_localXAxis1),a=r.x*n+r.y*s;return a};B.prototype.GetJointSpeed=function(){var t,i=this.m_bodyA,o=this.m_bodyB;t=i.m_xf.R;var e=this.m_localAnchor1.x-i.m_sweep.localCenter.x,n=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=t.col1.x*e+t.col2.x*n;n=t.col1.y*e+t.col2.y*n;e=s;t=o.m_xf.R;var r=this.m_localAnchor2.x-o.m_sweep.localCenter.x,a=this.m_localAnchor2.y-o.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a;a=t.col1.y*r+t.col2.y*a;r=s;var m=i.m_sweep.c.x+e,l=i.m_sweep.c.y+n,c=o.m_sweep.c.x+r,h=o.m_sweep.c.y+a,_=c-m,p=h-l,y=i.GetWorldVector(this.m_localXAxis1),u=i.m_linearVelocity,x=o.m_linearVelocity,f=i.m_angularVelocity,d=o.m_angularVelocity,b=_*-f*y.y+p*f*y.x+(y.x*(x.x+-d*a-u.x- -f*n)+y.y*(x.y+d*r-u.y-f*e));return b};B.prototype.IsLimitEnabled=function(){return this.m_enableLimit};B.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=t};B.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};B.prototype.GetUpperLimit=function(){return this.m_upperTranslation};B.prototype.SetLimits=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=t;this.m_upperTranslation=i};B.prototype.IsMotorEnabled=function(){return this.m_enableMotor};B.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=t};B.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=t};B.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};B.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=t};B.prototype.GetMotorForce=function(){return this.m_motorImpulse};B.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=u.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};B.prototype.InitVelocityConstraints=function(i){var o,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_localCenterA.SetV(n.GetLocalCenter());this.m_localCenterB.SetV(s.GetLocalCenter());{var a=n.GetTransform();s.GetTransform()}o=n.m_xf.R;var m=this.m_localAnchor1.x-this.m_localCenterA.x,l=this.m_localAnchor1.y-this.m_localCenterA.y;r=o.col1.x*m+o.col2.x*l;l=o.col1.y*m+o.col2.y*l;m=r;o=s.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y;r=o.col1.x*c+o.col2.x*h;h=o.col1.y*c+o.col2.y*h;c=r;var _=s.m_sweep.c.x+c-n.m_sweep.c.x-m,p=s.m_sweep.c.y+h-n.m_sweep.c.y-l;this.m_invMassA=n.m_invMass;this.m_invMassB=s.m_invMass;this.m_invIA=n.m_invI;this.m_invIB=s.m_invI;this.m_axis.SetV(e.MulMV(a.R,this.m_localXAxis1));this.m_a1=(_+m)*this.m_axis.y-(p+l)*this.m_axis.x;this.m_a2=c*this.m_axis.y-h*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass>Box2D.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass);this.m_perp.SetV(e.MulMV(a.R,this.m_localYAxis1));this.m_s1=(_+m)*this.m_perp.y-(p+l)*this.m_perp.x;this.m_s2=c*this.m_perp.y-h*this.m_perp.x;var y=this.m_invMassA,x=this.m_invMassB,f=this.m_invIA,d=this.m_invIB;this.m_K.col1.x=y+x+f*this.m_s1*this.m_s1+d*this.m_s2*this.m_s2;this.m_K.col1.y=f*this.m_s1+d*this.m_s2;this.m_K.col1.z=f*this.m_s1*this.m_a1+d*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=f+d;this.m_K.col2.z=f*this.m_a1+d*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=y+x+f*this.m_a1*this.m_a1+d*this.m_a2*this.m_a2;if(this.m_enableLimit){var b=this.m_axis.x*_+this.m_axis.y*p;if(e.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop)this.m_limitState=u.e_equalLimits;else if(b<=this.m_lowerTranslation){if(this.m_limitState!=u.e_atLowerLimit){this.m_limitState=u.e_atLowerLimit;this.m_impulse.z=0}}else if(b>=this.m_upperTranslation){if(this.m_limitState!=u.e_atUpperLimit){this.m_limitState=u.e_atUpperLimit;this.m_impulse.z=0}}else{this.m_limitState=u.e_inactiveLimit;this.m_impulse.z=0}}else this.m_limitState=u.e_inactiveLimit;0==this.m_enableMotor&&(this.m_motorImpulse=0);if(i.warmStarting){this.m_impulse.x*=i.dtRatio;this.m_impulse.y*=i.dtRatio;this.m_motorImpulse*=i.dtRatio;var v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,D=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,B=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,C=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.m_linearVelocity.x-=this.m_invMassA*v;n.m_linearVelocity.y-=this.m_invMassA*D;n.m_angularVelocity-=this.m_invIA*B;s.m_linearVelocity.x+=this.m_invMassB*v;s.m_linearVelocity.y+=this.m_invMassB*D;s.m_angularVelocity+=this.m_invIB*C}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};B.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,o=this.m_bodyB,r=i.m_linearVelocity,a=i.m_angularVelocity,m=o.m_linearVelocity,l=o.m_angularVelocity,c=0,h=0,_=0,p=0;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits){var y=this.m_axis.x*(m.x-r.x)+this.m_axis.y*(m.y-r.y)+this.m_a2*l-this.m_a1*a,x=this.m_motorMass*(this.m_motorSpeed-y),f=this.m_motorImpulse,d=t.dt*this.m_maxMotorForce;this.m_motorImpulse=e.Clamp(this.m_motorImpulse+x,-d,d);x=this.m_motorImpulse-f;c=x*this.m_axis.x;h=x*this.m_axis.y;_=x*this.m_a1;p=x*this.m_a2;r.x-=this.m_invMassA*c;r.y-=this.m_invMassA*h;a-=this.m_invIA*_;m.x+=this.m_invMassB*c;m.y+=this.m_invMassB*h;l+=this.m_invIB*p}var b=this.m_perp.x*(m.x-r.x)+this.m_perp.y*(m.y-r.y)+this.m_s2*l-this.m_s1*a,v=l-a;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var D=this.m_axis.x*(m.x-r.x)+this.m_axis.y*(m.y-r.y)+this.m_a2*l-this.m_a1*a,B=this.m_impulse.Copy(),C=this.m_K.Solve33(new s,-b,-v,-D);this.m_impulse.Add(C);this.m_limitState==u.e_atLowerLimit?this.m_impulse.z=e.Max(this.m_impulse.z,0):this.m_limitState==u.e_atUpperLimit&&(this.m_impulse.z=e.Min(this.m_impulse.z,0));var g=-b-(this.m_impulse.z-B.z)*this.m_K.col3.x,A=-v-(this.m_impulse.z-B.z)*this.m_K.col3.y,w=this.m_K.Solve22(new n,g,A);w.x+=B.x;w.y+=B.y;this.m_impulse.x=w.x;this.m_impulse.y=w.y;C.x=this.m_impulse.x-B.x;C.y=this.m_impulse.y-B.y;C.z=this.m_impulse.z-B.z;c=C.x*this.m_perp.x+C.z*this.m_axis.x;h=C.x*this.m_perp.y+C.z*this.m_axis.y;_=C.x*this.m_s1+C.y+C.z*this.m_a1;p=C.x*this.m_s2+C.y+C.z*this.m_a2;r.x-=this.m_invMassA*c;r.y-=this.m_invMassA*h;a-=this.m_invIA*_;m.x+=this.m_invMassB*c;m.y+=this.m_invMassB*h;l+=this.m_invIB*p}else{var S=this.m_K.Solve22(new n,-b,-v);this.m_impulse.x+=S.x;this.m_impulse.y+=S.y;c=S.x*this.m_perp.x;h=S.x*this.m_perp.y;_=S.x*this.m_s1+S.y;p=S.x*this.m_s2+S.y;r.x-=this.m_invMassA*c;r.y-=this.m_invMassA*h;a-=this.m_invIA*_;m.x+=this.m_invMassB*c;m.y+=this.m_invMassB*h;l+=this.m_invIB*p}i.m_linearVelocity.SetV(r);i.m_angularVelocity=a;o.m_linearVelocity.SetV(m);o.m_angularVelocity=l};B.prototype.SolvePositionConstraints=function(o){void 0===o&&(o=0);var r,a=this.m_bodyA,m=this.m_bodyB,l=a.m_sweep.c,c=a.m_sweep.a,h=m.m_sweep.c,_=m.m_sweep.a,p=0,y=0,u=0,x=0,f=0,d=0,b=0,v=!1,D=0,B=i.FromAngle(c),C=i.FromAngle(_);r=B;var g=this.m_localAnchor1.x-this.m_localCenterA.x,A=this.m_localAnchor1.y-this.m_localCenterA.y;p=r.col1.x*g+r.col2.x*A;A=r.col1.y*g+r.col2.y*A;g=p;r=C;var w=this.m_localAnchor2.x-this.m_localCenterB.x,S=this.m_localAnchor2.y-this.m_localCenterB.y;p=r.col1.x*w+r.col2.x*S;S=r.col1.y*w+r.col2.y*S;w=p;var M=h.x+w-l.x-g,V=h.y+S-l.y-A;if(this.m_enableLimit){this.m_axis=e.MulMV(B,this.m_localXAxis1);this.m_a1=(M+g)*this.m_axis.y-(V+A)*this.m_axis.x;this.m_a2=w*this.m_axis.y-S*this.m_axis.x;var I=this.m_axis.x*M+this.m_axis.y*V;if(e.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop){D=e.Clamp(I,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);d=e.Abs(I);v=!0}else if(I<=this.m_lowerTranslation){D=e.Clamp(I-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0);d=this.m_lowerTranslation-I;v=!0}else if(I>=this.m_upperTranslation){D=e.Clamp(I-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection);d=I-this.m_upperTranslation;v=!0}}this.m_perp=e.MulMV(B,this.m_localYAxis1);this.m_s1=(M+g)*this.m_perp.y-(V+A)*this.m_perp.x;this.m_s2=w*this.m_perp.y-S*this.m_perp.x;var G=new s,J=this.m_perp.x*M+this.m_perp.y*V,L=_-c-this.m_refAngle;d=e.Max(d,e.Abs(J));b=e.Abs(L);if(v){y=this.m_invMassA;u=this.m_invMassB;x=this.m_invIA;f=this.m_invIB;this.m_K.col1.x=y+u+x*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2;this.m_K.col1.y=x*this.m_s1+f*this.m_s2;this.m_K.col1.z=x*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=x+f;this.m_K.col2.z=x*this.m_a1+f*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=y+u+x*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2;this.m_K.Solve33(G,-J,-L,-D)}else{y=this.m_invMassA;u=this.m_invMassB;x=this.m_invIA;f=this.m_invIB;var F=y+u+x*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,P=x*this.m_s1+f*this.m_s2,R=x+f;this.m_K.col1.Set(F,P,0);this.m_K.col2.Set(P,R,0);var T=this.m_K.Solve22(new n,-J,-L);G.x=T.x;G.y=T.y;G.z=0}var k=G.x*this.m_perp.x+G.z*this.m_axis.x,z=G.x*this.m_perp.y+G.z*this.m_axis.y,E=G.x*this.m_s1+G.y+G.z*this.m_a1,N=G.x*this.m_s2+G.y+G.z*this.m_a2;l.x-=this.m_invMassA*k;l.y-=this.m_invMassA*z;c-=this.m_invIA*E;h.x+=this.m_invMassB*k;h.y+=this.m_invMassB*z;_+=this.m_invIB*N;a.m_sweep.a=c;m.m_sweep.a=_;a.SynchronizeTransform();m.SynchronizeTransform();return d<=t.b2_linearSlop&&b<=t.b2_angularSlop};Box2D.inherit(C,Box2D.Dynamics.Joints.b2JointDef);C.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;C.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n;this.localAxisA=new n};C.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=!1;this.maxMotorForce=0;this.motorSpeed=0};C.prototype.Initialize=function(t,i,o,e){this.bodyA=t;this.bodyB=i;this.localAnchorA=this.bodyA.GetLocalPoint(o);this.localAnchorB=this.bodyB.GetLocalPoint(o);this.localAxisA=this.bodyA.GetLocalVector(e);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(g,Box2D.Dynamics.Joints.b2Joint);g.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;g.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new n;this.m_groundAnchor2=new n;this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_u1=new n;this.m_u2=new n};g.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};g.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};g.prototype.GetReactionForce=function(t){void 0===t&&(t=0);return new n(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)};g.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);return 0};g.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();t.Add(this.m_groundAnchor1);return t};g.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();t.Add(this.m_groundAnchor2);return t};g.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),i=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,e=t.x-i,n=t.y-o;return Math.sqrt(e*e+n*n)};g.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),i=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,e=t.x-i,n=t.y-o;return Math.sqrt(e*e+n*n)};g.prototype.GetRatio=function(){return this.m_ratio};g.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_ratio=t.ratio;this.m_constant=t.lengthA+this.m_ratio*t.lengthB;this.m_maxLength1=e.Min(t.maxLengthA,this.m_constant-this.m_ratio*g.b2_minPulleyLength);this.m_maxLength2=e.Min(t.maxLengthB,(this.m_constant-g.b2_minPulleyLength)/this.m_ratio);this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0};g.prototype.InitVelocityConstraints=function(i){var o,e=this.m_bodyA,n=this.m_bodyB;o=e.m_xf.R;var s=this.m_localAnchor1.x-e.m_sweep.localCenter.x,r=this.m_localAnchor1.y-e.m_sweep.localCenter.y,a=o.col1.x*s+o.col2.x*r;r=o.col1.y*s+o.col2.y*r;s=a;o=n.m_xf.R;var m=this.m_localAnchor2.x-n.m_sweep.localCenter.x,l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=o.col1.x*m+o.col2.x*l;l=o.col1.y*m+o.col2.y*l;m=a;var c=e.m_sweep.c.x+s,h=e.m_sweep.c.y+r,_=n.m_sweep.c.x+m,p=n.m_sweep.c.y+l,y=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,x=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,f=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,d=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(c-y,h-x);this.m_u2.Set(_-f,p-d);var b=this.m_u1.Length(),v=this.m_u2.Length();b>t.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero();v>t.b2_linearSlop?this.m_u2.Multiply(1/v):this.m_u2.SetZero();var D=this.m_constant-b-this.m_ratio*v;if(D>0){this.m_state=u.e_inactiveLimit;this.m_impulse=0}else this.m_state=u.e_atUpperLimit;if(b<this.m_maxLength1){this.m_limitState1=u.e_inactiveLimit;this.m_limitImpulse1=0}else this.m_limitState1=u.e_atUpperLimit;if(v<this.m_maxLength2){this.m_limitState2=u.e_inactiveLimit;this.m_limitImpulse2=0}else this.m_limitState2=u.e_atUpperLimit;var B=s*this.m_u1.y-r*this.m_u1.x,C=m*this.m_u2.y-l*this.m_u2.x;this.m_limitMass1=e.m_invMass+e.m_invI*B*B;this.m_limitMass2=n.m_invMass+n.m_invI*C*C;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(i.warmStarting){this.m_impulse*=i.dtRatio;this.m_limitImpulse1*=i.dtRatio;this.m_limitImpulse2*=i.dtRatio;var g=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,A=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,w=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,S=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*g;e.m_linearVelocity.y+=e.m_invMass*A;e.m_angularVelocity+=e.m_invI*(s*A-r*g);n.m_linearVelocity.x+=n.m_invMass*w;n.m_linearVelocity.y+=n.m_invMass*S;n.m_angularVelocity+=n.m_invI*(m*S-l*w)}else{this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0}};g.prototype.SolveVelocityConstraints=function(){var t,i=this.m_bodyA,o=this.m_bodyB;t=i.m_xf.R;var n=this.m_localAnchor1.x-i.m_sweep.localCenter.x,s=this.m_localAnchor1.y-i.m_sweep.localCenter.y,r=t.col1.x*n+t.col2.x*s;s=t.col1.y*n+t.col2.y*s;n=r;t=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,m=this.m_localAnchor2.y-o.m_sweep.localCenter.y;r=t.col1.x*a+t.col2.x*m;m=t.col1.y*a+t.col2.y*m;a=r;var l=0,c=0,h=0,_=0,p=0,y=0,x=0,f=0,d=0,b=0,v=0;if(this.m_state==u.e_atUpperLimit){l=i.m_linearVelocity.x+-i.m_angularVelocity*s;c=i.m_linearVelocity.y+i.m_angularVelocity*n;h=o.m_linearVelocity.x+-o.m_angularVelocity*m;_=o.m_linearVelocity.y+o.m_angularVelocity*a;d=-(this.m_u1.x*l+this.m_u1.y*c)-this.m_ratio*(this.m_u2.x*h+this.m_u2.y*_);b=this.m_pulleyMass*-d;v=this.m_impulse;this.m_impulse=e.Max(0,this.m_impulse+b);b=this.m_impulse-v;p=-b*this.m_u1.x;y=-b*this.m_u1.y;x=-this.m_ratio*b*this.m_u2.x;f=-this.m_ratio*b*this.m_u2.y;i.m_linearVelocity.x+=i.m_invMass*p;i.m_linearVelocity.y+=i.m_invMass*y;i.m_angularVelocity+=i.m_invI*(n*y-s*p);o.m_linearVelocity.x+=o.m_invMass*x;o.m_linearVelocity.y+=o.m_invMass*f;o.m_angularVelocity+=o.m_invI*(a*f-m*x)}if(this.m_limitState1==u.e_atUpperLimit){l=i.m_linearVelocity.x+-i.m_angularVelocity*s;c=i.m_linearVelocity.y+i.m_angularVelocity*n;d=-(this.m_u1.x*l+this.m_u1.y*c);b=-this.m_limitMass1*d;v=this.m_limitImpulse1;this.m_limitImpulse1=e.Max(0,this.m_limitImpulse1+b);b=this.m_limitImpulse1-v;p=-b*this.m_u1.x;y=-b*this.m_u1.y;i.m_linearVelocity.x+=i.m_invMass*p;i.m_linearVelocity.y+=i.m_invMass*y;i.m_angularVelocity+=i.m_invI*(n*y-s*p)}if(this.m_limitState2==u.e_atUpperLimit){h=o.m_linearVelocity.x+-o.m_angularVelocity*m;_=o.m_linearVelocity.y+o.m_angularVelocity*a;d=-(this.m_u2.x*h+this.m_u2.y*_);b=-this.m_limitMass2*d;v=this.m_limitImpulse2;this.m_limitImpulse2=e.Max(0,this.m_limitImpulse2+b);b=this.m_limitImpulse2-v;x=-b*this.m_u2.x;f=-b*this.m_u2.y;o.m_linearVelocity.x+=o.m_invMass*x;o.m_linearVelocity.y+=o.m_invMass*f;o.m_angularVelocity+=o.m_invI*(a*f-m*x)}};g.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var o,n=this.m_bodyA,s=this.m_bodyB,r=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,m=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,l=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,c=0,h=0,_=0,p=0,y=0,x=0,f=0,d=0,b=0,v=0,D=0,B=0,C=0,g=0;if(this.m_state==u.e_atUpperLimit){o=n.m_xf.R;c=this.m_localAnchor1.x-n.m_sweep.localCenter.x;h=this.m_localAnchor1.y-n.m_sweep.localCenter.y;C=o.col1.x*c+o.col2.x*h;h=o.col1.y*c+o.col2.y*h;c=C;o=s.m_xf.R;_=this.m_localAnchor2.x-s.m_sweep.localCenter.x;p=this.m_localAnchor2.y-s.m_sweep.localCenter.y;C=o.col1.x*_+o.col2.x*p;p=o.col1.y*_+o.col2.y*p;_=C;y=n.m_sweep.c.x+c;x=n.m_sweep.c.y+h;f=s.m_sweep.c.x+_;d=s.m_sweep.c.y+p;this.m_u1.Set(y-r,x-a);this.m_u2.Set(f-m,d-l);b=this.m_u1.Length();v=this.m_u2.Length();b>t.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero();v>t.b2_linearSlop?this.m_u2.Multiply(1/v):this.m_u2.SetZero();D=this.m_constant-b-this.m_ratio*v;g=e.Max(g,-D);D=e.Clamp(D+t.b2_linearSlop,-t.b2_maxLinearCorrection,0);B=-this.m_pulleyMass*D;y=-B*this.m_u1.x;x=-B*this.m_u1.y;f=-this.m_ratio*B*this.m_u2.x;d=-this.m_ratio*B*this.m_u2.y;n.m_sweep.c.x+=n.m_invMass*y;n.m_sweep.c.y+=n.m_invMass*x;n.m_sweep.a+=n.m_invI*(c*x-h*y);s.m_sweep.c.x+=s.m_invMass*f;s.m_sweep.c.y+=s.m_invMass*d;s.m_sweep.a+=s.m_invI*(_*d-p*f);n.SynchronizeTransform();s.SynchronizeTransform()}if(this.m_limitState1==u.e_atUpperLimit){o=n.m_xf.R;c=this.m_localAnchor1.x-n.m_sweep.localCenter.x;h=this.m_localAnchor1.y-n.m_sweep.localCenter.y;C=o.col1.x*c+o.col2.x*h;h=o.col1.y*c+o.col2.y*h;c=C;y=n.m_sweep.c.x+c;x=n.m_sweep.c.y+h;this.m_u1.Set(y-r,x-a);b=this.m_u1.Length();if(b>t.b2_linearSlop){this.m_u1.x*=1/b;this.m_u1.y*=1/b}else this.m_u1.SetZero();D=this.m_maxLength1-b;g=e.Max(g,-D);D=e.Clamp(D+t.b2_linearSlop,-t.b2_maxLinearCorrection,0);B=-this.m_limitMass1*D;y=-B*this.m_u1.x;x=-B*this.m_u1.y;n.m_sweep.c.x+=n.m_invMass*y;n.m_sweep.c.y+=n.m_invMass*x;n.m_sweep.a+=n.m_invI*(c*x-h*y);n.SynchronizeTransform()}if(this.m_limitState2==u.e_atUpperLimit){o=s.m_xf.R;_=this.m_localAnchor2.x-s.m_sweep.localCenter.x;p=this.m_localAnchor2.y-s.m_sweep.localCenter.y;C=o.col1.x*_+o.col2.x*p;p=o.col1.y*_+o.col2.y*p;_=C;f=s.m_sweep.c.x+_;d=s.m_sweep.c.y+p;this.m_u2.Set(f-m,d-l);v=this.m_u2.Length();if(v>t.b2_linearSlop){this.m_u2.x*=1/v;this.m_u2.y*=1/v}else this.m_u2.SetZero();D=this.m_maxLength2-v;g=e.Max(g,-D);D=e.Clamp(D+t.b2_linearSlop,-t.b2_maxLinearCorrection,0);B=-this.m_limitMass2*D;f=-B*this.m_u2.x;d=-B*this.m_u2.y;s.m_sweep.c.x+=s.m_invMass*f;s.m_sweep.c.y+=s.m_invMass*d;s.m_sweep.a+=s.m_invI*(_*d-p*f);s.SynchronizeTransform()}return g<t.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(A,Box2D.Dynamics.Joints.b2JointDef);A.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;A.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new n;this.groundAnchorB=new n;this.localAnchorA=new n;this.localAnchorB=new n};A.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.lengthA=0;this.maxLengthA=0;this.lengthB=0;this.maxLengthB=0;this.ratio=1;this.collideConnected=!0};A.prototype.Initialize=function(t,i,o,e,n,s,r){void 0===r&&(r=0);this.bodyA=t;this.bodyB=i;this.groundAnchorA.SetV(o);this.groundAnchorB.SetV(e);this.localAnchorA=this.bodyA.GetLocalPoint(n);this.localAnchorB=this.bodyB.GetLocalPoint(s);var a=n.x-o.x,m=n.y-o.y;this.lengthA=Math.sqrt(a*a+m*m);var l=s.x-e.x,c=s.y-e.y;this.lengthB=Math.sqrt(l*l+c*c);this.ratio=r;var h=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=h-this.ratio*g.b2_minPulleyLength;this.maxLengthB=(h-g.b2_minPulleyLength)/this.ratio};Box2D.inherit(w,Box2D.Dynamics.Joints.b2Joint);w.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;
w.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new i;this.K1=new i;this.K2=new i;this.K3=new i;this.impulse3=new s;this.impulse2=new n;this.reduced=new n;this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_impulse=new s;this.m_mass=new o};w.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};w.prototype.GetReactionForce=function(t){void 0===t&&(t=0);return new n(t*this.m_impulse.x,t*this.m_impulse.y)};w.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);return t*this.m_impulse.z};w.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};w.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};w.prototype.IsLimitEnabled=function(){return this.m_enableLimit};w.prototype.EnableLimit=function(t){this.m_enableLimit=t};w.prototype.GetLowerLimit=function(){return this.m_lowerAngle};w.prototype.GetUpperLimit=function(){return this.m_upperAngle};w.prototype.SetLimits=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);this.m_lowerAngle=t;this.m_upperAngle=i};w.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);return this.m_enableMotor};w.prototype.EnableMotor=function(t){this.m_enableMotor=t};w.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=t};w.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};w.prototype.SetMaxMotorTorque=function(t){void 0===t&&(t=0);this.m_maxMotorTorque=t};w.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};w.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=t.lowerAngle;this.m_upperAngle=t.upperAngle;this.m_maxMotorTorque=t.maxMotorTorque;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=u.e_inactiveLimit};w.prototype.InitVelocityConstraints=function(i){var o,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_enableMotor||this.m_enableLimit;o=n.m_xf.R;var a=this.m_localAnchor1.x-n.m_sweep.localCenter.x,m=this.m_localAnchor1.y-n.m_sweep.localCenter.y;r=o.col1.x*a+o.col2.x*m;m=o.col1.y*a+o.col2.y*m;a=r;o=s.m_xf.R;var l=this.m_localAnchor2.x-s.m_sweep.localCenter.x,c=this.m_localAnchor2.y-s.m_sweep.localCenter.y;r=o.col1.x*l+o.col2.x*c;c=o.col1.y*l+o.col2.y*c;l=r;var h=n.m_invMass,_=s.m_invMass,p=n.m_invI,y=s.m_invI;this.m_mass.col1.x=h+_+m*m*p+c*c*y;this.m_mass.col2.x=-m*a*p-c*l*y;this.m_mass.col3.x=-m*p-c*y;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=h+_+a*a*p+l*l*y;this.m_mass.col3.y=a*p+l*y;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=p+y;this.m_motorMass=1/(p+y);0==this.m_enableMotor&&(this.m_motorImpulse=0);if(this.m_enableLimit){var x=s.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;if(e.Abs(this.m_upperAngle-this.m_lowerAngle)<2*t.b2_angularSlop)this.m_limitState=u.e_equalLimits;else if(x<=this.m_lowerAngle){this.m_limitState!=u.e_atLowerLimit&&(this.m_impulse.z=0);this.m_limitState=u.e_atLowerLimit}else if(x>=this.m_upperAngle){this.m_limitState!=u.e_atUpperLimit&&(this.m_impulse.z=0);this.m_limitState=u.e_atUpperLimit}else{this.m_limitState=u.e_inactiveLimit;this.m_impulse.z=0}}else this.m_limitState=u.e_inactiveLimit;if(i.warmStarting){this.m_impulse.x*=i.dtRatio;this.m_impulse.y*=i.dtRatio;this.m_motorImpulse*=i.dtRatio;var f=this.m_impulse.x,d=this.m_impulse.y;n.m_linearVelocity.x-=h*f;n.m_linearVelocity.y-=h*d;n.m_angularVelocity-=p*(a*d-m*f+this.m_motorImpulse+this.m_impulse.z);s.m_linearVelocity.x+=_*f;s.m_linearVelocity.y+=_*d;s.m_angularVelocity+=y*(l*d-c*f+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};w.prototype.SolveVelocityConstraints=function(t){var i,o=this.m_bodyA,n=this.m_bodyB,s=0,r=0,a=0,m=0,l=0,c=0,h=o.m_linearVelocity,_=o.m_angularVelocity,p=n.m_linearVelocity,y=n.m_angularVelocity,x=o.m_invMass,f=n.m_invMass,d=o.m_invI,b=n.m_invI;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits){var v=y-_-this.m_motorSpeed,D=this.m_motorMass*-v,B=this.m_motorImpulse,C=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=e.Clamp(this.m_motorImpulse+D,-C,C);D=this.m_motorImpulse-B;_-=d*D;y+=b*D}if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){i=o.m_xf.R;a=this.m_localAnchor1.x-o.m_sweep.localCenter.x;m=this.m_localAnchor1.y-o.m_sweep.localCenter.y;s=i.col1.x*a+i.col2.x*m;m=i.col1.y*a+i.col2.y*m;a=s;i=n.m_xf.R;l=this.m_localAnchor2.x-n.m_sweep.localCenter.x;c=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=i.col1.x*l+i.col2.x*c;c=i.col1.y*l+i.col2.y*c;l=s;var g=p.x+-y*c-h.x- -_*m,A=p.y+y*l-h.y-_*a,w=y-_;this.m_mass.Solve33(this.impulse3,-g,-A,-w);if(this.m_limitState==u.e_equalLimits)this.m_impulse.Add(this.impulse3);else if(this.m_limitState==u.e_atLowerLimit){r=this.m_impulse.z+this.impulse3.z;if(0>r){this.m_mass.Solve22(this.reduced,-g,-A);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}else if(this.m_limitState==u.e_atUpperLimit){r=this.m_impulse.z+this.impulse3.z;if(r>0){this.m_mass.Solve22(this.reduced,-g,-A);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}h.x-=x*this.impulse3.x;h.y-=x*this.impulse3.y;_-=d*(a*this.impulse3.y-m*this.impulse3.x+this.impulse3.z);p.x+=f*this.impulse3.x;p.y+=f*this.impulse3.y;y+=b*(l*this.impulse3.y-c*this.impulse3.x+this.impulse3.z)}else{i=o.m_xf.R;a=this.m_localAnchor1.x-o.m_sweep.localCenter.x;m=this.m_localAnchor1.y-o.m_sweep.localCenter.y;s=i.col1.x*a+i.col2.x*m;m=i.col1.y*a+i.col2.y*m;a=s;i=n.m_xf.R;l=this.m_localAnchor2.x-n.m_sweep.localCenter.x;c=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=i.col1.x*l+i.col2.x*c;c=i.col1.y*l+i.col2.y*c;l=s;var S=p.x+-y*c-h.x- -_*m,M=p.y+y*l-h.y-_*a;this.m_mass.Solve22(this.impulse2,-S,-M);this.m_impulse.x+=this.impulse2.x;this.m_impulse.y+=this.impulse2.y;h.x-=x*this.impulse2.x;h.y-=x*this.impulse2.y;_-=d*(a*this.impulse2.y-m*this.impulse2.x);p.x+=f*this.impulse2.x;p.y+=f*this.impulse2.y;y+=b*(l*this.impulse2.y-c*this.impulse2.x)}o.m_linearVelocity.SetV(h);o.m_angularVelocity=_;n.m_linearVelocity.SetV(p);n.m_angularVelocity=y};w.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var o,n=0,s=this.m_bodyA,r=this.m_bodyB,a=0,m=0,l=0,c=0,h=0;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var _=r.m_sweep.a-s.m_sweep.a-this.m_referenceAngle,p=0;if(this.m_limitState==u.e_equalLimits){n=e.Clamp(_-this.m_lowerAngle,-t.b2_maxAngularCorrection,t.b2_maxAngularCorrection);p=-this.m_motorMass*n;a=e.Abs(n)}else if(this.m_limitState==u.e_atLowerLimit){n=_-this.m_lowerAngle;a=-n;n=e.Clamp(n+t.b2_angularSlop,-t.b2_maxAngularCorrection,0);p=-this.m_motorMass*n}else if(this.m_limitState==u.e_atUpperLimit){n=_-this.m_upperAngle;a=n;n=e.Clamp(n-t.b2_angularSlop,0,t.b2_maxAngularCorrection);p=-this.m_motorMass*n}s.m_sweep.a-=s.m_invI*p;r.m_sweep.a+=r.m_invI*p;s.SynchronizeTransform();r.SynchronizeTransform()}o=s.m_xf.R;var y=this.m_localAnchor1.x-s.m_sweep.localCenter.x,x=this.m_localAnchor1.y-s.m_sweep.localCenter.y;l=o.col1.x*y+o.col2.x*x;x=o.col1.y*y+o.col2.y*x;y=l;o=r.m_xf.R;var f=this.m_localAnchor2.x-r.m_sweep.localCenter.x,d=this.m_localAnchor2.y-r.m_sweep.localCenter.y;l=o.col1.x*f+o.col2.x*d;d=o.col1.y*f+o.col2.y*d;f=l;var b=r.m_sweep.c.x+f-s.m_sweep.c.x-y,v=r.m_sweep.c.y+d-s.m_sweep.c.y-x,D=b*b+v*v,B=Math.sqrt(D);m=B;var C=s.m_invMass,g=r.m_invMass,A=s.m_invI,S=r.m_invI,M=10*t.b2_linearSlop;if(D>M*M){var V=C+g,I=1/V;c=I*-b;h=I*-v;var G=.5;s.m_sweep.c.x-=G*C*c;s.m_sweep.c.y-=G*C*h;r.m_sweep.c.x+=G*g*c;r.m_sweep.c.y+=G*g*h;b=r.m_sweep.c.x+f-s.m_sweep.c.x-y;v=r.m_sweep.c.y+d-s.m_sweep.c.y-x}this.K1.col1.x=C+g;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=C+g;this.K2.col1.x=A*x*x;this.K2.col2.x=-A*y*x;this.K2.col1.y=-A*y*x;this.K2.col2.y=A*y*y;this.K3.col1.x=S*d*d;this.K3.col2.x=-S*f*d;this.K3.col1.y=-S*f*d;this.K3.col2.y=S*f*f;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(w.tImpulse,-b,-v);c=w.tImpulse.x;h=w.tImpulse.y;s.m_sweep.c.x-=s.m_invMass*c;s.m_sweep.c.y-=s.m_invMass*h;s.m_sweep.a-=s.m_invI*(y*h-x*c);r.m_sweep.c.x+=r.m_invMass*c;r.m_sweep.c.y+=r.m_invMass*h;r.m_sweep.a+=r.m_invI*(f*h-d*c);s.SynchronizeTransform();r.SynchronizeTransform();return m<=t.b2_linearSlop&&a<=t.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new n});Box2D.inherit(S,Box2D.Dynamics.Joints.b2JointDef);S.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;S.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n};S.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.referenceAngle=0;this.lowerAngle=0;this.upperAngle=0;this.maxMotorTorque=0;this.motorSpeed=0;this.enableLimit=!1;this.enableMotor=!1};S.prototype.Initialize=function(t,i,o){this.bodyA=t;this.bodyB=i;this.localAnchorA=this.bodyA.GetLocalPoint(o);this.localAnchorB=this.bodyB.GetLocalPoint(o);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(M,Box2D.Dynamics.Joints.b2Joint);M.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;M.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_impulse=new s;this.m_mass=new o};M.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};M.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};M.prototype.GetReactionForce=function(t){void 0===t&&(t=0);return new n(t*this.m_impulse.x,t*this.m_impulse.y)};M.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);return t*this.m_impulse.z};M.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchorA.SetV(t.localAnchorA);this.m_localAnchorB.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_mass=new o};M.prototype.InitVelocityConstraints=function(t){var i,o=0,e=this.m_bodyA,n=this.m_bodyB;i=e.m_xf.R;var s=this.m_localAnchorA.x-e.m_sweep.localCenter.x,r=this.m_localAnchorA.y-e.m_sweep.localCenter.y;o=i.col1.x*s+i.col2.x*r;r=i.col1.y*s+i.col2.y*r;s=o;i=n.m_xf.R;var a=this.m_localAnchorB.x-n.m_sweep.localCenter.x,m=this.m_localAnchorB.y-n.m_sweep.localCenter.y;o=i.col1.x*a+i.col2.x*m;m=i.col1.y*a+i.col2.y*m;a=o;var l=e.m_invMass,c=n.m_invMass,h=e.m_invI,_=n.m_invI;this.m_mass.col1.x=l+c+r*r*h+m*m*_;this.m_mass.col2.x=-r*s*h-m*a*_;this.m_mass.col3.x=-r*h-m*_;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=l+c+s*s*h+a*a*_;this.m_mass.col3.y=s*h+a*_;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=h+_;if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_impulse.z*=t.dtRatio;e.m_linearVelocity.x-=l*this.m_impulse.x;e.m_linearVelocity.y-=l*this.m_impulse.y;e.m_angularVelocity-=h*(s*this.m_impulse.y-r*this.m_impulse.x+this.m_impulse.z);n.m_linearVelocity.x+=c*this.m_impulse.x;n.m_linearVelocity.y+=c*this.m_impulse.y;n.m_angularVelocity+=_*(a*this.m_impulse.y-m*this.m_impulse.x+this.m_impulse.z)}else this.m_impulse.SetZero()};M.prototype.SolveVelocityConstraints=function(){var t,i=0,o=this.m_bodyA,e=this.m_bodyB,n=o.m_linearVelocity,r=o.m_angularVelocity,a=e.m_linearVelocity,m=e.m_angularVelocity,l=o.m_invMass,c=e.m_invMass,h=o.m_invI,_=e.m_invI;t=o.m_xf.R;var p=this.m_localAnchorA.x-o.m_sweep.localCenter.x,y=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=t.col1.x*p+t.col2.x*y;y=t.col1.y*p+t.col2.y*y;p=i;t=e.m_xf.R;var u=this.m_localAnchorB.x-e.m_sweep.localCenter.x,x=this.m_localAnchorB.y-e.m_sweep.localCenter.y;i=t.col1.x*u+t.col2.x*x;x=t.col1.y*u+t.col2.y*x;u=i;var f=a.x-m*x-n.x+r*y,d=a.y+m*u-n.y-r*p,b=m-r,v=new s;this.m_mass.Solve33(v,-f,-d,-b);this.m_impulse.Add(v);n.x-=l*v.x;n.y-=l*v.y;r-=h*(p*v.y-y*v.x+v.z);a.x+=c*v.x;a.y+=c*v.y;m+=_*(u*v.y-x*v.x+v.z);o.m_angularVelocity=r;e.m_angularVelocity=m};M.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var o,n=0,r=this.m_bodyA,a=this.m_bodyB;o=r.m_xf.R;var m=this.m_localAnchorA.x-r.m_sweep.localCenter.x,l=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=o.col1.x*m+o.col2.x*l;l=o.col1.y*m+o.col2.y*l;m=n;o=a.m_xf.R;var c=this.m_localAnchorB.x-a.m_sweep.localCenter.x,h=this.m_localAnchorB.y-a.m_sweep.localCenter.y;n=o.col1.x*c+o.col2.x*h;h=o.col1.y*c+o.col2.y*h;c=n;var _=r.m_invMass,p=a.m_invMass,y=r.m_invI,u=a.m_invI,x=a.m_sweep.c.x+c-r.m_sweep.c.x-m,f=a.m_sweep.c.y+h-r.m_sweep.c.y-l,d=a.m_sweep.a-r.m_sweep.a-this.m_referenceAngle,b=10*t.b2_linearSlop,v=Math.sqrt(x*x+f*f),D=e.Abs(d);if(v>b){y*=1;u*=1}this.m_mass.col1.x=_+p+l*l*y+h*h*u;this.m_mass.col2.x=-l*m*y-h*c*u;this.m_mass.col3.x=-l*y-h*u;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=_+p+m*m*y+c*c*u;this.m_mass.col3.y=m*y+c*u;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=y+u;var B=new s;this.m_mass.Solve33(B,-x,-f,-d);r.m_sweep.c.x-=_*B.x;r.m_sweep.c.y-=_*B.y;r.m_sweep.a-=y*(m*B.y-l*B.x+B.z);a.m_sweep.c.x+=p*B.x;a.m_sweep.c.y+=p*B.y;a.m_sweep.a+=u*(c*B.y-h*B.x+B.z);r.SynchronizeTransform();a.SynchronizeTransform();return v<=t.b2_linearSlop&&D<=t.b2_angularSlop};Box2D.inherit(V,Box2D.Dynamics.Joints.b2JointDef);V.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;V.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n};V.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_weldJoint;this.referenceAngle=0};V.prototype.Initialize=function(t,i,o){this.bodyA=t;this.bodyB=i;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}();!function(){var t=Box2D.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1;this.m_lineThickness=1;this.m_alpha=1;this.m_fillAlpha=1;this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}};t.prototype._color=function(t,i){return"rgba("+((16711680&t)>>16)+","+((65280&t)>>8)+","+(255&t)+","+i+")"};t.prototype.b2DebugDraw=function(){this.m_drawFlags=0};t.prototype.SetFlags=function(t){void 0===t&&(t=0);this.m_drawFlags=t};t.prototype.GetFlags=function(){return this.m_drawFlags};t.prototype.AppendFlags=function(t){void 0===t&&(t=0);this.m_drawFlags|=t};t.prototype.ClearFlags=function(t){void 0===t&&(t=0);this.m_drawFlags&=~t};t.prototype.SetSprite=function(t){this.m_ctx=t};t.prototype.GetSprite=function(){return this.m_ctx};t.prototype.SetDrawScale=function(t){void 0===t&&(t=0);this.m_drawScale=t};t.prototype.GetDrawScale=function(){return this.m_drawScale};t.prototype.SetLineThickness=function(t){void 0===t&&(t=0);this.m_lineThickness=t;this.m_ctx.strokeWidth=t};t.prototype.GetLineThickness=function(){return this.m_lineThickness};t.prototype.SetAlpha=function(t){void 0===t&&(t=0);this.m_alpha=t};t.prototype.GetAlpha=function(){return this.m_alpha};t.prototype.SetFillAlpha=function(t){void 0===t&&(t=0);this.m_fillAlpha=t};t.prototype.GetFillAlpha=function(){return this.m_fillAlpha};t.prototype.SetXFormScale=function(t){void 0===t&&(t=0);this.m_xformScale=t};t.prototype.GetXFormScale=function(){return this.m_xformScale};t.prototype.DrawPolygon=function(t,i,o){if(i){var e=this.m_ctx,n=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(o.color,this.m_alpha);e.moveTo(t[0].x*n,t[0].y*n);for(var s=1;i>s;s++)e.lineTo(t[s].x*n,t[s].y*n);e.lineTo(t[0].x*n,t[0].y*n);e.closePath();e.stroke()}};t.prototype.DrawSolidPolygon=function(t,i,o){if(i){var e=this.m_ctx,n=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(o.color,this.m_alpha);e.fillStyle=this._color(o.color,this.m_fillAlpha);e.moveTo(t[0].x*n,t[0].y*n);for(var s=1;i>s;s++)e.lineTo(t[s].x*n,t[s].y*n);e.lineTo(t[0].x*n,t[0].y*n);e.closePath();e.fill();e.stroke()}};t.prototype.DrawCircle=function(t,i,o){if(i){var e=this.m_ctx,n=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(o.color,this.m_alpha);e.arc(t.x*n,t.y*n,i*n,0,2*Math.PI,!0);e.closePath();e.stroke()}};t.prototype.DrawSolidCircle=function(t,i,o,e){if(i){var n=this.m_ctx,s=this.m_drawScale,r=t.x*s,a=t.y*s;n.moveTo(0,0);n.beginPath();n.strokeStyle=this._color(e.color,this.m_alpha);n.fillStyle=this._color(e.color,this.m_fillAlpha);n.arc(r,a,i*s,0,2*Math.PI,!0);n.moveTo(r,a);n.lineTo((t.x+o.x*i)*s,(t.y+o.y*i)*s);n.closePath();n.fill();n.stroke()}};t.prototype.DrawSegment=function(t,i,o){var e=this.m_ctx,n=this.m_drawScale;e.strokeStyle=this._color(o.color,this.m_alpha);e.beginPath();e.moveTo(t.x*n,t.y*n);e.lineTo(i.x*n,i.y*n);e.closePath();e.stroke()};t.prototype.DrawTransform=function(t){var i=this.m_ctx,o=this.m_drawScale;i.beginPath();i.strokeStyle=this._color(16711680,this.m_alpha);i.moveTo(t.position.x*o,t.position.y*o);i.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*o,(t.position.y+this.m_xformScale*t.R.col1.y)*o);i.strokeStyle=this._color(65280,this.m_alpha);i.moveTo(t.position.x*o,t.position.y*o);i.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*o,(t.position.y+this.m_xformScale*t.R.col2.y)*o);i.closePath();i.stroke()}}();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;window.b2Vec2=Box2D.Common.Math.b2Vec2;window.b2BodyDef=Box2D.Dynamics.b2BodyDef;window.b2Body=Box2D.Dynamics.b2Body;window.b2FixtureDef=Box2D.Dynamics.b2FixtureDef;window.b2Fixture=Box2D.Dynamics.b2Fixture;window.b2World=Box2D.Dynamics.b2World;window.b2MassData=Box2D.Collision.Shapes.b2MassData;window.b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape;window.b2CircleShape=Box2D.Collision.Shapes.b2CircleShape;window.b2DebugDraw=Box2D.Dynamics.b2DebugDraw;window.b2ContactListener=Box2D.Dynamics.b2ContactListener;window.b2DistanceJointDef=Box2D.Dynamics.Joints.b2DistanceJointDef;window.b2RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef;window.b2PulleyJointDef=Box2D.Dynamics.Joints.b2PulleyJointDef;window.b2PrismaticJointDef=Box2D.Dynamics.Joints.b2PrismaticJointDef;window.b2LineJointDef=Box2D.Dynamics.Joints.b2LineJointDef;window.b2WeldJointDef=Box2D.Dynamics.Joints.b2WeldJointDef;window.b2GearJointDef=Box2D.Dynamics.Joints.b2GearJointDef;window.b2MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef;window.b2RopeJointDef=Box2D.Dynamics.Joints.b2RopeJointDef;window.b2_dynamicBody=Box2D.Dynamics.b2Body.b2_dynamicBody;window.b2_staticBody=Box2D.Dynamics.b2Body.b2_staticBody;window.b2_kinematicBody=Box2D.Dynamics.b2Body.b2_kinematicBody;
(function(){var t=this,e=e||{};e.WEBGL_RENDERER=0;e.CANVAS_RENDERER=1;e.VERSION="v2.2.0";e.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16};e.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1};e._UID=0;if("undefined"!=typeof Float32Array){e.Float32Array=Float32Array;e.Uint16Array=Uint16Array;e.Uint32Array=Uint32Array;e.ArrayBuffer=ArrayBuffer}else{e.Float32Array=Array;e.Uint16Array=Array}e.INTERACTION_FREQUENCY=30;e.AUTO_PREVENT_DEFAULT=!0;e.PI_2=2*Math.PI;e.RAD_TO_DEG=180/Math.PI;e.DEG_TO_RAD=Math.PI/180;e.RETINA_PREFIX="@2x";e.dontSayHello=!0;e.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1};e.sayHello=function(t){if(!e.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["%c %c %c Pixi.js "+e.VERSION+" - "+t+"  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,i)}else window.console&&console.log("Pixi.js "+e.VERSION+" - http://www.pixijs.com/");e.dontSayHello=!0}};e.Point=function(t,e){this.x=t||0;this.y=e||0};e.Point.prototype.clone=function(){return new e.Point(this.x,this.y)};e.Point.prototype.set=function(t,e){this.x=t||0;this.y=e||(0!==e?this.x:0)};e.Point.prototype.constructor=e.Point;e.Rectangle=function(t,e,i,r){this.x=t||0;this.y=e||0;this.width=i||0;this.height=r||0};e.Rectangle.prototype.clone=function(){return new e.Rectangle(this.x,this.y,this.width,this.height)};e.Rectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var r=this.y;if(e>=r&&e<=r+this.height)return!0}return!1};e.Rectangle.prototype.constructor=e.Rectangle;e.EmptyRectangle=new e.Rectangle(0,0,0,0);e.Polygon=function(t){t instanceof Array||(t=Array.prototype.slice.call(arguments));if(t[0]instanceof e.Point){for(var i=[],r=0,s=t.length;s>r;r++)i.push(t[r].x,t[r].y);t=i}this.closed=!0;this.points=t};e.Polygon.prototype.clone=function(){var t=this.points.slice();return new e.Polygon(t)};e.Polygon.prototype.contains=function(t,e){for(var i=!1,r=this.points.length/2,s=0,n=r-1;r>s;n=s++){var o=this.points[2*s],a=this.points[2*s+1],h=this.points[2*n],l=this.points[2*n+1],u=a>e!=l>e&&(h-o)*(e-a)/(l-a)+o>t;u&&(i=!i)}return i};e.Polygon.prototype.constructor=e.Polygon;e.Circle=function(t,e,i){this.x=t||0;this.y=e||0;this.radius=i||0};e.Circle.prototype.clone=function(){return new e.Circle(this.x,this.y,this.radius)};e.Circle.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.x-t,r=this.y-e,s=this.radius*this.radius;i*=i;r*=r;return s>=i+r};e.Circle.prototype.getBounds=function(){return new e.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)};e.Circle.prototype.constructor=e.Circle;e.Ellipse=function(t,e,i,r){this.x=t||0;this.y=e||0;this.width=i||0;this.height=r||0};e.Ellipse.prototype.clone=function(){return new e.Ellipse(this.x,this.y,this.width,this.height)};e.Ellipse.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,r=(e-this.y)/this.height;i*=i;r*=r;return 1>=i+r};e.Ellipse.prototype.getBounds=function(){return new e.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)};e.Ellipse.prototype.constructor=e.Ellipse;e.RoundedRectangle=function(t,e,i,r,s){this.x=t||0;this.y=e||0;this.width=i||0;this.height=r||0;this.radius=s||20};e.RoundedRectangle.prototype.clone=function(){return new e.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)};e.RoundedRectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var r=this.y;if(e>=r&&e<=r+this.height)return!0}return!1};e.RoundedRectangle.prototype.constructor=e.RoundedRectangle;e.Matrix=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0};e.Matrix.prototype.fromArray=function(t){this.a=t[0];this.b=t[1];this.c=t[3];this.d=t[4];this.tx=t[2];this.ty=t[5]};e.Matrix.prototype.toArray=function(t){this.array||(this.array=new e.Float32Array(9));var i=this.array;if(t){i[0]=this.a;i[1]=this.b;i[2]=0;i[3]=this.c;i[4]=this.d;i[5]=0;i[6]=this.tx;i[7]=this.ty;i[8]=1}else{i[0]=this.a;i[1]=this.c;i[2]=this.tx;i[3]=this.b;i[4]=this.d;i[5]=this.ty;i[6]=0;i[7]=0;i[8]=1}return i};e.Matrix.prototype.apply=function(t,i){i=i||new e.Point;i.x=this.a*t.x+this.c*t.y+this.tx;i.y=this.b*t.x+this.d*t.y+this.ty;return i};e.Matrix.prototype.applyInverse=function(t,i){i=i||new e.Point;var r=1/(this.a*this.d+this.c*-this.b);i.x=this.d*r*t.x+-this.c*r*t.y+(this.ty*this.c-this.tx*this.d)*r;i.y=this.a*r*t.y+-this.b*r*t.x+(-this.ty*this.a+this.tx*this.b)*r;return i};e.Matrix.prototype.translate=function(t,e){this.tx+=t;this.ty+=e;return this};e.Matrix.prototype.scale=function(t,e){this.a*=t;this.d*=e;this.c*=t;this.b*=e;this.tx*=t;this.ty*=e;return this};e.Matrix.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a,s=this.c,n=this.tx;this.a=r*e-this.b*i;this.b=r*i+this.b*e;this.c=s*e-this.d*i;this.d=s*i+this.d*e;this.tx=n*e-this.ty*i;this.ty=n*i+this.ty*e;return this};e.Matrix.prototype.append=function(t){var e=this.a,i=this.b,r=this.c,s=this.d;this.a=t.a*e+t.b*r;this.b=t.a*i+t.b*s;this.c=t.c*e+t.d*r;this.d=t.c*i+t.d*s;this.tx=t.tx*e+t.ty*r+this.tx;this.ty=t.tx*i+t.ty*s+this.ty;return this};e.Matrix.prototype.identity=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;return this};e.identityMatrix=new e.Matrix;e.DisplayObject=function(){e.EventTarget.call(this);this.position=new e.Point;this.scale=new e.Point(1,1);this.pivot=new e.Point(0,0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.buttonMode=!1;this.renderable=!1;this.parent=null;this.stage=null;this.worldAlpha=1;this._interactive=!1;this.defaultCursor="pointer";this.worldTransform=new e.Matrix;this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new e.Rectangle(0,0,1,1);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=!1;this._cacheIsDirty=!1};e.DisplayObject.prototype.constructor=e.DisplayObject;Object.defineProperty(e.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(t){this._interactive=t;this.stage&&(this.stage.dirty=!0)}});Object.defineProperty(e.DisplayObject.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}});Object.defineProperty(e.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1);this._mask=t;this._mask&&(this._mask.isMask=!0)}});Object.defineProperty(e.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(t){if(t){for(var e=[],i=0;i<t.length;i++)for(var r=t[i].passes,s=0;s<r.length;s++)e.push(r[s]);this._filterBlock={target:this,filterPasses:e}}this._filters=t}});Object.defineProperty(e.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){if(this._cacheAsBitmap!==t){t?this._generateCachedSprite():this._destroyCachedSprite();this._cacheAsBitmap=t}}});e.DisplayObject.prototype.updateTransform=function(){var t=this.parent.worldTransform,i=this.worldTransform;this.anchorPoint&&this.setAnchorPoint(this.anchorPoint.x,this.anchorPoint.y);var r;r=this.texture&&this.texture.frame&&this._width&&this._height?new e.Point(this.scale.x*this._width/this.texture.frame.width,this.scale.y*this._height/this.texture.frame.height):this.scale;var s=new e.Point(this.scale.x,this.scale.y),n=this.mirror||{horizontal:1,vertical:1};if(-1===n.horizontal){r.x*=-1;s.x*=-1}if(-1===n.vertical){r.y*=-1;s.y*=-1}var o,a,h,l,u,c;if(this.rotation%e.PI_2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}o=this._cr*r.x;a=this._sr*r.x;h=-this._sr*r.y;l=this._cr*r.y;u=this.position.x;c=this.position.y;if(this.pivot.x||this.pivot.y){u-=this.pivot.x*this._cr*s.x+this.pivot.y*-this._sr*s.y;c-=this.pivot.x*this._sr*s.x+this.pivot.y*this._cr*s.y}i.a=o*t.a+a*t.c;i.b=o*t.b+a*t.d;i.c=h*t.a+l*t.c;i.d=h*t.b+l*t.d;i.tx=u*t.a+c*t.c+t.tx;i.ty=u*t.b+c*t.d+t.ty}else{o=r.x;l=r.y;u=this.position.x-this.pivot.x*s.x;c=this.position.y-this.pivot.y*s.y;i.a=o*t.a;i.b=o*t.b;i.c=l*t.c;i.d=l*t.d;i.tx=u*t.a+c*t.c+t.tx;i.ty=u*t.b+c*t.d+t.ty}this.worldAlpha=this.alpha*this.parent.worldAlpha};e.DisplayObject.prototype.displayObjectUpdateTransform=e.DisplayObject.prototype.updateTransform;e.DisplayObject.prototype.getBounds=function(t){t=t;return e.EmptyRectangle};e.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(e.identityMatrix)};e.DisplayObject.prototype.setStageReference=function(t){this.stage=t;this._interactive&&(this.stage.dirty=!0)};e.DisplayObject.prototype.generateTexture=function(t,i,r){var s=this.getLocalBounds(),n=new e.RenderTexture(0|s.width,0|s.height,r,i,t);e.DisplayObject._tempMatrix.tx=-s.x;e.DisplayObject._tempMatrix.ty=-s.y;n.render(this,e.DisplayObject._tempMatrix);return n};e.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};e.DisplayObject.prototype.toGlobal=function(t){this.displayObjectUpdateTransform();return this.worldTransform.apply(t)};e.DisplayObject.prototype.toLocal=function(t,e){e&&(t=e.toGlobal(t));this.displayObjectUpdateTransform();return this.worldTransform.applyInverse(t)};e.DisplayObject.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha;t.gl?e.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):e.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)};e.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var t=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|t.width,0|t.height);else{var i=new e.RenderTexture(0|t.width,0|t.height);this._cachedSprite=new e.Sprite(i);this._cachedSprite.worldTransform=this.worldTransform}var r=this._filters;this._filters=null;this._cachedSprite.filters=r;e.DisplayObject._tempMatrix.tx=-t.x;e.DisplayObject._tempMatrix.ty=-t.y;this._cachedSprite.texture.render(this,e.DisplayObject._tempMatrix,!0);this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._filters=r;this._cacheAsBitmap=!0};e.DisplayObject.prototype._destroyCachedSprite=function(){if(this._cachedSprite){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null}};e.DisplayObject.prototype._renderWebGL=function(t){t=t};e.DisplayObject.prototype._renderCanvas=function(t){t=t};e.DisplayObject._tempMatrix=new e.Matrix;Object.defineProperty(e.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}});Object.defineProperty(e.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}});e.DisplayObjectContainer=function(){e.DisplayObject.call(this);this.children=[]};e.DisplayObjectContainer.prototype=Object.create(e.DisplayObject.prototype);e.DisplayObjectContainer.prototype.constructor=e.DisplayObjectContainer;Object.defineProperty(e.DisplayObjectContainer.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}});Object.defineProperty(e.DisplayObjectContainer.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}});e.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)};e.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length){t.parent&&t.parent.removeChild(t);t.parent=this;this.children.splice(e,0,t);this.stage&&t.setStageReference(this.stage);return t}throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)};e.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),r=this.getChildIndex(e);if(0>i||0>r)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e;this.children[r]=t}};e.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e};e.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(0>e||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1);this.children.splice(e,0,t)};e.DisplayObjectContainer.prototype.getChildAt=function(t){if(0>t||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]};e.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);return-1!==e?this.removeChildAt(e):void 0};e.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);this.stage&&e.removeStageReference();e.parent=void 0;this.children.splice(t,1);return e};e.DisplayObjectContainer.prototype.removeChildren=function(t,e){var i=t||0,r="number"==typeof e?e:this.children.length,s=r-i;if(s>0&&r>=s){for(var n=this.children.splice(i,s),o=0;o<n.length;o++){var a=n[o];this.stage&&a.removeStageReference();a.parent=void 0}return n}if(0===s&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")};e.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){this.displayObjectUpdateTransform();if(!this._cacheAsBitmap)for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform()}};e.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=e.DisplayObjectContainer.prototype.updateTransform;e.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return e.EmptyRectangle;for(var t,i,r,s=1/0,n=1/0,o=-1/0,a=-1/0,h=!1,l=0,u=this.children.length;u>l;l++){var c=this.children[l];if(c.visible){h=!0;t=this.children[l].getBounds();s=s<t.x?s:t.x;n=n<t.y?n:t.y;i=t.width+t.x;r=t.height+t.y;o=o>i?o:i;a=a>r?a:r}}if(!h)return e.EmptyRectangle;var d=this._bounds;d.x=s;d.y=n;d.width=o-s;d.height=a-n;return d};e.DisplayObjectContainer.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=e.identityMatrix;for(var i=0,r=this.children.length;r>i;i++)this.children[i].updateTransform();var s=this.getBounds();this.worldTransform=t;return s};e.DisplayObjectContainer.prototype.setStageReference=function(t){this.stage=t;this._interactive&&(this.stage.dirty=!0);for(var e=0,i=this.children.length;i>e;e++){var r=this.children[e];r.setStageReference(t)}};e.DisplayObjectContainer.prototype.removeStageReference=function(){for(var t=0,e=this.children.length;e>t;t++){var i=this.children[t];i.removeStageReference()}this._interactive&&(this.stage.dirty=!0);this.stage=null};e.DisplayObjectContainer.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0))if(this._cacheAsBitmap)this._renderCachedSprite(t);else{var e,i;if(this._mask||this._filters){if(this._filters){t.spriteBatch.flush();t.filterManager.pushFilter(this._filterBlock)}if(this._mask){t.spriteBatch.stop();t.maskManager.pushMask(this.mask,t);t.spriteBatch.start()}for(e=0,i=this.children.length;i>e;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop();this._mask&&t.maskManager.popMask(this._mask,t);this._filters&&t.filterManager.popFilter();t.spriteBatch.start()}else for(e=0,i=this.children.length;i>e;e++)this.children[e]._renderWebGL(t)}};e.DisplayObjectContainer.prototype._renderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(t);else{this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0,i=this.children.length;i>e;e++){var r=this.children[e];r._renderCanvas(t)}this._mask&&t.maskManager.popMask(t)}};e.Sprite=function(t){e.DisplayObjectContainer.call(this);this.anchor=new e.Point;this.texture=t||e.Texture.emptyTexture;this._width=0;this._height=0;this.tint=16777215;this.blendMode=e.blendModes.NORMAL;this.shader=null;this.texture.baseTexture.hasLoaded?this.onTextureUpdate():this.texture.on("update",this.onTextureUpdate.bind(this));this.renderable=!0};e.Sprite.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Sprite.prototype.constructor=e.Sprite;Object.defineProperty(e.Sprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}});Object.defineProperty(e.Sprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}});e.Sprite.prototype.setTexture=function(t){this.texture=t;this.cachedTint=16777215};e.Sprite.prototype.onTextureUpdate=function(){};e.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width,i=this.texture.frame.height,r=e*(1-this.anchor.x),s=e*-this.anchor.x,n=i*(1-this.anchor.y),o=i*-this.anchor.y,a=t||this.worldTransform,h=a.a,l=a.b,u=a.c,c=a.d,d=a.tx,p=a.ty,f=-1/0,g=-1/0,m=1/0,v=1/0;if(0===l&&0===u){0>h&&(h*=-1);0>c&&(c*=-1);m=h*s+d;f=h*r+d;v=c*o+p;g=c*n+p}else{var x=h*s+u*o+d,y=c*o+l*s+p,b=h*r+u*o+d,T=c*o+l*r+p,S=h*r+u*n+d,w=c*n+l*r+p,C=h*s+u*n+d,A=c*n+l*s+p;m=m>x?x:m;m=m>b?b:m;m=m>S?S:m;m=m>C?C:m;v=v>y?y:v;v=v>T?T:v;v=v>w?w:v;v=v>A?A:v;f=x>f?x:f;f=b>f?b:f;f=S>f?S:f;f=C>f?C:f;g=y>g?y:g;g=T>g?T:g;g=w>g?w:g;g=A>g?A:g}var _=this._bounds;_.x=m;_.width=f-m;_.y=v;_.height=g-v;this._currentBounds=_;return _};e.Sprite.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0))if(this.dirty&&this.speed&&(this.speed.x||this.speed.y)){var i=!this.generateTilingTexture;if(i){this._width||(this._width=100);this._height||(this._height=100);this.tileScale=new e.Point(1,1);this.tileScaleOffset=new e.Point(1,1);this.tilePosition=this.offset;this.setOffset&&this.setOffset(0,0);this.generateTilingTexture=e.TilingSprite.prototype.generateTilingTexture}try{e.TilingSprite.prototype._renderWebGL.call(this,t)}catch(r){console.log(r)}if(i){this.setOffset&&this.setOffset(1,0);this.setOffset&&this.setOffset(0,0)}}else{var s,n;if(this._mask||this._filters){var o=t.spriteBatch;if(this._filters){o.flush();t.filterManager.pushFilter(this._filterBlock)}if(this._mask){o.stop();t.maskManager.pushMask(this.mask,t);o.start()}o.render(this);for(s=0,n=this.children.length;n>s;s++)this.children[s]._renderWebGL(t);o.stop();this._mask&&t.maskManager.popMask(this._mask,t);this._filters&&t.filterManager.popFilter();o.start()}else{t.spriteBatch.render(this);for(s=0,n=this.children.length;n>s;s++)this.children[s]._renderWebGL(t)}}};e.Sprite.prototype._renderCanvas=function(t){if(!(this.visible===!1||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;t.context.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]}this._mask&&t.maskManager.pushMask(this._mask,t);if(this.texture.valid){var i=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha;if(t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode){t.scaleMode=this.texture.baseTexture.scaleMode;t.context[t.smoothProperty]=t.scaleMode===e.scaleModes.LINEAR}var r=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,s=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;if(t.roundPixels){t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0);r=0|r;s=0|s}else t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution);if(16777215!==this.tint){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;this.tintedTexture=e.CanvasTinter.getTintedTexture(this,this.tint)}t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,r/i,s/i,this.texture.crop.width/i,this.texture.crop.height/i)}else{var n=this.repeat?"repeat":this.repeat_x?"repeat-x":this.repeat_y?"repeat-y":"no-repeat",o=this.scale||new e.Point(1,1),a=this.offset||new e.Point(0,0);if(this.dirty&&this.speed&&(this.speed.x||this.speed.y)){var h=t.context,l=h.createPattern(this.texture.baseTexture.source,n);h.fillStyle=l;h.translate(a.x/o.x,a.y/o.y);h.fillRect(-a.x/o.x,-a.y/o.y,this.texture.crop.width,this.texture.crop.height)}else t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,r/i,s/i,this.texture.crop.width/i,this.texture.crop.height/i)}}for(var u=0,c=this.children.length;c>u;u++)this.children[u]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}};e.Sprite.fromFrame=function(t){var i=e.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache'+this);return new e.Sprite(i)};e.Sprite.fromImage=function(t,i,r){var s=e.Texture.fromImage(t,i,r);return new e.Sprite(s)};e.SpriteBatch=function(t){e.DisplayObjectContainer.call(this);this.textureThing=t;this.ready=!1};e.SpriteBatch.prototype=Object.create(e.DisplayObjectContainer.prototype);e.SpriteBatch.prototype.constructor=e.SpriteBatch;e.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new e.WebGLFastSpriteBatch(t);this.ready=!0};e.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};e.SpriteBatch.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){this.ready||this.initWebGL(t.gl);t.spriteBatch.stop();t.shaderManager.setShader(t.shaderManager.fastShader);this.fastSpriteBatch.begin(this,t);this.fastSpriteBatch.render(this);t.spriteBatch.start()}};e.SpriteBatch.prototype._renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){var e=t.context;e.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();for(var i=this.worldTransform,r=!0,s=0;s<this.children.length;s++){var n=this.children[s];if(n.visible){var o=n.texture,a=o.frame;e.globalAlpha=this.worldAlpha*n.alpha;if(n.rotation%(2*Math.PI)===0){if(r){e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty);r=!1}e.drawImage(o.baseTexture.source,a.x,a.y,a.width,a.height,n.anchor.x*-a.width*n.scale.x+n.position.x+.5|0,n.anchor.y*-a.height*n.scale.y+n.position.y+.5|0,a.width*n.scale.x,a.height*n.scale.y)}else{r||(r=!0);n.displayObjectUpdateTransform();var h=n.worldTransform;t.roundPixels?e.setTransform(h.a,h.b,h.c,h.d,0|h.tx,0|h.ty):e.setTransform(h.a,h.b,h.c,h.d,h.tx,h.ty);e.drawImage(o.baseTexture.source,a.x,a.y,a.width,a.height,n.anchor.x*-a.width+.5|0,n.anchor.y*-a.height+.5|0,a.width,a.height)}}}}};e.MovieClip=function(t){e.Sprite.call(this,t[0]);this.textures=t;this.animationSpeed=1;this.loop=!0;this.onComplete=null;this.currentFrame=0;this.playing=!1};e.MovieClip.prototype=Object.create(e.Sprite.prototype);e.MovieClip.prototype.constructor=e.MovieClip;Object.defineProperty(e.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}});e.MovieClip.prototype.stop=function(){this.playing=!1};e.MovieClip.prototype.play=function(){this.playing=!0};e.MovieClip.prototype.gotoAndStop=function(t){this.playing=!1;this.currentFrame=t;var e=this.currentFrame+.5|0;this.setTexture(this.textures[e%this.textures.length])};e.MovieClip.prototype.gotoAndPlay=function(t){this.currentFrame=t;this.playing=!0};e.MovieClip.prototype.updateTransform=function(){this.displayObjectContainerUpdateTransform();if(this.playing){this.currentFrame+=this.animationSpeed;var t=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length;if(this.loop||t<this.textures.length)this.setTexture(this.textures[t%this.textures.length]);else if(t>=this.textures.length){this.gotoAndStop(this.textures.length-1);this.onComplete&&this.onComplete()}}};e.MovieClip.fromFrames=function(t){for(var i=[],r=0;r<t.length;r++)i.push(new e.Texture.fromFrame(t[r]));return new e.MovieClip(i)};e.MovieClip.fromImages=function(t){for(var i=[],r=0;r<t.length;r++)i.push(new e.Texture.fromImage(t[r]));return new e.MovieClip(i)};e.FilterBlock=function(){this.visible=!0;this.renderable=!0};e.FilterBlock.prototype.constructor=e.FilterBlock;e.Text=function(t,i){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=1;e.Sprite.call(this,e.Texture.fromCanvas(this.canvas));this.setText(t);this.setStyle(i)};e.Text.prototype=Object.create(e.Sprite.prototype);e.Text.prototype.constructor=e.Text;Object.defineProperty(e.Text.prototype,"width",{get:function(){if(this.dirty){this.updateText();this.dirty=!1}return this._width},set:function(t){this._width=t}});Object.defineProperty(e.Text.prototype,"height",{get:function(){if(this.dirty){this.updateText();this.dirty=!1}return this._height},set:function(t){this._height=t}});e.Text.prototype.setStyle=function(t){t=t||{};t.font=t.font||"bold 20pt Arial";t.fill=t.fill||"black";t.align=t.align||"left";t.stroke=t.stroke||"black";t.strokeThickness=t.strokeThickness||0;t.wordWrap=t.wordWrap||!1;t.wordWrapWidth=t.wordWrapWidth||100;t.dropShadow=t.dropShadow||!1;t.dropShadowAngle=t.dropShadowAngle||Math.PI/6;t.dropShadowDistance=t.dropShadowDistance||4;t.dropShadowColor=t.dropShadowColor||"black";t.lineHeight=t.lineHeight||1.1;this.style=t;this.dirty=!0};e.Text.prototype.setText=function(t){this.text=t.toString()||" ";this.dirty=!0};e.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],r=0,s=this.determineFontProperties(this.style.font),n=0;n<e.length;n++){var o=this.context.measureText(e[n]).width;i[n]=o;r=Math.max(r,o)}var a=r+this.style.strokeThickness;this.style.dropShadow&&(a+=this.style.dropShadowDistance);this.canvas.width=Math.max(this.getSize().width,a)*this.resolution;r=this.canvas.width;var h=this.style.fontSize*this.style.lineHeight+this.style.strokeThickness,l=h*e.length;this.style.dropShadow&&(l+=this.style.dropShadowDistance);this.canvas.height=Math.max(this.getSize().height,l)*this.resolution;this.context.scale(this.resolution,this.resolution);navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.textBaseline="top";var u,c;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var d=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,p=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(n=0;n<e.length;n++){u=this.style.strokeThickness/2;c=this.style.strokeThickness/2+n*h+s.ascent;"right"===this.style.align?u+=r-i[n]:"center"===this.style.align&&(u+=(r-i[n])/2);this.style.fill&&this.context.fillText(e[n],u+d,c+p)}}this.context.fillStyle=this.style.fill;for(n=0;n<e.length;n++){u=this.style.strokeThickness/2;c=this.style.strokeThickness/2+n*h+(h-this.style.fontSize)/2;"right"===this.style.align?u+=r-i[n]:"center"===this.style.align&&(u+=(r-i[n])/2);this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[n],u,c);this.style.fill&&this.context.fillText(e[n],u,c)}this.updateTexture()};e.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.texture.baseTexture.dirty()};e.Text.prototype._renderWebGL=function(t){if(this.dirty){this.resolution=t.resolution;this.updateText();this.dirty=!1}e.Sprite.prototype._renderWebGL.call(this,t)};e.Text.prototype.updateTransform=function(){if(this.dirty){this.updateText();this.dirty=!1}e.Sprite.prototype.updateTransform.call(this)};e.Text.prototype.determineFontProperties=function(t){var i=e.Text.fontPropertiesCache[t];if(!i){i={};var r=e.Text.fontPropertiesCanvas,s=e.Text.fontPropertiesContext;s.font=t;var n=Math.ceil(s.measureText("|Mq").width),o=Math.ceil(s.measureText("M").width),a=2*o;o=o*this.style.lineHeight|0;i.lineHeight=o;r.width=n;r.height=a;s.fillStyle="#f00";s.fillRect(0,0,n,a);s.font=t;s.textBaseline="alphabetic";s.fillStyle="#000";s.fillText("|MÉq",0,o);var h,l,u=s.getImageData(0,0,n,a).data,c=u.length,d=4*n,p=0,f=!1;for(h=0;o>h;h++){for(l=0;d>l;l+=4)if(255!==u[p+l]){f=!0;break}if(f)break;p+=d}i.ascent=o-h;p=c-d;f=!1;for(h=a;h>o;h--){for(l=0;d>l;l+=4)if(255!==u[p+l]){f=!0;break}if(f)break;p-=d}i.descent=h-o;i.descent+=6;i.fontSize=i.ascent+i.descent;e.Text.fontPropertiesCache[t]=i}return i};e.Text.prototype.wordWrap=function(t){for(var e="",i=t.split("\n"),r=0;r<i.length;r++){for(var s=Math.max(this.getSize().width,this.style.wordWrapWidth||0),n=i[r].split(""),o=0;o<n.length;o++){var a=this.context.measureText(n[o]).width,h=a+this.context.measureText(" ").width;if(0===o||h>s){o>0&&(e+="\n");e+=n[o];s=Math.max(this.getSize().width,this.style.wordWrapWidth||0)-a}else{s-=a;e+=""+n[o]}}r<i.length-1&&(e+="\n")}return e};e.Text.prototype.getBounds=function(t){if(this.dirty){this.updateText();this.dirty=!1}return e.Sprite.prototype.getBounds.call(this,t)};e.Text.prototype.destroy=function(t){this.context=null;this.canvas=null;this.texture.destroy(void 0===t?!0:t)};e.Text.fontPropertiesCache={};e.Text.fontPropertiesCanvas=document.createElement("canvas");e.Text.fontPropertiesContext=e.Text.fontPropertiesCanvas.getContext("2d");e.BitmapText=function(t,i){e.DisplayObjectContainer.call(this);this.textWidth=0;this.textHeight=0;this._pool=[];this.setText(t);this.setStyle(i);this.updateText();this.dirty=!1};e.BitmapText.prototype=Object.create(e.DisplayObjectContainer.prototype);e.BitmapText.prototype.constructor=e.BitmapText;e.BitmapText.prototype.setText=function(t){this.text=t||" ";this.dirty=!0};e.BitmapText.prototype.setStyle=function(t){t=t||{};t.align=t.align||"left";this.style=t;var i=t.font.split(" ");this.fontName=i[i.length-1];this.fontSize=i.length>=2?parseInt(i[i.length-2],10):e.BitmapText.fonts[this.fontName].size;this.dirty=!0;this.tint=t.tint};e.BitmapText.prototype.updateText=function(){for(var t=e.BitmapText.fonts[this.fontName],i=new e.Point,r=null,s=[],n=0,o=[],a=0,h=this.fontSize/t.size,l=0;l<this.text.length;l++){var u=this.text.charCodeAt(l);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(l))){o.push(i.x);n=Math.max(n,i.x);a++;i.x=0;i.y+=t.lineHeight;r=null}else{var c=t.chars[u];if(c){r&&c.kerning[r]&&(i.x+=c.kerning[r]);s.push({texture:c.texture,line:a,charCode:u,position:new e.Point(i.x+c.xOffset,i.y+c.yOffset)});i.x+=c.xAdvance;r=u}}}o.push(i.x);n=Math.max(n,i.x);var d=[];for(l=0;a>=l;l++){var p=0;"right"===this.style.align?p=n-o[l]:"center"===this.style.align&&(p=(n-o[l])/2);d.push(p)}var f=this.children.length,g=s.length,m=this.tint||16777215;for(l=0;g>l;l++){var v=f>l?this.children[l]:this._pool.pop();v?v.setTexture(s[l].texture):v=new e.Sprite(s[l].texture);v.position.x=(s[l].position.x+d[s[l].line])*h;v.position.y=s[l].position.y*h;v.scale.x=v.scale.y=h;v.tint=m;v.parent||this.addChild(v)}for(;this.children.length>g;){var x=this.getChildAt(this.children.length-1);this._pool.push(x);this.removeChild(x)}this.textWidth=n*h;this.textHeight=(i.y+t.lineHeight)*h};e.BitmapText.prototype.updateTransform=function(){if(this.dirty){this.updateText();this.dirty=!1}e.DisplayObjectContainer.prototype.updateTransform.call(this)
};e.BitmapText.fonts={};e.InteractionData=function(){this.global=new e.Point;this.target=null;this.originalEvent=null};e.InteractionData.prototype.getLocalPosition=function(t,i){var r=t.worldTransform,s=this.global,n=r.a,o=r.c,a=r.tx,h=r.b,l=r.d,u=r.ty,c=1/(n*l+o*-h);i=i||new e.Point;i.x=l*c*s.x+-o*c*s.y+(u*o-a*l)*c;i.y=n*c*s.y+-h*c*s.x+(-u*n+a*h)*c;return i};e.InteractionData.prototype.constructor=e.InteractionData;e.InteractionManager=function(t){this.stage=t;this.mouse=new e.InteractionData;this.touches={};this.tempPoint=new e.Point;this.mouseoverEnabled=!0;this.pool=[];this.interactiveItems=[];this.interactionDOMElement=null;this.onMouseMove=this.onMouseMove.bind(this);this.onMouseDown=this.onMouseDown.bind(this);this.onMouseOut=this.onMouseOut.bind(this);this.onMouseUp=this.onMouseUp.bind(this);this.onTouchStart=this.onTouchStart.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.last=0;this.currentCursorStyle="inherit";this.mouseOut=!1;this.resolution=1;this._tempPoint=new e.Point};e.InteractionManager.prototype.constructor=e.InteractionManager;e.InteractionManager.prototype.collectInteractiveSprite=function(t,e){for(var i=t.children,r=i.length,s=r-1;s>=0;s--){var n=i[s];if(n._interactive){e.interactiveChildren=!0;n.children.length>0&&this.collectInteractiveSprite(n,n);this.interactiveItems.push(n)}else{n.__iParent=null;n.children.length>0&&this.collectInteractiveSprite(n,e)}}};e.InteractionManager.prototype.setTarget=function(t){this.target=t;this.resolution=t.resolution;null===this.interactionDOMElement&&this.setTargetDomElement(t.view)};e.InteractionManager.prototype.setTargetDomElement=function(t){this.removeEvents();if(window.navigator.msPointerEnabled){t.style["-ms-content-zooming"]="none";t.style["-ms-touch-action"]="none"}this.interactionDOMElement=t;t.addEventListener("mousemove",this.onMouseMove,!0);t.addEventListener("mousedown",this.onMouseDown,!0);t.addEventListener("mouseout",this.onMouseOut,!0);t.addEventListener("touchstart",this.onTouchStart,!0);t.addEventListener("touchend",this.onTouchEnd,!0);t.addEventListener("touchmove",this.onTouchMove,!0);window.addEventListener("mouseup",this.onMouseUp,!0)};e.InteractionManager.prototype.removeEvents=function(){if(this.interactionDOMElement){this.interactionDOMElement.style["-ms-content-zooming"]="";this.interactionDOMElement.style["-ms-touch-action"]="";this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0);this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0);this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0);this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0);this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0);this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0);this.interactionDOMElement=null;window.removeEventListener("mouseup",this.onMouseUp,!0)}};e.InteractionManager.prototype.update=function(){if(this.target){var t=Date.now(),i=t-this.last;i=i*e.INTERACTION_FREQUENCY/1e3;if(!(1>i)){this.last=t;var r=0;this.dirty&&this.rebuildInteractiveGraph();var s=this.interactiveItems.length,n="inherit",o=!1;for(r=0;s>r;r++){var a=this.interactiveItems[r];a.__hit=this.hitTest(a,this.mouse);this.mouse.target=a;if(a.__hit&&!o){a.buttonMode&&(n=a.defaultCursor);a.interactiveChildren||(o=!0);if(!a.__isOver){this.fireListeners(a,"mouseover",this.mouse);!a.__isOver&&a._listeners&&a._listeners.mouseenter&&this.fireListeners(a,"mouseenter",this.mouse);a.__isOver=!0}}else if(a.__isOver){this.fireListeners(a,"mouseout",this.mouse);a.__isOver=!1}}if(this.currentCursorStyle!==n){this.currentCursorStyle=n;this.interactionDOMElement.style.cursor=n}}}};e.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var t=this.interactiveItems.length,e=0;t>e;e++)this.interactiveItems[e].interactiveChildren=!1;this.interactiveItems=[];this.stage.interactive&&this.interactiveItems.push(this.stage);this.collectInteractiveSprite(this.stage,this.stage)};e.InteractionManager.prototype.onMouseMove=function(t){this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=t;var i=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(t.clientX-i.left)*(this.target.width/i.width)/this.resolution;this.mouse.global.y=(t.clientY-i.top)*(this.target.height/i.height)/this.resolution;e.setGlobalPos(this.mouse.global);var r=this.interactiveItems.length,s=this.interactiveItems[0]===this.stage,n=s?0:-1;t.stopPropagation=function(){t.propagationStopped=!0};for(var o=n+1;r>o;o++){var a=this.interactiveItems[o];if(this.hitTest(a,this.mouse)){if(!a.__isOver&&a._listeners&&a._listeners.mouseenter){this.fireListeners(a,"mouseenter",this.mouse);a.__isOver=!0}a._listeners&&a._listeners.mousemove&&this.fireListeners(a,"mousemove",this.mouse);if(t.propagationStopped)break}}s&&this.fireListeners(this.interactiveItems[0],"mousemove",this.mouse)};e.InteractionManager.prototype.onMouseDown=function(t){function i(e){if(e._listeners&&(e._listeners.mousedown||e._listeners.click)){e.__mouseIsDown=!0;e.__hit=this.hitTest(e,this.mouse);if(e.__hit){this.fireListeners(e,"mousedown",this.mouse);e.__isDown=!0;return!t.propagationStopped}}return!0}this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=t;e.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();var r=this.interactiveItems.length,s=this.mouse.originalEvent,n=(2===s.button||3===s.which,this.interactiveItems[0]===this.stage),o=n?0:-1;t.stopPropagation=function(){t.propagationStopped=!0};for(var a,h=o+1;r>h;h++){a=i.call(this,this.interactiveItems[h]);if(!a)break}n&&i.call(this,this.interactiveItems[0])};e.InteractionManager.prototype.onMouseOut=function(t){this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=t;var e=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var i=0;e>i;i++){var r=this.interactiveItems[i];if(r.__isOver){this.mouse.target=r;r.mouseout&&r.mouseout(this.mouse);r.__isOver=!1}}this.mouseOut=!0;this.mouse.global.x=-1e4;this.mouse.global.y=-1e4};e.InteractionManager.prototype.onMouseUp=function(t){function e(e){if(e._listeners&&(e._listeners.mouseup||e._listeners.click||e._listeners.mouseupoutside)){e.__hit=this.hitTest(e,this.mouse);if(e.__hit&&!r){this.fireListeners(e,"mouseup",this.mouse);e.__isDown&&this.fireListeners(e,"click",this.mouse);t.propagationStopped&&(r=!0)}else e.__isDown&&this.fireListeners(e,"mouseupoutside",this.mouse);e.__isDown=!1}}this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=t;var i=this.interactiveItems.length,r=!1,s=this.mouse.originalEvent,n=(2===s.button||3===s.which,this.interactiveItems[0]===this.stage),o=n?0:-1;t.stopPropagation=function(){t.propagationStopped=!0};for(var a=o+1;i>a;a++)e.call(this,this.interactiveItems[a]);if(n){r=!1;e.call(this,this.interactiveItems[0])}};e.InteractionManager.prototype.hitTest=function(t,i){var r=i.global;if(!t.worldVisible||!t.worldAlpha)return!1;t.worldTransform.applyInverse(r,this._tempPoint);var s,n=this._tempPoint.x,o=this._tempPoint.y;i.target=t;if(t.hitArea&&t.hitArea.contains)return t.hitArea.contains(n,o);if(t instanceof e.Sprite){var a,h=t.texture.frame.width,l=t.texture.frame.height,u=-h*t.anchor.x;if(n>u&&u+h>n){a=-l*t.anchor.y;if(o>a&&a+l>o)return!0}}else if(t instanceof e.Graphics){var c=t.graphicsData;for(s=0;s<c.length;s++){var d=c[s];if(d.fill&&d.shape&&d.shape.contains(n,o))return!0}}var p=t.children.length;for(s=0;p>s;s++){var f=t.children[s],g=this.hitTest(f,i);if(g){i.target=t;return!0}}return!1};e.InteractionManager.prototype.onTouchMove=function(t){function i(t){if(t.__touchData&&t.__touchData[a.identifier]){var e=this.hitTest(t,r);if(!e)return!0;this.fireListeners(t,"touchmove",r);if(r.originalEvent.propagationStopped)return!1}return!0}this.dirty&&this.rebuildInteractiveGraph();var r,s=this.interactionDOMElement.getBoundingClientRect(),n=t.changedTouches,o=0;for(o=0;o<n.length;o++){var a=n[o];r=this.touches[a.identifier];r.originalEvent=t;r.global.x=(a.clientX-s.left)*(this.target.width/s.width)/this.resolution;r.global.y=(a.clientY-s.top)*(this.target.height/s.height)/this.resolution;e.setGlobalPos(r.global);if(navigator.isCocoonJS&&!s.left&&!s.top&&!t.target.style.width&&!t.target.style.height){r.global.x=a.clientX;r.global.y=a.clientY}var h=this.interactiveItems[0]===this.stage,l=h?0:-1;r.originalEvent.stopPropagation=function(){r.originalEvent.propagationStopped=!0};for(var u,c=l+1;c<this.interactiveItems.length;c++){u=i.call(this,this.interactiveItems[c]);if(!u)break}h&&i.call(this,this.interactiveItems[0])}};e.InteractionManager.prototype.onTouchStart=function(t){function i(t){t.__touchData=t.__touchData||{};t.__touchData[o.identifier]=a;if(!t._listeners||!(t._listeners.touchstart||t._listeners.tap||t._listeners.touchend))return!0;t.__hit=this.hitTest(t,a);if(t.__hit){this.fireListeners(t,"touchstart",a);t.__isDown=!0;if(a.originalEvent.propagationStopped)return!1}return!0}this.dirty&&this.rebuildInteractiveGraph();var r=this.interactionDOMElement.getBoundingClientRect();e.AUTO_PREVENT_DEFAULT&&t.preventDefault();for(var s=t.changedTouches,n=0;n<s.length;n++){var o=s[n],a=this.pool.pop();a||(a=new e.InteractionData);a.originalEvent=t;this.touches[o.identifier]=a;a.global.x=(o.clientX-r.left)*(this.target.width/r.width)/this.resolution;a.global.y=(o.clientY-r.top)*(this.target.height/r.height)/this.resolution;e.setGlobalPos(a.global);if(navigator.isCocoonJS&&!r.left&&!r.top&&!t.target.style.width&&!t.target.style.height){a.global.x=o.clientX;a.global.y=o.clientY}var h=this.interactiveItems.length,l=this.interactiveItems[0]===this.stage,u=l?0:-1;a.originalEvent.stopPropagation=function(){a.originalEvent.propagationStopped=!0};for(var c,d=u+1;h>d;d++){c=i.call(this,this.interactiveItems[d]);if(!c)break}l&&i.call(this,this.interactiveItems[0])}};e.InteractionManager.prototype.onTouchEnd=function(t){function i(t){if(t.__touchData&&t.__touchData[o.identifier]){if(t._listeners&&(t._listeners.touchend||t._listeners.tap||t._listeners.touchendoutside)){t.__hit=this.hitTest(t,t.__touchData[o.identifier]);if(t.__hit&&!h){this.fireListeners(t,"touchend",a);t.__isDown&&this.fireListeners(t,"tap",a);a.originalEvent.propagationStopped&&(h=!0)}else t.__isDown&&this.fireListeners(t,"touchendoutside",a);t.__isDown=!1}t.__touchData[o.identifier]=null}}this.dirty&&this.rebuildInteractiveGraph();for(var r=this.interactionDOMElement.getBoundingClientRect(),s=t.changedTouches,n=0;n<s.length;n++){var o=s[n],a=this.touches[o.identifier],h=!1;a.global.x=(o.clientX-r.left)*(this.target.width/r.width)/this.resolution;a.global.y=(o.clientY-r.top)*(this.target.height/r.height)/this.resolution;e.setGlobalPos(a.global);if(navigator.isCocoonJS&&!r.left&&!r.top&&!t.target.style.width&&!t.target.style.height){a.global.x=o.clientX;a.global.y=o.clientY}var l=this.interactiveItems.length;a.originalEvent=t||window.event;var u=this.interactiveItems[0]===this.stage,c=u?0:-1;a.originalEvent.stopPropagation=function(){a.originalEvent.propagationStopped=!0};for(var d=c+1;l>d;d++)i.call(this,this.interactiveItems[d]);u&&i.call(this,this.interactiveItems[0]);this.pool.push(a);this.touches[o.identifier]=null}};e.InteractionManager.prototype.fireListeners=function(t,e,i){if(!t.isShieldEvent||!t.isShieldEvent(e)){var r=t&&t._listeners&&t._listeners[e];if(r)for(var s=0,n=r.length;n>s;s++)"function"==typeof r[s]&&r[s](i)}};e.Stage=function(t){e.DisplayObjectContainer.call(this);this.worldTransform=new e.Matrix;this.interactive=!0;this.interactionManager=new e.InteractionManager(this);this.dirty=!0;this.stage=this;this.stage.hitArea=new e.Rectangle(0,0,1e5,1e5);this.setBackgroundColor(t)};e.Stage.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Stage.prototype.constructor=e.Stage;e.Stage.prototype.setInteractionDelegate=function(t){this.interactionManager.setTargetDomElement(t)};e.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform();if(this.dirty){this.dirty=!1;this.interactionManager.dirty=!0}this.interactive&&this.interactionManager.update()};e.Stage.prototype.setBackgroundColor=function(t){this.backgroundColor=t||0;this.backgroundColorSplit=e.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i;this.backgroundColorString="#"+i};e.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};!function(t){for(var e=0,i=["ms","moz","webkit","o"],r=0;r<i.length&&!t.requestAnimationFrame;++r){t.requestAnimationFrame=t[i[r]+"RequestAnimationFrame"];t.cancelAnimationFrame=t[i[r]+"CancelAnimationFrame"]||t[i[r]+"CancelRequestAnimationFrame"]}t.requestAnimationFrame||(t.requestAnimationFrame=function(i){var r=(new Date).getTime(),s=Math.max(0,16-(r-e)),n=t.setTimeout(function(){i(r+s)},s);e=r+s;return n});t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)});t.requestAnimFrame=t.requestAnimationFrame}(this);e.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]};e.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]};"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){return function(t){function e(){for(var r=arguments.length,n=new Array(r);r--;)n[r]=arguments[r];n=s.concat(n);return i.apply(this instanceof e?this:t,n)}var i=this,r=arguments.length-1,s=[];if(r>0){s.length=r;for(;r--;)s[r]=arguments[r+1]}if("function"!=typeof i)throw new TypeError;e.prototype=function n(t){t&&(n.prototype=t);return this instanceof n?void 0:new n}(i.prototype);return e}}());e.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var e=0;e<t.length;e++)try{return new window.ActiveXObject(t[e])}catch(i){}};e.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var t=document.createElement("canvas");t.width=1;t.height=1;var e=t.getContext("2d");e.fillStyle="#000";e.fillRect(0,0,1,1);e.globalCompositeOperation="multiply";e.fillStyle="#fff";e.fillRect(0,0,1,1);return 0===e.getImageData(0,0,1,1).data[0]};e.getNextPowerOfTwo=function(t){if(t>0&&0===(t&t-1))return t;for(var e=1;t>e;)e<<=1;return e};e.isPowerOfTwo=function(t,e){return t>0&&0===(t&t-1)&&e>0&&0===(e&e-1)};e.EventTarget={call:function(t){if(t){t=t.prototype||t;e.EventTarget.mixin(t)}},mixin:function(t){t.listeners=function(t){this._listeners=this._listeners||{};return this._listeners[t]?this._listeners[t].slice():[]};t.emit=t.dispatchEvent=function(t,i){this._listeners=this._listeners||{};if("object"==typeof t){i=t;t=t.type}i&&i.__isEventObject===!0||(i=new e.Event(this,t,i));if(this._listeners&&this._listeners[t]){var r,s=this._listeners[t].slice(0),n=s.length,o=s[0];for(r=0;n>r;o=s[++r])if(!(o.target&&o.target.isShieldEvent&&o.target.isShieldEvent(i))){o.call(this,i);if(i.stoppedImmediate)return this}if(i.stopped)return this}this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,t,i);return this};t.on=t.addEventListener=function(t,e){if(!(t instanceof Array)){this._listeners=this._listeners||{};(this._listeners[t]=this._listeners[t]||[]).push(e);return this}var i=this;t.forEach(function(t){i.addEventListener(t,e)})};t.listen=t.on;t.once=function(t,e){function i(){e.apply(r.off(t,i),arguments)}this._listeners=this._listeners||{};var r=this;i._originalHandler=e;return this.on(t,i)};t.off=t.removeEventListener=function(t,e){if(!(t instanceof Array)){this._listeners=this._listeners||{};if(!this._listeners[t])return this;for(var i=this._listeners[t],r=e?i.length:0;r-->0;)(i[r]===e||i[r]._originalHandler===e)&&i.splice(r,1);0===i.length&&delete this._listeners[t];return this}var s=this;t.forEach(function(t){s.removeEventListener(t,e)})};t.unlisten=t.removeEventListener;t.removeAllListeners=function(t){this._listeners=this._listeners||{};if(!this._listeners[t])return this;delete this._listeners[t];return this};t.removeAllEventListeners=t.removeAllListeners}};e.Event=function(t,e,i){this.__isEventObject=!0;this.stopped=!1;this.stoppedImmediate=!1;this.target=t;this.type=e;this.data=i;for(var r in i)this[r]=i[r];this.content=i;this.timeStamp=Date.now()};e.Event.prototype.stopPropagation=function(){this.stopped=!0};e.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0};e.autoDetectRenderer=function(t,i,r){t||(t=800);i||(i=600);var s=function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(e){return!1}}();if(s){console.log("using webgl");return new e.WebGLRenderer(t,i,r)}console.log("using canvas");return new e.CanvasRenderer(t,i,r)};e.autoDetectRecommendedRenderer=function(t,i,r){t||(t=800);i||(i=600);var s=function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(e){return!1}}(),n=/Android/i.test(navigator.userAgent);if(s&&!n){console.log("using webgl");return new e.WebGLRenderer(t,i,r)}console.log("using canvas");return new e.CanvasRenderer(t,i,r)};e.PolyK={};e.PolyK.Triangulate=function(t){var i=!0,r=t.length>>1;if(3>r)return[];for(var s=[],n=[],o=0;r>o;o++)n.push(o);o=0;for(var a=r;a>3;){var h=n[(o+0)%a],l=n[(o+1)%a],u=n[(o+2)%a],c=t[2*h],d=t[2*h+1],p=t[2*l],f=t[2*l+1],g=t[2*u],m=t[2*u+1],v=!1;if(e.PolyK._convex(c,d,p,f,g,m,i)){v=!0;for(var x=0;a>x;x++){var y=n[x];if(y!==h&&y!==l&&y!==u&&e.PolyK._PointInTriangle(t[2*y],t[2*y+1],c,d,p,f,g,m)){v=!1;break}}}if(v){s.push(h,l,u);n.splice((o+1)%a,1);a--;o=0}else if(o++>3*a){if(!i)return null;s=[];n=[];for(o=0;r>o;o++)n.push(o);o=0;a=r;i=!1}}s.push(n[0],n[1],n[2]);return s};e.PolyK._PointInTriangle=function(t,e,i,r,s,n,o,a){var h=o-i,l=a-r,u=s-i,c=n-r,d=t-i,p=e-r,f=h*h+l*l,g=h*u+l*c,m=h*d+l*p,v=u*u+c*c,x=u*d+c*p,y=1/(f*v-g*g),b=(v*m-g*x)*y,T=(f*x-g*m)*y;return b>=0&&T>=0&&1>b+T};e.PolyK._convex=function(t,e,i,r,s,n,o){return(e-r)*(s-i)+(i-t)*(n-r)>=0===o};e.initDefaultShaders=function(){};e.CompileVertexShader=function(t,i){return e._CompileShader(t,i,t.VERTEX_SHADER)};e.CompileFragmentShader=function(t,i){return e._CompileShader(t,i,t.FRAGMENT_SHADER)};e._CompileShader=function(t,e,i){var r=e.join("\n"),s=t.createShader(i);t.shaderSource(s,r);t.compileShader(s);if(!t.getShaderParameter(s,t.COMPILE_STATUS)){window.console.log(t.getShaderInfoLog(s));return null}return s};e.compileProgram=function(t,i,r){var s=e.CompileFragmentShader(t,r),n=e.CompileVertexShader(t,i),o=t.createProgram();t.attachShader(o,n);t.attachShader(o,s);t.linkProgram(o);t.getProgramParameter(o,t.LINK_STATUS)||window.console.log("Could not initialise shaders");return o};e.PixiShader=function(t){this._UID=e._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.firstRun=!0;this.dirty=!0;this.attributes=[];this.init()};e.PixiShader.prototype.constructor=e.PixiShader;e.PixiShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc||e.PixiShader.defaultVertexSrc,this.fragmentSrc);t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.dimensions=t.getUniformLocation(i,"dimensions");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.colorAttribute=t.getAttribLocation(i,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(i,r);this.initUniforms();this.program=i};e.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var i in this.uniforms){t=this.uniforms[i];var r=t.type;if("sampler2D"===r){t._init=!1;null!==t.value&&this.initSampler2D(t)}else if("mat2"===r||"mat3"===r||"mat4"===r){t.glMatrix=!0;t.glValueLength=1;"mat2"===r?t.glFunc=e.uniformMatrix2fv:"mat3"===r?t.glFunc=e.uniformMatrix3fv:"mat4"===r&&(t.glFunc=e.uniformMatrix4fv)}else{t.glFunc=e["uniform"+r];t.glValueLength="2f"===r||"2i"===r?2:"3f"===r||"3i"===r?3:"4f"===r||"4i"===r?4:1}}};e.PixiShader.prototype.initSampler2D=function(t){if(t.value&&t.value.baseTexture&&t.value.baseTexture.hasLoaded){var e=this.gl;e.activeTexture(e["TEXTURE"+this.textureCount]);e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]);if(t.textureData){var i=t.textureData,r=i.magFilter?i.magFilter:e.LINEAR,s=i.minFilter?i.minFilter:e.LINEAR,n=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE,o=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE,a=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat){n=e.REPEAT;o=e.REPEAT}e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY);if(i.width){var h=i.width?i.width:512,l=i.height?i.height:2,u=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,a,h,l,u,a,e.UNSIGNED_BYTE,null)}else e.texImage2D(e.TEXTURE_2D,0,a,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,o)}e.uniform1i(t.uniformLocation,this.textureCount);t._init=!0;this.textureCount++}};e.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var t,i=this.gl;for(var r in this.uniforms){t=this.uniforms[r];if(1===t.glValueLength)t.glMatrix===!0?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value);else if(2===t.glValueLength)t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y);else if(3===t.glValueLength)t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z);else if(4===t.glValueLength)t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w);else if("sampler2D"===t.type)if(t._init){i.activeTexture(i["TEXTURE"+this.textureCount]);t.value.baseTexture._dirty[i.id]?e.instances[i.id].updateTexture(t.value.baseTexture):i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]);i.uniform1i(t.uniformLocation,this.textureCount);this.textureCount++}else this.initSampler2D(t)}};e.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};e.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];e.PixiFastShader=function(t){this._UID=e._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};e.PixiFastShader.prototype.constructor=e.PixiFastShader;e.PixiFastShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.dimensions=t.getUniformLocation(i,"dimensions");this.uMatrix=t.getUniformLocation(i,"uMatrix");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aPositionCoord=t.getAttribLocation(i,"aPositionCoord");this.aScale=t.getAttribLocation(i,"aScale");this.aRotation=t.getAttribLocation(i,"aRotation");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.colorAttribute=t.getAttribLocation(i,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=i};e.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};e.StripShader=function(t){this._UID=e._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};e.StripShader.prototype.constructor=e.StripShader;e.StripShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.colorAttribute=t.getAttribLocation(i,"aColor");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i};e.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};e.PrimitiveShader=function(t){this._UID=e._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};e.PrimitiveShader.prototype.constructor=e.PrimitiveShader;e.PrimitiveShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.tintColor=t.getUniformLocation(i,"tint");this.flipY=t.getUniformLocation(i,"flipY");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.colorAttribute=t.getAttribLocation(i,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i};e.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};e.ComplexPrimitiveShader=function(t){this._UID=e._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};e.ComplexPrimitiveShader.prototype.constructor=e.ComplexPrimitiveShader;e.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.tintColor=t.getUniformLocation(i,"tint");this.color=t.getUniformLocation(i,"color");this.flipY=t.getUniformLocation(i,"flipY");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i};e.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};e.WebGLGraphics=function(){};e.WebGLGraphics.renderGraphics=function(t,i){var r,s=i.gl,n=i.projection,o=i.offset,a=i.shaderManager.primitiveShader;t.dirty&&e.WebGLGraphics.updateGraphics(t,s);for(var h=t._webGL[s.id],l=0;l<h.data.length;l++)if(1===h.data[l].mode){r=h.data[l];i.stencilManager.pushStencil(t,r,i);s.drawElements(s.TRIANGLE_FAN,4,s.UNSIGNED_SHORT,2*(r.indices.length-4));i.stencilManager.popStencil(t,r,i)}else{r=h.data[l];i.shaderManager.setShader(a);a=i.shaderManager.primitiveShader;s.uniformMatrix3fv(a.translationMatrix,!1,t.worldTransform.toArray(!0));s.uniform1f(a.flipY,1);s.uniform2f(a.projectionVector,n.x,-n.y);s.uniform2f(a.offsetVector,-o.x,-o.y);s.uniform3fv(a.tintColor,e.hex2rgb(t.tint));s.uniform1f(a.alpha,t.worldAlpha);s.bindBuffer(s.ARRAY_BUFFER,r.buffer);s.vertexAttribPointer(a.aVertexPosition,2,s.FLOAT,!1,24,0);s.vertexAttribPointer(a.colorAttribute,4,s.FLOAT,!1,24,8);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.indexBuffer);s.drawElements(s.TRIANGLE_STRIP,r.indices.length,s.UNSIGNED_SHORT,0)}};e.WebGLGraphics.updateGraphics=function(t,i){var r=t._webGL[i.id];r||(r=t._webGL[i.id]={lastIndex:0,data:[],gl:i});t.dirty=!1;var s;if(t.clearDirty){t.clearDirty=!1;for(s=0;s<r.data.length;s++){var n=r.data[s];n.reset();e.WebGLGraphics.graphicsDataPool.push(n)}r.data=[];r.lastIndex=0}var o;for(s=r.lastIndex;s<t.graphicsData.length;s++){var a=t.graphicsData[s];if(a.type===e.Graphics.POLY){a.points=a.shape.points.slice();a.shape.closed&&(a.points[0]!==a.points[a.points.length-2]||a.points[1]!==a.points[a.points.length-1])&&a.points.push(a.points[0],a.points[1]);if(a.fill&&a.points.length>=6)if(a.points.length<12){o=e.WebGLGraphics.switchMode(r,0);var h=e.WebGLGraphics.buildPoly(a,o);if(!h){o=e.WebGLGraphics.switchMode(r,1);e.WebGLGraphics.buildComplexPoly(a,o)}}else{o=e.WebGLGraphics.switchMode(r,1);
e.WebGLGraphics.buildComplexPoly(a,o)}if(a.lineWidth>0){o=e.WebGLGraphics.switchMode(r,0);e.WebGLGraphics.buildLine(a,o)}}else{o=e.WebGLGraphics.switchMode(r,0);a.type===e.Graphics.RECT?e.WebGLGraphics.buildRectangle(a,o):a.type===e.Graphics.CIRC||a.type===e.Graphics.ELIP?e.WebGLGraphics.buildCircle(a,o):a.type===e.Graphics.RREC&&e.WebGLGraphics.buildRoundedRectangle(a,o)}r.lastIndex++}for(s=0;s<r.data.length;s++){o=r.data[s];o.dirty&&o.upload()}};e.WebGLGraphics.switchMode=function(t,i){var r;if(t.data.length){r=t.data[t.data.length-1];if(r.mode!==i||1===i){r=e.WebGLGraphics.graphicsDataPool.pop()||new e.WebGLGraphicsData(t.gl);r.mode=i;t.data.push(r)}}else{r=e.WebGLGraphics.graphicsDataPool.pop()||new e.WebGLGraphicsData(t.gl);r.mode=i;t.data.push(r)}r.dirty=!0;return r};e.WebGLGraphics.buildRectangle=function(t,i){var r=t.shape,s=r.x,n=r.y,o=r.width,a=r.height;if(t.fill){var h=e.hex2rgb(t.fillColor),l=t.fillAlpha,u=h[0]*l,c=h[1]*l,d=h[2]*l,p=i.points,f=i.indices,g=p.length/6;p.push(s,n);p.push(u,c,d,l);p.push(s+o,n);p.push(u,c,d,l);p.push(s,n+a);p.push(u,c,d,l);p.push(s+o,n+a);p.push(u,c,d,l);f.push(g,g,g+1,g+2,g+3,g+3)}if(t.lineWidth){var m=t.points;t.points=[s,n,s+o,n,s+o,n+a,s,n+a,s,n];e.WebGLGraphics.buildLine(t,i);t.points=m}};e.WebGLGraphics.buildRoundedRectangle=function(t,i){var r=t.shape,s=r.x,n=r.y,o=r.width,a=r.height,h=r.radius,l=[];l.push(s,n+h);l=l.concat(e.WebGLGraphics.quadraticBezierCurve(s,n+a-h,s,n+a,s+h,n+a));l=l.concat(e.WebGLGraphics.quadraticBezierCurve(s+o-h,n+a,s+o,n+a,s+o,n+a-h));l=l.concat(e.WebGLGraphics.quadraticBezierCurve(s+o,n+h,s+o,n,s+o-h,n));l=l.concat(e.WebGLGraphics.quadraticBezierCurve(s+h,n,s,n,s,n+h));if(t.fill){var u=e.hex2rgb(t.fillColor),c=t.fillAlpha,d=u[0]*c,p=u[1]*c,f=u[2]*c,g=i.points,m=i.indices,v=g.length/6,x=e.PolyK.Triangulate(l),y=0;for(y=0;y<x.length;y+=3){m.push(x[y]+v);m.push(x[y]+v);m.push(x[y+1]+v);m.push(x[y+2]+v);m.push(x[y+2]+v)}for(y=0;y<l.length;y++)g.push(l[y],l[++y],d,p,f,c)}if(t.lineWidth){var b=t.points;t.points=l;e.WebGLGraphics.buildLine(t,i);t.points=b}};e.WebGLGraphics.quadraticBezierCurve=function(t,e,i,r,s,n){function o(t,e,i){var r=e-t;return t+r*i}for(var a,h,l,u,c,d,p=20,f=[],g=0,m=0;p>=m;m++){g=m/p;a=o(t,i,g);h=o(e,r,g);l=o(i,s,g);u=o(r,n,g);c=o(a,l,g);d=o(h,u,g);f.push(c,d)}return f};e.WebGLGraphics.buildCircle=function(t,i){var r,s,n=t.shape,o=n.x,a=n.y;if(t.type===e.Graphics.CIRC){r=n.radius;s=n.radius}else{r=n.width;s=n.height}var h=40,l=2*Math.PI/h,u=0;if(t.fill){var c=e.hex2rgb(t.fillColor),d=t.fillAlpha,p=c[0]*d,f=c[1]*d,g=c[2]*d,m=i.points,v=i.indices,x=m.length/6;v.push(x);for(u=0;h+1>u;u++){m.push(o,a,p,f,g,d);m.push(o+Math.sin(l*u)*r,a+Math.cos(l*u)*s,p,f,g,d);v.push(x++,x++)}v.push(x-1)}if(t.lineWidth){var y=t.points;t.points=[];for(u=0;h+1>u;u++)t.points.push(o+Math.sin(l*u)*r,a+Math.cos(l*u)*s);e.WebGLGraphics.buildLine(t,i);t.points=y}};e.WebGLGraphics.buildLine=function(t,i){var r=0,s=t.points;if(0!==s.length){if(t.lineWidth%2)for(r=0;r<s.length;r++)s[r]+=.5;var n=new e.Point(s[0],s[1]),o=new e.Point(s[s.length-2],s[s.length-1]);if(n.x===o.x&&n.y===o.y){s=s.slice();s.pop();s.pop();o=new e.Point(s[s.length-2],s[s.length-1]);var a=o.x+.5*(n.x-o.x),h=o.y+.5*(n.y-o.y);s.unshift(a,h);s.push(a,h)}var l,u,c,d,p,f,g,m,v,x,y,b,T,S,w,C,A,_,E,M,R,L,F,B=i.points,P=i.indices,D=s.length/2,I=s.length,O=B.length/6,G=t.lineWidth/2,U=e.hex2rgb(t.lineColor),k=t.lineAlpha,N=U[0]*k,j=U[1]*k,W=U[2]*k;c=s[0];d=s[1];p=s[2];f=s[3];v=-(d-f);x=c-p;F=Math.sqrt(v*v+x*x);v/=F;x/=F;v*=G;x*=G;B.push(c-v,d-x,N,j,W,k);B.push(c+v,d+x,N,j,W,k);for(r=1;D-1>r;r++){c=s[2*(r-1)];d=s[2*(r-1)+1];p=s[2*r];f=s[2*r+1];g=s[2*(r+1)];m=s[2*(r+1)+1];v=-(d-f);x=c-p;F=Math.sqrt(v*v+x*x);v/=F;x/=F;v*=G;x*=G;y=-(f-m);b=p-g;F=Math.sqrt(y*y+b*b);y/=F;b/=F;y*=G;b*=G;w=-x+d-(-x+f);C=-v+p-(-v+c);A=(-v+c)*(-x+f)-(-v+p)*(-x+d);_=-b+m-(-b+f);E=-y+p-(-y+g);M=(-y+g)*(-b+f)-(-y+p)*(-b+m);R=w*E-_*C;if(Math.abs(R)<.1){R+=10.1;B.push(p-v,f-x,N,j,W,k);B.push(p+v,f+x,N,j,W,k)}else{l=(C*M-E*A)/R;u=(_*A-w*M)/R;L=(l-p)*(l-p)+(u-f)+(u-f);if(L>19600){T=v-y;S=x-b;F=Math.sqrt(T*T+S*S);T/=F;S/=F;T*=G;S*=G;B.push(p-T,f-S);B.push(N,j,W,k);B.push(p+T,f+S);B.push(N,j,W,k);B.push(p-T,f-S);B.push(N,j,W,k);I++}else{B.push(l,u);B.push(N,j,W,k);B.push(p-(l-p),f-(u-f));B.push(N,j,W,k)}}}c=s[2*(D-2)];d=s[2*(D-2)+1];p=s[2*(D-1)];f=s[2*(D-1)+1];v=-(d-f);x=c-p;F=Math.sqrt(v*v+x*x);v/=F;x/=F;v*=G;x*=G;B.push(p-v,f-x);B.push(N,j,W,k);B.push(p+v,f+x);B.push(N,j,W,k);P.push(O);for(r=0;I>r;r++)P.push(O++);P.push(O-1)}};e.WebGLGraphics.buildComplexPoly=function(t,i){var r=t.points.slice();if(!(r.length<6)){var s=i.indices;i.points=r;i.alpha=t.fillAlpha;i.color=e.hex2rgb(t.fillColor);for(var n,o,a=1/0,h=-1/0,l=1/0,u=-1/0,c=0;c<r.length;c+=2){n=r[c];o=r[c+1];a=a>n?n:a;h=n>h?n:h;l=l>o?o:l;u=o>u?o:u}r.push(a,l,h,l,h,u,a,u);var d=r.length/2;for(c=0;d>c;c++)s.push(c)}};e.WebGLGraphics.buildPoly=function(t,i){var r=t.points;if(!(r.length<6)){var s=i.points,n=i.indices,o=r.length/2,a=e.hex2rgb(t.fillColor),h=t.fillAlpha,l=a[0]*h,u=a[1]*h,c=a[2]*h,d=e.PolyK.Triangulate(r);if(!d)return!1;var p=s.length/6,f=0;for(f=0;f<d.length;f+=3){n.push(d[f]+p);n.push(d[f]+p);n.push(d[f+1]+p);n.push(d[f+2]+p);n.push(d[f+2]+p)}for(f=0;o>f;f++)s.push(r[2*f],r[2*f+1],l,u,c,h);return!0}};e.WebGLGraphics.graphicsDataPool=[];e.WebGLGraphicsData=function(t){this.gl=t;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.mode=1;this.alpha=1;this.dirty=!0};e.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};e.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new e.Float32Array(this.points);t.bindBuffer(t.ARRAY_BUFFER,this.buffer);t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW);this.glIndicies=new e.Uint16Array(this.indices);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW);this.dirty=!1};e.glContexts=[];e.instances=[];e.WebGLRenderer=function(t,i,r){if(r)for(var s in e.defaultRenderOptions)"undefined"==typeof r[s]&&(r[s]=e.defaultRenderOptions[s]);else r=e.defaultRenderOptions;if(!e.defaultRenderer){e.sayHello("webGL");e.defaultRenderer=this}this.type=e.WEBGL_RENDERER;this.resolution=r.resolution;this.transparent=r.transparent;this.autoResize=r.autoResize||!1;this.preserveDrawingBuffer=r.preserveDrawingBuffer;this.clearBeforeRender=r.clearBeforeRender;this.width=t||800;this.height=i||600;this.view=r.view||document.createElement("canvas");this.contextLostBound=this.handleContextLost.bind(this);this.contextRestoredBound=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLostBound,!1);this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1);this._contextOptions={alpha:this.transparent,antialias:r.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:r.preserveDrawingBuffer};this.projection=new e.Point;this.offset=new e.Point(0,0);this.shaderManager=new e.WebGLShaderManager;this.spriteBatch=new e.WebGLSpriteBatch;this.maskManager=new e.WebGLMaskManager;this.filterManager=new e.WebGLFilterManager;this.stencilManager=new e.WebGLStencilManager;this.blendModeManager=new e.WebGLBlendModeManager;this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.initContext();this.mapBlendModes()};e.WebGLRenderer.prototype.constructor=e.WebGLRenderer;e.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=t;if(!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=t.id=e.WebGLRenderer.glContextId++;e.glContexts[this.glContextId]=t;e.instances[this.glContextId]=this;t.disable(t.DEPTH_TEST);t.disable(t.CULL_FACE);t.enable(t.BLEND);this.shaderManager.setContext(t);this.spriteBatch.setContext(t);this.maskManager.setContext(t);this.filterManager.setContext(t);this.blendModeManager.setContext(t);this.stencilManager.setContext(t);this.renderSession.gl=this.gl;this.resize(this.width,this.height)};e.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){if(this.__stage!==t){t.interactive&&t.interactionManager.removeEvents();this.__stage=t}t.updateTransform();var e=this.gl;if(t._interactive){if(!t._interactiveEventsAdded){t._interactiveEventsAdded=!0;t.interactionManager.setTarget(this)}}else if(t._interactiveEventsAdded){t._interactiveEventsAdded=!1;t.interactionManager.setTarget(this)}e.viewport(0,0,this.width,this.height);e.bindFramebuffer(e.FRAMEBUFFER,null);if(this.clearBeforeRender){this.transparent?e.clearColor(0,0,0,0):e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1);e.clear(e.COLOR_BUFFER_BIT)}this.renderDisplayObject(t,this.projection)}};e.WebGLRenderer.prototype.renderDisplayObject=function(t,i,r){this.renderSession.blendModeManager.setBlendMode(e.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=r?-1:1;this.renderSession.projection=i;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,r);t._renderWebGL(this.renderSession);this.spriteBatch.end()};e.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution;this.height=e*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};e.WebGLRenderer.prototype.updateTexture=function(t){if(t.hasLoaded){var i=this.gl;t._glTextures[i.id]||(t._glTextures[i.id]=i.createTexture());i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]);i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST);if(t.mipmap&&e.isPowerOfTwo(t.width,t.height)){i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);i.generateMipmap(i.TEXTURE_2D)}else i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST);if(t._powerOf2){i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)}else{i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)}t._dirty[i.id]=!1;return t._glTextures[i.id]}};e.WebGLRenderer.prototype.handleContextLost=function(t){t.preventDefault();this.contextLost=!0};e.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var t in e.TextureCache){var i=e.TextureCache[t].baseTexture;i._glTextures=[]}this.contextLost=!1};e.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound);this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound);e.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null};e.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;if(!e.blendModesWebGL){e.blendModesWebGL=[];e.blendModesWebGL[e.blendModes.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.ADD]=[t.SRC_ALPHA,t.DST_ALPHA];e.blendModesWebGL[e.blendModes.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.SCREEN]=[t.SRC_ALPHA,t.ONE];e.blendModesWebGL[e.blendModes.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA]}};e.WebGLRenderer.glContextId=0;e.WebGLBlendModeManager=function(){this.currentBlendMode=99999};e.WebGLBlendModeManager.prototype.constructor=e.WebGLBlendModeManager;e.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t};e.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var i=e.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(i[0],i[1]);return!0};e.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};e.WebGLMaskManager=function(){};e.WebGLMaskManager.prototype.constructor=e.WebGLMaskManager;e.WebGLMaskManager.prototype.setContext=function(t){this.gl=t};e.WebGLMaskManager.prototype.pushMask=function(t,i){var r=i.gl;t.dirty&&e.WebGLGraphics.updateGraphics(t,r);t._webGL[r.id].data.length&&i.stencilManager.pushStencil(t,t._webGL[r.id].data[0],i)};e.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)};e.WebGLMaskManager.prototype.destroy=function(){this.gl=null};e.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=!0;this.count=0};e.WebGLStencilManager.prototype.setContext=function(t){this.gl=t};e.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var r=this.gl;this.bindGraphics(t,e,i);if(0===this.stencilStack.length){r.enable(r.STENCIL_TEST);r.clear(r.STENCIL_BUFFER_BIT);this.reverse=!0;this.count=0}this.stencilStack.push(e);var s=this.count;r.colorMask(!1,!1,!1,!1);r.stencilFunc(r.ALWAYS,0,255);r.stencilOp(r.KEEP,r.KEEP,r.INVERT);if(1===e.mode){r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0);if(this.reverse){r.stencilFunc(r.EQUAL,255-s,255);r.stencilOp(r.KEEP,r.KEEP,r.DECR)}else{r.stencilFunc(r.EQUAL,s,255);r.stencilOp(r.KEEP,r.KEEP,r.INCR)}r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4));this.reverse?r.stencilFunc(r.EQUAL,255-(s+1),255):r.stencilFunc(r.EQUAL,s+1,255);this.reverse=!this.reverse}else{if(this.reverse){r.stencilFunc(r.EQUAL,s,255);r.stencilOp(r.KEEP,r.KEEP,r.INCR)}else{r.stencilFunc(r.EQUAL,255-s,255);r.stencilOp(r.KEEP,r.KEEP,r.DECR)}r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0);this.reverse?r.stencilFunc(r.EQUAL,s+1,255):r.stencilFunc(r.EQUAL,255-(s+1),255)}r.colorMask(!0,!0,!0,!0);r.stencilOp(r.KEEP,r.KEEP,r.KEEP);this.count++};e.WebGLStencilManager.prototype.bindGraphics=function(t,i,r){this._currentGraphics=t;var s,n=this.gl,o=r.projection,a=r.offset;if(1===i.mode){s=r.shaderManager.complexPrimitiveShader;r.shaderManager.setShader(s);n.uniform1f(s.flipY,r.flipY);n.uniformMatrix3fv(s.translationMatrix,!1,t.worldTransform.toArray(!0));n.uniform2f(s.projectionVector,o.x,-o.y);n.uniform2f(s.offsetVector,-a.x,-a.y);n.uniform3fv(s.tintColor,e.hex2rgb(t.tint));n.uniform3fv(s.color,i.color);n.uniform1f(s.alpha,t.worldAlpha*i.alpha);n.bindBuffer(n.ARRAY_BUFFER,i.buffer);n.vertexAttribPointer(s.aVertexPosition,2,n.FLOAT,!1,8,0);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.indexBuffer)}else{s=r.shaderManager.primitiveShader;r.shaderManager.setShader(s);n.uniformMatrix3fv(s.translationMatrix,!1,t.worldTransform.toArray(!0));n.uniform1f(s.flipY,r.flipY);n.uniform2f(s.projectionVector,o.x,-o.y);n.uniform2f(s.offsetVector,-a.x,-a.y);n.uniform3fv(s.tintColor,e.hex2rgb(t.tint));n.uniform1f(s.alpha,t.worldAlpha);n.bindBuffer(n.ARRAY_BUFFER,i.buffer);n.vertexAttribPointer(s.aVertexPosition,2,n.FLOAT,!1,24,0);n.vertexAttribPointer(s.colorAttribute,4,n.FLOAT,!1,24,8);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.indexBuffer)}};e.WebGLStencilManager.prototype.popStencil=function(t,e,i){var r=this.gl;this.stencilStack.pop();this.count--;if(0===this.stencilStack.length)r.disable(r.STENCIL_TEST);else{var s=this.count;this.bindGraphics(t,e,i);r.colorMask(!1,!1,!1,!1);if(1===e.mode){this.reverse=!this.reverse;if(this.reverse){r.stencilFunc(r.EQUAL,255-(s+1),255);r.stencilOp(r.KEEP,r.KEEP,r.INCR)}else{r.stencilFunc(r.EQUAL,s+1,255);r.stencilOp(r.KEEP,r.KEEP,r.DECR)}r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4));r.stencilFunc(r.ALWAYS,0,255);r.stencilOp(r.KEEP,r.KEEP,r.INVERT);r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0);this.reverse?r.stencilFunc(r.EQUAL,s,255):r.stencilFunc(r.EQUAL,255-s,255)}else{if(this.reverse){r.stencilFunc(r.EQUAL,s+1,255);r.stencilOp(r.KEEP,r.KEEP,r.DECR)}else{r.stencilFunc(r.EQUAL,255-(s+1),255);r.stencilOp(r.KEEP,r.KEEP,r.INCR)}r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0);this.reverse?r.stencilFunc(r.EQUAL,s,255):r.stencilFunc(r.EQUAL,255-s,255)}r.colorMask(!0,!0,!0,!0);r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}};e.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null};e.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]};e.WebGLShaderManager.prototype.constructor=e.WebGLShaderManager;e.WebGLShaderManager.prototype.setContext=function(t){this.gl=t;this.primitiveShader=new e.PrimitiveShader(t);this.complexPrimitiveShader=new e.ComplexPrimitiveShader(t);this.defaultShader=new e.PixiShader(t);this.fastShader=new e.PixiFastShader(t);this.stripShader=new e.StripShader(t);this.setShader(this.defaultShader)};e.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=!0}var r=this.gl;for(e=0;e<this.attribState.length;e++)if(this.attribState[e]!==this.tempAttribState[e]){this.attribState[e]=this.tempAttribState[e];this.tempAttribState[e]?r.enableVertexAttribArray(e):r.disableVertexAttribArray(e)}};e.WebGLShaderManager.prototype.setShader=function(t){if(this._currentId===t._UID)return!1;this._currentId=t._UID;this.currentShader=t;this.gl.useProgram(t.program);this.setAttribs(t.attributes);return!0};e.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};e.WebGLSpriteBatch=function(){this.vertSize=5;this.size=2e3;var t=4*this.size*4*this.vertSize,i=6*this.size;this.vertices=new e.ArrayBuffer(t);this.positions=new e.Float32Array(this.vertices);this.colors=new e.Uint32Array(this.vertices);this.indices=new e.Uint16Array(i);this.lastIndexCount=0;for(var r=0,s=0;i>r;r+=6,s+=4){this.indices[r+0]=s+0;this.indices[r+1]=s+1;this.indices[r+2]=s+2;this.indices[r+3]=s+0;this.indices[r+4]=s+2;this.indices[r+5]=s+3}this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=!0;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=new e.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])};e.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t;this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW);this.currentBlendMode=99999;var i=new e.PixiShader(t);i.fragmentSrc=this.defaultShader.fragmentSrc;i.uniforms={};i.init();this.defaultShader.shaders[t.id]=i};e.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};e.WebGLSpriteBatch.prototype.end=function(){this.flush()};e.WebGLSpriteBatch.prototype.render=function(t){var e=t.texture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=e.baseTexture}var i=e._uvs;if(i){var r,s,n,o,a=t.anchor.x,h=t.anchor.y;if(e.trim){var l=e.trim;s=l.x-a*l.width;r=s+e.crop.width;o=l.y-h*l.height;n=o+e.crop.height}else{r=e.frame.width*(1-a);s=e.frame.width*-a;n=e.frame.height*(1-h);o=e.frame.height*-h}var u=4*this.currentBatchSize*this.vertSize,c=e.baseTexture.resolution,d=t.worldTransform,p=d.a/c,f=d.b/c,g=d.c/c,m=d.d/c,v=d.tx,x=d.ty,y=this.colors,b=this.positions;if(this.renderSession.roundPixels){b[u]=p*s+g*o+v|0;b[u+1]=m*o+f*s+x|0;b[u+5]=p*r+g*o+v|0;b[u+6]=m*o+f*r+x|0;b[u+10]=p*r+g*n+v|0;b[u+11]=m*n+f*r+x|0;b[u+15]=p*s+g*n+v|0;b[u+16]=m*n+f*s+x|0}else{b[u]=p*s+g*o+v;b[u+1]=m*o+f*s+x;b[u+5]=p*r+g*o+v;b[u+6]=m*o+f*r+x;b[u+10]=p*r+g*n+v;b[u+11]=m*n+f*r+x;b[u+15]=p*s+g*n+v;b[u+16]=m*n+f*s+x}b[u+2]=i.x0;b[u+3]=i.y0;b[u+7]=i.x1;b[u+8]=i.y1;b[u+12]=i.x2;b[u+13]=i.y2;b[u+17]=i.x3;b[u+18]=i.y3;var T=t.tint;y[u+4]=y[u+9]=y[u+14]=y[u+19]=(T>>16)+(65280&T)+((255&T)<<16)+(255*t.worldAlpha<<24);this.sprites[this.currentBatchSize++]=t}};e.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var i=t.tilingTexture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=i.baseTexture}t._uvs||(t._uvs=new e.TextureUvs);var r=t._uvs;t.tilePosition.x%=i.baseTexture.width*t.tileScaleOffset.x;t.tilePosition.y%=i.baseTexture.height*t.tileScaleOffset.y;var s=t.tilePosition.x/(i.baseTexture.width*t.tileScaleOffset.x),n=t.tilePosition.y/(i.baseTexture.height*t.tileScaleOffset.y),o=t.width/i.baseTexture.width/(t.tileScale.x*t.tileScaleOffset.x),a=t.height/i.baseTexture.height/(t.tileScale.y*t.tileScaleOffset.y);r.x0=0-s;r.y0=0-n;r.x1=1*o-s;r.y1=0-n;r.x2=1*o-s;r.y2=1*a-n;r.x3=0-s;r.y3=1*a-n;var h=t.tint,l=(h>>16)+(65280&h)+((255&h)<<16)+(255*t.alpha<<24),u=this.positions,c=this.colors,d=t.width,p=t.height,f=t.anchor.x,g=t.anchor.y,m=d*(1-f),v=d*-f,x=p*(1-g),y=p*-g,b=4*this.currentBatchSize*this.vertSize,T=i.baseTexture.resolution,S=t.worldTransform,w=S.a/T,C=S.b/T,A=S.c/T,_=S.d/T,E=S.tx,M=S.ty;u[b++]=w*v+A*y+E;u[b++]=_*y+C*v+M;u[b++]=r.x0;u[b++]=r.y0;c[b++]=l;u[b++]=w*m+A*y+E;u[b++]=_*y+C*m+M;u[b++]=r.x1;u[b++]=r.y1;c[b++]=l;u[b++]=w*m+A*x+E;u[b++]=_*x+C*m+M;u[b++]=r.x2;u[b++]=r.y2;c[b++]=l;u[b++]=w*v+A*x+E;u[b++]=_*x+C*v+M;u[b++]=r.x3;u[b++]=r.y3;c[b++]=l;this.sprites[this.currentBatchSize++]=t};e.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t,i=this.gl;if(this.dirty){this.dirty=!1;i.activeTexture(i.TEXTURE0);i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t=this.defaultShader.shaders[i.id];var r=4*this.vertSize;i.vertexAttribPointer(t.aVertexPosition,2,i.FLOAT,!1,r,0);i.vertexAttribPointer(t.aTextureCoord,2,i.FLOAT,!1,r,8);i.vertexAttribPointer(t.colorAttribute,4,i.UNSIGNED_BYTE,!0,r,16)}if(this.currentBatchSize>.5*this.size)i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices);else{var s=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);i.bufferSubData(i.ARRAY_BUFFER,0,s)}for(var n,o,a,h,l=0,u=0,c=null,d=this.renderSession.blendModeManager.currentBlendMode,p=null,f=!1,g=!1,m=0,v=this.currentBatchSize;v>m;m++){h=this.sprites[m];n=h.texture.baseTexture;o=h.blendMode;a=h.shader||this.defaultShader;f=d!==o;g=p!==a;if(c!==n||f||g){this.renderBatch(c,l,u);u=m;l=0;c=n;if(f){d=o;this.renderSession.blendModeManager.setBlendMode(d)}if(g){p=a;t=p.shaders[i.id];if(!t){t=new e.PixiShader(i);t.fragmentSrc=p.fragmentSrc;t.uniforms=p.uniforms;t.init();p.shaders[i.id]=t}this.renderSession.shaderManager.setShader(t);t.dirty&&t.syncUniforms();var x=this.renderSession.projection;i.uniform2f(t.projectionVector,x.x,x.y);var y=this.renderSession.offset;i.uniform2f(t.offsetVector,y.x,y.y)}}l++}this.renderBatch(c,l,u);this.currentBatchSize=0}};e.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var r=this.gl;t._dirty[r.id]?this.renderSession.renderer.updateTexture(t):r.bindTexture(r.TEXTURE_2D,t._glTextures[r.id]);r.drawElements(r.TRIANGLES,6*e,r.UNSIGNED_SHORT,6*i*2);this.renderSession.drawCount++}};e.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=!0};e.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0};e.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};e.WebGLFastSpriteBatch=function(t){this.vertSize=10;this.maxSize=6e3;this.size=this.maxSize;var i=4*this.size*this.vertSize,r=6*this.maxSize;this.vertices=new e.Float32Array(i);this.indices=new e.Uint16Array(r);this.vertexBuffer=null;this.indexBuffer=null;this.lastIndexCount=0;for(var s=0,n=0;r>s;s+=6,n+=4){this.indices[s+0]=n+0;this.indices[s+1]=n+1;this.indices[s+2]=n+2;this.indices[s+3]=n+0;this.indices[s+4]=n+2;this.indices[s+5]=n+3}this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(t)};e.WebGLFastSpriteBatch.prototype.constructor=e.WebGLFastSpriteBatch;e.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t;this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)};e.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=t.worldTransform.toArray(!0);this.start()};e.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};e.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children,i=e[0];if(i.texture._uvs){this.currentBaseTexture=i.texture.baseTexture;if(i.blendMode!==this.renderSession.blendModeManager.currentBlendMode){this.flush();this.renderSession.blendModeManager.setBlendMode(i.blendMode)}for(var r=0,s=e.length;s>r;r++)this.renderSprite(e[r]);this.flush()}};e.WebGLFastSpriteBatch.prototype.renderSprite=function(t){if(t.visible){if(t.texture.baseTexture!==this.currentBaseTexture){this.flush();this.currentBaseTexture=t.texture.baseTexture;if(!t.texture._uvs)return}var e,i,r,s,n,o,a,h,l=this.vertices;e=t.texture._uvs;i=t.texture.frame.width;r=t.texture.frame.height;if(t.texture.trim){var u=t.texture.trim;n=u.x-t.anchor.x*u.width;s=n+t.texture.crop.width;a=u.y-t.anchor.y*u.height;o=a+t.texture.crop.height}else{s=t.texture.frame.width*(1-t.anchor.x);n=t.texture.frame.width*-t.anchor.x;o=t.texture.frame.height*(1-t.anchor.y);a=t.texture.frame.height*-t.anchor.y}h=4*this.currentBatchSize*this.vertSize;l[h++]=n;l[h++]=a;l[h++]=t.position.x;l[h++]=t.position.y;l[h++]=t.scale.x;l[h++]=t.scale.y;l[h++]=t.rotation;l[h++]=e.x0;l[h++]=e.y1;l[h++]=t.alpha;l[h++]=s;l[h++]=a;l[h++]=t.position.x;l[h++]=t.position.y;l[h++]=t.scale.x;l[h++]=t.scale.y;l[h++]=t.rotation;l[h++]=e.x1;l[h++]=e.y1;l[h++]=t.alpha;l[h++]=s;l[h++]=o;l[h++]=t.position.x;l[h++]=t.position.y;l[h++]=t.scale.x;l[h++]=t.scale.y;l[h++]=t.rotation;l[h++]=e.x2;l[h++]=e.y2;l[h++]=t.alpha;l[h++]=n;l[h++]=o;l[h++]=t.position.x;l[h++]=t.position.y;l[h++]=t.scale.x;l[h++]=t.scale.y;l[h++]=t.rotation;l[h++]=e.x3;l[h++]=e.y3;l[h++]=t.alpha;this.currentBatchSize++;this.currentBatchSize>=this.size&&this.flush()}};e.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t);t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]);if(this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++}};e.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};e.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y);t.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var i=4*this.vertSize;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,!1,i,0);t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,!1,i,8);t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,!1,i,16);t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,!1,i,24);t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,!1,i,28);t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,!1,i,36)};e.WebGLFilterManager=function(){this.filterStack=[];this.offsetX=0;this.offsetY=0};e.WebGLFilterManager.prototype.constructor=e.WebGLFilterManager;e.WebGLFilterManager.prototype.setContext=function(t){this.gl=t;this.texturePool=[];this.initShaderBuffers()};e.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t;this.defaultShader=t.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x;this.height=2*-i.y;this.buffer=e};e.WebGLFilterManager.prototype.pushFilter=function(t){var i=this.gl,r=this.renderSession.projection,s=this.renderSession.offset;t._filterArea=t.target.filterArea||t.target.getBounds();this.filterStack.push(t);var n=t.filterPasses[0];this.offsetX+=t._filterArea.x;this.offsetY+=t._filterArea.y;var o=this.texturePool.pop();o?o.resize(this.width,this.height):o=new e.FilterTexture(this.gl,this.width,this.height);i.bindTexture(i.TEXTURE_2D,o.texture);var a=t._filterArea,h=n.padding;a.x-=h;a.y-=h;a.width+=2*h;a.height+=2*h;a.x<0&&(a.x=0);a.width>this.width&&(a.width=this.width);a.y<0&&(a.y=0);a.height>this.height&&(a.height=this.height);i.bindFramebuffer(i.FRAMEBUFFER,o.frameBuffer);i.viewport(0,0,a.width,a.height);r.x=a.width/2;r.y=-a.height/2;s.x=-a.x;s.y=-a.y;i.colorMask(!0,!0,!0,!0);i.clearColor(0,0,0,0);i.clear(i.COLOR_BUFFER_BIT);t._glFilterTexture=o};e.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,i=this.filterStack.pop(),r=i._filterArea,s=i._glFilterTexture,n=this.renderSession.projection,o=this.renderSession.offset;if(i.filterPasses.length>1){t.viewport(0,0,r.width,r.height);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=r.height;this.vertexArray[2]=r.width;this.vertexArray[3]=r.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=r.width;this.vertexArray[7]=0;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=r.width/this.width;this.uvArray[5]=r.height/this.height;this.uvArray[6]=r.width/this.width;this.uvArray[7]=r.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var a=s,h=this.texturePool.pop();
h||(h=new e.FilterTexture(this.gl,this.width,this.height));h.resize(this.width,this.height);t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer);t.clear(t.COLOR_BUFFER_BIT);t.disable(t.BLEND);for(var l=0;l<i.filterPasses.length-1;l++){var u=i.filterPasses[l];t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,a.texture);this.applyFilterPass(u,r,r.width,r.height);var c=a;a=h;h=c}t.enable(t.BLEND);s=a;this.texturePool.push(h)}var d=i.filterPasses[i.filterPasses.length-1];this.offsetX-=r.x;this.offsetY-=r.y;var p=this.width,f=this.height,g=0,m=0,v=this.buffer;if(0===this.filterStack.length)t.colorMask(!0,!0,!0,!0);else{var x=this.filterStack[this.filterStack.length-1];r=x._filterArea;p=r.width;f=r.height;g=r.x;m=r.y;v=x._glFilterTexture.frameBuffer}n.x=p/2;n.y=-f/2;o.x=g;o.y=m;r=i._filterArea;var y=r.x-g,b=r.y-m;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=y;this.vertexArray[1]=b+r.height;this.vertexArray[2]=y+r.width;this.vertexArray[3]=b+r.height;this.vertexArray[4]=y;this.vertexArray[5]=b;this.vertexArray[6]=y+r.width;this.vertexArray[7]=b;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=r.width/this.width;this.uvArray[5]=r.height/this.height;this.uvArray[6]=r.width/this.width;this.uvArray[7]=r.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);t.viewport(0,0,p,f);t.bindFramebuffer(t.FRAMEBUFFER,v);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,s.texture);this.applyFilterPass(d,r,p,f);this.texturePool.push(s);i._glFilterTexture=null};e.WebGLFilterManager.prototype.applyFilterPass=function(t,i,r,s){var n=this.gl,o=t.shaders[n.id];if(!o){o=new e.PixiShader(n);o.fragmentSrc=t.fragmentSrc;o.uniforms=t.uniforms;o.init();t.shaders[n.id]=o}this.renderSession.shaderManager.setShader(o);n.uniform2f(o.projectionVector,r/2,-s/2);n.uniform2f(o.offsetVector,0,0);if(t.uniforms.dimensions){t.uniforms.dimensions.value[0]=this.width;t.uniforms.dimensions.value[1]=this.height;t.uniforms.dimensions.value[2]=this.vertexArray[0];t.uniforms.dimensions.value[3]=this.vertexArray[5]}o.syncUniforms();n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.vertexAttribPointer(o.aVertexPosition,2,n.FLOAT,!1,0,0);n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer);n.vertexAttribPointer(o.aTextureCoord,2,n.FLOAT,!1,0,0);n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer);n.vertexAttribPointer(o.colorAttribute,2,n.FLOAT,!1,0,0);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0);this.renderSession.drawCount++};e.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer();this.uvBuffer=t.createBuffer();this.colorBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.vertexArray=new e.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW);this.uvArray=new e.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW);this.colorArray=new e.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer);t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)};e.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null;this.offsetX=0;this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null;t.deleteBuffer(this.vertexBuffer);t.deleteBuffer(this.uvBuffer);t.deleteBuffer(this.colorBuffer);t.deleteBuffer(this.indexBuffer)};e.FilterTexture=function(t,i,r,s){this.gl=t;this.frameBuffer=t.createFramebuffer();this.texture=t.createTexture();s=s||e.scaleModes.DEFAULT;t.bindTexture(t.TEXTURE_2D,this.texture);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,s===e.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,s===e.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);this.renderBuffer=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer);this.resize(i,r)};e.FilterTexture.prototype.constructor=e.FilterTexture;e.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0);t.clear(t.COLOR_BUFFER_BIT)};e.FilterTexture.prototype.resize=function(t,e){if(this.width!==t||this.height!==e){this.width=t;this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null);i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer);i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)}};e.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer);t.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};e.CanvasBuffer=function(t,e){this.width=t;this.height=e;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=t;this.canvas.height=e};e.CanvasBuffer.prototype.constructor=e.CanvasBuffer;e.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};e.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t;this.height=this.canvas.height=e};e.CanvasMaskManager=function(){};e.CanvasMaskManager.prototype.constructor=e.CanvasMaskManager;e.CanvasMaskManager.prototype.pushMask=function(t,i){var r=i.context;r.save();var s=t.alpha,n=t.worldTransform,o=i.resolution;r.setTransform(n.a*o,n.b*o,n.c*o,n.d*o,n.tx*o,n.ty*o);e.CanvasGraphics.renderGraphicsMask(t,r);r.clip();t.worldAlpha=s};e.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()};e.CanvasTinter=function(){};e.CanvasTinter.getTintedTexture=function(t,i){var r=t.texture;i=e.CanvasTinter.roundColor(i);var s="#"+("00000"+(0|i).toString(16)).substr(-6);r.tintCache=r.tintCache||{};if(r.tintCache[s])return r.tintCache[s];var n=e.CanvasTinter.canvas||document.createElement("canvas");e.CanvasTinter.tintMethod(r,i,n);if(e.CanvasTinter.convertTintToImage){var o=new Image;o.src=n.toDataURL();r.tintCache[s]=o}else{r.tintCache[s]=n;e.CanvasTinter.canvas=null}return n};e.CanvasTinter.tintWithMultiply=function(t,e,i){var r=i.getContext("2d"),s=t.crop;i.width=s.width;i.height=s.height;r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6);r.fillRect(0,0,s.width,s.height);r.globalCompositeOperation="multiply";r.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height);r.globalCompositeOperation="destination-atop";r.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height)};e.CanvasTinter.tintWithOverlay=function(t,e,i){var r=i.getContext("2d"),s=t.crop;i.width=s.width;i.height=s.height;r.globalCompositeOperation="copy";r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6);r.fillRect(0,0,s.width,s.height);r.globalCompositeOperation="destination-atop";r.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height)};e.CanvasTinter.tintWithPerPixel=function(t,i,r){var s=r.getContext("2d"),n=t.crop;r.width=n.width;r.height=n.height;s.globalCompositeOperation="copy";s.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height);for(var o=e.hex2rgb(i),a=o[0],h=o[1],l=o[2],u=s.getImageData(0,0,n.width,n.height),c=u.data,d=0;d<c.length;d+=4){c[d+0]*=a;c[d+1]*=h;c[d+2]*=l}s.putImageData(u,0,0)};e.CanvasTinter.roundColor=function(t){var i=e.CanvasTinter.cacheStepsPerColorChannel,r=e.hex2rgb(t);r[0]=Math.min(255,r[0]/i*i);r[1]=Math.min(255,r[1]/i*i);r[2]=Math.min(255,r[2]/i*i);return e.rgb2hex(r)};e.CanvasTinter.cacheStepsPerColorChannel=8;e.CanvasTinter.convertTintToImage=!1;e.CanvasTinter.canUseMultiply=e.canUseNewCanvasBlendModes();e.CanvasTinter.tintMethod=e.CanvasTinter.canUseMultiply?e.CanvasTinter.tintWithMultiply:e.CanvasTinter.tintWithPerPixel;e.CanvasRenderer=function(t,i,r){if(r)for(var s in e.defaultRenderOptions)"undefined"==typeof r[s]&&(r[s]=e.defaultRenderOptions[s]);else r=e.defaultRenderOptions;if(!e.defaultRenderer){e.sayHello("Canvas");e.defaultRenderer=this}this.type=e.CANVAS_RENDERER;this.resolution=r.resolution;this.clearBeforeRender=r.clearBeforeRender;this.transparent=r.transparent;this.autoResize=r.autoResize||!1;this.width=t||800;this.height=i||600;this.width*=this.resolution;this.height*=this.resolution;this.view=r.view||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=!0;this.view.width=this.width*this.resolution;this.view.height=this.height*this.resolution;this.count=0;this.maskManager=new e.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1};this.mapBlendModes();this.resize(t,i);"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")};e.CanvasRenderer.prototype.constructor=e.CanvasRenderer;e.CanvasRenderer.prototype.render=function(t){t.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=e.blendModes.NORMAL;this.context.globalCompositeOperation=e.blendModesCanvas[e.blendModes.NORMAL];if(navigator.isCocoonJS&&this.view.screencanvas){this.context.fillStyle="black";this.context.clear()}if(this.clearBeforeRender)if(this.transparent)this.context.clearRect(0,0,this.width,this.height);else{this.context.fillStyle=t.backgroundColorString;this.context.fillRect(0,0,this.width,this.height)}this.renderDisplayObject(t);if(t.interactive&&!t._interactiveEventsAdded){t._interactiveEventsAdded=!0;t.interactionManager.setTarget(this)}};e.CanvasRenderer.prototype.destroy=function(t){"undefined"==typeof t&&(t=!0);t&&this.view.parent&&this.view.parent.removeChild(this.view);this.view=null;this.context=null;this.maskManager=null;this.renderSession=null};e.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution;this.height=e*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}};e.CanvasRenderer.prototype.renderDisplayObject=function(t,e){this.renderSession.context=e||this.context;this.renderSession.resolution=this.resolution;t._renderCanvas(this.renderSession)};e.CanvasRenderer.prototype.mapBlendModes=function(){if(!e.blendModesCanvas){e.blendModesCanvas=[];if(e.canUseNewCanvasBlendModes()){e.blendModesCanvas[e.blendModes.NORMAL]="source-over";e.blendModesCanvas[e.blendModes.ADD]="lighter";e.blendModesCanvas[e.blendModes.MULTIPLY]="multiply";e.blendModesCanvas[e.blendModes.SCREEN]="screen";e.blendModesCanvas[e.blendModes.OVERLAY]="overlay";e.blendModesCanvas[e.blendModes.DARKEN]="darken";e.blendModesCanvas[e.blendModes.LIGHTEN]="lighten";e.blendModesCanvas[e.blendModes.COLOR_DODGE]="color-dodge";e.blendModesCanvas[e.blendModes.COLOR_BURN]="color-burn";e.blendModesCanvas[e.blendModes.HARD_LIGHT]="hard-light";e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="soft-light";e.blendModesCanvas[e.blendModes.DIFFERENCE]="difference";e.blendModesCanvas[e.blendModes.EXCLUSION]="exclusion";e.blendModesCanvas[e.blendModes.HUE]="hue";e.blendModesCanvas[e.blendModes.SATURATION]="saturation";e.blendModesCanvas[e.blendModes.COLOR]="color";e.blendModesCanvas[e.blendModes.LUMINOSITY]="luminosity"}else{e.blendModesCanvas[e.blendModes.NORMAL]="source-over";e.blendModesCanvas[e.blendModes.ADD]="lighter";e.blendModesCanvas[e.blendModes.MULTIPLY]="source-over";e.blendModesCanvas[e.blendModes.SCREEN]="source-over";e.blendModesCanvas[e.blendModes.OVERLAY]="source-over";e.blendModesCanvas[e.blendModes.DARKEN]="source-over";e.blendModesCanvas[e.blendModes.LIGHTEN]="source-over";e.blendModesCanvas[e.blendModes.COLOR_DODGE]="source-over";e.blendModesCanvas[e.blendModes.COLOR_BURN]="source-over";e.blendModesCanvas[e.blendModes.HARD_LIGHT]="source-over";e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="source-over";e.blendModesCanvas[e.blendModes.DIFFERENCE]="source-over";e.blendModesCanvas[e.blendModes.EXCLUSION]="source-over";e.blendModesCanvas[e.blendModes.HUE]="source-over";e.blendModesCanvas[e.blendModes.SATURATION]="source-over";e.blendModesCanvas[e.blendModes.COLOR]="source-over";e.blendModesCanvas[e.blendModes.LUMINOSITY]="source-over"}}};e.CanvasGraphics=function(){};e.CanvasGraphics.renderGraphics=function(t,i){var r=t.worldAlpha;if(t.dirty){this.updateGraphicsTint(t);t.dirty=!1}for(var s=0;s<t.graphicsData.length;s++){var n=t.graphicsData[s],o=n.shape,a=n._fillTint,h=n._lineTint;i.lineWidth=n.lineWidth;if(n.type===e.Graphics.POLY){i.beginPath();var l=o.points;i.moveTo(l[0],l[1]);for(var u=1;u<l.length/2;u++)i.lineTo(l[2*u],l[2*u+1]);o.closed&&i.lineTo(l[0],l[1]);l[0]===l[l.length-2]&&l[1]===l[l.length-1]&&i.closePath();if(n.fill){i.globalAlpha=n.fillAlpha*r;i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6);i.fill()}if(n.lineWidth){i.globalAlpha=n.lineAlpha*r;i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6);i.stroke()}}else if(n.type===e.Graphics.RECT){if(n.fillColor||0===n.fillColor){i.globalAlpha=n.fillAlpha*r;i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6);i.fillRect(o.x,o.y,o.width,o.height)}if(n.lineWidth){i.globalAlpha=n.lineAlpha*r;i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6);i.strokeRect(o.x,o.y,o.width,o.height)}}else if(n.type===e.Graphics.CIRC){i.beginPath();i.arc(o.x,o.y,o.radius,0,2*Math.PI);i.closePath();if(n.fill){i.globalAlpha=n.fillAlpha*r;i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6);i.fill()}if(n.lineWidth){i.globalAlpha=n.lineAlpha*r;i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6);i.stroke()}}else if(n.type===e.Graphics.ELIP){var c=2*o.width,d=2*o.height,p=o.x-c/2,f=o.y-d/2;i.beginPath();var g=.5522848,m=c/2*g,v=d/2*g,x=p+c,y=f+d,b=p+c/2,T=f+d/2;i.moveTo(p,T);i.bezierCurveTo(p,T-v,b-m,f,b,f);i.bezierCurveTo(b+m,f,x,T-v,x,T);i.bezierCurveTo(x,T+v,b+m,y,b,y);i.bezierCurveTo(b-m,y,p,T+v,p,T);i.closePath();if(n.fill){i.globalAlpha=n.fillAlpha*r;i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6);i.fill()}if(n.lineWidth){i.globalAlpha=n.lineAlpha*r;i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6);i.stroke()}}else if(n.type===e.Graphics.RREC){var S=o.x,w=o.y,C=o.width,A=o.height,_=o.radius,E=Math.min(C,A)/2|0;_=_>E?E:_;i.beginPath();i.moveTo(S,w+_);i.lineTo(S,w+A-_);i.quadraticCurveTo(S,w+A,S+_,w+A);i.lineTo(S+C-_,w+A);i.quadraticCurveTo(S+C,w+A,S+C,w+A-_);i.lineTo(S+C,w+_);i.quadraticCurveTo(S+C,w,S+C-_,w);i.lineTo(S+_,w);i.quadraticCurveTo(S,w,S,w+_);i.closePath();if(n.fillColor||0===n.fillColor){i.globalAlpha=n.fillAlpha*r;i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6);i.fill()}if(n.lineWidth){i.globalAlpha=n.lineAlpha*r;i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6);i.stroke()}}}};e.CanvasGraphics.renderGraphicsMask=function(t,i){var r=t.graphicsData.length;if(0!==r){if(r>1){r=1;window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object")}for(var s=0;1>s;s++){var n=t.graphicsData[s],o=n.shape;if(n.type===e.Graphics.POLY){i.beginPath();var a=o.points;i.moveTo(a[0],a[1]);for(var h=1;h<a.length/2;h++)i.lineTo(a[2*h],a[2*h+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&i.closePath()}else if(n.type===e.Graphics.RECT){i.beginPath();i.rect(o.x,o.y,o.width,o.height);i.closePath()}else if(n.type===e.Graphics.CIRC){i.beginPath();i.arc(o.x,o.y,o.radius,0,2*Math.PI);i.closePath()}else if(n.type===e.Graphics.ELIP){var l=2*o.width,u=2*o.height,c=o.x-l/2,d=o.y-u/2;i.beginPath();var p=.5522848,f=l/2*p,g=u/2*p,m=c+l,v=d+u,x=c+l/2,y=d+u/2;i.moveTo(c,y);i.bezierCurveTo(c,y-g,x-f,d,x,d);i.bezierCurveTo(x+f,d,m,y-g,m,y);i.bezierCurveTo(m,y+g,x+f,v,x,v);i.bezierCurveTo(x-f,v,c,y+g,c,y);i.closePath()}else if(n.type===e.Graphics.RREC){var b=o.points,T=b[0],S=b[1],w=b[2],C=b[3],A=b[4],_=Math.min(w,C)/2|0;A=A>_?_:A;i.beginPath();i.moveTo(T,S+A);i.lineTo(T,S+C-A);i.quadraticCurveTo(T,S+C,T+A,S+C);i.lineTo(T+w-A,S+C);i.quadraticCurveTo(T+w,S+C,T+w,S+C-A);i.lineTo(T+w,S+A);i.quadraticCurveTo(T+w,S,T+w-A,S);i.lineTo(T+A,S);i.quadraticCurveTo(T,S,T,S+A);i.closePath()}}}};e.CanvasGraphics.updateGraphicsTint=function(t){if(16777215!==t.tint)for(var e=(t.tint>>16&255)/255,i=(t.tint>>8&255)/255,r=(255&t.tint)/255,s=0;s<t.graphicsData.length;s++){var n=t.graphicsData[s],o=0|n.fillColor,a=0|n.lineColor;n._fillTint=((o>>16&255)/255*e*255<<16)+((o>>8&255)/255*i*255<<8)+(255&o)/255*r*255;n._lineTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(255&a)/255*r*255}};e.Graphics=function(){e.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=16777215;this.blendMode=e.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=!1;this.boundsPadding=0;this._localBounds=new e.Rectangle(0,0,1,1);this.dirty=!0;this.webGLDirty=!1;this.cachedSpriteDirty=!1};e.Graphics.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Graphics.prototype.constructor=e.Graphics;Object.defineProperty(e.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t;if(this._cacheAsBitmap)this._generateCachedSprite();else{this.destroyCachedSprite();this.dirty=!0}}});e.Graphics.prototype.lineStyle=function(t,i,r){this.lineWidth=t||0;this.lineColor=i||0;this.lineAlpha=arguments.length<3?1:r;if(this.currentPath){if(this.currentPath.shape.points.length){this.drawShape(new e.Polygon(this.currentPath.shape.points.slice(-2)));return this}this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha}return this};e.Graphics.prototype.moveTo=function(t,i){this.drawShape(new e.Polygon([t,i]));return this};e.Graphics.prototype.lineTo=function(t,e){this.currentPath.shape.points.push(t,e);this.dirty=!0;return this};e.Graphics.prototype.quadraticCurveTo=function(t,e,i,r){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var s,n,o=20,a=this.currentPath.shape.points;0===a.length&&this.moveTo(0,0);for(var h=a[a.length-2],l=a[a.length-1],u=0,c=1;o>=c;c++){u=c/o;s=h+(t-h)*u;n=l+(e-l)*u;a.push(s+(t+(i-t)*u-s)*u,n+(e+(r-e)*u-n)*u)}this.dirty=!0;return this};e.Graphics.prototype.bezierCurveTo=function(t,e,i,r,s,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var o,a,h,l,u,c=20,d=this.currentPath.shape.points,p=d[d.length-2],f=d[d.length-1],g=0,m=1;c>=m;m++){g=m/c;o=1-g;a=o*o;h=a*o;l=g*g;u=l*g;d.push(h*p+3*a*g*t+3*o*l*i+u*s,h*f+3*a*g*e+3*o*l*r+u*n)}this.dirty=!0;return this};e.Graphics.prototype.arcTo=function(t,e,i,r,s){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var n=this.currentPath.shape.points,o=n[n.length-2],a=n[n.length-1],h=a-e,l=o-t,u=r-e,c=i-t,d=Math.abs(h*c-l*u);if(1e-8>d||0===s)(n[n.length-2]!==t||n[n.length-1]!==e)&&n.push(t,e);else{var p=h*h+l*l,f=u*u+c*c,g=h*u+l*c,m=s*Math.sqrt(p)/d,v=s*Math.sqrt(f)/d,x=m*g/p,y=v*g/f,b=m*c+v*l,T=m*u+v*h,S=l*(v+x),w=h*(v+x),C=c*(m+y),A=u*(m+y),_=Math.atan2(w-T,S-b),E=Math.atan2(A-T,C-b);this.arc(b+t,T+e,s,_,E,l*u>c*h)}this.dirty=!0;return this};e.Graphics.prototype.arc=function(t,e,i,r,s,n){var o,a=t+Math.cos(r)*i,h=e+Math.sin(r)*i;if(this.currentPath){o=this.currentPath.shape.points;0===o.length?o.push(a,h):(o[o.length-2]!==a||o[o.length-1]!==h)&&o.push(a,h)}else{this.moveTo(a,h);o=this.currentPath.shape.points}if(r===s)return this;!n&&r>=s?s+=2*Math.PI:n&&s>=r&&(r+=2*Math.PI);var l=n?-1*(r-s):s-r,u=Math.abs(l)/(2*Math.PI)*40;if(0===l)return this;for(var c=l/(2*u),d=2*c,p=Math.cos(c),f=Math.sin(c),g=u-1,m=g%1/g,v=0;g>=v;v++){var x=v+m*v,y=c+r+d*x,b=Math.cos(y),T=-Math.sin(y);o.push((p*b+f*T)*i+t,(p*-T+f*b)*i+e)}this.dirty=!0;return this};e.Graphics.prototype.beginFill=function(t,e){this.filling=!0;this.fillColor=t||0;this.fillAlpha=void 0===e?1:e;if(this.currentPath&&this.currentPath.shape.points.length<=2){this.currentPath.fill=this.filling;this.currentPath.fillColor=this.fillColor;this.currentPath.fillAlpha=this.fillAlpha}return this};e.Graphics.prototype.endFill=function(){this.filling=!1;this.fillColor=null;this.fillAlpha=1;return this};e.Graphics.prototype.drawRect=function(t,i,r,s){this.drawShape(new e.Rectangle(t,i,r,s));return this};e.Graphics.prototype.drawRoundedRect=function(t,i,r,s,n){this.drawShape(new e.RoundedRectangle(t,i,r,s,n));return this};e.Graphics.prototype.drawCircle=function(t,i,r){this.drawShape(new e.Circle(t,i,r));return this};e.Graphics.prototype.drawEllipse=function(t,i,r,s){this.drawShape(new e.Ellipse(t,i,r,s));return this};e.Graphics.prototype.drawPolygon=function(t){t instanceof Array||(t=Array.prototype.slice.call(arguments));this.drawShape(new e.Polygon(t));return this};e.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=!1;this.dirty=!0;this.clearDirty=!0;this.graphicsData=[];return this};e.Graphics.prototype.generateTexture=function(t,i){t=t||1;var r=this.getBounds(),s=new e.CanvasBuffer(r.width*t,r.height*t),n=e.Texture.fromCanvas(s.canvas,i);n.baseTexture.resolution=t;s.context.scale(t,t);s.context.translate(-r.x,-r.y);e.CanvasGraphics.renderGraphics(this,s.context);return n};e.Graphics.prototype._renderWebGL=function(t){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0)if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=!1;this.dirty=!1}this._cachedSprite.worldAlpha=this.worldAlpha;e.Sprite.prototype._renderWebGL.call(this._cachedSprite,t)}else{t.spriteBatch.stop();t.blendModeManager.setBlendMode(this.blendMode);this._mask&&t.maskManager.pushMask(this._mask,t);this._filters&&t.filterManager.pushFilter(this._filterBlock);if(this.blendMode!==t.spriteBatch.currentBlendMode){t.spriteBatch.currentBlendMode=this.blendMode;var i=e.blendModesWebGL[t.spriteBatch.currentBlendMode];t.spriteBatch.gl.blendFunc(i[0],i[1])}if(this.webGLDirty){this.dirty=!0;this.webGLDirty=!1}e.WebGLGraphics.renderGraphics(this,t);if(this.children.length){t.spriteBatch.start();for(var r=0,s=this.children.length;s>r;r++)this.children[r]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter();this._mask&&t.maskManager.popMask(this.mask,t);t.drawCount++;t.spriteBatch.start()}};e.Graphics.prototype._renderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0)if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=!1;this.dirty=!1}this._cachedSprite.alpha=this.alpha;e.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)}else{var i=t.context,r=this.worldTransform;if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;i.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]}this._mask&&t.maskManager.pushMask(this._mask,t);var s=t.resolution;i.setTransform(r.a*s,r.b*s,r.c*s,r.d*s,r.tx*s,r.ty*s);e.CanvasGraphics.renderGraphics(this,i);for(var n=0,o=this.children.length;o>n;n++)this.children[n]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}};e.Graphics.prototype.getBounds=function(t){if(this.isMask)return e.EmptyRectangle;if(this.dirty){this.updateLocalBounds();this.webGLDirty=!0;this.cachedSpriteDirty=!0;this.dirty=!1}var i=this._localBounds,r=i.x,s=i.width+i.x,n=i.y,o=i.height+i.y,a=t||this.worldTransform,h=a.a,l=a.b,u=a.c,c=a.d,d=a.tx,p=a.ty,f=h*s+u*o+d,g=c*o+l*s+p,m=h*r+u*o+d,v=c*o+l*r+p,x=h*r+u*n+d,y=c*n+l*r+p,b=h*s+u*n+d,T=c*n+l*s+p,S=f,w=g,C=f,A=g;C=C>m?m:C;C=C>x?x:C;C=C>b?b:C;A=A>v?v:A;A=A>y?y:A;A=A>T?T:A;S=m>S?m:S;S=x>S?x:S;S=b>S?b:S;w=v>w?v:w;w=y>w?y:w;w=T>w?T:w;this._bounds.x=C;this._bounds.width=S-C;this._bounds.y=A;this._bounds.height=w-A;return this._bounds};e.Graphics.prototype.updateLocalBounds=function(){var t=1/0,i=-1/0,r=1/0,s=-1/0;if(this.graphicsData.length)for(var n,o,a,h,l,u,c=0;c<this.graphicsData.length;c++){var d=this.graphicsData[c],p=d.type,f=d.lineWidth;n=d.shape;if(p===e.Graphics.RECT||p===e.Graphics.RREC){a=n.x-f/2;h=n.y-f/2;l=n.width+f;u=n.height+f;t=t>a?a:t;i=a+l>i?a+l:i;r=r>h?h:r;s=h+u>s?h+u:s}else if(p===e.Graphics.CIRC){a=n.x;h=n.y;l=n.radius+f/2;u=n.radius+f/2;t=t>a-l?a-l:t;i=a+l>i?a+l:i;r=r>h-u?h-u:r;s=h+u>s?h+u:s}else if(p===e.Graphics.ELIP){a=n.x;h=n.y;l=n.width+f/2;u=n.height+f/2;t=t>a-l?a-l:t;i=a+l>i?a+l:i;r=r>h-u?h-u:r;s=h+u>s?h+u:s}else{o=n.points;for(var g=0;g<o.length;g+=2){a=o[g];h=o[g+1];t=t>a-f?a-f:t;i=a+f>i?a+f:i;r=r>h-f?h-f:r;s=h+f>s?h+f:s}}}else{t=0;i=0;r=0;s=0}var m=this.boundsPadding;this._localBounds.x=t-m;this._localBounds.width=i-t+2*m;this._localBounds.y=r-m;this._localBounds.height=s-r+2*m};e.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(t.width,t.height);else{var i=new e.CanvasBuffer(t.width,t.height),r=e.Texture.fromCanvas(i.canvas);this._cachedSprite=new e.Sprite(r);this._cachedSprite.buffer=i;this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._cachedSprite.buffer.context.translate(-t.x,-t.y);this.worldAlpha=1;e.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};e.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite,e=t.texture,i=t.buffer.canvas;e.baseTexture.width=i.width;e.baseTexture.height=i.height;e.crop.width=e.frame.width=i.width;e.crop.height=e.frame.height=i.height;t._width=i.width;t._height=i.height;e.baseTexture.dirty()};e.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null};e.Graphics.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop();this.currentPath=null;var i=new e.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);this.graphicsData.push(i);if(i.type===e.Graphics.POLY){i.shape.closed=this.filling;this.currentPath=i}this.dirty=!0;return i};e.GraphicsData=function(t,e,i,r,s,n,o){this.lineWidth=t;this.lineColor=e;this.lineAlpha=i;this._lineTint=e;this.fillColor=r;this.fillAlpha=s;this._fillTint=r;this.fill=n;this.shape=o;this.type=o.type};e.Graphics.POLY=0;e.Graphics.RECT=1;e.Graphics.CIRC=2;e.Graphics.ELIP=3;e.Graphics.RREC=4;e.Polygon.prototype.type=e.Graphics.POLY;e.Rectangle.prototype.type=e.Graphics.RECT;e.Circle.prototype.type=e.Graphics.CIRC;e.Ellipse.prototype.type=e.Graphics.ELIP;e.RoundedRectangle.prototype.type=e.Graphics.RREC;e.Strip=function(t){e.DisplayObjectContainer.call(this);this.texture=t;this.uvs=new e.Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new e.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new e.Float32Array([1,1,1,1]);this.indices=new e.Uint16Array([0,1,2,3]);this.dirty=!0;this.blendMode=e.blendModes.NORMAL;this.canvasPadding=0;this.drawMode=e.Strip.DrawModes.TRIANGLE_STRIP};e.Strip.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Strip.prototype.constructor=e.Strip;e.Strip.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0)){t.spriteBatch.stop();this._vertexBuffer||this._initWebGL(t);t.shaderManager.setShader(t.shaderManager.stripShader);this._renderStrip(t);t.spriteBatch.start()}};e.Strip.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer();this._indexBuffer=e.createBuffer();this._uvBuffer=e.createBuffer();this._colorBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer);e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer);e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)};e.Strip.prototype._renderStrip=function(t){var i=t.gl,r=t.projection,s=t.offset,n=t.shaderManager.stripShader,o=this.drawMode===e.Strip.DrawModes.TRIANGLE_STRIP?i.TRIANGLE_STRIP:i.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode);i.uniformMatrix3fv(n.translationMatrix,!1,this.worldTransform.toArray(!0));i.uniform2f(n.projectionVector,r.x,-r.y);i.uniform2f(n.offsetVector,-s.x,-s.y);i.uniform1f(n.alpha,this.worldAlpha);if(this.dirty){this.dirty=!1;i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer);i.bufferData(i.ARRAY_BUFFER,this.vertices,i.STATIC_DRAW);i.vertexAttribPointer(n.aVertexPosition,2,i.FLOAT,!1,0,0);i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer);i.bufferData(i.ARRAY_BUFFER,this.uvs,i.STATIC_DRAW);i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,!1,0,0);i.activeTexture(i.TEXTURE0);this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer);i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW)}else{i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer);i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices);i.vertexAttribPointer(n.aVertexPosition,2,i.FLOAT,!1,0,0);i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer);i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,!1,0,0);i.activeTexture(i.TEXTURE0);this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer)}i.drawElements(o,this.indices.length,i.UNSIGNED_SHORT,0)};e.Strip.prototype._renderCanvas=function(t){var i=t.context,r=this.worldTransform;t.roundPixels?i.setTransform(r.a,r.b,r.c,r.d,0|r.tx,0|r.ty):i.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty);this.drawMode===e.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(i):this._renderCanvasTriangles(i)};e.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices,i=this.uvs,r=e.length/2;this.count++;for(var s=0;r-2>s;s++){var n=2*s;this._renderCanvasDrawTriangle(t,e,i,n,n+2,n+4)}};e.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices,i=this.uvs,r=this.indices,s=r.length;this.count++;for(var n=0;s>n;n+=3){var o=2*r[n],a=2*r[n+1],h=2*r[n+2];this._renderCanvasDrawTriangle(t,e,i,o,a,h)}};e.Strip.prototype._renderCanvasDrawTriangle=function(t,e,i,r,s,n){var o=this.texture.baseTexture.source,a=this.texture.width,h=this.texture.height,l=e[r],u=e[s],c=e[n],d=e[r+1],p=e[s+1],f=e[n+1],g=i[r]*a,m=i[s]*a,v=i[n]*a,x=i[r+1]*h,y=i[s+1]*h,b=i[n+1]*h;if(this.canvasPadding>0){var T=this.canvasPadding/this.worldTransform.a,S=this.canvasPadding/this.worldTransform.d,w=(l+u+c)/3,C=(d+p+f)/3,A=l-w,_=d-C,E=Math.sqrt(A*A+_*_);l=w+A/E*(E+T);d=C+_/E*(E+S);A=u-w;_=p-C;E=Math.sqrt(A*A+_*_);u=w+A/E*(E+T);p=C+_/E*(E+S);A=c-w;_=f-C;E=Math.sqrt(A*A+_*_);c=w+A/E*(E+T);f=C+_/E*(E+S)}t.save();t.beginPath();
t.moveTo(l,d);t.lineTo(u,p);t.lineTo(c,f);t.closePath();t.clip();var M=g*y+x*v+m*b-y*v-x*m-g*b,R=l*y+x*c+u*b-y*c-x*u-l*b,L=g*u+l*v+m*c-u*v-l*m-g*c,F=g*y*c+x*u*v+l*m*b-l*y*v-x*m*c-g*u*b,B=d*y+x*f+p*b-y*f-x*p-d*b,P=g*p+d*v+m*f-p*v-d*m-g*f,D=g*y*f+x*p*v+d*m*b-d*y*v-x*m*f-g*p*b;t.transform(R/M,B/M,L/M,P/M,F/M,D/M);t.drawImage(o,0,0);t.restore()};e.Strip.prototype.renderStripFlat=function(t){var e=this.context,i=t.vertices,r=i.length/2;this.count++;e.beginPath();for(var s=1;r-2>s;s++){var n=2*s,o=i[n],a=i[n+2],h=i[n+4],l=i[n+1],u=i[n+3],c=i[n+5];e.moveTo(o,l);e.lineTo(a,u);e.lineTo(h,c)}e.fillStyle="#FF0000";e.fill();e.closePath()};e.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0};e.Strip.prototype.getBounds=function(t){for(var i=t||this.worldTransform,r=i.a,s=i.b,n=i.c,o=i.d,a=i.tx,h=i.ty,l=-1/0,u=-1/0,c=1/0,d=1/0,p=this.vertices,f=0,g=p.length;g>f;f+=2){var m=p[f],v=p[f+1],x=r*m+n*v+a,y=o*v+s*m+h;c=c>x?x:c;d=d>y?y:d;l=x>l?x:l;u=y>u?y:u}if(c===-1/0||1/0===u)return e.EmptyRectangle;var b=this._bounds;b.x=c;b.width=l-c;b.y=d;b.height=u-d;this._currentBounds=b;return b};e.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1};e.Rope=function(t,i){e.Strip.call(this,t);this.points=i;this.vertices=new e.Float32Array(4*i.length);this.uvs=new e.Float32Array(4*i.length);this.colors=new e.Float32Array(2*i.length);this.indices=new e.Uint16Array(2*i.length);this.refresh()};e.Rope.prototype=Object.create(e.Strip.prototype);e.Rope.prototype.constructor=e.Rope;e.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=t[0],r=this.indices,s=this.colors;this.count-=.2;e[0]=0;e[1]=0;e[2]=0;e[3]=1;s[0]=1;s[1]=1;r[0]=0;r[1]=1;for(var n,o,a,h=t.length,l=1;h>l;l++){n=t[l];o=4*l;a=l/(h-1);if(l%2){e[o]=a;e[o+1]=0;e[o+2]=a;e[o+3]=1}else{e[o]=a;e[o+1]=0;e[o+2]=a;e[o+3]=1}o=2*l;s[o]=1;s[o+1]=1;o=2*l;r[o]=o;r[o+1]=o+1;i=n}}};e.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var i,r=t[0],s={x:0,y:0};this.count-=.2;for(var n,o,a,h,l,u=this.vertices,c=t.length,d=0;c>d;d++){n=t[d];o=4*d;i=d<t.length-1?t[d+1]:n;s.y=-(i.x-r.x);s.x=i.y-r.y;a=10*(1-d/(c-1));a>1&&(a=1);h=Math.sqrt(s.x*s.x+s.y*s.y);l=this.texture.height/2;s.x/=h;s.y/=h;s.x*=l;s.y*=l;u[o]=n.x+s.x;u[o+1]=n.y+s.y;u[o+2]=n.x-s.x;u[o+3]=n.y-s.y;r=n}e.DisplayObjectContainer.prototype.updateTransform.call(this)}};e.Rope.prototype.setTexture=function(t){this.texture=t};e.TilingSprite=function(t,i,r){e.Sprite.call(this,t);this._width=i||100;this._height=r||100;this.tileScale=new e.Point(1,1);this.tileScaleOffset=new e.Point(1,1);this.tilePosition=new e.Point(0,0);this.renderable=!0;this.tint=16777215;this.blendMode=e.blendModes.NORMAL};e.TilingSprite.prototype=Object.create(e.Sprite.prototype);e.TilingSprite.prototype.constructor=e.TilingSprite;Object.defineProperty(e.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}});Object.defineProperty(e.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}});e.TilingSprite.prototype.setTexture=function(t){if(this.texture!==t){this.texture=t;this.refreshTexture=!0;this.cachedTint=16777215}};e.TilingSprite.prototype._renderWebGL=function(t){if(this.visible!==!1&&0!==this.alpha){var e,i;if(this._mask){t.spriteBatch.stop();t.maskManager.pushMask(this.mask,t);t.spriteBatch.start()}if(this._filters){t.spriteBatch.flush();t.filterManager.pushFilter(this._filterBlock)}if(!this.tilingTexture||this.refreshTexture){this.generateTilingTexture(!0);if(this.tilingTexture&&this.tilingTexture.needsUpdate){t.renderer.updateTexture(this.tilingTexture.baseTexture);this.tilingTexture.needsUpdate=!1}}else t.spriteBatch.renderTilingSprite(this);for(e=0,i=this.children.length;i>e;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop();this._filters&&t.filterManager.popFilter();this._mask&&t.maskManager.popMask(this._mask,t);t.spriteBatch.start()}};e.TilingSprite.prototype._renderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha){var i=t.context;this._mask&&t.maskManager.pushMask(this._mask,i);i.globalAlpha=this.worldAlpha;var r,s,n=this.worldTransform,o=t.resolution;i.setTransform(n.a*o,n.b*o,n.c*o,n.d*o,n.tx*o,n.ty*o);if(!this.__tilePattern||this.refreshTexture){this.generateTilingTexture(!1);if(!this.tilingTexture)return;this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat")}if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;i.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]}var a=this.tilePosition,h=this.tileScale;a.x%=this.tilingTexture.baseTexture.width;a.y%=this.tilingTexture.baseTexture.height;i.scale(h.x,h.y);i.translate(a.x+this.anchor.x*-this._width,a.y+this.anchor.y*-this._height);i.fillStyle=this.__tilePattern;i.fillRect(-a.x,-a.y,this._width/h.x,this._height/h.y);i.scale(1/h.x,1/h.y);i.translate(-a.x+this.anchor.x*this._width,-a.y+this.anchor.y*this._height);this._mask&&t.maskManager.popMask(t.context);for(r=0,s=this.children.length;s>r;r++)this.children[r]._renderCanvas(t)}};e.TilingSprite.prototype.getBounds=function(){var t=this._width,e=this._height,i=t*(1-this.anchor.x),r=t*-this.anchor.x,s=e*(1-this.anchor.y),n=e*-this.anchor.y,o=this.worldTransform,a=o.a,h=o.b,l=o.c,u=o.d,c=o.tx,d=o.ty,p=a*r+l*n+c,f=u*n+h*r+d,g=a*i+l*n+c,m=u*n+h*i+d,v=a*i+l*s+c,x=u*s+h*i+d,y=a*r+l*s+c,b=u*s+h*r+d,T=-1/0,S=-1/0,w=1/0,C=1/0;w=w>p?p:w;w=w>g?g:w;w=w>v?v:w;w=w>y?y:w;C=C>f?f:C;C=C>m?m:C;C=C>x?x:C;C=C>b?b:C;T=p>T?p:T;T=g>T?g:T;T=v>T?v:T;T=y>T?y:T;S=f>S?f:S;S=m>S?m:S;S=x>S?x:S;S=b>S?b:S;var A=this._bounds;A.x=w;A.width=T-w;A.y=C;A.height=S-C;this._currentBounds=A;return A};e.TilingSprite.prototype.onTextureUpdate=function(){};e.TilingSprite.prototype.generateTilingTexture=function(t){if(this.texture.baseTexture.hasLoaded){var i,r,s=this.originalTexture||this.texture,n=s.frame,o=n.width!==s.baseTexture.width||n.height!==s.baseTexture.height,a=!1;if(t){i=e.getNextPowerOfTwo(n.width);r=e.getNextPowerOfTwo(n.height);(n.width!==i||n.height!==r||s.baseTexture.width!==i||s.baseTexture.height||r)&&(a=!0)}else if(o){i=n.width;r=n.height;a=!0}if(a){var h;if(this.tilingTexture&&this.tilingTexture.isTiling){h=this.tilingTexture.canvasBuffer;h.resize(i,r);this.tilingTexture.baseTexture.width=i;this.tilingTexture.baseTexture.height=r;this.tilingTexture.needsUpdate=!0}else{h=new e.CanvasBuffer(i,r);this.tilingTexture=e.Texture.fromCanvas(h.canvas);this.tilingTexture.canvasBuffer=h;this.tilingTexture.isTiling=!0}h.context.drawImage(s.baseTexture.source,s.crop.x,s.crop.y,s.crop.width,s.crop.height,0,0,i,r);this.tileScaleOffset.x=n.width/i;this.tileScaleOffset.y=n.height/r}else{this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0);this.tileScaleOffset.x=1;this.tileScaleOffset.y=1;this.tilingTexture=s}this.refreshTexture=!1;this.originalTexture=this.texture;this.texture=this.tilingTexture;this.tilingTexture.baseTexture._powerOf2=!0}};var i={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array};i.BoneData=function(t,e){this.name=t;this.parent=e};i.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1};i.SlotData=function(t,e){this.name=t;this.boneData=e};i.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,additiveBlending:!1};i.IkConstraintData=function(t){this.name=t;this.bones=[]};i.IkConstraintData.prototype={target:null,bendDirection:1,mix:1};i.Bone=function(t,e,i){this.data=t;this.skeleton=e;this.parent=i;this.setToSetupPose()};i.Bone.yDown=!1;i.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var t=this.parent;if(t){this.worldX=this.x*t.m00+this.y*t.m01+t.worldX;this.worldY=this.x*t.m10+this.y*t.m11+t.worldY;if(this.data.inheritScale){this.worldScaleX=t.worldScaleX*this.scaleX;this.worldScaleY=t.worldScaleY*this.scaleY}else{this.worldScaleX=this.scaleX;this.worldScaleY=this.scaleY}this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK;this.worldFlipX=t.worldFlipX!=this.flipX;this.worldFlipY=t.worldFlipY!=this.flipY}else{var e=this.skeleton.flipX,r=this.skeleton.flipY;this.worldX=e?-this.x:this.x;this.worldY=r!=i.Bone.yDown?-this.y:this.y;this.worldScaleX=this.scaleX;this.worldScaleY=this.scaleY;this.worldRotation=this.rotationIK;this.worldFlipX=e!=this.flipX;this.worldFlipY=r!=this.flipY}var s=this.worldRotation*i.degRad,n=Math.cos(s),o=Math.sin(s);if(this.worldFlipX){this.m00=-n*this.worldScaleX;this.m01=o*this.worldScaleY}else{this.m00=n*this.worldScaleX;this.m01=-o*this.worldScaleY}if(this.worldFlipY!=i.Bone.yDown){this.m10=-o*this.worldScaleX;this.m11=-n*this.worldScaleY}else{this.m10=o*this.worldScaleX;this.m11=n*this.worldScaleY}},setToSetupPose:function(){var t=this.data;this.x=t.x;this.y=t.y;this.rotation=t.rotation;this.rotationIK=this.rotation;this.scaleX=t.scaleX;this.scaleY=t.scaleY;this.flipX=t.flipX;this.flipY=t.flipY},worldToLocal:function(t){var e=t[0]-this.worldX,r=t[1]-this.worldY,s=this.m00,n=this.m10,o=this.m01,a=this.m11;if(this.worldFlipX!=(this.worldFlipY!=i.Bone.yDown)){s=-s;a=-a}var h=1/(s*a-o*n);t[0]=e*s*h-r*o*h;t[1]=r*a*h-e*n*h},localToWorld:function(t){var e=t[0],i=t[1];t[0]=e*this.m00+i*this.m01+this.worldX;t[1]=e*this.m10+i*this.m11+this.worldY}};i.Slot=function(t,e){this.data=t;this.bone=e;this.setToSetupPose()};i.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment=t;this._attachmentTime=this.bone.skeleton.time;this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r;this.g=t.g;this.b=t.b;this.a=t.a;for(var e=this.bone.skeleton.data.slots,i=0,r=e.length;r>i;i++)if(e[i]==t){this.setAttachment(t.attachmentName?this.bone.skeleton.getAttachmentBySlotIndex(i,t.attachmentName):null);break}}};i.IkConstraint=function(t,e){this.data=t;this.mix=t.mix;this.bendDirection=t.bendDirection;this.bones=[];for(var i=0,r=t.bones.length;r>i;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)};i.IkConstraint.prototype={apply:function(){var t=this.target,e=this.bones;switch(e.length){case 1:i.IkConstraint.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:i.IkConstraint.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix)}}};i.IkConstraint.apply1=function(t,e,r,s){var n=t.data.inheritRotation&&t.parent?t.parent.worldRotation:0,o=t.rotation,a=Math.atan2(r-t.worldY,e-t.worldX)*i.radDeg-n;t.rotationIK=o+(a-o)*s};i.IkConstraint.apply2=function(t,e,r,s,n,o){var a=e.rotation,h=t.rotation;if(o){var l,u,c=i.temp,d=t.parent;if(d){c[0]=r;c[1]=s;d.worldToLocal(c);r=(c[0]-t.x)*d.worldScaleX;s=(c[1]-t.y)*d.worldScaleY}else{r-=t.x;s-=t.y}if(e.parent==t){l=e.x;u=e.y}else{c[0]=e.x;c[1]=e.y;e.parent.localToWorld(c);t.worldToLocal(c);l=c[0];u=c[1]}var p=l*t.worldScaleX,f=u*t.worldScaleY,g=Math.atan2(f,p),m=Math.sqrt(p*p+f*f),v=e.data.length*e.worldScaleX,x=2*m*v;if(1e-4>x)e.rotationIK=a+(Math.atan2(s,r)*i.radDeg-h-a)*o;else{var y=(r*r+s*s-m*m-v*v)/x;-1>y?y=-1:y>1&&(y=1);var b=Math.acos(y)*n,T=m+v*y,S=v*Math.sin(b),w=Math.atan2(s*T-r*S,r*T+s*S),C=(w-g)*i.radDeg-h;C>180?C-=360:-180>C&&(C+=360);t.rotationIK=h+C*o;C=(b+g)*i.radDeg-a;C>180?C-=360:-180>C&&(C+=360);e.rotationIK=a+(C+t.worldRotation-e.parent.worldRotation)*o}}else{e.rotationIK=a;t.rotationIK=h}};i.Skin=function(t){this.name=t;this.attachments={}};i.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var r=i.indexOf(":"),s=parseInt(i.substring(0,r)),n=i.substring(r+1),o=t.slots[s];if(o.attachment&&o.attachment.name==n){var a=this.getAttachment(s,n);a&&o.setAttachment(a)}}}};i.Animation=function(t,e,i){this.name=t;this.timelines=e;this.duration=i};i.Animation.prototype={apply:function(t,e,i,r,s){if(r&&0!=this.duration){i%=this.duration;e%=this.duration}for(var n=this.timelines,o=0,a=n.length;a>o;o++)n[o].apply(t,e,i,s,1)},mix:function(t,e,i,r,s,n){if(r&&0!=this.duration){i%=this.duration;e%=this.duration}for(var o=this.timelines,a=0,h=o.length;h>a;a++)o[a].apply(t,e,i,s,n)}};i.Animation.binarySearch=function(t,e,i){var r=0,s=Math.floor(t.length/i)-2;if(!s)return i;for(var n=s>>>1;;){t[(n+1)*i]<=e?r=n+1:s=n;if(r==s)return(r+1)*i;n=r+s>>>1}};i.Animation.binarySearch1=function(t,e){var i=0,r=t.length-2;if(!r)return 1;for(var s=r>>>1;;){t[s+1]<=e?i=s+1:r=s;if(i==r)return i+1;s=i+r>>>1}};i.Animation.linearSearch=function(t,e,i){for(var r=0,s=t.length-i;s>=r;r+=i)if(t[r]>e)return r;return-1};i.Curves=function(){this.curves=[]};i.Curves.prototype={setLinear:function(t){this.curves[19*t]=0},setStepped:function(t){this.curves[19*t]=1},setCurve:function(t,e,i,r,s){var n=.1,o=n*n,a=o*n,h=3*n,l=3*o,u=6*o,c=6*a,d=2*-e+r,p=2*-i+s,f=3*(e-r)+1,g=3*(i-s)+1,m=e*h+d*l+f*a,v=i*h+p*l+g*a,x=d*u+f*c,y=p*u+g*c,b=f*c,T=g*c,S=19*t,w=this.curves;w[S++]=2;for(var C=m,A=v,_=S+19-1;_>S;S+=2){w[S]=C;w[S+1]=A;m+=x;v+=y;x+=b;y+=T;C+=m;A+=v}},getCurvePercent:function(t,e){e=0>e?0:e>1?1:e;var i=this.curves,r=19*t,s=i[r];if(0===s)return e;if(1==s)return 0;r++;for(var n=0,o=r,a=r+19-1;a>r;r+=2){n=i[r];if(n>=e){var h,l;if(r==o){h=0;l=0}else{h=i[r-2];l=i[r-1]}return l+(i[r+1]-l)*(e-h)/(n-h)}}var u=i[r-1];return u+(1-u)*(e-n)/(1-n)}};i.RotateTimeline=function(t){this.curves=new i.Curves(t);this.frames=[];this.frames.length=2*t};i.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2;this.frames[t]=e;this.frames[t+1]=i},apply:function(t,e,r,s,n){var o=this.frames;if(!(r<o[0])){var a=t.bones[this.boneIndex];if(r>=o[o.length-2]){for(var h=a.data.rotation+o[o.length-1]-a.rotation;h>180;)h-=360;for(;-180>h;)h+=360;a.rotation+=h*n}else{var l=i.Animation.binarySearch(o,r,2),u=o[l-1],c=o[l],d=1-(r-c)/(o[l-2]-c);d=this.curves.getCurvePercent(l/2-1,d);for(var h=o[l+1]-u;h>180;)h-=360;for(;-180>h;)h+=360;h=a.data.rotation+(u+h*d)-a.rotation;for(;h>180;)h-=360;for(;-180>h;)h+=360;a.rotation+=h*n}}}};i.TranslateTimeline=function(t){this.curves=new i.Curves(t);this.frames=[];this.frames.length=3*t};i.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,r){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=r},apply:function(t,e,r,s,n){var o=this.frames;if(!(r<o[0])){var a=t.bones[this.boneIndex];if(r>=o[o.length-3]){a.x+=(a.data.x+o[o.length-2]-a.x)*n;a.y+=(a.data.y+o[o.length-1]-a.y)*n}else{var h=i.Animation.binarySearch(o,r,3),l=o[h-2],u=o[h-1],c=o[h],d=1-(r-c)/(o[h+-3]-c);d=this.curves.getCurvePercent(h/3-1,d);a.x+=(a.data.x+l+(o[h+1]-l)*d-a.x)*n;a.y+=(a.data.y+u+(o[h+2]-u)*d-a.y)*n}}}};i.ScaleTimeline=function(t){this.curves=new i.Curves(t);this.frames=[];this.frames.length=3*t};i.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,r){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=r},apply:function(t,e,r,s,n){var o=this.frames;if(!(r<o[0])){var a=t.bones[this.boneIndex];if(r>=o[o.length-3]){a.scaleX+=(a.data.scaleX*o[o.length-2]-a.scaleX)*n;a.scaleY+=(a.data.scaleY*o[o.length-1]-a.scaleY)*n}else{var h=i.Animation.binarySearch(o,r,3),l=o[h-2],u=o[h-1],c=o[h],d=1-(r-c)/(o[h+-3]-c);d=this.curves.getCurvePercent(h/3-1,d);a.scaleX+=(a.data.scaleX*(l+(o[h+1]-l)*d)-a.scaleX)*n;a.scaleY+=(a.data.scaleY*(u+(o[h+2]-u)*d)-a.scaleY)*n}}}};i.ColorTimeline=function(t){this.curves=new i.Curves(t);this.frames=[];this.frames.length=5*t};i.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,r,s,n){t*=5;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=r;this.frames[t+3]=s;this.frames[t+4]=n},apply:function(t,e,r,s,n){var o=this.frames;if(!(r<o[0])){var a,h,l,u;if(r>=o[o.length-5]){var c=o.length-1;a=o[c-3];h=o[c-2];l=o[c-1];u=o[c]}else{var d=i.Animation.binarySearch(o,r,5),p=o[d-4],f=o[d-3],g=o[d-2],m=o[d-1],v=o[d],x=1-(r-v)/(o[d-5]-v);x=this.curves.getCurvePercent(d/5-1,x);a=p+(o[d+1]-p)*x;h=f+(o[d+2]-f)*x;l=g+(o[d+3]-g)*x;u=m+(o[d+4]-m)*x}var y=t.slots[this.slotIndex];if(1>n){y.r+=(a-y.r)*n;y.g+=(h-y.g)*n;y.b+=(l-y.b)*n;y.a+=(u-y.a)*n}else{y.r=a;y.g=h;y.b=l;y.a=u}}}};i.AttachmentTimeline=function(t){this.curves=new i.Curves(t);this.frames=[];this.frames.length=t;this.attachmentNames=[];this.attachmentNames.length=t};i.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.attachmentNames[t]=i},apply:function(t,e,r){var s=this.frames;if(r<s[0])e>r&&this.apply(t,e,Number.MAX_VALUE,null,0);else{e>r&&(e=-1);var n=r>=s[s.length-1]?s.length-1:i.Animation.binarySearch1(s,r)-1;if(!(s[n]<e)){var o=this.attachmentNames[n];t.slots[this.slotIndex].setAttachment(o?t.getAttachmentBySlotIndex(this.slotIndex,o):null)}}}};i.EventTimeline=function(t){this.frames=[];this.frames.length=t;this.events=[];this.events.length=t};i.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.events[t]=i},apply:function(t,e,r,s,n){if(s){var o=this.frames,a=o.length;if(e>r){this.apply(t,e,Number.MAX_VALUE,s,n);e=-1}else if(e>=o[a-1])return;if(!(r<o[0])){var h;if(e<o[0])h=0;else{h=i.Animation.binarySearch1(o,e);for(var l=o[h];h>0&&o[h-1]==l;)h--}for(var u=this.events;a>h&&r>=o[h];h++)s.push(u[h])}}}};i.DrawOrderTimeline=function(t){this.frames=[];this.frames.length=t;this.drawOrders=[];this.drawOrders.length=t};i.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.drawOrders[t]=i},apply:function(t,e,r){var s=this.frames;if(!(r<s[0])){var n;n=r>=s[s.length-1]?s.length-1:i.Animation.binarySearch1(s,r)-1;var o=t.drawOrder,a=t.slots,h=this.drawOrders[n];if(h)for(var l=0,u=h.length;u>l;l++)o[l]=t.slots[h[l]];else for(var l=0,u=a.length;u>l;l++)o[l]=a[l]}}};i.FfdTimeline=function(t){this.curves=new i.Curves(t);this.frames=[];this.frames.length=t;this.frameVertices=[];this.frameVertices.length=t};i.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.frameVertices[t]=i},apply:function(t,e,r,s,n){var o=t.slots[this.slotIndex];if(o.attachment==this.attachment){var a=this.frames;if(!(r<a[0])){var h=this.frameVertices,l=h[0].length,u=o.attachmentVertices;u.length!=l&&(n=1);u.length=l;if(r>=a[a.length-1]){var c=h[a.length-1];if(1>n)for(var d=0;l>d;d++)u[d]+=(c[d]-u[d])*n;else for(var d=0;l>d;d++)u[d]=c[d]}else{var p=i.Animation.binarySearch1(a,r),f=a[p],g=1-(r-f)/(a[p-1]-f);g=this.curves.getCurvePercent(p-1,0>g?0:g>1?1:g);var m=h[p-1],v=h[p];if(1>n)for(var d=0;l>d;d++){var x=m[d];u[d]+=(x+(v[d]-x)*g-u[d])*n}else for(var d=0;l>d;d++){var x=m[d];u[d]=x+(v[d]-x)*g}}}}}};i.IkConstraintTimeline=function(t){this.curves=new i.Curves(t);this.frames=[];this.frames.length=3*t};i.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,r){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=r},apply:function(t,e,r,s,n){var o=this.frames;if(!(r<o[0])){var a=t.ikConstraints[this.ikConstraintIndex];if(r>=o[o.length-3]){a.mix+=(o[o.length-2]-a.mix)*n;a.bendDirection=o[o.length-1]}else{var h=i.Animation.binarySearch(o,r,3),l=o[h+-2],u=o[h],c=1-(r-u)/(o[h+-3]-u);c=this.curves.getCurvePercent(h/3-1,c);var d=l+(o[h+1]-l)*c;a.mix+=(d-a.mix)*n;a.bendDirection=o[h+-1]}}}};i.FlipXTimeline=function(t){this.curves=new i.Curves(t);this.frames=[];this.frames.length=2*t};i.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2;this.frames[t]=e;this.frames[t+1]=i?1:0},apply:function(t,e,r){var s=this.frames;if(r<s[0])e>r&&this.apply(t,e,Number.MAX_VALUE,null,0);else{e>r&&(e=-1);var n=(r>=s[s.length-2]?s.length:i.Animation.binarySearch(s,r,2))-2;s[n]<e||(t.bones[boneIndex].flipX=0!=s[n+1])}}};i.FlipYTimeline=function(t){this.curves=new i.Curves(t);this.frames=[];this.frames.length=2*t};i.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2;this.frames[t]=e;this.frames[t+1]=i?1:0},apply:function(t,e,r){var s=this.frames;if(r<s[0])e>r&&this.apply(t,e,Number.MAX_VALUE,null,0);else{e>r&&(e=-1);var n=(r>=s[s.length-2]?s.length:i.Animation.binarySearch(s,r,2))-2;s[n]<e||(t.bones[boneIndex].flipY=0!=s[n+1])}}};i.SkeletonData=function(){this.bones=[];this.slots=[];this.skins=[];this.events=[];this.animations=[];this.ikConstraints=[]};i.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].name==t)return slot[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){for(var e=this.skins,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},findEvent:function(t){for(var e=this.events,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){for(var e=this.animations,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null}};i.Skeleton=function(t){this.data=t;this.bones=[];for(var e=0,r=t.bones.length;r>e;e++){var s=t.bones[e],n=s.parent?this.bones[t.bones.indexOf(s.parent)]:null;this.bones.push(new i.Bone(s,this,n))}this.slots=[];this.drawOrder=[];for(var e=0,r=t.slots.length;r>e;e++){var o=t.slots[e],a=this.bones[t.bones.indexOf(o.boneData)],h=new i.Slot(o,a);this.slots.push(h);this.drawOrder.push(h)}this.ikConstraints=[];for(var e=0,r=t.ikConstraints.length;r>e;e++)this.ikConstraints.push(new i.IkConstraint(t.ikConstraints[e],this));this.boneCache=[];this.updateCache()};i.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var t=this.ikConstraints,e=t.length,i=e+1,r=this.boneCache;r.length>i&&(r.length=i);for(var s=0,n=r.length;n>s;s++)r[s].length=0;for(;r.length<i;)r[r.length]=[];var o=r[0],a=this.bones;t:for(var s=0,n=a.length;n>s;s++){var h=a[s],l=h;do{for(var u=0;e>u;u++)for(var c=t[u],d=c.bones[0],p=c.bones[c.bones.length-1];;){if(l==p){r[u].push(h);r[u+1].push(h);continue t}if(p==d)break;p=p.parent}l=l.parent}while(l);o[o.length]=h}},updateWorldTransform:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++){var r=t[e];r.rotationIK=r.rotation}for(var e=0,s=this.boneCache.length-1;;){for(var n=this.boneCache[e],o=0,a=n.length;a>o;o++)n[o].updateWorldTransform();if(e==s)break;this.ikConstraints[e].apply();e++}},setToSetupPose:function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++)t[e].setToSetupPose();for(var r=this.ikConstraints,e=0,i=r.length;i>e;e++){var s=r[e];s.bendDirection=s.data.bendDirection;s.mix=s.data.mix}},setSlotsToSetupPose:function(){for(var t=this.slots,e=this.drawOrder,i=0,r=t.length;r>i;i++){e[i]=t[i];t[i].setToSetupPose(i)}},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){if(t)if(this.skin)t._attachAll(this,this.skin);else for(var e=this.slots,i=0,r=e.length;r>i;i++){var s=e[i],n=s.data.attachmentName;if(n){var o=t.getAttachment(i,n);o&&s.setAttachment(o)}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var i=this.slots,r=0,s=i.length;s>r;r++){var n=i[r];if(n.data.name==t){var o=null;if(e){o=this.getAttachmentBySlotIndex(r,e);if(!o)throw"Attachment not found: "+e+", for slot: "+t}n.setAttachment(o);return}}throw"Slot not found: "+t},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return e[i];return null},update:function(t){this.time+=t}};i.EventData=function(t){this.name=t};i.EventData.prototype={intValue:0,floatValue:0,stringValue:null};i.Event=function(t){this.data=t};i.Event.prototype={intValue:0,floatValue:0,stringValue:null};i.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3};i.RegionAttachment=function(t){this.name=t;this.offset=[];this.offset.length=8;this.uvs=[];this.uvs.length=8};i.RegionAttachment.prototype={type:i.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,r,s){var n=this.uvs;if(s){n[2]=t;n[3]=r;n[4]=t;n[5]=e;n[6]=i;n[7]=e;n[0]=i;n[1]=r}else{n[0]=t;n[1]=r;n[2]=t;n[3]=e;n[4]=i;n[5]=e;n[6]=i;n[7]=r}},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.regionOffsetX*t,s=-this.height/2*this.scaleY+this.regionOffsetY*e,n=r+this.regionWidth*t,o=s+this.regionHeight*e,a=this.rotation*i.degRad,h=Math.cos(a),l=Math.sin(a),u=r*h+this.x,c=r*l,d=s*h+this.y,p=s*l,f=n*h+this.x,g=n*l,m=o*h+this.y,v=o*l,x=this.offset;x[0]=u-p;x[1]=d+c;x[2]=u-v;x[3]=m+c;x[4]=f-v;x[5]=m+g;x[6]=f-p;x[7]=d+g},computeVertices:function(t,e,i,r){t+=i.worldX;e+=i.worldY;var s=i.m00,n=i.m01,o=i.m10,a=i.m11,h=this.offset;r[0]=h[0]*s+h[1]*n+t;r[1]=h[0]*o+h[1]*a+e;r[2]=h[2]*s+h[3]*n+t;r[3]=h[2]*o+h[3]*a+e;r[4]=h[4]*s+h[5]*n+t;r[5]=h[4]*o+h[5]*a+e;r[6]=h[6]*s+h[7]*n+t;r[7]=h[6]*o+h[7]*a+e}};i.MeshAttachment=function(t){this.name=t};i.MeshAttachment.prototype={type:i.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,e=this.regionV2-this.regionV,r=this.regionUVs.length;this.uvs&&this.uvs.length==r||(this.uvs=new i.Float32Array(r));if(this.regionRotate)for(var s=0;r>s;s+=2){this.uvs[s]=this.regionU+this.regionUVs[s+1]*t;this.uvs[s+1]=this.regionV+e-this.regionUVs[s]*e}else for(var s=0;r>s;s+=2){this.uvs[s]=this.regionU+this.regionUVs[s]*t;this.uvs[s+1]=this.regionV+this.regionUVs[s+1]*e}},computeWorldVertices:function(t,e,i,r){var s=i.bone;t+=s.worldX;e+=s.worldY;var n=s.m00,o=s.m01,a=s.m10,h=s.m11,l=this.vertices,u=l.length;i.attachmentVertices.length==u&&(l=i.attachmentVertices);for(var c=0;u>c;c+=2){var d=l[c],p=l[c+1];r[c]=d*n+p*o+t;r[c+1]=d*a+p*h+e}}};i.SkinnedMeshAttachment=function(t){this.name=t};i.SkinnedMeshAttachment.prototype={type:i.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,e=this.regionV2-this.regionV,r=this.regionUVs.length;this.uvs&&this.uvs.length==r||(this.uvs=new i.Float32Array(r));if(this.regionRotate)for(var s=0;r>s;s+=2){this.uvs[s]=this.regionU+this.regionUVs[s+1]*t;this.uvs[s+1]=this.regionV+e-this.regionUVs[s]*e}else for(var s=0;r>s;s+=2){this.uvs[s]=this.regionU+this.regionUVs[s]*t;this.uvs[s+1]=this.regionV+this.regionUVs[s+1]*e}},computeWorldVertices:function(t,e,i,r){var s,n,o,a,h,l,u,c=i.bone.skeleton.bones,d=this.weights,p=this.bones,f=0,g=0,m=0,v=0,x=p.length;if(i.attachmentVertices.length)for(var y=i.attachmentVertices;x>g;f+=2){n=0;o=0;s=p[g++]+g;for(;s>g;g++,m+=3,v+=2){a=c[p[g]];h=d[m]+y[v];l=d[m+1]+y[v+1];u=d[m+2];n+=(h*a.m00+l*a.m01+a.worldX)*u;o+=(h*a.m10+l*a.m11+a.worldY)*u}r[f]=n+t;r[f+1]=o+e}else for(;x>g;f+=2){n=0;o=0;s=p[g++]+g;for(;s>g;g++,m+=3){a=c[p[g]];h=d[m];l=d[m+1];u=d[m+2];n+=(h*a.m00+l*a.m01+a.worldX)*u;o+=(h*a.m10+l*a.m11+a.worldY)*u}r[f]=n+t;r[f+1]=o+e}}};i.BoundingBoxAttachment=function(t){this.name=t;this.vertices=[]};i.BoundingBoxAttachment.prototype={type:i.AttachmentType.boundingbox,computeWorldVertices:function(t,e,i,r){t+=i.worldX;e+=i.worldY;for(var s=i.m00,n=i.m01,o=i.m10,a=i.m11,h=this.vertices,l=0,u=h.length;u>l;l+=2){var c=h[l],d=h[l+1];r[l]=c*s+d*n+t;r[l+1]=c*o+d*a+e}}};i.AnimationStateData=function(t){this.skeletonData=t;this.animationToMixTime={}};i.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var r=this.skeletonData.findAnimation(t);if(!r)throw"Animation not found: "+t;var s=this.skeletonData.findAnimation(e);if(!s)throw"Animation not found: "+e;this.setMix(r,s,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}};i.TrackEntry=function(){};i.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null};i.AnimationState=function(t){this.data=t;this.tracks=[];this.events=[]};i.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){i.time+=t*i.timeScale;if(i.previous){var r=t*i.previous.timeScale;i.previous.time+=r;i.mixTime+=r}var s=i.next;if(s){s.time=i.lastTime-s.delay;s.time>=0&&this.setCurrent(e,s)}else!i.loop&&i.lastTime>=i.endTime&&this.clearTrack(e)}}},apply:function(t){for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){this.events.length=0;var r=i.time,s=i.lastTime,n=i.endTime,o=i.loop;!o&&r>n&&(r=n);var a=i.previous;if(a){var h=a.time;!a.loop&&h>a.endTime&&(h=a.endTime);a.animation.apply(t,h,h,a.loop,null);var l=i.mixTime/i.mixDuration*i.mix;if(l>=1){l=1;i.previous=null}i.animation.mix(t,i.lastTime,r,o,this.events,l)}else 1==i.mix?i.animation.apply(t,i.lastTime,r,o,this.events):i.animation.mix(t,i.lastTime,r,o,this.events,i.mix);for(var u=0,c=this.events.length;c>u;u++){var d=this.events[u];i.onEvent&&i.onEvent(e,d);this.onEvent&&this.onEvent(e,d)}if(o?s%n>r%n:n>s&&r>=n){var p=Math.floor(r/n);i.onComplete&&i.onComplete(e,p);this.onComplete&&this.onComplete(e,p)}i.lastTime=i.time}}},clearTracks:function(){for(var t=0,e=this.tracks.length;e>t;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];
if(e){e.onEnd&&e.onEnd(t);this.onEnd&&this.onEnd(t);this.tracks[t]=null}}},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];for(;t>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(t,e){var i=this._expandToIndex(t);if(i){var r=i.previous;i.previous=null;i.onEnd&&i.onEnd(t);this.onEnd&&this.onEnd(t);e.mixDuration=this.data.getMix(i.animation,e.animation);if(e.mixDuration>0){e.mixTime=0;e.previous=r&&i.mixTime/i.mixDuration<.5?r:i}}this.tracks[t]=e;e.onStart&&e.onStart(t);this.onStart&&this.onStart(t)},setAnimationByName:function(t,e,i){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;return this.setAnimation(t,r,i)},setAnimation:function(t,e,r){var s=new i.TrackEntry;s.animation=e;s.loop=r;s.endTime=e.duration;this.setCurrent(t,s);return s},addAnimationByName:function(t,e,i,r){var s=this.data.skeletonData.findAnimation(e);if(!s)throw"Animation not found: "+e;return this.addAnimation(t,s,i,r)},addAnimation:function(t,e,r,s){var n=new i.TrackEntry;n.animation=e;n.loop=r;n.endTime=e.duration;var o=this._expandToIndex(t);if(o){for(;o.next;)o=o.next;o.next=n}else this.tracks[t]=n;0>=s&&(o?s+=o.endTime-this.data.getMix(o.animation,e):s=0);n.delay=s;return n},getCurrent:function(t){return t>=this.tracks.length?null:this.tracks[t]}};i.SkeletonJson=function(t){this.attachmentLoader=t};i.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,e){var r=new i.SkeletonData;r.name=e;var s=t.skeleton;if(s){r.hash=s.hash;r.version=s.spine;r.width=s.width||0;r.height=s.height||0}for(var n=t.bones,o=0,a=n.length;a>o;o++){var h=n[o],l=null;if(h.parent){l=r.findBone(h.parent);if(!l)throw"Parent bone not found: "+h.parent}var u=new i.BoneData(h.name,l);u.length=(h.length||0)*this.scale;u.x=(h.x||0)*this.scale;u.y=(h.y||0)*this.scale;u.rotation=h.rotation||0;u.scaleX=h.hasOwnProperty("scaleX")?h.scaleX:1;u.scaleY=h.hasOwnProperty("scaleY")?h.scaleY:1;u.inheritScale=h.hasOwnProperty("inheritScale")?h.inheritScale:!0;u.inheritRotation=h.hasOwnProperty("inheritRotation")?h.inheritRotation:!0;r.bones.push(u)}var c=t.ik;if(c)for(var o=0,a=c.length;a>o;o++){for(var d=c[o],p=new i.IkConstraintData(d.name),n=d.bones,f=0,g=n.length;g>f;f++){var m=r.findBone(n[f]);if(!m)throw"IK bone not found: "+n[f];p.bones.push(m)}p.target=r.findBone(d.target);if(!p.target)throw"Target bone not found: "+d.target;p.bendDirection=!d.hasOwnProperty("bendPositive")||d.bendPositive?1:-1;p.mix=d.hasOwnProperty("mix")?d.mix:1;r.ikConstraints.push(p)}for(var v=t.slots,o=0,a=v.length;a>o;o++){var x=v[o],u=r.findBone(x.bone);if(!u)throw"Slot bone not found: "+x.bone;var y=new i.SlotData(x.name,u),b=x.color;if(b){y.r=this.toColor(b,0);y.g=this.toColor(b,1);y.b=this.toColor(b,2);y.a=this.toColor(b,3)}y.attachmentName=x.attachment;y.additiveBlending=x.additive&&"true"==x.additive;r.slots.push(y)}var T=t.skins;for(var S in T)if(T.hasOwnProperty(S)){var w=T[S],C=new i.Skin(S);for(var A in w)if(w.hasOwnProperty(A)){var _=r.findSlotIndex(A),E=w[A];for(var M in E)if(E.hasOwnProperty(M)){var R=this.readAttachment(C,M,E[M]);R&&C.addAttachment(_,M,R)}}r.skins.push(C);"default"==C.name&&(r.defaultSkin=C)}var L=t.events;for(var F in L)if(L.hasOwnProperty(F)){var B=L[F],P=new i.EventData(F);P.intValue=B["int"]||0;P.floatValue=B["float"]||0;P.stringValue=B.string||null;r.events.push(P)}var D=t.animations;for(var I in D)D.hasOwnProperty(I)&&this.readAnimation(I,D[I],r);return r},readAttachment:function(t,e,r){e=r.name||e;var s=i.AttachmentType[r.type||"region"],n=r.path||e,o=this.scale;if(s==i.AttachmentType.region){var a=this.attachmentLoader.newRegionAttachment(t,e,n);if(!a)return null;a.path=n;a.x=(r.x||0)*o;a.y=(r.y||0)*o;a.scaleX=r.hasOwnProperty("scaleX")?r.scaleX:1;a.scaleY=r.hasOwnProperty("scaleY")?r.scaleY:1;a.rotation=r.rotation||0;a.width=(r.width||0)*o;a.height=(r.height||0)*o;var h=r.color;if(h){a.r=this.toColor(h,0);a.g=this.toColor(h,1);a.b=this.toColor(h,2);a.a=this.toColor(h,3)}a.updateOffset();return a}if(s==i.AttachmentType.mesh){var l=this.attachmentLoader.newMeshAttachment(t,e,n);if(!l)return null;l.path=n;l.vertices=this.getFloatArray(r,"vertices",o);l.triangles=this.getIntArray(r,"triangles");l.regionUVs=this.getFloatArray(r,"uvs",1);l.updateUVs();h=r.color;if(h){l.r=this.toColor(h,0);l.g=this.toColor(h,1);l.b=this.toColor(h,2);l.a=this.toColor(h,3)}l.hullLength=2*(r.hull||0);r.edges&&(l.edges=this.getIntArray(r,"edges"));l.width=(r.width||0)*o;l.height=(r.height||0)*o;return l}if(s==i.AttachmentType.skinnedmesh){var l=this.attachmentLoader.newSkinnedMeshAttachment(t,e,n);if(!l)return null;l.path=n;for(var u=this.getFloatArray(r,"uvs",1),c=this.getFloatArray(r,"vertices",1),d=[],p=[],f=0,g=c.length;g>f;){var m=0|c[f++];p[p.length]=m;for(var v=f+4*m;v>f;){p[p.length]=c[f];d[d.length]=c[f+1]*o;d[d.length]=c[f+2]*o;d[d.length]=c[f+3];f+=4}}l.bones=p;l.weights=d;l.triangles=this.getIntArray(r,"triangles");l.regionUVs=u;l.updateUVs();h=r.color;if(h){l.r=this.toColor(h,0);l.g=this.toColor(h,1);l.b=this.toColor(h,2);l.a=this.toColor(h,3)}l.hullLength=2*(r.hull||0);r.edges&&(l.edges=this.getIntArray(r,"edges"));l.width=(r.width||0)*o;l.height=(r.height||0)*o;return l}if(s==i.AttachmentType.boundingbox){for(var x=this.attachmentLoader.newBoundingBoxAttachment(t,e),c=r.vertices,f=0,g=c.length;g>f;f++)x.vertices.push(c[f]*o);return x}throw"Unknown attachment type: "+s},readAnimation:function(t,e,r){var s=[],n=0,o=e.slots;for(var a in o)if(o.hasOwnProperty(a)){var h=o[a],l=r.findSlotIndex(a);for(var u in h)if(h.hasOwnProperty(u)){var c=h[u];if("color"==u){var d=new i.ColorTimeline(c.length);d.slotIndex=l;for(var p=0,f=0,g=c.length;g>f;f++){var m=c[f],v=m.color,x=this.toColor(v,0),y=this.toColor(v,1),b=this.toColor(v,2),T=this.toColor(v,3);d.setFrame(p,m.time,x,y,b,T);this.readCurve(d,p,m);p++}s.push(d);n=Math.max(n,d.frames[5*d.getFrameCount()-5])}else{if("attachment"!=u)throw"Invalid timeline type for a slot: "+u+" ("+a+")";var d=new i.AttachmentTimeline(c.length);d.slotIndex=l;for(var p=0,f=0,g=c.length;g>f;f++){var m=c[f];d.setFrame(p++,m.time,m.name)}s.push(d);n=Math.max(n,d.frames[d.getFrameCount()-1])}}}var S=e.bones;for(var w in S)if(S.hasOwnProperty(w)){var C=r.findBoneIndex(w);if(-1==C)throw"Bone not found: "+w;var A=S[w];for(var u in A)if(A.hasOwnProperty(u)){var c=A[u];if("rotate"==u){var d=new i.RotateTimeline(c.length);d.boneIndex=C;for(var p=0,f=0,g=c.length;g>f;f++){var m=c[f];d.setFrame(p,m.time,m.angle);this.readCurve(d,p,m);p++}s.push(d);n=Math.max(n,d.frames[2*d.getFrameCount()-2])}else if("translate"==u||"scale"==u){var d,_=1;if("scale"==u)d=new i.ScaleTimeline(c.length);else{d=new i.TranslateTimeline(c.length);_=this.scale}d.boneIndex=C;for(var p=0,f=0,g=c.length;g>f;f++){var m=c[f],E=(m.x||0)*_,M=(m.y||0)*_;d.setFrame(p,m.time,E,M);this.readCurve(d,p,m);p++}s.push(d);n=Math.max(n,d.frames[3*d.getFrameCount()-3])}else{if("flipX"!=u&&"flipY"!=u)throw"Invalid timeline type for a bone: "+u+" ("+w+")";var E="flipX"==u,d=E?new i.FlipXTimeline(c.length):new i.FlipYTimeline(c.length);d.boneIndex=C;for(var R=E?"x":"y",p=0,f=0,g=c.length;g>f;f++){var m=c[f];d.setFrame(p,m.time,m[R]||!1);p++}s.push(d);n=Math.max(n,d.frames[2*d.getFrameCount()-2])}}}var L=e.ik;for(var F in L)if(L.hasOwnProperty(F)){var B=r.findIkConstraint(F),c=L[F],d=new i.IkConstraintTimeline(c.length);d.ikConstraintIndex=r.ikConstraints.indexOf(B);for(var p=0,f=0,g=c.length;g>f;f++){var m=c[f],P=m.hasOwnProperty("mix")?m.mix:1,D=!m.hasOwnProperty("bendPositive")||m.bendPositive?1:-1;d.setFrame(p,m.time,P,D);this.readCurve(d,p,m);p++}s.push(d);n=Math.max(n,d.frames[3*d.frameCount-3])}var I=e.ffd;for(var O in I){var G=r.findSkin(O),h=I[O];for(a in h){var l=r.findSlotIndex(a),U=h[a];for(var k in U){var c=U[k],d=new i.FfdTimeline(c.length),N=G.getAttachment(l,k);if(!N)throw"FFD attachment not found: "+k;d.slotIndex=l;d.attachment=N;var j,W=N.type==i.AttachmentType.mesh;j=W?N.vertices.length:N.weights.length/3*2;for(var p=0,f=0,g=c.length;g>f;f++){var Y,m=c[f];if(m.vertices){var V=m.vertices,Y=[];Y.length=j;var X=m.offset||0,z=V.length;if(1==this.scale)for(var H=0;z>H;H++)Y[H+X]=V[H];else for(var H=0;z>H;H++)Y[H+X]=V[H]*this.scale;if(W)for(var q=N.vertices,H=0,z=Y.length;z>H;H++)Y[H]+=q[H]}else if(W)Y=N.vertices;else{Y=[];Y.length=j}d.setFrame(p,m.time,Y);this.readCurve(d,p,m);p++}s[s.length]=d;n=Math.max(n,d.frames[d.frameCount-1])}}}var K=e.drawOrder;K||(K=e.draworder);if(K){for(var d=new i.DrawOrderTimeline(K.length),J=r.slots.length,p=0,f=0,g=K.length;g>f;f++){var Q=K[f],$=null;if(Q.offsets){$=[];$.length=J;for(var H=J-1;H>=0;H--)$[H]=-1;var Z=Q.offsets,te=[];te.length=J-Z.length;for(var ee=0,ie=0,H=0,z=Z.length;z>H;H++){var re=Z[H],l=r.findSlotIndex(re.slot);if(-1==l)throw"Slot not found: "+re.slot;for(;ee!=l;)te[ie++]=ee++;$[ee+re.offset]=ee++}for(;J>ee;)te[ie++]=ee++;for(var H=J-1;H>=0;H--)-1==$[H]&&($[H]=te[--ie])}d.setFrame(p++,Q.time,$)}s.push(d);n=Math.max(n,d.frames[d.getFrameCount()-1])}var se=e.events;if(se){for(var d=new i.EventTimeline(se.length),p=0,f=0,g=se.length;g>f;f++){var ne=se[f],oe=r.findEvent(ne.name);if(!oe)throw"Event not found: "+ne.name;var ae=new i.Event(oe);ae.intValue=ne.hasOwnProperty("int")?ne["int"]:oe.intValue;ae.floatValue=ne.hasOwnProperty("float")?ne["float"]:oe.floatValue;ae.stringValue=ne.hasOwnProperty("string")?ne.string:oe.stringValue;d.setFrame(p++,ne.time,ae)}s.push(d);n=Math.max(n,d.frames[d.getFrameCount()-1])}r.animations.push(new i.Animation(t,s,n))},readCurve:function(t,e,i){var r=i.curve;r?"stepped"==r?t.curves.setStepped(e):r instanceof Array&&t.curves.setCurve(e,r[0],r[1],r[2],r[3]):t.curves.setLinear(e)},toColor:function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2*e+2),16)/255},getFloatArray:function(t,e,r){var s=t[e],n=new i.Float32Array(s.length),o=0,a=s.length;if(1==r)for(;a>o;o++)n[o]=s[o];else for(;a>o;o++)n[o]=s[o]*r;return n},getIntArray:function(t,e){for(var r=t[e],s=new i.Uint16Array(r.length),n=0,o=r.length;o>n;n++)s[n]=0|r[n];return s}};i.Atlas=function(t,e){this.textureLoader=e;this.pages=[];this.regions=[];var r=new i.AtlasReader(t),s=[];s.length=4;for(var n=null;;){var o=r.readLine();if(null===o)break;o=r.trim(o);if(o.length)if(n){var a=new i.AtlasRegion;a.name=o;a.page=n;a.rotate="true"==r.readValue();r.readTuple(s);var h=parseInt(s[0]),l=parseInt(s[1]);r.readTuple(s);var u=parseInt(s[0]),c=parseInt(s[1]);a.u=h/n.width;a.v=l/n.height;if(a.rotate){a.u2=(h+c)/n.width;a.v2=(l+u)/n.height}else{a.u2=(h+u)/n.width;a.v2=(l+c)/n.height}a.x=h;a.y=l;a.width=Math.abs(u);a.height=Math.abs(c);if(4==r.readTuple(s)){a.splits=[parseInt(s[0]),parseInt(s[1]),parseInt(s[2]),parseInt(s[3])];if(4==r.readTuple(s)){a.pads=[parseInt(s[0]),parseInt(s[1]),parseInt(s[2]),parseInt(s[3])];r.readTuple(s)}}a.originalWidth=parseInt(s[0]);a.originalHeight=parseInt(s[1]);r.readTuple(s);a.offsetX=parseInt(s[0]);a.offsetY=parseInt(s[1]);a.index=parseInt(r.readValue());this.regions.push(a)}else{n=new i.AtlasPage;n.name=o;if(2==r.readTuple(s)){n.width=parseInt(s[0]);n.height=parseInt(s[1]);r.readTuple(s)}n.format=i.Atlas.Format[s[0]];r.readTuple(s);n.minFilter=i.Atlas.TextureFilter[s[0]];n.magFilter=i.Atlas.TextureFilter[s[1]];var d=r.readValue();n.uWrap=i.Atlas.TextureWrap.clampToEdge;n.vWrap=i.Atlas.TextureWrap.clampToEdge;"x"==d?n.uWrap=i.Atlas.TextureWrap.repeat:"y"==d?n.vWrap=i.Atlas.TextureWrap.repeat:"xy"==d&&(n.uWrap=n.vWrap=i.Atlas.TextureWrap.repeat);e.load(n,o,this);this.pages.push(n)}else n=null}};i.Atlas.prototype={findRegion:function(t){for(var e=this.regions,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},dispose:function(){for(var t=this.pages,e=0,i=t.length;i>e;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,i=0,r=e.length;r>i;i++){var s=e[i];if(s.page==t){s.u=s.x/t.width;s.v=s.y/t.height;if(s.rotate){s.u2=(s.x+s.height)/t.width;s.v2=(s.y+s.width)/t.height}else{s.u2=(s.x+s.width)/t.width;s.v2=(s.y+s.height)/t.height}}}}};i.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6};i.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6};i.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2};i.AtlasPage=function(){};i.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0};i.AtlasRegion=function(){};i.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null};i.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)};i.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw"Invalid line: "+e;for(var r=0,s=i+1;3>r;r++){var n=e.indexOf(",",s);if(-1==n)break;t[r]=this.trim(e.substr(s,n-s));s=n+1}t[r]=this.trim(e.substring(s));return r+1}};i.AtlasAttachmentLoader=function(t){this.atlas=t};i.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,e,r){var s=this.atlas.findRegion(r);if(s){var n=new i.RegionAttachment(e);n.rendererObject=s;n.setUVs(s.u,s.v,s.u2,s.v2,s.rotate);n.regionOffsetX=s.offsetX;n.regionOffsetY=s.offsetY;n.regionWidth=s.width;n.regionHeight=s.height;n.regionOriginalWidth=s.originalWidth;n.regionOriginalHeight=s.originalHeight;return n}console.log("Region not found in atlas: "+r+" (region attachment: "+e+")")},newMeshAttachment:function(t,e,r){var s=this.atlas.findRegion(r);if(s){var n=new i.MeshAttachment(e);n.rendererObject=s;n.regionU=s.u;n.regionV=s.v;n.regionU2=s.u2;n.regionV2=s.v2;n.regionRotate=s.rotate;n.regionOffsetX=s.offsetX;n.regionOffsetY=s.offsetY;n.regionWidth=s.width;n.regionHeight=s.height;n.regionOriginalWidth=s.originalWidth;n.regionOriginalHeight=s.originalHeight;return n}console.log("Region not found in atlas: "+r+" (mesh attachment: "+e+")")},newSkinnedMeshAttachment:function(t,e,r){var s=this.atlas.findRegion(r);if(s){var n=new i.SkinnedMeshAttachment(e);n.rendererObject=s;n.regionU=s.u;n.regionV=s.v;n.regionU2=s.u2;n.regionV2=s.v2;n.regionRotate=s.rotate;n.regionOffsetX=s.offsetX;n.regionOffsetY=s.offsetY;n.regionWidth=s.width;n.regionHeight=s.height;n.regionOriginalWidth=s.originalWidth;n.regionOriginalHeight=s.originalHeight;return n}console.log("Region not found in atlas: "+r+" (skinned mesh attachment: "+e+")")},newBoundingBoxAttachment:function(t,e){return new i.BoundingBoxAttachment(e)}};i.SkeletonBounds=function(){this.polygonPool=[];this.polygons=[];this.boundingBoxes=[]};i.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,e){var r=t.slots,s=r.length,n=t.x,o=t.y,a=this.boundingBoxes,h=this.polygonPool,l=this.polygons;a.length=0;for(var u=0,c=l.length;c>u;u++)h.push(l[u]);l.length=0;for(var u=0;s>u;u++){var d=r[u],p=d.attachment;if(p.type==i.AttachmentType.boundingbox){a.push(p);var f,g=h.length;if(g>0){f=h[g-1];h.splice(g-1,1)}else f=[];l.push(f);f.length=p.vertices.length;p.computeWorldVertices(n,o,d.bone,f)}}e&&this.aabbCompute()},aabbCompute:function(){for(var t=this.polygons,e=Number.MAX_VALUE,i=Number.MAX_VALUE,r=Number.MIN_VALUE,s=Number.MIN_VALUE,n=0,o=t.length;o>n;n++)for(var a=t[n],h=0,l=a.length;l>h;h+=2){var u=a[h],c=a[h+1];e=Math.min(e,u);i=Math.min(i,c);r=Math.max(r,u);s=Math.max(s,c)}this.minX=e;this.minY=i;this.maxX=r;this.maxY=s},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,i,r){var s=this.minX,n=this.minY,o=this.maxX,a=this.maxY;if(s>=t&&s>=i||n>=e&&n>=r||t>=o&&i>=o||e>=a&&r>=a)return!1;var h=(r-e)/(i-t),l=h*(s-t)+e;if(l>n&&a>l)return!0;l=h*(o-t)+e;if(l>n&&a>l)return!0;var u=(n-e)/h+t;if(u>s&&o>u)return!0;u=(a-e)/h+t;return u>s&&o>u?!0:!1},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){for(var i=this.polygons,r=0,s=i.length;s>r;r++)if(this.polygonContainsPoint(i[r],t,e))return this.boundingBoxes[r];return null},intersectsSegment:function(t,e,i,r){for(var s=this.polygons,n=0,o=s.length;o>n;n++)if(s[n].intersectsSegment(t,e,i,r))return this.boundingBoxes[n];return null},polygonContainsPoint:function(t,e,i){for(var r=t.length,s=r-2,n=!1,o=0;r>o;o+=2){var a=t[o+1],h=t[s+1];if(i>a&&h>=i||i>h&&a>=i){var l=t[o];l+(i-a)/(h-a)*(t[s]-l)<e&&(n=!n)}s=o}return n},polygonIntersectsSegment:function(t,e,i,r,s){for(var n=t.length,o=e-r,a=i-s,h=e*s-i*r,l=t[n-2],u=t[n-1],c=0;n>c;c+=2){var d=t[c],p=t[c+1],f=l*p-u*d,g=l-d,m=u-p,v=o*m-a*g,x=(h*g-o*f)/v;if((x>=l&&d>=x||x>=d&&l>=x)&&(x>=e&&r>=x||x>=r&&e>=x)){var y=(h*m-a*f)/v;if((y>=u&&p>=y||y>=p&&u>=y)&&(y>=i&&s>=y||y>=s&&i>=y))return!0}l=d;u=p}return!1},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}};i.Bone.yDown=!0;e.AnimCache={};e.SpineTextureLoader=function(t,i){e.EventTarget.call(this);this.basePath=t;this.crossorigin=i;this.loadingCount=0};e.SpineTextureLoader.prototype=e.SpineTextureLoader;e.SpineTextureLoader.prototype.load=function(t,i){t.rendererObject=e.BaseTexture.fromImage(this.basePath+"/"+i,this.crossorigin);if(!t.rendererObject.hasLoaded){var r=this;++r.loadingCount;t.rendererObject.addEventListener("loaded",function(){--r.loadingCount;r.dispatchEvent({type:"loadedBaseTexture",content:r})})}};e.SpineTextureLoader.prototype.unload=function(t){t.destroy(!0)};e.Spine=function(t){e.DisplayObjectContainer.call(this);this.spineData=e.AnimCache[t];if(!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+t);this.skeleton=new i.Skeleton(this.spineData);this.skeleton.updateWorldTransform();this.stateData=new i.AnimationStateData(this.spineData);this.state=new i.AnimationState(this.stateData);this.slotContainers=[];for(var r=0,s=this.skeleton.drawOrder.length;s>r;r++){var n=this.skeleton.drawOrder[r],o=n.attachment,a=new e.DisplayObjectContainer;this.slotContainers.push(a);this.addChild(a);if(o instanceof i.RegionAttachment){var h=o.rendererObject.name,l=this.createSprite(n,o);n.currentSprite=l;n.currentSpriteName=h;a.addChild(l)}else{if(!(o instanceof i.MeshAttachment))continue;var u=this.createMesh(n,o);n.currentMesh=u;n.currentMeshName=o.name;a.addChild(u)}}this.autoUpdate=!0};e.Spine.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Spine.prototype.constructor=e.Spine;Object.defineProperty(e.Spine.prototype,"autoUpdate",{get:function(){return this.updateTransform===e.Spine.prototype.autoUpdateTransform},set:function(t){this.updateTransform=t?e.Spine.prototype.autoUpdateTransform:e.DisplayObjectContainer.prototype.updateTransform}});e.Spine.prototype.update=function(t){this.state.update(t);this.state.apply(this.skeleton);this.skeleton.updateWorldTransform();for(var r=this.skeleton.drawOrder,s=0,n=r.length;n>s;s++){var o=r[s],a=o.attachment,h=this.slotContainers[s];if(a){var l=a.type;if(l===i.AttachmentType.region){if(a.rendererObject&&(!o.currentSpriteName||o.currentSpriteName!==a.name)){var u=a.rendererObject.name;void 0!==o.currentSprite&&(o.currentSprite.visible=!1);o.sprites=o.sprites||{};if(void 0!==o.sprites[u])o.sprites[u].visible=!0;else{var c=this.createSprite(o,a);h.addChild(c)}o.currentSprite=o.sprites[u];o.currentSpriteName=u}var d=o.bone;h.position.x=d.worldX+a.x*d.m00+a.y*d.m01;h.position.y=d.worldY+a.x*d.m10+a.y*d.m11;h.scale.x=d.worldScaleX;h.scale.y=d.worldScaleY;h.rotation=-(o.bone.worldRotation*i.degRad);o.currentSprite.tint=e.rgb2hex([o.r,o.g,o.b])}else{if(l!==i.AttachmentType.skinnedmesh){h.visible=!1;continue}if(!o.currentMeshName||o.currentMeshName!==a.name){var p=a.name;void 0!==o.currentMesh&&(o.currentMesh.visible=!1);o.meshes=o.meshes||{};if(void 0!==o.meshes[p])o.meshes[p].visible=!0;else{var f=this.createMesh(o,a);h.addChild(f)}o.currentMesh=o.meshes[p];o.currentMeshName=p}a.computeWorldVertices(o.bone.skeleton.x,o.bone.skeleton.y,o,o.currentMesh.vertices)}h.visible=!0;h.alpha=o.a}else h.visible=!1}};e.Spine.prototype.autoUpdateTransform=function(){this.lastTime=this.lastTime||Date.now();var t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now();this.update(t);e.DisplayObjectContainer.prototype.updateTransform.call(this)};e.Spine.prototype.createSprite=function(t,r){var s=r.rendererObject,n=s.page.rendererObject,o=new e.Rectangle(s.x,s.y,s.rotate?s.height:s.width,s.rotate?s.width:s.height),a=new e.Texture(n,o),h=new e.Sprite(a),l=s.rotate?.5*Math.PI:0;h.scale.set(s.width/s.originalWidth,s.height/s.originalHeight);h.rotation=l-r.rotation*i.degRad;h.anchor.x=h.anchor.y=.5;t.sprites=t.sprites||{};t.sprites[s.name]=h;return h};e.Spine.prototype.createMesh=function(t,i){var r=i.rendererObject,s=r.page.rendererObject,n=new e.Texture(s),o=new e.Strip(n);o.drawMode=e.Strip.DrawModes.TRIANGLES;o.canvasPadding=1.5;o.vertices=new e.Float32Array(i.uvs.length);o.uvs=i.uvs;o.indices=i.triangles;t.meshes=t.meshes||{};t.meshes[i.name]=o;return o};e.BaseTextureCache={};e.BaseTextureCacheIdGenerator=0;e.BaseTexture=function(t,i){this.resolution=1;this.width=100;this.height=100;this.scaleMode=i||e.scaleModes.DEFAULT;this.hasLoaded=!1;this.source=t;this._UID=e._UID++;this.premultipliedAlpha=!0;this._glTextures=[];this.mipmap=!1;this._dirty=[!0,!0,!0,!0];if(t){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this.hasLoaded=!0;this.width=this.source.naturalWidth||this.source.width;this.height=this.source.naturalHeight||this.source.height;this.dirty()}else{var r=this;this.source.onload=function(){r.hasLoaded=!0;r.width=r.source.naturalWidth||r.source.width;r.height=r.source.naturalHeight||r.source.height;r.dirty();r.dispatchEvent({type:"loaded",content:r})};this.source.onerror=function(){r.dispatchEvent({type:"error",content:r})}}this.imageUrl=null;this._powerOf2=!1}};e.BaseTexture.prototype.constructor=e.BaseTexture;e.EventTarget.mixin(e.BaseTexture.prototype);e.BaseTexture.prototype.destroy=function(){if(this.imageUrl){delete e.BaseTextureCache[this.imageUrl];delete e.TextureCache[this.imageUrl];this.imageUrl=null;navigator.isCocoonJS||(this.source.src="")}else this.source&&this.source._pixiId&&delete e.BaseTextureCache[this.source._pixiId];this.source=null;this.unloadFromGPU()};e.BaseTexture.prototype.updateSourceImage=function(t){this.hasLoaded=!1;this.source.src=null;this.source.src=t};e.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0};e.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;t>=0;t--){var i=this._glTextures[t],r=e.glContexts[t];r&&i&&r.deleteTexture(i)}this._glTextures.length=0;this.dirty()};e.loadedImages_={};e.BaseTexture.fromImage=function(t,i,r){var s=e.BaseTextureCache[t];void 0===i&&-1===t.indexOf("data:")&&(i=!0);if(!s){var n=e.loadedImages_[t];if(!n){n=new Image;n.src=t;e.loadedImages_[t]=n;console.log("not preloaded:"+t)}s=new e.BaseTexture(n,r);s.imageUrl=t;e.BaseTextureCache[t]=s;-1!==t.indexOf(e.RETINA_PREFIX+".")&&(s.resolution=2)}return s};e.BaseTexture.fromCanvas=function(t,i){t._pixiId||(t._pixiId="canvas_"+e.TextureCacheIdGenerator++);var r=e.BaseTextureCache[t._pixiId];if(!r){r=new e.BaseTexture(t,i);e.BaseTextureCache[t._pixiId]=r}return r};e.TextureCache={};e.FrameCache={};e.TextureCacheIdGenerator=0;e.Texture=function(t,i,r,s){this.noFrame=!1;if(!i){this.noFrame=!0;i=new e.Rectangle(0,0,1,1)}t instanceof e.Texture&&(t=t.baseTexture);this.baseTexture=t;this.frame=i;this.trim=s;this.valid=!1;this.requiresUpdate=!1;this._uvs=null;this.width=0;this.height=0;this.crop=r||new e.Rectangle(0,0,1,1);if(t.hasLoaded){this.noFrame&&(i=new e.Rectangle(0,0,t.width,t.height));this.setFrame(i)}else t.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))};e.Texture.prototype.constructor=e.Texture;e.EventTarget.mixin(e.Texture.prototype);e.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded);this.noFrame&&(this.frame=new e.Rectangle(0,0,t.width,t.height));this.setFrame(this.frame);this.dispatchEvent({type:"update",content:this})};e.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy();this.valid=!1};e.Texture.prototype.setFrame=function(t){if(!this.trim){t.x+t.width>this.baseTexture.width;t.y+t.height>this.baseTexture.height}this.noFrame=!1;this.frame=t;this.width=t.width;this.height=t.height;this.crop.x=t.x;this.crop.y=t.y;this.crop.width=t.width;this.crop.height=t.height;this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;if(this.trim){this.width=this.trim.width;this.height=this.trim.height;this.frame.width=this.trim.width;this.frame.height=this.trim.height}this.valid&&this._updateUvs()};e.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new e.TextureUvs);var t=this.crop,i=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=t.x/i;this._uvs.y0=t.y/r;this._uvs.x1=(t.x+t.width)/i;this._uvs.y1=t.y/r;this._uvs.x2=(t.x+t.width)/i;this._uvs.y2=(t.y+t.height)/r;this._uvs.x3=t.x/i;this._uvs.y3=(t.y+t.height)/r};e.Texture.fromImage=function(t,i,r){var s=e.TextureCache[t];if(s)s=new e.Texture(s.baseTexture);else{s=new e.Texture(e.BaseTexture.fromImage(t,i,r));e.TextureCache[t]=s}return s};e.Texture.fromFrame=function(t){var i=e.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache ');return i};e.Texture.fromCanvas=function(t,i){var r=e.BaseTexture.fromCanvas(t,i);return new e.Texture(r)};e.Texture.addTextureToCache=function(t,i){e.TextureCache[i]=t};e.Texture.removeTextureFromCache=function(t){var i=e.TextureCache[t];delete e.TextureCache[t];delete e.BaseTextureCache[t];return i};e.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};e.Texture.emptyTexture=new e.Texture(new e.BaseTexture);e.RenderTexture=function(t,i,r,s,n){this.width=t||100;this.height=i||100;this.resolution=n||1;this.frame=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.crop=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.baseTexture=new e.BaseTexture;this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution;this.baseTexture._glTextures=[];this.baseTexture.resolution=this.resolution;this.baseTexture.scaleMode=s||e.scaleModes.DEFAULT;this.baseTexture.hasLoaded=!0;e.Texture.call(this,this.baseTexture,new e.Rectangle(0,0,this.width,this.height));this.renderer=r||e.defaultRenderer;if(this.renderer.type===e.WEBGL_RENDERER){var o=this.renderer.gl;this.baseTexture._dirty[o.id]=!1;this.textureBuffer=new e.FilterTexture(o,this.width*this.resolution,this.height*this.resolution,this.baseTexture.scaleMode);this.baseTexture._glTextures[o.id]=this.textureBuffer.texture;this.render=this.renderWebGL;this.projection=new e.Point(.5*this.width,.5*-this.height)}else{this.render=this.renderCanvas;this.textureBuffer=new e.CanvasBuffer(this.width*this.resolution,this.height*this.resolution);this.baseTexture.source=this.textureBuffer.canvas}this.valid=!0;this._updateUvs()};e.RenderTexture.prototype=Object.create(e.Texture.prototype);e.RenderTexture.prototype.constructor=e.RenderTexture;e.RenderTexture.prototype.resize=function(t,i,r){if(t!==this.width||i!==this.height){this.valid=t>0&&i>0;this.width=this.frame.width=this.crop.width=t;this.height=this.frame.height=this.crop.height=i;if(r){this.baseTexture.width=this.width;this.baseTexture.height=this.height}if(this.renderer.type===e.WEBGL_RENDERER){this.projection.x=this.width/2;this.projection.y=-this.height/2}this.valid&&this.textureBuffer.resize(this.width*this.resolution,this.height*this.resolution)}};e.RenderTexture.prototype.clear=function(){if(this.valid){this.renderer.type===e.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer);this.textureBuffer.clear()}};e.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid){var r=t.worldTransform;r.identity();r.translate(0,2*this.projection.y);e&&r.append(e);r.scale(1,-1);t.worldAlpha=1;for(var s=t.children,n=0,o=s.length;o>n;n++)s[n].updateTransform();var a=this.renderer.gl;a.viewport(0,0,this.width*this.resolution,this.height*this.resolution);a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer);i&&this.textureBuffer.clear();this.renderer.spriteBatch.dirty=!0;this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer);this.renderer.spriteBatch.dirty=!0}};e.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid){var r=t.worldTransform;r.identity();e&&r.append(e);t.worldAlpha=1;for(var s=t.children,n=0,o=s.length;o>n;n++)s[n].updateTransform();i&&this.textureBuffer.clear();var a=this.textureBuffer.context,h=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(t,a);this.renderer.resolution=h}};e.RenderTexture.prototype.getImage=function(){var t=new Image;t.src=this.getBase64();return t};e.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};e.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===e.WEBGL_RENDERER){var t=this.renderer.gl,i=this.textureBuffer.width,r=this.textureBuffer.height,s=new Uint8Array(4*i*r);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer);t.readPixels(0,0,i,r,t.RGBA,t.UNSIGNED_BYTE,s);t.bindFramebuffer(t.FRAMEBUFFER,null);var n=new e.CanvasBuffer(i,r),o=n.context.getImageData(0,0,i,r);o.data.set(s);n.context.putImageData(o,0,0);return n.canvas}return this.textureBuffer.canvas};e.RenderTexture.tempMatrix=new e.Matrix;e.VideoTexture=function(t,i){if(!t)throw new Error("No video source element specified.");(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0);e.BaseTexture.call(this,t,i);this.autoUpdate=!1;this.updateBound=this._onUpdate.bind(this);if(!t.complete){this._onCanPlay=this.onCanPlay.bind(this);t.addEventListener("canplay",this._onCanPlay);t.addEventListener("canplaythrough",this._onCanPlay);t.addEventListener("play",this.onPlayStart.bind(this));t.addEventListener("pause",this.onPlayStop.bind(this))}};e.VideoTexture.prototype=Object.create(e.BaseTexture.prototype);e.VideoTexture.constructor=e.VideoTexture;e.VideoTexture.prototype._onUpdate=function(){if(this.autoUpdate){window.requestAnimationFrame(this.updateBound);this.dirty()}};e.VideoTexture.prototype.onPlayStart=function(){if(!this.autoUpdate){window.requestAnimationFrame(this.updateBound);this.autoUpdate=!0}};e.VideoTexture.prototype.onPlayStop=function(){this.autoUpdate=!1};e.VideoTexture.prototype.onCanPlay=function(){if("canplaythrough"===event.type){this.hasLoaded=!0;if(this.source){this.source.removeEventListener("canplay",this._onCanPlay);this.source.removeEventListener("canplaythrough",this._onCanPlay);this.width=this.source.videoWidth;this.height=this.source.videoHeight;if(!this.__loaded){this.__loaded=!0;this.dispatchEvent({type:"loaded",content:this})}}}};e.VideoTexture.prototype.destroy=function(){if(this.source&&this.source._pixiId){e.BaseTextureCache[this.source._pixiId]=null;delete e.BaseTextureCache[this.source._pixiId];this.source._pixiId=null;delete this.source._pixiId}e.BaseTexture.prototype.destroy.call(this)};e.VideoTexture.baseTextureFromVideo=function(t,i){t._pixiId||(t._pixiId="video_"+e.TextureCacheIdGenerator++);var r=e.BaseTextureCache[t._pixiId];if(!r){r=new e.VideoTexture(t,i);e.BaseTextureCache[t._pixiId]=r}return r};e.VideoTexture.textureFromVideo=function(t,i){var r=e.VideoTexture.baseTextureFromVideo(t,i);
return new e.Texture(r)};e.VideoTexture.fromUrl=function(t,i){var r=document.createElement("video");r.src=t;r.autoPlay=!0;r.play();return e.VideoTexture.textureFromVideo(r,i)};e.AssetLoader=function(t,i){this.assetURLs=t;this.crossorigin=i;this.loadersByType={jpg:e.ImageLoader,jpeg:e.ImageLoader,png:e.ImageLoader,gif:e.ImageLoader,webp:e.ImageLoader,json:e.JsonLoader,atlas:e.AtlasLoader,anim:e.SpineLoader,xml:e.BitmapFontLoader,fnt:e.BitmapFontLoader}};e.EventTarget.mixin(e.AssetLoader.prototype);e.AssetLoader.prototype.constructor=e.AssetLoader;e.AssetLoader.prototype._getDataType=function(t){var e="data:",i=t.slice(0,e.length).toLowerCase();if(i===e){var r=t.slice(e.length),s=r.indexOf(",");if(-1===s)return null;var n=r.slice(0,s).split(";")[0];return n&&"text/plain"!==n.toLowerCase()?n.split("/").pop().toLowerCase():"txt"}return null};e.AssetLoader.prototype.load=function(){function t(t){e.onAssetLoaded(t.data.content)}var e=this;this.loadCount=this.assetURLs.length;for(var i=0;i<this.assetURLs.length;i++){var r=this.assetURLs[i],s=this._getDataType(r);s||(s=r.split("?").shift().split(".").pop().toLowerCase());var n=this.loadersByType[s];if(!n)throw new Error(s+" is an unsupported file type");var o=new n(r,this.crossorigin);o.on("loaded",t);o.load()}};e.AssetLoader.prototype.onAssetLoaded=function(t){this.loadCount--;this.emit("onProgress",{content:this,loader:t});this.onProgress&&this.onProgress(t);if(!this.loadCount){this.emit("onComplete",{content:this});this.onComplete&&this.onComplete()}};e.JsonLoader=function(t,e){this.url=t;this.crossorigin=e;this.baseUrl=t.replace(/[^\/]*$/,"");this.loaded=!1};e.JsonLoader.prototype.constructor=e.JsonLoader;e.EventTarget.mixin(e.JsonLoader.prototype);e.JsonLoader.prototype.load=function(){if(window.XDomainRequest&&this.crossorigin){this.ajaxRequest=new window.XDomainRequest;this.ajaxRequest.timeout=3e3;this.ajaxRequest.onerror=this.onError.bind(this);this.ajaxRequest.ontimeout=this.onError.bind(this);this.ajaxRequest.onprogress=function(){};this.ajaxRequest.onload=this.onJSONLoaded.bind(this)}else{this.ajaxRequest=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");this.ajaxRequest.onreadystatechange=this.onReadyStateChanged.bind(this)}this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.send()};e.JsonLoader.prototype.onReadyStateChanged=function(){4!==this.ajaxRequest.readyState||200!==this.ajaxRequest.status&&-1!==window.location.href.indexOf("http")||this.onJSONLoaded()};e.JsonLoader.prototype.onJSONLoaded=function(){if(this.ajaxRequest.responseText){this.json=JSON.parse(this.ajaxRequest.responseText);if(this.json.frames&&this.json.meta&&this.json.meta.image){var t=this.baseUrl+this.json.meta.image,r=new e.ImageLoader(t,this.crossorigin),s=this.json.frames;this.texture=r.texture.baseTexture;r.addEventListener("loaded",this.onLoaded.bind(this));for(var n in s){var o=s[n].frame;if(o){var a=new e.Rectangle(o.x,o.y,o.w,o.h),h=a.clone(),l=null;if(s[n].trimmed){var u=s[n].sourceSize,c=s[n].spriteSourceSize;l=new e.Rectangle(c.x,c.y,u.w,u.h)}e.TextureCache[n]=new e.Texture(this.texture,a,h,l)}}r.load()}else if(this.json.bones)if(e.AnimCache[this.url])this.onLoaded();else{var d=this.url.substr(0,this.url.lastIndexOf("."))+".atlas",p=new e.JsonLoader(d,this.crossorigin),f=this;p.onJSONLoaded=function(){if(this.ajaxRequest.responseText){var t=new e.SpineTextureLoader(this.url.substring(0,this.url.lastIndexOf("/"))),r=new i.Atlas(this.ajaxRequest.responseText,t),s=new i.AtlasAttachmentLoader(r),n=new i.SkeletonJson(s),o=n.readSkeletonData(f.json);e.AnimCache[f.url]=o;f.spine=o;f.spineAtlas=r;f.spineAtlasLoader=p;t.loadingCount>0?t.addEventListener("loadedBaseTexture",function(t){t.content.content.loadingCount<=0&&f.onLoaded()}):f.onLoaded()}else this.onError()};p.load()}else this.onLoaded()}else this.onError()};e.JsonLoader.prototype.onLoaded=function(){this.loaded=!0;this.dispatchEvent({type:"loaded",content:this})};e.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})};e.AtlasLoader=function(t,e){this.url=t;this.baseUrl=t.replace(/[^\/]*$/,"");this.crossorigin=e;this.loaded=!1};e.AtlasLoader.constructor=e.AtlasLoader;e.EventTarget.mixin(e.AtlasLoader.prototype);e.AtlasLoader.prototype.load=function(){this.ajaxRequest=new e.AjaxRequest;this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this);this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json");this.ajaxRequest.send(null)};e.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var t=this.ajaxRequest.responseText.split(/\r?\n/),i=-3,r=0,s=null,n=!1,o=0,a=0,h=this.onLoaded.bind(this);for(o=0;o<t.length;o++){t[o]=t[o].replace(/^\s+|\s+$/g,"");""===t[o]&&(n=o+1);if(t[o].length>0){if(n===o){this.atlas.meta.image.push(t[o]);r=this.atlas.meta.image.length-1;this.atlas.frames.push({});i=-3}else if(i>0)if(i%7===1){null!=s&&(this.atlas.frames[r][s.name]=s);s={name:t[o],frame:{}}}else{var l=t[o].split(" ");if(i%7===3){s.frame.x=Number(l[1].replace(",",""));s.frame.y=Number(l[2])}else if(i%7===4){s.frame.w=Number(l[1].replace(",",""));s.frame.h=Number(l[2])}else if(i%7===5){var u={x:0,y:0,w:Number(l[1].replace(",","")),h:Number(l[2])};if(u.w>s.frame.w||u.h>s.frame.h){s.trimmed=!0;s.realSize=u}else s.trimmed=!1}}i++}}null!=s&&(this.atlas.frames[r][s.name]=s);if(this.atlas.meta.image.length>0){this.images=[];for(a=0;a<this.atlas.meta.image.length;a++){var c=this.baseUrl+this.atlas.meta.image[a],d=this.atlas.frames[a];this.images.push(new e.ImageLoader(c,this.crossorigin));for(o in d){var p=d[o].frame;if(p){e.TextureCache[o]=new e.Texture(this.images[a].texture.baseTexture,{x:p.x,y:p.y,width:p.w,height:p.h});if(d[o].trimmed){e.TextureCache[o].realSize=d[o].realSize;e.TextureCache[o].trim||(e.TextureCache[o].trim={});e.TextureCache[o].trim.x=0;e.TextureCache[o].trim.y=0}}}}this.currentImageId=0;for(a=0;a<this.images.length;a++)this.images[a].on("loaded",h);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()};e.AtlasLoader.prototype.onLoaded=function(){if(this.images.length-1>this.currentImageId){this.currentImageId++;this.images[this.currentImageId].load()}else{this.loaded=!0;this.emit("loaded",{content:this})}};e.AtlasLoader.prototype.onError=function(){this.emit("error",{content:this})};e.SpriteSheetLoader=function(t,e){this.url=t;this.crossorigin=e;this.baseUrl=t.replace(/[^\/]*$/,"");this.texture=null;this.frames={}};e.SpriteSheetLoader.prototype.constructor=e.SpriteSheetLoader;e.EventTarget.mixin(e.SpriteSheetLoader.prototype);e.SpriteSheetLoader.prototype.load=function(){var t=this,i=new e.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(e){t.json=e.data.content.json;t.onLoaded()});i.load()};e.SpriteSheetLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})};e.ImageLoader=function(t,i){this.texture=e.Texture.fromImage(t,i);this.frames=[]};e.ImageLoader.prototype.constructor=e.ImageLoader;e.EventTarget.mixin(e.ImageLoader.prototype);e.ImageLoader.prototype.load=function(){this.texture.baseTexture.hasLoaded?this.onLoaded():this.texture.baseTexture.on("loaded",this.onLoaded.bind(this))};e.ImageLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})};e.ImageLoader.prototype.loadFramedSpriteSheet=function(t,i,r){this.frames=[];for(var s=Math.floor(this.texture.width/t),n=Math.floor(this.texture.height/i),o=0,a=0;n>a;a++)for(var h=0;s>h;h++,o++){var l=new e.Texture(this.texture.baseTexture,{x:h*t,y:a*i,width:t,height:i});this.frames.push(l);r&&(e.TextureCache[r+"-"+o]=l)}this.load()};e.BitmapFontLoader=function(t,e){this.url=t;this.crossorigin=e;this.baseUrl=t.replace(/[^\/]*$/,"");this.texture=null};e.BitmapFontLoader.prototype.constructor=e.BitmapFontLoader;e.EventTarget.mixin(e.BitmapFontLoader.prototype);e.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new e.AjaxRequest;this.ajaxRequest.onreadystatechange=this.onXMLLoaded.bind(this);this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml");this.ajaxRequest.send(null)};e.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var t=this.ajaxRequest.responseXML;if(!t||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var i=new DOMParser;t=i.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var r=document.createElement("div");r.innerHTML=this.ajaxRequest.responseText;t=r}var s=this.baseUrl+t.getElementsByTagName("page")[0].getAttribute("file"),n=new e.ImageLoader(s,this.crossorigin);this.texture=n.texture.baseTexture;var o={},a=t.getElementsByTagName("info")[0],h=t.getElementsByTagName("common")[0];o.font=a.getAttribute("face");o.size=parseInt(a.getAttribute("size"),10);o.lineHeight=parseInt(h.getAttribute("lineHeight"),10);o.chars={};for(var l=t.getElementsByTagName("char"),u=0;u<l.length;u++){var c=parseInt(l[u].getAttribute("id"),10),d=new e.Rectangle(parseInt(l[u].getAttribute("x"),10),parseInt(l[u].getAttribute("y"),10),parseInt(l[u].getAttribute("width"),10),parseInt(l[u].getAttribute("height"),10));o.chars[c]={xOffset:parseInt(l[u].getAttribute("xoffset"),10),yOffset:parseInt(l[u].getAttribute("yoffset"),10),xAdvance:parseInt(l[u].getAttribute("xadvance"),10),kerning:{},texture:e.TextureCache[c]=new e.Texture(this.texture,d)}}var p=t.getElementsByTagName("kerning");for(u=0;u<p.length;u++){var f=parseInt(p[u].getAttribute("first"),10),g=parseInt(p[u].getAttribute("second"),10),m=parseInt(p[u].getAttribute("amount"),10);o.chars[g].kerning[f]=m}e.BitmapText.fonts[o.font]=o;n.addEventListener("loaded",this.onLoaded.bind(this));n.load()}};e.BitmapFontLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})};e.SpineLoader=function(t,e){this.url=t;this.crossorigin=e;this.loaded=!1};e.SpineLoader.prototype.constructor=e.SpineLoader;e.EventTarget.mixin(e.SpineLoader.prototype);e.SpineLoader.prototype.load=function(){var t=this,i=new e.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(e){t.json=e.data.content.json;t.onLoaded()});i.load()};e.SpineLoader.prototype.onLoaded=function(){this.loaded=!0;this.emit("loaded",{content:this})};e.AbstractFilter=function(t,e){this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.uniforms=e||{};this.fragmentSrc=t||[]};e.AbstractFilter.prototype.constructor=e.AbstractFilter;e.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;e>t;t++)this.shaders[t].dirty=!0};e.AlphaMaskFilter=function(t){e.AbstractFilter.call(this);this.passes=[this];t.baseTexture._powerOf2=!0;this.uniforms={mask:{type:"sampler2D",value:t},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}};if(t.baseTexture.hasLoaded){this.uniforms.mask.value.x=t.width;this.uniforms.mask.value.y=t.height}else{this.boundLoadedFunction=this.onTextureLoaded.bind(this);t.baseTexture.on("loaded",this.boundLoadedFunction)}this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]};e.AlphaMaskFilter.prototype=Object.create(e.AbstractFilter.prototype);e.AlphaMaskFilter.prototype.constructor=e.AlphaMaskFilter;e.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width;this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height;this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)};Object.defineProperty(e.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(t){this.uniforms.mask.value=t}});e.ColorMatrixFilter=function(){e.AbstractFilter.call(this);this.passes=[this];this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]};e.ColorMatrixFilter.prototype=Object.create(e.AbstractFilter.prototype);e.ColorMatrixFilter.prototype.constructor=e.ColorMatrixFilter;Object.defineProperty(e.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(t){this.uniforms.matrix.value=t}});e.GrayFilter=function(){e.AbstractFilter.call(this);this.passes=[this];this.uniforms={gray:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]};e.GrayFilter.prototype=Object.create(e.AbstractFilter.prototype);e.GrayFilter.prototype.constructor=e.GrayFilter;Object.defineProperty(e.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(t){this.uniforms.gray.value=t}});e.DisplacementFilter=function(t){e.AbstractFilter.call(this);this.passes=[this];t.baseTexture._powerOf2=!0;this.uniforms={displacementMap:{type:"sampler2D",value:t},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}};if(t.baseTexture.hasLoaded){this.uniforms.mapDimensions.value.x=t.width;this.uniforms.mapDimensions.value.y=t.height}else{this.boundLoadedFunction=this.onTextureLoaded.bind(this);t.baseTexture.on("loaded",this.boundLoadedFunction)}this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]};e.DisplacementFilter.prototype=Object.create(e.AbstractFilter.prototype);e.DisplacementFilter.prototype.constructor=e.DisplacementFilter;e.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width;this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height;this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)};Object.defineProperty(e.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(t){this.uniforms.displacementMap.value=t}});Object.defineProperty(e.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}});Object.defineProperty(e.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}});e.PixelateFilter=function(){e.AbstractFilter.call(this);this.passes=[this];this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new e.Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]};e.PixelateFilter.prototype=Object.create(e.AbstractFilter.prototype);e.PixelateFilter.prototype.constructor=e.PixelateFilter;Object.defineProperty(e.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(t){this.dirty=!0;this.uniforms.pixelSize.value=t}});e.BlurXFilter=function(){e.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]};e.BlurXFilter.prototype=Object.create(e.AbstractFilter.prototype);e.BlurXFilter.prototype.constructor=e.BlurXFilter;Object.defineProperty(e.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.dirty=!0;this.uniforms.blur.value=1/7e3*t}});e.BlurYFilter=function(){e.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]};e.BlurYFilter.prototype=Object.create(e.AbstractFilter.prototype);e.BlurYFilter.prototype.constructor=e.BlurYFilter;Object.defineProperty(e.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.uniforms.blur.value=1/7e3*t}});e.BlurFilter=function(){this.blurXFilter=new e.BlurXFilter;this.blurYFilter=new e.BlurYFilter;this.passes=[this.blurXFilter,this.blurYFilter]};e.BlurFilter.prototype=Object.create(e.AbstractFilter.prototype);e.BlurFilter.prototype.constructor=e.BlurFilter;Object.defineProperty(e.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t}});Object.defineProperty(e.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t}});Object.defineProperty(e.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t}});e.InvertFilter=function(){e.AbstractFilter.call(this);this.passes=[this];this.uniforms={invert:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]};e.InvertFilter.prototype=Object.create(e.AbstractFilter.prototype);e.InvertFilter.prototype.constructor=e.InvertFilter;Object.defineProperty(e.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(t){this.uniforms.invert.value=t}});e.SepiaFilter=function(){e.AbstractFilter.call(this);this.passes=[this];this.uniforms={sepia:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]};e.SepiaFilter.prototype=Object.create(e.AbstractFilter.prototype);e.SepiaFilter.prototype.constructor=e.SepiaFilter;Object.defineProperty(e.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(t){this.uniforms.sepia.value=t}});e.TwistFilter=function(){e.AbstractFilter.call(this);this.passes=[this];this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]};e.TwistFilter.prototype=Object.create(e.AbstractFilter.prototype);e.TwistFilter.prototype.constructor=e.TwistFilter;Object.defineProperty(e.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.dirty=!0;this.uniforms.offset.value=t}});Object.defineProperty(e.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(t){this.dirty=!0;this.uniforms.radius.value=t}});Object.defineProperty(e.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(t){this.dirty=!0;this.uniforms.angle.value=t}});e.ColorStepFilter=function(){e.AbstractFilter.call(this);this.passes=[this];this.uniforms={step:{type:"1f",value:5}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]};e.ColorStepFilter.prototype=Object.create(e.AbstractFilter.prototype);e.ColorStepFilter.prototype.constructor=e.ColorStepFilter;Object.defineProperty(e.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(t){this.uniforms.step.value=t}});e.DotScreenFilter=function(){e.AbstractFilter.call(this);this.passes=[this];this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]};e.DotScreenFilter.prototype=Object.create(e.AbstractFilter.prototype);e.DotScreenFilter.prototype.constructor=e.DotScreenFilter;Object.defineProperty(e.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.dirty=!0;this.uniforms.scale.value=t}});Object.defineProperty(e.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(t){this.dirty=!0;this.uniforms.angle.value=t}});e.CrossHatchFilter=function(){e.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]};e.CrossHatchFilter.prototype=Object.create(e.AbstractFilter.prototype);e.CrossHatchFilter.prototype.constructor=e.CrossHatchFilter;Object.defineProperty(e.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.uniforms.blur.value=1/7e3*t}});e.RGBSplitFilter=function(){e.AbstractFilter.call(this);this.passes=[this];this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]};e.RGBSplitFilter.prototype=Object.create(e.AbstractFilter.prototype);e.RGBSplitFilter.prototype.constructor=e.RGBSplitFilter;Object.defineProperty(e.RGBSplitFilter.prototype,"red",{get:function(){return this.uniforms.red.value},set:function(t){this.uniforms.red.value=t}});Object.defineProperty(e.RGBSplitFilter.prototype,"green",{get:function(){return this.uniforms.green.value},set:function(t){this.uniforms.green.value=t}});Object.defineProperty(e.RGBSplitFilter.prototype,"blue",{get:function(){return this.uniforms.blue.value},set:function(t){this.uniforms.blue.value=t}});if("undefined"!=typeof exports){"undefined"!=typeof module&&module.exports&&(exports=module.exports=e);exports.PIXI=e}else"undefined"!=typeof define&&define.amd?define(e):t.PIXI=e}).call(window);

!function(){function t(t){window.mouseX=t.x;window.mouseY=t.y;if(window.current_scene){window.mouseX/=current_scene.scale.x;window.mouseY/=current_scene.scale.y;window.mouseX-=current_scene.viewOffset.x;window.mouseY-=current_scene.viewOffset.y;window.mouseX-=current_scene.position.x/current_scene.scale.x;window.mouseY-=current_scene.position.y/current_scene.scale.y}}PIXI.DisplayObject.prototype.getHidden=function(){return!this.visible};PIXI.DisplayObject.prototype.setHidden=function(t){this.visible=!t};PIXI.DisplayObjectContainer.prototype.appendChild=PIXI.DisplayObjectContainer.prototype.addChild;PIXI.DisplayObjectContainer.prototype.setChildIndex=PIXI.DisplayObjectContainer.prototype.addChildAt;PIXI.DisplayObjectContainer.prototype.setSize=function(t,i){this._width;this._width=t;this._height;this._height=i;return this};PIXI.Sprite.prototype.setSize=function(t,i){this._width=t;this._height=i;return this};PIXI.Text.prototype.setSize=function(t,i){this._width="object"==typeof t?t.width:t;this._height="object"==typeof t?t.height:i;return this};PIXI.Text.prototype.getText=function(){return this.text};PIXI.DisplayObjectContainer.prototype.getSize=function(){return{width:this._width,height:this._height}};PIXI.DisplayObject.prototype.setAnchorPoint=function(t,i){this.anchorPoint||(this.anchorPoint={});this.anchorPoint.x=t;this.anchorPoint.y=i;this.pivot.x=t*this._width;this.pivot.y=i*this._height;return this};PIXI.DisplayObject.prototype.getAnchorPoint=function(){this.anchorPoint||(this.anchorPoint={x:this.pivot.x/this._width,y:this.pivot.y/this._height});return this.anchorPoint};PIXI.DisplayObject.prototype.setPosition=function(t,i){if(null!=t.x){i=t.y;t=t.x}this.position.x=t;this.position.y=i;return this};PIXI.DisplayObject.prototype.getPosition=function(){return this.position};PIXI.DisplayObject.prototype.setScale=function(t,i){this.scale.x=t;this.scale.y=i};PIXI.DisplayObject.prototype.getScale=function(){return this.scale};PIXI.DisplayObject.prototype.setRotation=function(t){this.rotation=-t*PIXI.DEG_TO_RAD;return this};PIXI.DisplayObject.prototype.getRotation=function(){return Math.round(-this.rotation*PIXI.RAD_TO_DEG*1e4)/1e4};PIXI.DisplayObject.prototype.setOpacity=function(t){this.alpha=t;return this};PIXI.DisplayObject.prototype.getOpacity=function(){return this.alpha};PIXI.Sprite.prototype.setStroke=function(t,i){i=i.replace("#","0x");i=parseInt(i,16);this.stroke={width:t,color:i};var e=qyengine.getTextureFromFill(this.fill_,this.width,this.height,this.radius||0,this.stroke);this.setTexture(e)};PIXI.Sprite.prototype.setRadius=function(t){this.radius=t;var i=qyengine.getTextureFromFill(this.fill_,this.width,this.height,this.radius||0,this.stroke);this.setTexture(i)};PIXI.Sprite.prototype.setFill=function(t){t.url_&&(t=t.url_);var i=this.getSize()||{width:16,height:16};this.setTexture(qyengine.getTextureFromFill(t,i.width,i.height,this.radius||0));return this};PIXI.Sprite.prototype.setImgSize=function(){};PIXI.Sprite.prototype.setText=function(){return this};PIXI.Sprite.prototype.generateMask=function(){var t=this.generatedMask;if(!t){t=this.generatedMask=new PIXI.Graphics;t.lineStyle(0);t.generateFrom=this}this.parent&&this.parent.addChild(t);var i=this.x,e=this.y;t.setPosition(i,e);t.pivot.x=this.pivot.x;t.pivot.y=this.pivot.y;var s=this.width,o=this.height;if(t.__width!==s||t.__height!==o){i=0;e=0;t.clear();t.beginFill(9160191,.4);t.moveTo(i,e);t.lineTo(s+i,e);t.lineTo(s+i,o+e);t.lineTo(i,o+e);t.lineTo(i,e);t.__width=s;t.__height=o}t.setScale(this.scaleX,this.scaleY);t.setRotation(this.getRotation());return t};PIXI.Text.prototype.moveBySpeed=function(){};PIXI.setGlobalPos=t;PIXI.DisplayObject.prototype.runAction=function(t){this.animations_||(this.animations_=[]);this.animations_.push(t);t.setTarget(this);t.start()};PIXI.DisplayObject.prototype.stopAllAnimations=function(){var t=this.animations_;if(t){t.forEach&&t.forEach(function(t){t.stop()});this.animations_=[]}};Object.defineProperty(PIXI.DisplayObject.prototype,"_mask",{get:function(){var t=this.__mask;if(t&&t.generateFrom&&t.generateFrom.generateMask){t=t.generateFrom.generateMask();this.__mask=t}return this.__mask},set:function(t){t&&t.generateMask&&(t=t.generateMask());if(this.__mask!==t){if(this.__mask){this.__mask.isMask=!1;this.__mask.parent&&this.__mask.parent.removeChild(this.__mask);var i=this.__mask.generateFrom;i&&i.setHidden(!1)}this.__mask=t;if(this.__mask){this.__mask.isMask=!0;var i=this.__mask.generateFrom;i&&i.setHidden(!0)}}}})}();
function containPoint(e,t,n){return t>=e.lx&&n>=e.ly&&t<=e.rx&&n<=e.ry}function genDataforms(e){e=JSON.parse(JSON.stringify(e||{}));for(var t in e)e[t]=genDataform(e[t]);return e}function genDataform(e){if(e instanceof Array){var t={};e.forEach(function(e,n){t[n+1]=e});return t}return e.data}qyengine.g_b2Vec2=new b2Vec2(0,0);qyengine.R2A=180/Math.PI;qyengine.A2R=Math.PI/180;qyengine.EventsOnQyObj=["create","destroy","outofscene","outofview","inscene","inview","collision","collisionend","enterobject","leaveobject","pathstart","pathend","pathpoint","movestart","moveend","timelinestart","timelinestop","keyframestart","keyframeend","animationstart","animationend","alarm","wakeup","sleep","message"];window.inherits=function(e,t){function n(){}n.prototype=t.prototype;e.superClass_=t.prototype;e.prototype=new n;e.prototype.constructor=e};window.setStyles=function(e,t){qyboot.is_ie&&void 0!==e.cssText?e.cssText=t:e.innerHTML=t};window.installStyles=function(e){var t=null;if(qyboot.is_ie&&document.createStyleSheet){t=document.createStyleSheet();setStyles(t,e)}else{var n=document.getElementsByTagName("head")[0];if(!n){var r=document.getElementsByTagName("body")[0];n=document.createElement("head");r.parentNode.insertBefore(n,r)}t=document.createElement("style");setStyles(t,e);n.appendChild(t)}return t};window.installFont=function(e,t,n){var r=n||"truetype";installStyles('@font-face{font-family: "'+e+'";src: url('+t+') format("'+r+'");})')};window.getStyleFromFont=function(e){var t={fill:e.fontColor||"#000000",font:(e.fontStyle||"normal")+" "+(e.fontWeight||"400")+" "+(e.fontSize||36)+"px/"+(e.lineHeight||1.1)+" "+(e.fontFamily||"Arial"),align:e.align||"center",wordWrap:!0,fontSize:e.fontSize||36,lineHeight:e.lineHeight||1.1};return t};window.cloneObject=function e(t){var n=typeof t;if(t&&"object"==n){if(t.clone)return t.clone();var r=t instanceof Array?[]:{};for(var i in t)r[i]=e(t[i]);return r}return t};window.object_extend=function(e,t){if(!e||!t)return null;for(var n in t)e[n]=t[n];return e};window.array_extend=function(e,t){if(t instanceof Array)for(var n=0;n<t.length;n++)e.push(t[n]);else null!=e&&e.push(t);return e};window.array_range=function(e){for(var t=new Array(e),n=0;e>n;n++)t[n]=n;return t};window.array_equal=function(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0};window.array_map=function(e,t){for(var n=new Array(e.length),r=0;r<e.length;r++)n[r]=t(e[r]);return n};window.array_foreach=function(e,t){for(var n=0;n<e.length;n++)t(e[n])};window.array_remove=function(e,t){var n=e.indexOf(t);n>=0&&e.splice(n,1)};window.sign=function(e){return e?0>e?-1:1:0};window.pointAt=function(e,t,n){if(null==n){n=t.y;t=t.x}var r=t-e.x,i=n-e.y,a=sign(r),o=sign(i),s={startX:e.x,startY:e.y,x:t,y:n,xRatio:a,yRatio:o};if(0==r||0==i)return s;var u=Math.pow(r/i,2),c=1/(1+u),g=1-c;s.xRatio*=Math.sqrt(g);s.yRatio*=Math.sqrt(c);return s};window.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)};window.modulo=function(e,t){var n=e%t;return 0>n*t?n+t:n};window.azimuth=function(e){return modulo(180*Math.atan2(e.y,e.x)/Math.PI,360)};window.checkNumbers=function(e,t){if(null==e){e=-1e3;t=-1e3}else if(null!=e.x){t=e.y;e=e.x}if(isNaN(e)){console.log("NaN encountered");e=-1e3}if(isNaN(t)){console.log("NaN encountered");t=-1e3}qyengine.g_b2Vec2.x=e;qyengine.g_b2Vec2.y=t;return qyengine.g_b2Vec2};qyengine.calAngle=function(e,t){qyengine.g_b2Vec2.x=e;qyengine.g_b2Vec2.y=-t;return azimuth(qyengine.g_b2Vec2)};qyengine.calDistance=function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))};window.addGenericProperties=function(e){Object.defineProperties(e.prototype,{x:{configurable:!0,get:function(){return this.getPosition().x},set:function(e){var t=this.getPosition();this.setPosition(e,t.y);return this}},y:{configurable:!0,get:function(){return this.getPosition().y},set:function(e){var t=this.getPosition();this.setPosition(t.x,e);return this}},scaleX:{configurable:!0,get:function(){return this.getScale().x},set:function(e){var t=this.getScale();this.setScale(e,t.y);return this}},scaleY:{configurable:!0,get:function(){return this.getScale().y},set:function(e){var t=this.getScale();this.setScale(t.x,e);return this}},width:{configurable:!0,get:function(){return this.getSize().width},set:function(e){var t=this.getSize();this.setSize(e,t.height);return this}},height:{configurable:!0,get:function(){return this.getSize().height},set:function(e){var t=this.getSize();this.setSize(t.width,e);return this}}})};window.addTimelineSupport=function(e){Object.defineProperties(e.prototype,{timeline:{configurable:!0,get:function(){return this.getTimeline()},set:function(e){this.setTimeline&&this.setTimeline(e);return this}}});e.prototype.getTimeline=function(){return this.timeline_};e.prototype.setTimeline=function(e,t){this.timeline_&&this.timeline_.stop();e.classId&&(e=e.classId);var n=qyengine.guardType(e);if(n){this.timeline_=new n(t);this.timeline_.target=this;t&&t.start&&this.timeline_.start()}return this};e.prototype.startTimeline=function(){this.timeline_&&this.timeline_.start();return this};e.prototype.stopTimeline=function(){this.timeline_&&this.timeline_.stop();return this};e.prototype.setTimelinePosition=function(e,t){this.timeline_&&this.timeline_.setPosition(e,t);return this};e.prototype.setTimelineSpeed=function(e,t){this.timeline_&&this.timeline_.setSpeed(e,t)}};window.year=function(e){return qyboot.getSystemTime("local"===e).getFullYear()};window.month=function(e){return qyboot.getSystemTime("local"===e).getMonth()+1};window.day=function(e){return qyboot.getSystemTime("local"===e).getDate()};window.hours=function(e){return qyboot.getSystemTime("local"===e).getHours()};window.minutes=function(e){return qyboot.getSystemTime("local"===e).getMinutes()};window.seconds=function(e){return qyboot.getSystemTime("local"===e).getSeconds()};window.milliseconds=function(e){return qyboot.getSystemTime("local"===e).getMilliseconds()};window.time=function(e){return qyboot.getSystemTime("local"===e).getTime()};window.setCursor=function(e){document.body.style.cursor="default";var t=game.director&&game.director.domElement||document.body;t&&(t.style.cursor=e)};qyengine.initBrowserVars=function(){localStorage.removeItem("QYFC/deployed/qiyun/signin/userpane.js");var e="gm_browserVariables",t={};t.vars_=t;var n=window.current_game.browserVariable;qyengine.initVars(t,n);delete t.vars_;n=localStorage.getItem(e);if(n)try{n=JSON.parse(n)}catch(r){n={}}for(var i in n)t[i]=n[i];localStorage.setItem(e,JSON.stringify(t));window.browser||(window.browser={});window.browser.vars_=window.browser;window.browser.classId="browser";window.browser.setVar=function(t,n,r){if(void 0!==this[t])r?this[t]+=n:this[t]=n;else{Object.defineProperty(window.browser,t,{get:function(){var n=localStorage.getItem(e);n&&(n=JSON.parse(n));return n&&n[t]},set:function(n){var r=localStorage.getItem(e);r&&(r=JSON.parse(r));r||(r={});r[t]=n;localStorage.setItem(e,JSON.stringify(r))}});this[t]=n}var i=this.classId+"_"+t;qyengine.updateDraw(i,this[t])};for(var a in t)window.browser.setVar(a,t[a]);current_game.extend&&qyengine.initVars(current_game,current_game.extend)};qyengine.setResolution=function(e){qyengine.gRenderer&&(qyengine.gRenderer.resolution=e);qyengine.gStage&&qyengine.gStage.interactionManager&&qyengine.gStage.interactionManager.resolution&&(qyengine.gStage.interactionManager.resolution=e)};qyengine.gmx_foreach=window.gmx_foreach=function(e,t){if(e&&t&&0!=e.length)for(var n=0;n<e.length;n++)t(e[n])};qyengine.guardType=function(e){if("string"!=typeof e)return e;var t=gmx_[e];t||console.log("type "+e+" is not defined.");return t};qyengine.guardId=function(e){var t=window[e];t||console.log("id "+JSON.stringify(e)+" is not defined.");return t};qyengine.getInstancesByType=function(e){function t(e,t){for(var n=0,r=e.length;r>n;n++)if(t instanceof e[n])return!0}e instanceof Array||(e=[e]);var n=[],r=[];e.forEach(function(e){var t=qyengine.guardType(e);t&&n.indexOf(t)<0&&n.push(t)});if(!n||!n.length)return r;for(var i=0;i<current_scene.instances.length;i++){var a=current_scene.instances[i];a.destroyBuffered||a.destroyed_||!t(n,a)||r.push(a)}return r};qyengine.getInstanceCount=function(e){var t=qyengine.guardType(e);if(!t)return 0;for(var n=0,r=0;r<current_scene.instances.length;r++){var i=current_scene.instances[r];i instanceof t&&!(i.destroyBuffered||i.destroyed_||i.isHidden_)&&n++}return n};qyengine.forEach=function(e,t){var n=qyengine.getInstancesByType(t);gmx_foreach(n,function(t){e.call(t)})};qyengine.all=function(e,t){for(var n=qyengine.getInstancesByType(t),r=0;r<n.length;r++)if(!e.call(n[r]))return!1;return!0};qyengine.forEachTag=function(e,t){var n=game.tags&&game.tags[t],r=n&&n.objects||[];if(r.length){var i=qyengine.getInstancesByType(r);gmx_foreach(i,function(t){e.call(t)})}};qyengine.queryPoint=function(e,t){for(var n=[],r=current_scene.instances.length,i=0;r>i;i++){var a=current_scene.instances[i],o=a.getBoundingBox();containPoint(o,e,t)&&n.push(a)}return n};qyengine.checkIfEmpty=function(e,t,n){var r=qyengine.queryPoint(e,t);if(!n)return 0==r.length;for(var i=0;i<r.length;i++){var a=r[i];if("solid"==a.getType()&&!a.destroyBuffered&&!a.destroyed_)return!1}return!0};qyengine.setVar=function(e,t,n){null!=this.vars_[e]&&n?this.vars_[e]+=t:this.vars_[e]=t;var r=this.classId+"_"+e;qyengine.updateDraw(r,this.vars_[e])};qyengine.initVars=function(e,t){e.vars_||(e.vars_={});for(var n in t){var r=t[n];null!=r.value&&(r=r.value);r.length>1&&"{"==r[0]&&"}"==r[r.length-1]&&(r="(function(){return "+r+";})();");e.vars_[n]=qyboot.evalClean.call(e,r)}};qyengine.toggleVar=function(e){this.vars_[e]=null!=this.vars_[e]?!this.vars_[e]:!0;var t=this.classId+"_"+e;qyengine.updateDraw(t,this.vars_[e])};qyengine.initDataforms=function(){current_game.dataforms||qyengine.getDataforms()};qyengine.getDataforms=function(){Object.defineProperty(current_game,"dataforms",{get:function(){if(current_game.__dataforms)return current_game.__dataforms;var e=SelfModName(),t=qyremote.getAppUserData(e,!0);if(t&&t.success){try{t=JSON.parse(t.result)}catch(n){}if(t){qyengine.dataforms=t.__dataforms||{};t=genDataforms(qyengine.dataforms);current_game.__dataforms=t||""}}return current_game.__dataforms}})};qyengine.updateDataforms=function(e,t,n){game.dataforms;var r=qyengine.dataforms;if(r){var i=r[e];if(i){i.data[n[t]]=n;var a={__dataforms:{}};a.__dataforms[e]={data:{}};a.__dataforms[e].data[n[t]]=n;qyengine.uploadDataform(a);current_game.dataforms&&current_game.dataforms[e]&&(current_game.dataforms[e][n[t]]=n);current_game.__dataforms&&current_game.__dataforms[e]&&(current_game.__dataforms[e][n[t]]=n)}}};qyengine.deleteFromDataform=function(e,t,n){game.dataforms;var r=qyengine.dataforms;if(r){var i=r[e];if(i){delete i.data[n[t]];var a={__dataforms:{}};a.__dataforms[e]={data:{}};a.__dataforms[e].data[n[t]]=null;qyengine.uploadDataform(a);current_game.dataforms&&current_game.dataforms[e]&&delete current_game.dataforms[e][n[t]];current_game.__dataforms&&current_game.__dataforms[e]&&delete current_game.__dataforms[e][n[t]]}}};qyengine.uploadDataform=function(e){var t=SelfModName();qyremote_async.saveAppUserData(t,!0,JSON.stringify(e),function(){})};qyengine.isInTags=function(e,t){for(var n=game.tags&&game.tags[e]&&game.tags[e].objects||[],r=0,i=n.length;i>r;r++)if(t instanceof qyengine.guardType(n[r]))return!0;return!1};window.dataformData=function(e,t,n){var r=game.dataforms&&game.dataforms[e];return r[t]&&r[t][n]};window.dataformDataLength=function(e){var t=game.dataforms&&game.dataforms[e]||{};return Object.keys(t).length};window.instanceLength=function(e){var t=qyengine.getInstancesByType(e)||[];return t.length};
window.qyengine||(window.qyengine={});!function(){qyengine.merge=function(e,n){var t=null!=e?cloneObject(e):{};if(!n||"object"!=typeof n)return t;for(var i in n)n.hasOwnProperty(i)&&(void 0==t[i]?t[i]=n[i]:t[i]instanceof Array?array_extend(t[i],n[i]):"object"==typeof t[i]&&"object"==typeof n[i]?qyengine.addToObj(t[i],n[i]):t[i]=n[i]);return t};qyengine.addToObj=function(e,n){if(!e||"object"!=typeof e)return n;if(!n||"object"!=typeof n)return e;for(var t in n)n.hasOwnProperty(t)&&(void 0==e[t]||"object"!=typeof e[t]||"object"!=typeof n[t]?e[t]=n[t]:qyengine.addToObj(e[t],n[t]));return e};qyengine.installFonts=function(e){e||(e=current_game.customFonts);for(var n in e)installFont(n,e[n])};qyengine.makeLabel=function(){var e=new PIXI.Text("");return e};window.getText=function(e,n){if(current_game.texts&&e in current_game.texts){var t=current_game.texts[e],i=qyboot.getDefaultLocaleName();if("string"==typeof t.text)e=t.text;else if(null!=t.text[i])e=t.text[i];else for(var o in t.text){e=t.text[o];break}if(n){var r=t.font instanceof Object?t.font:current_game.fonts[t.font]||{};return{text:e,font:r,size:t.size}}return e}return n?e.font?e:{text:e,font:{}}:null!=e.text?e.text:e};window.current_game||(window.current_game={});window.gmx_||(window.gmx_={});window.current_game.vars_||(window.current_game.vars_={});window.current_game.score||(window.current_game.score=0);window.current_game.lives||(window.current_game.lives=3);window.current_game.health||(window.current_game.health=100);window.game=window.current_game;window.engine=window.qyengine;window.current_game.money||(window.current_game.health=0);window.current_game.experience||(window.current_game.experience=0);window.current_game.level||(window.current_game.level=0);window.mouseX=0;window.mouseY=0;window.browser={}}();!function(){qyengine.isApk=!!window.cordova;qyengine.isApk&&qyboot.ready(function(){document.addEventListener("deviceready",function(){setTimeout(function(){navigator.splashscreen&&navigator.splashscreen.hide()},1e3)},!1)})}();!function(){function e(e,n){var t=new Image;t.onload=function(){PIXI.loadedImages_[e]=t;n(e,t)};t.onerror=function(){n(e,null)};t.src=e}function n(e,n){function t(){qyengine.unlockAudio_||(qyengine.unlockAudio_=i);n(e)}if(qyengine.soundExist(e))n(e);else{var i=qyengine.getSound(e,{autoplay:!1,onload:t,onloaderror:function(){console.log("load error ",e);n(e)}});qyengine.isApk&&t()}}function t(e,n){var t=new XMLHttpRequest;t.open("GET",e,!0);t.onreadystatechange=function(){if(4==t.readyState){t.onreadystatechange=function(){};200==t.status?n(e,t.responseText):n(e,null)}};t.send(null)}var i=/^file:/.test(window.document.location.protocol),o=!qyengine.isApk&&i;qyengine.isFileProtocol=i;qyengine.isRunningLocal=o;qyengine.audioUnlocked=!qyboot.is_ios;qyengine.unlockAudio_;var r=!0;qyengine.preloadFileList=function(i,o,a){function s(e,n){++u;a&&(l[e]=n);o&&o(Math.round(1e4*u/d)/100);u>=d&&a&&a(l)}var g=i[0],c=i[1];g&&c||o&&o(100);var u=0,d=g.length+c.length,l={};0==d&&o&&o(100);for(var f=0;f<g.length;f++){var _=g[f];r&&/.(png|jpeg|jpg|gif)$/.test(_.toLowerCase())?e(_,s):t(_,s)}for(f=0;f<c.length;f++)n(c[f],s)};qyengine.loading_scene="qyDefaultLoadingScene";qyengine.pause_scene="qyDefaultPauseScene"}();!function(){var e={click:"/public/qiyun/preload/sounds/click.ogg",loadingText:"/public/qiyun/preload/images/loaddingText.png",loadingLogo:"/public/qiyun/preload/images/loadingLogo.png"};if(window.qyProjUrl)for(var n in e)e[n]="assets"+e[n];qyengine.initLoadingScene=function(){gmx_.bg_loading=function(e){this.init_(e,"bg_loading")};qyengine.define_type("bg_loading",QyBackground,{fill:"#243145",size:{width:8,height:8},imgSize:{width:8,height:8},anchorPoint:{x:0,y:0}});gmx_.snd_preload=function(e){this.init_(e,"snd_preload")};qyengine.define_type("snd_preload",QySound,{urls:[e.click,".mp3"],preload:!0,volume:0,background:!1});gmx_.sprites_loaddingText=function(e){this.init_(e,"sprites_loaddingText")};qyengine.define_type("sprites_loaddingText",QySprite,{fill:e.loadingText,anchorPoint:{x:.5,y:.5},size:{width:180,height:82},imgSize:{width:180,height:82}});gmx_.sprites_loadingLogo=function(e){this.init_(e,"sprites_loadingLogo")};qyengine.define_type("sprites_loadingLogo",QySprite,{fill:e.loadingLogo,anchorPoint:{x:.5,y:.5},size:{width:180,height:150},imgSize:{width:180,height:150}});gmx_.spr_white=function(e){this.init_(e,"spr_white")};qyengine.define_type("spr_white",QySprite,{size:{width:150,height:140},imgSize:{width:150,height:140},anchorPoint:{x:.5,y:1},fill:"#ffffff"});gmx_.objects_loaddingText=function(e){this.init_(e,"objects_loaddingText")};qyengine.define_type("objects_loaddingText",QyObject,{sprite:"sprites_loaddingText"},{create:function(){qyengine.play_sound(snd_preload,{})}});gmx_.objects_loadingLogo=function(e){this.init_(e,"objects_loadingLogo")};qyengine.define_type("objects_loadingLogo",QyObject,{sprite:"sprites_loadingLogo"});gmx_.obj_spr_white=function(e){this.init_(e,"obj_spr_white")};qyengine.define_type("obj_spr_white",QyObject,{sprite:"spr_white",parent:"no-parent"},{loading:function(e){this.progress=e.progress;this.scaleY=this.progress/100}});gmx_.qyDefaultLoadingScene=function(e){this.init_(e,"qyDefaultLoadingScene")};qyengine.define_type("qyDefaultLoadingScene",QyScene,{size:{width:1600,height:900},background:"bg_loading",layers:[{id:"default",objects:[{type:"objects_loaddingText",id:"objects_loaddingText",position:{x:800,y:609}},{type:"obj_spr_white",id:"obj_spr_white",scale:{x:1,y:0},position:{x:800,y:510}},{type:"objects_loadingLogo",id:"objects_loadingLogo_1",position:{x:800,y:441}}]}]});current_game.sceneRes=qyengine.addToObj(current_game.sceneRes,{qyDefaultLoadingScene:{files:[e.loadingText,e.loadingLogo],sounds:["snd_preload"],usedScenes:[]}});qyengine.installFonts()}}();!function(){function e(){return qyboot.getPrefix()+SelfModName()}function n(){if(f)return f;var n=qyboot.getCurrentUser(),t=n&&n.userid;t||(t="Guest_tmp");f="QYAPP/"+e()+"/"+t;return f}function t(e){var n={};for(var t in e)current_game.extend[t].serverVariable&&(n[t]=e[t]);for(var t in n)delete e[t];return[e,n]}function i(n){var i=t(n),o=i[0],r=i[1];Object.keys(o).length>0&&qyremote.saveAppUserData(e(),JSON.stringify(o));Object.keys(r).length>0&&qyremote.saveAppUserData(e(),!0,JSON.stringify(r))}function o(){var e=n();if(e&&current_game.extend){var t=current_game.extend,o={},r=!1;for(var a in t)if(t[a].autosave){o[a]=l(a);r=!0}if(r){qyboot.saveToLS(e,o);try{i(o)}catch(s){console.log(s)}}}return!0}function r(){if(current_game.extend){var e=current_game.extend,n=!1;for(var t in e)if(e[t].autosave){n=!0;break}if(n){var i=a();if(i)for(var t in e)e[t].autosave&&null!=i[t]&&d(t,i[t])}}return!0}function a(n){var t;if(n&&current_game.extend[n]){t=current_game.extend[n].serverVariable?qyremote.getAppUserData(e(),!0):qyremote.getAppUserData(e());if(t.success){var i=JSON.parse(t.result);return i[n]}return void 0}var t=qyremote.getAppUserData(e(),!0);if(t.success){var i=JSON.parse(t.result);t=qyremote.getAppUserData(e());if(t.success){var o=JSON.parse(t.result);for(var r in i)o[r]=i[r]}return o}return void 0}function s(e,t){t||(t="both");var i,o=n();if("local"==t){i=qyboot.getFromLS(o)||{};return i[e]}try{return a(e)}catch(r){console.log(r)}}function g(e,t,o){var r=n(),a=qyboot.getFromLS(r)||{};a[e]=t;o||(o="both");("local"==o||"both"==o)&&qyboot.saveToLS(r,a);if("remote"==o||"both"==o){var s={};s[e]=t;try{i(s)}catch(g){console.log(g)}}return!0}function c(e,n){var t=l(e);return g(e,t,n)}function u(e,n){var t=s(e,n);null!=t&&d(e,t)}function d(e,n){switch(e){case"score":case"lives":case"health":current_game[e]=n;return;default:current_game.vars_||(current_game.vars_={});current_game.vars_[e]=n;return}}function l(e){switch(e){case"score":case"lives":case"health":return current_game[e];default:return current_game.vars_&&current_game.vars_[e]}}var f;qyengine.storeAppUserData=o;window.onunload=function(){o()};qyengine.loadAppUserData=r;qyengine.saveGameVar=c;qyengine.loadGameVar=u}();qyengine.supported_devices={};
!function(){function t(t,i,s,r,n){r||(r=0);var o=parseInt(t);if(!e){e=new PIXI.Graphics;e.boundsPadding=0}e.beginFill(o);n||(n={width:0,color:"#000000"});e.lineStyle(n.width,parseInt(n.color.slice(1),16));var h=0,a=0;r=Math.min(i/2,r);if(i===s&&r===i/2){n.width&&e.currentPath&&e.currentPath.shape&&(e.currentPath.shape.points=[2*r,r]);e.arc(r,r,r,0,2*Math.PI)}else{e.moveTo(h+r,a);e.lineTo(h+i-r,a);e.quadraticCurveTo(h+i,a,h+i,a+r);e.lineTo(h+i,a+s-r);e.quadraticCurveTo(h+i,a+s,h+i-r,a+s);e.lineTo(h+r,a+s);e.quadraticCurveTo(h,a+s,h,a+s-r);e.lineTo(h,a+r);e.quadraticCurveTo(h,a,h+r,a)}e.endFill();var l=e.generateTexture();e.clear();return l}qyengine.getDirector=function(){return current_game.director};window.gmx_listen=function(t,e,i){return t.listen(e,i)};var e;qyengine.getTextureFromFill=function(e,i,s,r,n){if("string"!=typeof e||/^rgb/.test(e)){console.log(e+" is not supported in webgl mode at present");e="#ffffff"}var o;o=/^#/.test(e)?t("0x"+e.substr(1),i,s,r,n):PIXI.Texture.fromImage(e);return o};window.QySprite=function(t){t||(t={});t.size||(t.size={width:0,height:0});this.mirror={horizontal:1,vertical:1};this.offset={x:0,y:0};var e=void 0===t.fill?"#ffffff":t.fill,i=t.size.width,s=t.size.height,r=qyengine.getTextureFromFill(e,i,s,t.radius,t.stroke);PIXI.Sprite.call(this,r);this.setSize(i,s);window.game&&"pixel"===window.game.filter&&(this.filters=[new PIXI.PixelateFilter]);this.qyobj=t&&t.qyobj;delete t.fill;this.fromJson(t);this.fill_=e};inherits(QySprite,PIXI.Sprite);addGenericProperties(QySprite);Object.defineProperties(QySprite.prototype,{speed:{configurable:!0,get:function(){return this.speed_||{x:0,y:0}},set:function(t){this.setSpeed&&this.setSpeed(t);return this}}});QySprite.Props={size:{"default":{x:0,y:0},help:""}};QySprite.prototype.isBG=!1;QySprite.prototype.getDirector=qyengine.getDirector;QySprite.prototype.fromJson=function(t){t||(t={});delete this.pixiFrames;delete this.imgSize;this.fill_=null;t.mirror&&this.setMirror(t.mirror.horizontal,t.mirror.vertical);this.minTimeDelta=null!=t.minTimeDelta?t.minTimeDelta:.1;t.size&&this.setSize(t.size.width,t.size.height);t.anchorPoint&&this.setAnchorPoint(t.anchorPoint.x,t.anchorPoint.y);if(t.position){var e=checkNumbers(t.position);this.setPosition(e.x,e.y)}t.scale&&this.setScale(t.scale.x,t.scale.y);t.rotation&&this.setRotation(t.rotation);null!=t.opacity&&this.setOpacity(t.opacity);if(this.keyframe){this.keyframe.stop();this.keyframe=null}if(t.skeleton)this.setSkeleton(t.skeleton);else{delete this.skeleton;this.repeat_x=t.repeat||t.repeat_x;this.repeat_y=t.repeat||t.repeat_y;this.repeat=this.repeat_x&&this.repeat_y;this.stroke=t.stroke||{width:0,color:"#000000"};this.radius=t.radius||0;t.fill&&this.setFill(t.fill);t.imgSize&&this.setImgSize(t.imgSize.width,t.imgSize.height);t.keyframe&&this.setKeyFrame(t.keyframe);t.scale&&this.setScale(t.scale.x,t.scale.y);this.setText(t.text)}this.collisionData=t.collisionData;this.setSpeed(t.background_speed||0);this.accSeconds=0;return this};QySprite.prototype.runAction=function(t){this.animations_||(this.animations_=[]);this.animations_.push(t);t.setTarget(this);t.start()};PIXI.Text.prototype.runAction=QySprite.prototype.runAction;QySprite.prototype.setSkeleton=function(t){function e(e){e.setLoop(t.loop);t.startAnimation&&e.setStartAnimation(t.startAnimation);if(t.skin)try{e.skeleton.setSkinByName(t.skin)}catch(s){console.log(s)}e.setPosition(i.width*i.anchorPoint.x,i.height*i.anchorPoint.y)}var i=this;if(this.skeleton){if(this.skeleton.name===t.skeleton){e(this.skeleton);return}this.skeleton&&this.removeChild(this.skeleton)}var s=t.skeleton,r=qyengine.guardType(s);if(!r)return this;var n=this.skeleton=new r;n.name=s;n.load(function(){e(n);n.listen("skeletonEnd",function(t){i.dispatchEvent(t)});i.addChild(n);i.setFill("");i.texture.crop=new PIXI.Rectangle(0,0,i.width,i.height);i.texture.frame=new PIXI.Rectangle(0,0,i.width,i.height)})};QySprite.prototype.getOffset=function(){return this.offset};QySprite.prototype.setOffset=function(t,e){if(this.isBG)var i=current_scene.full_size;else{var i=this.keyframe?this.imgSize:this.getSize();if(!this.keyframe&&(this.repeat||this.repeat_x||this.repeat_y)){t%=i.width;e%=i.height}}if(t!=this.offset.x||e!=this.offset.y){this.offset.x=t;this.offset.y=e;this.frame||(this.frame={});this.frame.x=-t/this.scale.x;this.frame.y=-e/this.scale.y;this.frame.width=i.width;this.frame.height=i.height;this.texture.setFrame(this.frame);this.dirty=!0}return this};QySprite.prototype.setImgSize=function(t,e){this.imgSize={width:t,height:e};var i=this.getSize();if(!this.keyframe){!this.repeat_x&&(t=i.width);!this.repeat_y&&(e=i.height)}this.fill_&&this.fill_.setSize&&this.fill_.setSize(t,e)};QySprite.prototype.setMirror=function(t,e){var i=!1;if(null!=t&&this.mirror.horizontal!=t){this.mirror.horizontal=t;i=!0}if(null!=e&&this.mirror.vertical!=e){this.mirror.vertical=e;i=!0}};QySprite.prototype.makeTextLabel=function(t){if(!this.txtLabel_){this.txtLabel_=qyengine.makeLabel();this.appendChild(this.txtLabel_)}var e=this.txtLabel_;if(!t||"object"!=typeof t)return e;var i=t.size||this.getSize(),s=t.position||{x:0,y:0},r="object"==typeof t.font?t.font:current_game.fonts[t.font]||{};e.setStyle(getStyleFromFont(r));e.setSize(i);e.setPosition(s.x+this.width*this.anchorPoint.x,s.y+this.height*this.anchorPoint.y);return e};QySprite.prototype.setText=function(t){if(void 0!==t){var e=cloneObject(t.font);if(current_game.texts[t.text]){var i;i=JSON.parse(JSON.stringify(current_game.texts[t.text]));i.content=i.text;delete i.text;qyengine.addToObj(i,t);t=i}else current_game.texts[t]&&(t=current_game.texts[t]);e&&(t.font=e);var s,r=this.makeTextLabel(t);t.content&&(t.text=t.content);if("object"==typeof t){if("string"==typeof t.text)s=t.text;else{var n=qyboot.getDefaultLocaleName();if(t.text&&t.text[n])s=t.text[n];else for(var o in t.text){s=t[o];break}}null!=s||(s=t[n])}else s=t;null!=s||(s="");r.setText(s);r.setMultiline&&r.setMultiline(!0);return this}this.txtLabel_&&this.txtLabel_.setText("")};QySprite.prototype.getText=function(){return this.txtLabel_&&this.txtLabel_.getText()};QySprite.prototype.addText=function(t){var e=this.getText();e&&(t=e+t);return this.setText(t)};QySprite.prototype.setFontColor=function(t){if(this.txtLabel_){var e=this.txtLabel_.style;e.fill=t;this.txtLabel_.setStyle(e)}};QySprite.prototype.setFontSize=function(t){if(this.txtLabel_){for(var e=this.txtLabel_.style,i=e.font,s=i.split(" "),r=0,n=s.length;n>r;r++)(s[r].indexOf("px")>-1||s[r].indexOf("pt")>-1)&&(s[r]=t+"px");e.font=s.join(" ");this.txtLabel_.setStyle(e)}};QySprite.prototype.setKeyFrame=function(t){this.keyframe&&this.keyframe.stop();this.keyframe=new QyKeyframe(t);var e=this.qyobj||this;gmx_listen(this.keyframe,"timelinestop",function(){e.dispatchEvent("keyframeend")});gmx_listen(this.keyframe,"timelinestart",function(){e.dispatchEvent("keyframestart")});this.keyframe.setSprite(this);var i=this.getSize();this.setOffset(-i.width*this.keyframe.xStart,-i.height*this.keyframe.yStart);this.texture.setFrame({x:i.width*this.keyframe.xStart,y:i.height*this.keyframe.yStart,width:Math.min(i.width,this.texture.width),height:Math.min(i.height,this.texture.height)});this.onTextureUpdate();this.keyframe.start();return this};QySprite.prototype.changeAnimation=function(t){if(this.curAnimationName!=t){this.curAnimationName=t;if(this.keyframe){this.keyframe.stop();this.keyframe.changeFrame(t);this.keyframe.setSprite(this)}}return this};QySprite.prototype.toJson=function(){};QySprite.prototype.setSpeed=function(t,e){if(null==t)return this;("number"==typeof e||"number"==typeof t)&&(t={x:t,y:e||0});this.speed_=t};QySprite.prototype.moveBySpeed=function(t){if(this.speed_&&(0!=this.speed_.x||0!=this.speed_.y)){this.accSeconds+=t;if(this.accSeconds>this.minTimeDelta){this.moveBy(this.speed_.x*this.accSeconds,this.speed_.y*this.accSeconds);this.accSeconds=0}}};QySprite.prototype.moveTo=function(t,e){this.setOffset(t,e);return this};QySprite.prototype.moveBy=function(t,e){null!=t||(t=0);null!=e||(e=0);if(0==t&&0==e)return this;this.setOffset(this.offset.x+t,this.offset.y+e);return this};QySprite.prototype.setFrameSpeed=function(t){this.keyframe&&this.keyframe.setSpeed(t)};QySprite.prototype.setSkeletonSpeed=function(t){this.skeleton&&this.skeleton.setSpeed(t)};QySprite.prototype.shieldEvent=function(t){this.shieldedEvent||(this.shieldedEvent=[]);this.shieldedEvent.indexOf(t)<0&&this.shieldedEvent.push(t)};QySprite.prototype.cancelShieldEvent=function(t){this.shieldedEvent||(this.shieldedEvent=[]);var e=this.shieldedEvent.indexOf(t);e>-1&&this.shieldedEvent.splice(e,1)};QySprite.prototype.isShieldEvent=function(t){return this.shieldedEvent&&this.shieldedEvent.indexOf(t)>-1};QySprite.prototype.setMask=function(t){this.mask=t};QySprite.prototype.cancelMask=function(){this.mask=null}}();
!function(){function i(i){i||(i={});i.anchorPoint||(i.anchorPoint={x:0,y:0});var t=i.fill,e=i.size.width,o=i.size.height,s=qyengine.getTextureFromFill(t,e,o);PIXI.TilingSprite.call(this,s,e,o);this.minTimeDelta=null!=i.minTimeDelta?i.minTimeDelta:.1;this.setSpeed(i.background_speed||0);this.tileScale.x=e/s.width;this.tileScale.y=o/s.height}inherits(i,PIXI.TilingSprite);i.prototype.moveBySpeed=function(i){this.tilePosition.x=(this.tilePosition.x+i*this.speed_.x/this.tileScale.x)%this.width;this.tilePosition.y=(this.tilePosition.y+i*this.speed_.y/this.tileScale.y)%this.height};i.prototype.setSpeed=QySprite.prototype.setSpeed;i.prototype.moveBy=function(i,t){this.tilePosition.x+=i/this.tileScale.x;this.tilePosition.y+=t/this.tileScale.y};window.QyBackground=i;i.prototype.isBG=!0}();
!function(){function t(t){PIXI.DisplayObjectContainer.call(this);t||(t={});t.hiddenAtStart&&this.hide();t.sticky&&(this.sticky=!0);t.ignore25d&&(this.ignore25d=!0);t.id&&(window[t.id]=this)}inherits(t,PIXI.DisplayObjectContainer);window.QyLayer=t;addGenericProperties(t);t.prototype.toObj=function(){};t.prototype.getNumberOfChildren=function(){return this.children.length};t.prototype.show=function(){this.isHidden_=!1;this.setHidden(!1);for(var t=this.children_||this.children,i=0;i<t.length;i++){var e=t[i];e.domElement&&!e.getHidden()&&(e.domElement.style.display="block")}};t.prototype.hide=function(){this.isHidden_=!0;this.setHidden(!0);for(var t=this.children_||this.children,i=0;i<t.length;i++){var e=t[i];e.domElement&&(e.domElement.style.display="none")}};t.prototype.toggleHidden=function(){this.isHidden_?this.show():this.hide()};t.prototype.setPosition=function(){PIXI.DisplayObjectContainer.prototype.setPosition.apply(this,arguments);for(var t=this.children_||this.children,i=0;i<t.length;i++){var e=t[i];e.domElement&&(e.dirty=!0)}}}();
!function(){function e(e){QyLayer.call(this,qyengine.addToObj({sticky:!0},e));this.varLabels={};current_game.drawScore&&this.drawVariable("score","score:"+current_game.score,0,0);current_game.drawLives&&this.drawVariable("lives","lives:"+current_game.lives,200,0);current_game.drawHealth&&this.drawVariable("health","health:"+current_game.health,400,0)}inherits(e,QyLayer);window.QyStickyLayer=e;e.prototype.drawVariable=function(e,i,t,n,r,a){var s=this.varLabels[e];if(!s){s=qyengine.makeLabel();this.varLabels[e]=s;this.appendChild(s)}s.setStyle(getStyleFromFont(r));s.setSize({width:100,height:100});a&&a.size&&s.setSize(a.size);s.setText(i);null!=t&&s.setPosition(t,n);return this};e.prototype.updateHealthImage=function(e,i,t,n){if(this.healthSprite){var r;if(null==e||null==i){r=this.healthSprite.getPosition();null==e&&(e=r.x);null==i&&(i=r.y)}if(t||n){r||(r=this.healthSprite.getPosition());t&&(e+=r.x);n&&(i+=r.y)}this.healthSprite.setPosition(e,i);var a=Math.max(Math.min(current_game.health,1),0),s=this.healthSprite.constructor.defaultOpt.size;this.healthSprite.setSize(s.width*a,s.height*a)}};e.prototype.drawLifeImage=function(e,i,t,n,r,a){if(!this.lifeImgContainer){this.lifeImgContainer=new PIXI.DisplayObjectContainer;this.appendChild(this.lifeImgContainer)}a||(a=this.lifeImgContainer.spacer||0);this.lifeImgContainer.spacer=a;if(t){t.classId&&(t=t.classId);if(this.lifeImgContainer.spriteName!=t){this.lifeImgContainer.children.length&&this.lifeImgContainer.removeChildren();this.lifeImgContainer.spriteName=t}}else{if(!this.lifeImgContainer.spriteName)return;t=this.lifeImgContainer.spriteName}var s;if(null==e||null==i){s=this.lifeImgContainer.getPosition();null==e&&(e=s.x);null==i&&(i=s.y)}if(n||r){s||(s=this.lifeImgContainer.getPosition());n&&(e+=s.x);r&&(i+=s.y)}this.lifeImgContainer.setPosition(e,i);var l=this.lifeImgContainer.children_||this.lifeImgContainer.children,h=l.length,o=current_game.lives;o>=0||(o=0);if(h>o)for(var g=h-1;g>=o;g--)this.lifeImgContainer.removeChildAt(g);else if(o>h){var f=qyengine.guardType(t);if(f)for(g=0;o-h>g;g++){var m=new f;m.setPosition(g*(a+m.width),0);this.lifeImgContainer.appendChild(m)}}}}();
!function(){function o(o){if(o.urls&&!(o.urls.length<2))for(var t=o.urls[0],i=1;i<o.urls.length;i++){var e=o.urls[i];"."==e[0]&&(o.urls[i]=t.replace(/\.[^./]+$/,e))}}function t(){var o=window.location.pathname,t=o.substring(0,o.lastIndexOf("/"))+"/";console.log(t);return t}function i(t){QyEventTarget.call(this);t||(t={});if(t.background){this.is_background=!0;null==t.loop&&(t.loop=!0)}this.loop=t.loop;for(var i=0;i<e.length;i++){var n="sound"+e[i];if(t[n]){gmx_listen(this,e[i],t[n]);delete t[n]}}o(t);try{if(qyengine.isApk){this.initCordovaAudio(t);this.setVolume(t.volume)}else this.initHowl(t)}catch(s){console.log(s)}}window.QyEventTarget=function(){};PIXI.EventTarget.mixin(QyEventTarget.prototype);var e=["ends","load","loaderror","pause","play"];inherits(i,QyEventTarget);window.QySound=i;if(qyengine.isApk){i.prototype.play=function(){if(this.cordovaAudio){this.shouldStop=!this.loop;this.cordovaAudio.play()}};i.prototype.pause=function(){this.cordovaAudio&&this.cordovaAudio.pause()};i.prototype.stop=function(){if(this.cordovaAudio){this.shouldStop=!0;this.cordovaAudio.stop()}};i.prototype.mute=function(){if(!this._muted){this._muted=!0;this.oldVolume_=this.volume_;this.setVolume(0)}};i.prototype.unmute=function(){if(this._muted){this._muted=!1;null!=this.oldVolume_&&this.setVolume(this.oldVolume_)}};i.prototype.unload=function(){this.cordovaAudio&&this.cordovaAudio.release()};i.prototype.setVolume=function(o){o>=0&&1>=o||(o=1);this.volume_=o;this.cordovaAudio&&this.cordovaAudio.setVolume(o)};i.prototype.getVolume=function(){return this.volume_};i.prototype.getActiveNode=function(){return this._activeNode}}else{object_extend(i,Howler);i.prototype.getActiveNode=function(){this.howl||this.initHowl();return this.howl&&this.howl._activeNode()};i.prototype.setVolume=function(o){this.howl&&this.howl.volume(o)};i.prototype.getVolume=function(){this.howl&&this.howl.volume()};!function(){function o(o){i.prototype[o]=function(){this.howl&&this.howl[o]()}}for(var t=["play","pause","stop","mute","unmute","unload"],e=0;e<t.length;e++)o(t[e])}()}i.prototype.initCordovaAudio=function(o){var i=t()+o.urls[0],e=this;this.cordovaAudio=new Media(i,void 0,function(o){console.log(i+":Audio Error: "+JSON.stringify(o))},function(o){switch(o){case Media.MEDIA_NONE:break;case Media.MEDIA_STARTING:e._activeNode=e;break;case Media.MEDIA_RUNNING:e.onplay();break;case Media.MEDIA_PAUSED:e.onpause();break;case Media.MEDIA_STOPPED:if(e.shouldStop){e._activeNode=null;e.onend()}else e.cordovaAudio.play()}})};i.prototype.initHowl=function(o){this.howl=new Howl(qyengine.addToObj({onend:this.onend.bind(this),onload:this.onload.bind(this),onloaderror:this.onloaderror.bind(this),onpause:this.onpause.bind(this),onplay:this.onplay.bind(this)},o))};i.prototype.onend=function(){this.dispatchEvent("soundend")};i.prototype.onload=function(){this.dispatchEvent("soundload")};i.prototype.onloaderror=function(){this.dispatchEvent("soundloaderror")};i.prototype.onpause=function(){this.dispatchEvent("soundpause")};i.prototype.onplay=function(){this.dispatchEvent("soundplay")}}();
!function(){function t(t){QyEventTarget.call(this);this.setStepProps(t);this.scheduledIdx=null;this.speedRatio=t&&t.speed||1}inherits(t,QyEventTarget);window.QyTimeline=t;t.prototype.getDirector=qyengine.getDirector;t.prototype.setPosition=function(t,e){e&&(t+=this.stepProps.startPosition);this.stepProps.startPosition=t;return this};t.prototype.setSpeed=function(t,e){t=null!=t?t/100:1;e&&(t*=this.speedRatio);this.speedRatio=t;return this};t.prototype.setStepProps=function(t){t||(t={});this.stepProps={loop:null!=t.loop?t.loop:!1,delay:t.delay||0,startPosition:t.startPosition||0};return this};t.prototype.stop=function(){if(null!=this.scheduledIdx){qyengine.unscheduleTask(this.scheduledIdx);this.scheduledIdx=null;if(this.started){this.started=!1;this.dispatchEvent("timelinestop");if(!(this instanceof QyKeyframe)){var t=this.startedOpt&&this.startedOpt.target||this.target;t&&t.dispatchEvent("timelinestop")}}}return this};t.prototype.start=function(t){if(!this.stepDefs_)return this;this.stop();var e=qyengine.merge(this.stepProps,t);if(e.startPosition>=this.stepMax_){if(!e.loop)return this;e.offset=e.startPosition%this.stepMax_}else e.offset=e.startPosition;for(var s=this.stepDefs_,i=s.length,r=0;i>r&&!(s[r][0]>=e.offset);r++);e.startIdx=r;this.startedOpt=e;var n=this.startedOpt.delay;n?this.scheduledIdx=qyengine.callAfter(this.startImm_.bind(this),n):this.startImm_();return this};t.prototype.startImm_=function(){this.stop();this.dispatchEvent("timelinestart");if(!(this instanceof QyKeyframe)){var t=this.startedOpt&&this.startedOpt.target||this.target;t&&t.dispatchEvent("timelinestart")}this.started=!0;this.scheduledIdx=qyengine.scheduleTask(this.step_.bind(this),this,-1);window.current_scene&&current_scene.isPaused_&&current_game.director&&qyengine.changeDirectorActivity&&qyengine.changeDirectorActivity(current_game.director,!0);return this};t.prototype.step_=function(t){t/=10;for(var e=this.startedOpt.target||this.target,s=this.startedOpt.loop,i=this.startedOpt.offset,r=t*this.speedRatio,n=i+r,o={type:"timeline"},a=this.stepDefs_,h=a.length;this.started;){for(var p=this.startedOpt.startIdx;h>p;p++){var d=a[p],c=d[0],l=d[1],u=d[2];if(!(n>c)){this.startedOpt.offset=n;this.startedOpt.startIdx=p;current_scene.isPaused_;return}o.step=c;u&&(o.extraArg=u);l.call(e,o)}if(!(s===!0||s>1)){this.stop();current_scene.isPaused_;return}s!==!0&&this.startedOpt.loop--;i=0;this.startedOpt.startIdx=0;n-=this.stepMax_}}}();
!function(){function t(t){for(var e=t.length,i=new Array(e),s=0;e>s;s++){var r=t[s],o=s==t.length-1?t[0]:t[s+1],n=pointAt(r,o);n.pointIdx=s;var h=r.speed&&r.speed/100||1;n.xRatio*=h;n.yRatio*=h;i[s]=n}return i}function e(t,e){if(0>e){t.x=t.dir.startX+t.relatedTo.x;t.y=t.dir.startY+t.relatedTo.y;t.xRatio=-t.dir.xRatio;t.yRatio=-t.dir.yRatio}else{t.x=t.dir.x+t.relatedTo.x;t.y=t.dir.y+t.relatedTo.y;t.xRatio=t.dir.xRatio;t.yRatio=t.dir.yRatio}return t}function i(t){QyEventTarget.call(this);this.at_end="stop";this.speed=100;t||(t={});this.setupOpt(t);var e;window.current_scene&&current_scene.classId&&(e=t[current_scene.classId]);if(!e)for(var i in t)if(t[i].points){e=t[i];break}e&&this.setupOpt(e)}inherits(i,QyEventTarget);window.QyPath=i;i.prototype.setSpeed=function(t){this.speed=t;if(this.target){var i=this.target.moveTarget_;if(i){e(i,t);t=Math.abs(t);this.target.setSpeed(t*i.xRatio,t*i.yRatio)}}return this};i.prototype.setPosition=function(t,e){e&&(t+=this.position);this.setupOpt({reversed:!1,position:t,speed:Math.abs(this.speed)});if(this.target&&this.target.moveTarget_){var i=this.getPoints()[this.position],s=this.getDirs()[this.position],r=this.target.moveTarget_,o=r.relatedTo;this.target&&this.target.setPosition(i.x+o.x,i.y+o.y,!0);this.moveOneStep(s,r);return this}};i.prototype.setupOpt=function(t){t||(t={});null!=t.closed&&(this.closed=t.closed);null!=t.at_end&&(this.at_end=t.at_end);null!=t.relative&&(this.relative=t.relative);null!=t.reversed&&(this.reversed=t.reversed);null!=t.speed&&(this.speed=t.speed);null!=t.points&&this.setPoints(t.points);if(null!=t.position&&this.points&&this.points.length>0){var e=this.points.length,i=t.position;this.position=0>i?e-1+i%e:i%e}else null==this.point&&(this.position=0)};i.prototype.setPoints=function(t){if(this.closed){this.points=new Array(t.length+1);for(var e=0;e<t.length;e++)this.points[e]=t[e];this.points[t.length]=t[0]}else this.points=t;delete this.revPoints;delete this.Dirs;delete this.revDirs};i.prototype.getPoints=function(){if(this.reversed){if(this.revPoints)return this.revPoints;for(var t=this.points.length,e=t-1,i=new Array(t),s=0;t>s;s++)i[s]=this.points[e-s];this.constructor.prototype.revPoints=i;return i}return this.points};i.prototype.getDirs=function(){if(!this.points||0==this.points.length)return[];if(this.reversed){if(this.revDirs)return this.revDirs;var e=t(this.getPoints());this.constructor.prototype.revDirs=e;return e}if(this.Dirs)return this.Dirs;var i=t(this.points);this.constructor.prototype.Dirs=i;return i};i.prototype.moveOneStep=function(t,e){e||(e={relatedTo:{x:0,y:0}});e.dir=t;this.target.moveTarget_=e;this.setSpeed(this.speed)};i.prototype.start=function(t){if(!this.target||this.started)return this;t&&this.setupOpt(t);var e=this.getDirs();if(0!=e.length)if(1!=e.length){var i=this.getPoints()[this.position],s=e[this.position],r={relatedTo:{x:0,y:0}},o=this.target.getPosition();this.targetStartPos={x:o.x,y:o.y};if(this.relative){var n=o.x-i.x,h=o.y-i.y;r.relatedTo.x=n;r.relatedTo.y=h}else{this.target.setPosition(i.x,i.y,!0);this.targetStartPos.x=i.x;this.targetStartPos.y=i.y;this.relative=!0}this.moveOneStep(s,r);this.started=!0;this.target.dispatchEvent("pathstart")}else this.relative||this.target.setPosition(e[0].x,e[0].y)};i.prototype.stop=function(){if(this.target&&this.started){delete this.target.moveTarget_;this.target.setSpeed(0);this.started=!1;return this}};i.prototype.reachPoint=function(t){var e=t.dir,i=this.points.length,s=0;this.speed<=0&&e.pointIdx<=0?s=1:this.speed>=0&&e.pointIdx>=i-2&&(s=2);if(s){this.position=0;this.target.dispatchEvent("pathend");switch(this.at_end){case"stop":this.stop();return;case"revert":if(1==s)this.setSpeed(-this.speed);else if(2==s){this.reversed=!this.reversed;this.stop();this.start()}return;case"recurse":this.target.setPosition(this.targetStartPos.x,this.targetStartPos.y,!0);case"continue":if(1==s)this.setSpeed(-this.speed);else if(2==s){this.stop();this.start()}return}}this.target.dispatchEvent({type:"pathpoint",pointIdx:e.pointIdx});var r=this.getDirs();e=r[(i+e.pointIdx+sign(this.speed))%i];this.moveOneStep(e,t)}}();
!function(){function t(t){this.type=t.type;this.changeFrame(t)}function e(){}inherits(t,QyTimeline);window.QyKeyframe=t;t.prototype.changeFrame=function(t){this.loop=null!=t.loop?t.loop:!0;this.startPosition=null!=t.startPosition?t.startPosition:0;if("multiImages"==this.type){this.setupMultiImages(t.frames);this.xStart=0;this.yStart=0}else if("largeImage"==this.type&&void 0!==t.total){this.setupLargeImage(t);this.xStart=0;this.yStart=0}else{if("string"==typeof t)t=this.frames&&this.frames[t];else if(t.frames){this.frames=t.frames;t=t.frames[t.defaultFrame]}this.delay=null!=t.delay?60*t.delay:200;this.xNum=t.xNum||1;this.xStart=null!=t.xStart?t.xStart:0;this.xEnd=null!=t.xEnd?t.xEnd:this.xNum-1;this.yStart=null!=t.yStart?t.yStart:0;this.yEnd=t.yEnd?t.yEnd:this.yStart;this.xLen=this.xEnd-this.xStart+1;this.yLen=this.yEnd-this.yStart+1,this.setupStepDefs()}this.target=this;QyTimeline.call(this,{delay:0,loop:this.loop,startPosition:this.startPosition});t.sprite&&this.setSprite(t.sprite)};t.prototype.showOneMultiImgsFrame=function(t){var e=t.extraArg[0],s=this.frames[e];this.sprite.setTexture(PIXI.Texture.fromImage(s.url));return this};t.prototype.showOneLargeImgFrame=function(t){var e=t.extraArg[0],s=t.extraArg[1],i=this.frame,r=this.size,a=i.hFrameOffset+e,h=i.vFrameOffset+s,n=i.hPixelOffset+r.width*a+e*i.hSplit,o=i.vPixelOffset+r.height*h+s*i.vSplit;this.setPixiFrame(n,o,r.width,r.height);return this};t.prototype.setupMultiImages=function(t){this.frames=t;var s=t.length,i=0;this.stepDefs_=new Array(s+1);for(var r=0;s>r;r++){this.stepDefs_[r]=[i,this.showOneMultiImgsFrame,[r]];i+=60*t[r].delay}this.stepDefs_[s]=[i,e];this.stepMax_=i+1;return this};t.prototype.setupLargeImage=function(t){this.frame=t;var s=t.total,i=60*t.delay,r=t.xNum;this.stepDefs_=new Array(s+1);for(var a=0;s>a;a++)this.stepDefs_[a]=[a*i,this.showOneLargeImgFrame,[a%r,Math.floor(a/r)]];this.stepDefs_[s]=[s*i,e];this.stepMax_=s*i+1;return this};t.prototype.setupStepDefs=function(){var t=this.xStart,s=this.xLen,i=this.yStart,r=this.yLen,a=this.delay,h=s*r,n=0;this.stepDefs_=new Array(h+1);for(var o=0;r>o;o++)for(var p=0;s>p;p++){n=o*s+p;this.stepDefs_[n]=[n*a,this.showFrame,[t+p,i+o]]}this.stepDefs_[h]=[h*a,e];this.stepMax_=h*a+1;return this};t.prototype.showFrame=function(t){var e=t.extraArg,s=e[0],i=e[1],r=this.size;this.setPixiFrame(s*r.width,i*r.height,r.width,r.height);return this};t.prototype.setPixiFrame=function(t,e,s,i){var r=this.sprite,a=t+":"+e;r.pixiFrames||(r.pixiFrames={});if(!r.pixiFrames[a]){var h={x:t,y:e,width:s,height:i};r.pixiFrames[a]=new PIXI.Texture(r.texture.baseTexture,h);r.setSize(h.width,h.height)}r.setTexture(r.pixiFrames[a])};t.prototype.setSprite=function(t){this.sprite=t;this.size=t.getSize();return this};var s=!1;t.prototype.getDirector=function(){return current_scene.isPaused_&&s?null:qyengine.getDirector()};t.prototype.setSpeed=function(t){var e;if("multiImages"===this.type){var s=JSON.parse(JSON.stringify(this.frames||[]));s&&s.length&&s.forEach(function(e){e.delay/=t/100});e={loop:this.loop,frames:s,startPosition:this.startPosition}}else if("largeImage"===this.type){var i=JSON.parse(JSON.stringify(this.frame||{}));i.delay/=t/100;e=i}else{e=this;this.delay=this.delay/60/t*100}this.stop();this.changeFrame(e);this.start()}}();
!function(){function t(t,e){return t.lx<e.rx&&e.lx<t.rx&&t.ly<e.ry&&e.ly<t.ry}function e(t,e){var i=e.type||e;qyengine.EventsOnQyObj.indexOf(i)>=0?t.dispatchEvent(e):t.currentSprite&&t.currentSprite.dispatchEvent(e)}function i(t){for(var e=0;e<p.length;e++){var i=p[e];if(t[i]){t.type=i;t.val=t[i];return t}}}function n(t){var e;t instanceof Array?t.length>0&&(e=t[0]):e="object"==typeof t?t:qyengine.guardId(t);return e&&!e.destroyed_?e:null}function r(t){var e=[];t.forEach(function(t){e.push(o(t))});return e}function o(t){if(t.type&&void 0!==t.keyCode)return{type:t.type,data:t.keyCode+""};if("swipe"===t.type&&t.gesture&&t.gesture.direction)return{type:t.type,data:t.gesture.direction};if("string"==typeof t){if(t.indexOf(":")<0)return t;var e=t.split(":");return{type:e[0],data:e[1]}}return t.type||t}var s=[],a=new PIXI.Point,h=new PIXI.Point,u=new PIXI.InteractionData,d=[],c=!1,p=["scaleTo","scaleBy","moveTo","moveBy","rotateTo","rotateBy","colorTo","fadeTo","fadeBy","delay"];qyengine.pixiMoveHandler=function(t){if(0!=d.length){if(t){u.global.x=t.global.x;u.global.y=t.global.y;if(window.current_scene){u.global.x/=window.current_scene.scale.x;u.global.y/=window.current_scene.scale.y;u.global.x-=window.current_scene.viewOffset.x;u.global.y-=window.current_scene.viewOffset.y}t=u}else{t=u;t.global.x=window.mouseX;t.global.y=window.mouseY}var e=t.global;a.x=e.x-current_scene.viewOffset.x;a.y=e.y-current_scene.viewOffset.y;for(var i=0;i<d.length;i++){var n=d[i];h.x=a.x;h.y=a.y;var r=n.getPosition(),o=n.followingMouse,s=r.x,c=r.y,p=n.followMouse.deltaX,y=n.followMouse.deltaY;if("both"==o){s=h.x+p;c=h.y+y}else"x"==o?s=h.x+p:c=h.y+y;n.setPosition(s,c,!0)}}};window.isPassed=function(t,e,i){var n=0==t?!0:t>0?i>=e:e>=i;return n};window.gScale=.1;qyengine.setGScale=function(t){gScale=t||.1;return gScale};qyengine.getGScale=function(){return gScale};var y=window.QyObject=function(t){t||(t={});this.mirror={horizontal:1,vertical:1};QyEventTarget.call(this);this.initVars(t);this.scene=t.sceneId?window[t.sceneId]:window.current_scene;this.scene.instances.push(this);t.physics&&(this.physics=t.physics);t.mirror&&this.setMirror(t.mirror.horizontal,t.mirror.vertical);t.sprite&&"no-sprite"!==t.sprite&&this.changeSprite(t.sprite,t);t.position&&(this.selfPos={x:t.position.x,y:t.position.y});t.gesture&&this.setupHammer();t.layer&&(this.layerName=t.layer);null!=t.speed&&this.setSpeed(t.speed);t.timeline&&this.setTimeline(t.timeline);t.hiddenAtStart&&this.hide();this.checkOutofscene(this.getPosition(),!0);this.zIndex=t.zIndex||0};inherits(y,QyEventTarget);addGenericProperties(y);addTimelineSupport(y);Object.defineProperties(y.prototype,{text:{configurable:!0,get:function(){return this.getText()},set:function(t){this.setText(t)}},rotation:{configurable:!0,get:function(){return this.getRotation()},set:function(t){this.setRotation(t)}},rotationSpeed:{configurable:!0,get:function(){return this.getRotationSpeed()},set:function(t){this.setRotationSpeed(t)}},fixedRotation:{configurable:!0,get:function(){return this.isFixedRotation()},set:function(t){this.setFixedRotation(t)}},speed:{configurable:!0,get:function(){return this.getSpeed()||{x:0,y:0,angle:0}},set:function(t,e){this.setSpeed&&this.setSpeed(t,e);return this}},friction:{configurable:!0,get:function(){return this.getFriction()},set:function(t){this.setFriction(t);return this}},gravityScale:{configurable:!0,get:function(){return this.getGravityScale()},set:function(t){this.setGravityScale(t);return this}},restitution:{configurable:!0,get:function(){return this.getRestitution()},set:function(t){this.setRestitution(t);return this}},"是感应器":{configurable:!0,get:function(){return this.getIsSensor()},set:function(t){this.setIsSensor(t);return this}},isSensor:{configurable:!0,get:function(){return this.getIsSensor()},set:function(t){this.setIsSensor(t);return this}},awake:{configurable:!0,get:function(){return this.isAwake()},set:function(t){this.setAwake(t);return this}}});y.prototype.step_=function(t){this.currentSprite&&this.currentSprite.moveBySpeed&&this.currentSprite.moveBySpeed(t);this.b2dBody?this.updateByBody():this.moveBySpeed(t);this.faceForwardAlways&&this.faceForward(this.faceForwardAlways.delta,!0);this.faceTowardAlways&&this.faceToward(this.faceTowardAlways);var e=this.followingOpt;if(e){var i=n(e.objId);if(i&&i.getPosition){var r=i.getPosition(),o=this.getPosition(),s=o.x,a=o.y,h=e.followType;if("both"==h){s=r.x+e.x;a=r.y+e.y}else"x"==h?s=r.x+e.x:a=r.y+e.y;this.setPosition(s,a,!0)}}if(this.followingMouse){var u=this.getPosition();qyengine.calDistance(u.x,u.y,window.mouseX||0,window.mouseY||0)<10&&this.setSpeed(0,0)}};y.prototype.moveBySpeed=function(t){if(!this.selfSpeed){this.checkOutofscene();return this}var e,i=this.selfSpeed.x*t,n=this.selfSpeed.y*t,r=this.getPosition(),o={x:r.x+i,y:r.y+n},s=this.moveTarget_;if(s&&isPassed(s.xRatio,s.x,o.x)&&isPassed(s.yRatio,s.y,o.y)){o.x=s.x;o.y=s.y;this.setPosition(o.x,o.y,!0);if(s.relatedTo&&this.path_)this.path_.reachPoint(s);else{delete this.moveTarget_;e=!0}}else this.setPosition(o.x,o.y,!0);if(e){c=!0;this.dispatchEvent("moveend");c=!1;this.moveendSpSet?this.moveendSpSet=!1:this.setSpeed(0)}return this};y.prototype.updatePosByBody=function(){var t=this.b2dBody.GetPosition(),e=new PIXI.Point(t.x/gScale,t.y/gScale);if(this.oldPos_.x!=e.x||this.oldPos_.y!=e.y){var i,n=this.moveTarget_,r=this.currentSprite;if(n&&isPassed(n.xRatio,n.x,e.x)&&isPassed(n.yRatio,n.y,e.y)){var o;if(e.x!=n.x){e.x=n.x;o=!0}if(e.y!=n.y){e.y=n.y;o=!0}o&&this.setPosition(e.x,e.y,!0);if(n.relatedTo&&this.path_)this.path_.reachPoint(n);else{delete this.moveTarget_;i=!0}}this.oldPos_.x=e.x;this.oldPos_.y=e.y;r.setPosition(e);if(i){c=!0;this.dispatchEvent("moveend");c=!1;this.moveendSpSet?this.moveendSpSet=!1:this.setSpeed(0)}this.checkOutofscene(e)}else this.checkOutofscene(e)};y.prototype.updateRotByBody=function(){var t=this.currentSprite;if(t){var e=this.b2dBody.GetAngle(),i=Math.abs(e);1e-6>=i&&(e=0);if(this.oldRotr_!=e){var n=-e*qyengine.R2A;t.setRotation(n);this.oldRotr_=e;this.oldRota_=n}}};y.prototype.updateByBody=function(){this.updatePosByBody();this.updateRotByBody()};y.prototype.initVars=function(t){this.vars_={};this.constructor.prototype.setVar=qyengine.setVar;this.constructor.prototype.toggleVar=qyengine.toggleVar;t.extend&&qyengine.initVars(this,t.extend)};y.prototype.changeSprite=function(t,e){t.classId&&(t=t.classId);if(this.spriteName==t)return this;this.spriteName=t;var i=qyengine.guardType(t);if(!i)return this;if(this.insideChangeSprite)return this;this.insideChangeSprite=!0;if(this.currentSprite)this.currentSprite.fromJson(qyengine.merge(i.defaultOpt,e));else{e||(e={});e.qyobj=this;this.currentSprite=new i(e);e.qyobj=null}this.currentSprite.setMirror(this.mirror.horizontal,this.mirror.vertical);if(this.physics){var n=this.currentSprite.collisionData;if(n){this.physics.collisionData=n;this.setupBody(!0)}else this.setupBody()}this.insideChangeSprite=!1;return this};y.prototype.setMirror=function(t,e){var i;if(null!=t&&this.mirror.horizontal!=t){i=!0;this.mirror.horizontal=t}if(null!=e&&this.mirror.vertical!=e){i=!0;this.mirror.vertical=e}if(i&&this.currentSprite&&this.currentSprite.setMirror){this.currentSprite.setMirror(this.mirror.horizontal,this.mirror.vertical);this.b2dBody&&this.setupBody(!0)}};y.prototype.mirrorH=function(){this.setMirror(-1,void 0)};y.prototype.mirrorV=function(){this.setMirror(void 0,-1)};y.prototype.getSize=function(){return this.currentSprite?this.currentSprite.getSize():{width:0,height:0}};y.prototype.setSize=function(t,e){var i=this.currentSprite;if(i){var n=i.getSize();if(t!=n.x||e!=n.y){i.setSize(t,e);t>0&&e>0&&this.rebuildBody()}}return this};y.prototype.getAnchorPoint=function(){var t=this.currentSprite;return t&&t.getAnchorPoint()};y.prototype.setAnchorPoint=function(t,e){var i=this.currentSprite;return i&&i.setAnchorPoint(t,e)};y.prototype.getPosition=function(){var t=this.currentSprite;if(t){var e=t.getPosition();if(this.scroller){e=e.clone();e.x+=this.scroller.x;e.y+=this.scroller.y}return e}return this.selfPos};y.prototype.setPosition=function(t,e,i){var n=checkNumbers(t,e);t=n.x;e=n.y;var r=this.currentSprite;if(!r){this.selfPos||(this.selfPos={});this.selfPos.x=t;this.selfPos.y=e;this.checkOutofscene(this.selfPos);return this}var o=this.b2dBody;if(o)if(i){qyengine.g_b2Vec2.x=t*gScale;qyengine.g_b2Vec2.y=e*gScale;o.SetPosition(qyengine.g_b2Vec2);r.setPosition(t,e);this.setAwake(!0)}else this.moveTo(t,e,300);else{r.setPosition(t,e);qyengine.g_b2Vec2.x=t;qyengine.g_b2Vec2.y=e;this.checkOutofscene(qyengine.g_b2Vec2)}current_scene.is25D&&this.checkZAxis();return this};y.prototype.setScale=function(t,e){var i=this.currentSprite;if(i){var n=i.getScale();if(t!=n.x||e!=n.y){i.setScale(t,e);t>0&&e>0&&this.rebuildBody()}}return this};y.prototype.getScale=function(){var t=this.currentSprite;return t&&t.getScale()};y.prototype.getRotation=function(){var t=this.currentSprite;return t&&t.getRotation()};y.prototype.setRotation=function(t){if(null==t||t==this.oldRota_)return this;var e=this.currentSprite;if(e){var i=this.b2dBody;i?i.SetAngle(-t*qyengine.A2R):e.setRotation(t)}return this};y.prototype.rotateTo=function(t){return this.setRotation(t%360)};y.prototype.rotateBy=function(t){var e=this.getRotation();return this.rotateTo(e+t)};y.prototype.setOpacity=function(t){this.currentSprite&&this.currentSprite.setOpacity&&this.currentSprite.setOpacity(t)};y.prototype.setMask=function(t){if(t!==this){var e;e="string"==typeof t?window[t]&&window[t].currentSprite:t&&t.currentSprite;if(e){this.mask=e;var i=this.currentSprite;i&&i.setMask&&i.setMask(e)}}};y.prototype.cancelMask=function(){this.mask=null;this.currentSprite&&this.currentSprite.cancelMask&&this.currentSprite.cancelMask()};y.prototype.setSpriteSpeed=function(t,e){this.currentSprite&&this.currentSprite.setSpeed&&this.currentSprite.setSpeed(t,e)};y.prototype.setFrameSpeed=function(t){this.currentSprite&&this.currentSprite.setFrameSpeed(t);return this};y.prototype.setSkeletonSpeed=function(t){this.currentSprite&&this.currentSprite.setSkeletonSpeed(t);return this};y.prototype.setupHammer=function(){if(this.hammer||!this.currentSprite)return this;this.currentSprite.interactive=!0;this.hammer=Hammer(this.currentSprite);var t=this;for(var e in Hammer.gestures)this.hammer.on(Hammer.gestures[e].name,function(e){t.isShieldEvent(e)||t.dispatchEvent(e)});return this};y.prototype.show=function(){this.setHidden(!1);return this};y.prototype.hide=function(){this.setHidden(!0);return this};y.prototype.setHidden=function(t){this.currentSprite&&this.currentSprite.setHidden(t);this.setActive(!t);this.isHidden_=t;return this};y.prototype.toggleHidden=function(){this.setHidden(!this.isHidden_)};y.prototype.getText=function(){return this.currentSprite&&this.currentSprite.getText&&this.currentSprite.getText()};y.prototype.setText=function(t){this.currentSprite&&this.currentSprite.setText&&this.currentSprite.setText(t)};y.prototype.addText=function(t){this.currentSprite&&this.currentSprite.addText&&this.currentSprite.addText(t)};y.prototype.setFontColor=function(t){this.currentSprite&&this.currentSprite.setFontColor&&this.currentSprite.setFontColor(t)};y.prototype.setFontSize=function(t){this.currentSprite&&this.currentSprite.setFontSize&&this.currentSprite.setFontSize(t)};y.prototype.setRandomPath=function(t){var e=t.paths;if(!e||0==e.length)return this;var i=random(e.length-1);return this.setPath(e[i],t)};y.prototype.setPath=function(t,e){t.classId&&(t=t.classId);var i=qyengine.guardType(t);if(i){this.path_=new i(e);this.path_.target=this;this.path_.start()}return this};y.prototype.setPathSpeed=function(t,e){if(this.path_){e&&(t+=this.path_.speed);this.path_.setSpeed(t)}return this};y.prototype.setPathPosition=function(t,e){this.path_&&this.path_.setPosition(t,e)};y.prototype.endPath=function(){if(this.path_){this.path_.stop();this.setSpeed(0)}};y.prototype.objListen=function(t,e,i){this.eventHandlerKeys||(this.eventHandlerKeys=[]);gmx_listen(t,e,i);this.eventHandlerKeys.push([t,e,i])};y.prototype.selfListen=function(t,e){this.objListen(this,t,e)};y.prototype.selfUnlisten=function(){if(this.eventHandlerKeys){array_foreach(this.eventHandlerKeys,function(t){t[0].unlisten(t[1],t[2])});this.eventHandlerKeys.length=0}};y.prototype.spriteListen=function(t,e){if(this.currentSprite){this.currentSprite.interactive=!0;this.currentSprite.listen(t,e);this.currentSprite[t]=e;this.spriteHandlers||(this.spriteHandlers=[]);this.spriteHandlers.push([t,e])}return this};y.prototype.spriteUnlisten=function(){var t=this.currentSprite;if(t){t.keyframe&&t.keyframe.stop();if(this.spriteHandlers){array_foreach(this.spriteHandlers,function(e){t.unlisten(e[0],e[1])});this.spriteHandlers.length=0}t.removeFromParent&&t.removeFromParent();var e=t.parent_||t.parent;e&&e.removeChild(t);delete this.currentSprite}this.releaseDraggable&&this.releaseDraggable()};y.prototype.destroy=function(t){if(qyengine.insideGStep){if(!this.destroyBuffered){t||this.dispatchEvent("destroy");qyengine.toDestroy.push(this);this.destroyBuffered=!0}}else if(!this.destroyed_){this.destroyed_=!0;t||this.dispatchEvent("destroy");this.destroyIsolate();this.stopAnimation();this.unfollowMouse();this.destroyBody();this.maintainId();array_remove(this.scene.instances,this)}};y.prototype.destroyIsolate=function(){this.selfUnlisten();this.spriteUnlisten();this.cancelAllAlarms();this.stopTimeline();delete this.timeline_};y.prototype.maintainId=function(){var t=this.id;if(t){if(window[t]==this){var e=window[t].classId;e?window[t]={classId:e,destroyed_:!0}:delete window[t]}delete this.id}};y.prototype.isDestroyed=function(){return this.destroyBuffered||this.destroyed_};y.prototype.changeAnimation=function(t){this.currentSprite&&this.currentSprite.changeAnimation(t);return this};y.prototype.stopAnimation=function(){if(this.animation){this.animation.stop();this.animation.removeAllEventListeners("animationstart");this.animation.removeAllEventListeners("animationend")}return this};y.prototype.runAnimation=function(t){if(this.currentSprite){var e=this.createAnimation(t);if(e){this.stopAnimation();this.animation=e;var i=this;gmx_listen(e,"animationstart",function(){i.dispatchEvent("animationstart")});gmx_listen(e,"animationend",function(){i.dispatchEvent("animationend")});this.currentSprite.runAction(e)}}return this};y.prototype.createAnimation=function(t){if("string"==typeof t){var e=current_game.animations[t];if(!e)return null;var n=this.createFrames(e.frames);return QyAnimation.loop(n,e.loop)}if(t instanceof Array){var r=this,o=array_map(t,function(t){return r.createAnimation(t)});return 1==o.length?o[0]:QyAnimation.sequence(o)}t=i(t);var e=QyAnimation[t.type](t.val);t.duration&&e.setDuration(t.duration);return e};y.prototype.createOneFrame=function(t){for(var e=[],i=t.anim,n=t.duration,r=this.getPosition(),o=0;o<i.length;o++){var s=i[o],a=s[0],h=s[1];if("oldFormatMove"==a){a="moveTo";h={x:h.x+r.x,y:h.y+r.y}}QyAnimation[a]||console.log(a);var u=QyAnimation[a](h);u.setDuration(n);e.push(u)}return 1==e.length?e[0]:QyAnimation.spawn(e)};y.prototype.createFrames=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];e.push(this.createOneFrame(n))}return 1==e.length?e[0]:QyAnimation.sequence(e)};y.prototype.setSpeed=function(t,e){if(null==t)return this;c&&(this.moveendSpSet=!0);("number"==typeof e||"number"==typeof t)&&(t=new b2Vec2(t,e||0));if(this.b2dBody){t.x*=gScale;t.y*=gScale;this.setAwake(!0);this.b2dBody.SetLinearVelocity(t);this.speedOpt=t}else{this.selfSpeed=t;this.selfSpeed.angle=qyengine.calAngle(t.x,t.y);this.selfPos||(this.selfPos={x:0,y:0})}if(this.movestarted&&0==t.x&&0==t.y){this.movestarted=!1;current_scene.is25D&&this.checkZAxis()}return this};y.prototype.setSpeedWithAngle=function(t,e){var i=e*qyengine.A2R;return this.setSpeed(t*Math.cos(i),-t*Math.sin(i))};y.prototype.setSpeedTowardPos=function(t,e,i){if(null==t||null==e)return this;null!=i||(i=200);var n=this.getPosition(),r=t-n.x,o=e-n.y,s=qyengine.calAngle(r,o);return this.setSpeedWithAngle(i,s)};y.prototype.setSpeedTowardObject=function(t,e){var i=n(t),r=i&&i.getPosition();return r?this.setSpeedTowardPos(r.x,r.y,e):void 0};y.prototype.setSpeedTowardTap=function(t){return this.setSpeedTowardPos(window.mouseX,window.mouseY,t)};y.prototype.getSpeed=function(){if(!this.b2dBody)return this.selfSpeed||this.animSpeed;var t=this.b2dBody.GetLinearVelocity();this.speedOpt||(this.speedOpt={});this.speedOpt.x=t.x/gScale;this.speedOpt.y=t.y/gScale;this.speedOpt.angle=qyengine.calAngle(t.x,t.y);return this.speedOpt};y.prototype.moveBy=function(t,e,i){var n=this.getPosition();return this.moveTo(n.x+t,n.y+e,i)};y.prototype.moveTo=function(t,e,i){i||(i=300);var n=this.getPosition(),r=pointAt(n,t,e);if(0==r.xRatio&&0==r.yRatio){this.dispatchEvent("moveend");this.movestarted=!1;return this}if(this.b2dBody){this.moveTarget_=r;this.setSpeed({x:r.xRatio*i,y:r.yRatio*i});this.animSpeed=null}else if(this.currentSprite){var o=new QyAnimation.MoveTo({x:t,y:e});i&&o.setSpeed(i);this.animSpeed={x:r.xRatio*i,y:r.yRatio*i,angle:qyengine.calAngle(r.xRatio,r.yRatio)};var s=this;gmx_listen(o,"animationend",function(){s.dispatchEvent("moveend");s.animSpeed=null;s.movestarted=!1;current_scene.is25D&&s.checkZAxis()});this.currentSprite.runAction(o)}this.dispatchEvent("movestart");this.movestarted=!0;return this};y.prototype.setViewCenter=function(t){current_scene.viewFollowObj(this,!0,t)};y.prototype.setFollowView=function(){if(!this.id){this.id="followingObj";window[this.id]=this}current_scene.setFollowView(this)};y.prototype.followMouse=function(t,e,i,n,r,o){this.followMouse.deltaX=e;this.followMouse.deltaY=i;if(!this.followingMouse){d.push(this);t&&hide_cursor()}this.followingMouse=n;this.followingMouseWay=r||"instant";this.followingMouseSpeed=o;qyengine.pixiMoveHandler();return this};y.prototype.unfollowMouse=function(){if(this.followingMouse){delete this.followingMouse;array_remove(d,this);if(d.length<=0){restore_cursor();array_foreach(s,function(t){current_game.director.unlistenByKey(t)});s.length=0}this.releaseMouseJoint();this.setSpeed(0,0)}this.followingOpt=null;return this};y.prototype.setFollowObj=function(t,e,i,n){this.followingOpt={objId:t,x:e,y:i,followType:n}};y.prototype.setUnfollow=function(){this.unfollowMouse()};y.prototype.checkIfEmpty=function(t,e,i){return qyengine.checkIfEmpty(t,e,i)};y.prototype.checkIfCollide=function(t,e,i){return!qyengine.checkIfEmpty(t,e,i)};y.prototype.checkTypeAt=function(t,e,i){var n=qyengine.guardType(i);if(!n)return!1;for(var r=qyengine.queryPoint(t,e),o=0;o<r.length;o++){var s=r[o];if(s instanceof n&&!s.destroyBuffered&&!s.destroyed_)return!0}return!1};current_game.checkTypeAt=y.prototype.checkTypeAt;y.prototype.checkOutofscene=function(t,e){t||(t=this.getPosition());if(t){var i="",n=t.x,r=t.y;0>n?i="left":n>this.scene.full_size.width?i="right":0>r?i="top":r>this.scene.full_size.height&&(i="bottom");if(this.isBullet_&&i)this.destroy();else{if(!e)if(i&&!this.outofscene)this.dispatchEvent({type:"outofscene",outType:i});else if(!i&&this.outofscene){var o="left",s={left:n/this.scene.full_size.width,top:r/this.scene.full_size.height,right:(this.scene.full_size.width-n)/this.scene.full_size.width,bottom:(this.scene.full_size.height-r)/this.scene.full_size.height};for(var a in s)s[a]<s[o]&&(o=a);this.dispatchEvent({type:"inscene",inType:o})}this.outofscene=i;this.checkOutofview(t,e)}}};y.prototype.checkOutofview=function(t,e){var i="",n=this.scene.getSize(),r=this.scene.viewOffset,o=t.x+r.x,s=t.y+r.y;0>o?i="left":o>n.width?i="right":0>s?i="top":s>n.height&&(i="bottom");if(this.isBullet_&&i)this.destroy();else{if(!e)if(i&&!this.outofview)this.isBullet_?this.destroy():this.dispatchEvent({type:"outofview",outType:i});else if(!i&&this.outofview){var a="left",h={left:o/n.width,top:s/n.height,right:(n.width-o)/n.width,bottom:(n.height-s)/n.height};for(var u in h)h[u]<h[a]&&(a=u);this.dispatchEvent({type:"inview",inType:a})}this.outofview=i}};var l=[];y.prototype.checkZAxis=function(){var e=this.layer;if(e&&!e.ignore25d){var i=e.children_||e.children,n=this.getBoundingBox();l.length=0;for(var r=0;r<i.length;r++)if(!i[r].getHidden()){var o=i[r].qyobj;if(o!=this){var s=o.getBoundingBox();if(t(n,s)){s.curIdx_=r;l.push(s)}}else n.curIdx_=r}var a=n.curIdx_;for(r=0;r<l.length;r++){s=l[r];if(s.ry>n.ry){s.curIdx_<n.curIdx_&&(a=s.curIdx_);break}a<s.curIdx_&&(a=s.curIdx_)}a!=n.curIdx_&&e.setChildIndex(this.currentSprite,a)}};y.prototype.cancelAlarm=function(t){if(this.scheduledAlarms){var e=this.scheduledAlarms[t];if(e>=0){unscheduleTask(e);this.scheduledAlarms[t]=-1}}};y.prototype.cancelAllAlarms=function(){if(this.scheduledAlarms)for(var t in this.scheduledAlarms)this.cancelAlarm(t)};y.prototype.setAlarm=function(t,e){this.scheduledAlarms||(this.scheduledAlarms={});this.cancelAlarm(t);var i=this,n=function(){i.scheduledAlarms[t]=-1;var e={type:"alarm",alarmIdx:t};if(i==current_scene)for(var n=0;n<current_scene.instances.length;n++)current_scene.instances[n].dispatchEvent(e);i.dispatchEvent(e)};this.scheduledAlarms[t]=callAfter(n.bind(this),this,e)};y.prototype.dispatchMessage=function(t){if(this==current_scene)for(var i=0;i<current_scene.instances.length;i++)e(current_scene.instances[i],t);e(this,t)};y.prototype.getBoundingBox=function(){this.boundingBox_||(this.boundingBox_={lx:0,rx:0,ly:0,ry:0});if(this.currentSprite){var t=this.getPosition(),e=this.getAnchorPoint(),i=this.getSize(),n=this.getScale();this.boundingBox_.lx=t.x-e.x*i.width*n.x;this.boundingBox_.rx=t.x+(1-e.x)*i.width*n.x;this.boundingBox_.ly=t.y-e.y*i.height*n.y;this.boundingBox_.ry=t.y+(1-e.y)*i.height*n.y}return this.boundingBox_};y.prototype.angleTo=function(t){if(!window[t])return 0;var e=window[t].x,i=window[t].y;if(void 0===e||void 0===i)return 0;var n=this.getPosition(),r=e-n.x,o=i-n.y;return qyengine.calAngle(r,o)};y.prototype.distanceTo=function(t){if(!window[t])return 0;var e=window[t].x,i=window[t].y;if(void 0===e||void 0===i)return 0;var n=this.getPosition();return qyengine.calDistance(e,i,n.x,n.y)};Object.defineProperties(y.prototype,{angleToMouse:{get:function(){var t=this.getPosition(),e=window.mouseX-t.x,i=window.mouseY-t.y;return qyengine.calAngle(e,i)}},distanceToMouse:{get:function(){var t=this.getPosition();return qyengine.calDistance(window.mouseX,window.mouseY,t.x,t.y)}}});!function(){var t={density:1};y.prototype.rebuildBody=function(){if(this.b2dBody)if(qyengine.insideGStep){if(!this.rebuildBuffered){qyengine.toRebuild.push(this);this.rebuildBuffered=!0}}else this.setupBody(!0)};y.prototype.setupBody=function(e){if(this.destroyed_||this.destroyBuffered)return this;this.physics||(this.physics=t);if(this.b2dBody&&!e)return this;var i=this.currentSprite;if(!i)return this;i.physics&&i.physics.collisionData&&(this.physics.collisionData=i.physics.collisionData);if(e&&this.b2dBody){this.destroyFixtures();this.b2dBody.fixtureDef=null;this.setAwake(!0)}var n,r=this.calShape(),o=this.calFixtureDef(),s=this.calBody();if(r instanceof Array)for(var a=0;a<r.length;a++){o.shape=r[a];n=s.CreateFixture(o);n.fixName=r[a].fixName}else{o.shape=r;n=s.CreateFixture(o);n.fixName=r.fixName}current_scene.instancesWithBody.push(this);return this};y.prototype.calShape=function(){var t=this.getAnchorPoint(),e=this.currentSprite.constructor.defaultOpt.size,i=this.getSize(),n=this.getScale(),r=i.width/e.width*n.x*gScale,o=i.height/e.height*n.y*gScale,i=e,s=i.width/2,a=i.height/2,h=(.5-t.x)*i.width,u=(.5-t.y)*i.height,d={x:h*r,y:u*o};return this.genShape(this.physics.collisionData,d,s,a,r,o)};y.prototype.calFixtureDef=function(){if(this.fixtureDef)return this.fixtureDef;var t=new b2FixtureDef,e=this.physics;object_extend(t,e);t.filter.categoryBits=e.categoryBits;t.filter.maskBits=e.maskBits;e.solid&&(t.density||(t.density=1));this.fixtureDef=t;this.isSensor_=t.isSensor;return t};y.prototype.calBody=function(){if(this.b2dBody)return this.b2dBody;var t=this.getPosition(),e=this.getRotation(),i=-e*qyengine.A2R,n=this.physics,r=new b2BodyDef;object_extend(r,n);r.position.x=t.x*gScale;r.position.y=t.y*gScale;r.angle=i;n.solid||(r.type=b2Body.b2_dynamicBody);this.b2dBody=current_game.world.CreateBody(r);this.bodyDef=r;this.oldRotr_=i;this.oldRota_=e;this.oldPos_=t;if(n){this.controlRotation(n.rotateSpeed,n.rotateOnly);this.setFixedRotation(n.fixedRotation);this.isBullet_=!!n.bullet}this.b2dBody.qyobj=this;this.joints_={};this.jointCount_=0;return this.b2dBody};y.prototype.genShape=function(t,e,i,n,r,o){var s;if(t instanceof Array){for(var a=[],h=0;h<t.length;h++){s=this.genShape(t[h],e,i,n,r,o);s&&array_extend(a,s)}return a}if(t)switch(t.type){case"polygon":s=this.genPolygonShape(t,e,r,o);break;case"circle":s=this.genCircleShape(t,e,i,n,r,o)}s||(s=b2PolygonShape.AsOrientedBox(i*r,n*o,e));var u=t&&t.name;if(s instanceof Array)for(var h=0;h<s.length;h++)s[h].fixName=u;else s.fixName=u;return s};y.prototype.genPolygonShape=function(t,e,i,n){var r,o,s,a,h;if(t.points&&(a=t.points.length)>2){for(var u=new Array(a),d=0;a>d;d++){o=t.points[d].x*i;s=t.points[d].y*n;h=d;if(-1==this.mirror.horizontal&&-1==this.mirror.vertical){o=-o;s=-s}else if(-1==this.mirror.horizontal){h=a-d-1;o=-o}else if(-1==this.mirror.vertical){h=a-d-1;s=-s}u[h]={x:o+e.x,y:s+e.y}}try{r=qyengine.separateShape(u)}catch(c){console.log(c);r=b2PolygonShape.AsArray(u)}}return r};y.prototype.genCircleShape=function(t,e,i,n,r,o){var s=new b2CircleShape,a=t.center&&t.center.x&&t.center.x*r||0,h=t.center&&t.center.y&&t.center.y*o||0,u=-1==this.mirror.horizontal?-a:a,d=-1==this.mirror.vertical?-h:h,c=new b2Vec2(u+e.x,d+e.y),p=t.radius&&t.radius*Math.min(r,o)||Math.min(i*r,n*o);s.SetLocalPosition(c);s.SetRadius(p);return s};y.prototype.controlRotation=function(t,e){if(null==t&&null==e)return this;this.b2dBody||this.setupBody();var i=this.b2dBody;if(!i)return this;t||(t=0);i.m_angularVelocity=-t*qyengine.A2R;e?this.setRotateOnly():this.removeRotateOnly();this.setAwake(!0);return this};y.prototype.setFixedRotation=function(t){this.b2dBody||this.setupBody();var e=this.b2dBody;if(!e)return this;if(null==t||t===!1)e.SetFixedRotation(!1);else{t!==!0&&this.setRotation(t);e.m_angularVelocity=0;e.SetFixedRotation(!0)}e.SetAwake(!0);return this};y.prototype.isFixedRotation=function(){return this.b2dBody&&this.b2dBody.IsFixedRotation()};y.prototype.setRotateOnly=function(){if(this.pinJoint)return this;this.b2dBody||this.setupBody();var t=this.b2dBody;if(!t)return this;var e=current_game.world.GetGroundBody(),i=new b2RevoluteJointDef;i.Initialize(t,e,t.GetWorldCenter());this.pinJoint=current_game.world.CreateJoint(i);return this};y.prototype.removeRotateOnly=function(){if(!this.pinJoint)return this;current_game.world.DestroyJoint(this.pinJoint);this.pinJoint=null;return this};y.prototype.setAwake=function(t){this.b2dBody&&!this.b2dBody.IsAwake()&&this.b2dBody.SetAwake(t)};y.prototype.isAwake=function(){return this.b2dBody&&this.b2dBody.IsAwake()};y.prototype.destroyFixtures=function(){var t=this.b2dBody;if(t)for(var e=t.GetFixtureList();e;){t.DestroyFixture(e);e=t.GetFixtureList()}};y.prototype.destroyBody=function(){this.releaseJoints();this.releaseMouseJoint();if(this.b2dBody){current_game.world.DestroyBody(this.b2dBody);array_remove(this.scene.instancesWithBody,this);delete this.b2dBody}};y.prototype.releaseBody=function(){var t=this.b2dBody;if(t){t.qyobj=null;current_game.world.DestroyBody(t);this.b2dBody=null}};y.prototype.setActive=function(t){this.b2dBody&&this.b2dBody.SetActive(t)};y.prototype.makeDraggable=function(t){function e(){o.initMouseJoint(t);qyengine.gStage.addEventListener(["mouseup","touchend"],i);qyengine.gStage.addEventListener(["mousemove","touchmove"],n)}function i(){o.releaseMouseJoint();qyengine.gStage.removeEventListener("mousemove",n);qyengine.gStage.removeEventListener("touchmove",n);qyengine.gStage.removeEventListener("mouseup",i);qyengine.gStage.removeEventListener("touchend",i)}function n(t){var e=t.global;o.dragToPos(e.x,e.y)}var r=this.currentSprite;if(!r||this.dragListeners&&this.dragListeners.length>0)return this;var o=this;this.dragListeners||(this.dragListeners=[]);this.spriteListen("mousedown",e);this.spriteListen("touchstart",e);this.dragListeners.push({target:r,type:"mousedown",handler:e});this.dragListeners.push({target:r,type:"touchstart",handler:e});return this};y.prototype.releaseDraggable=function(){this.releaseMouseJoint();if(this.dragListeners){array_foreach(this.dragListeners,function(t){t.target&&t.target.removeEventListener&&t.target.removeEventListener(t.type,t.handler)});this.dragListeners.length=0}};y.prototype.dragToObj=function(t,e){var i=n(t);if(i&&i.getPosition){var r=i.getPosition();this.dragToPos(r.x,r.y,e)}};y.prototype.dragToPos=function(t,e,i){var n=this.initMouseJoint(i);qyengine.g_b2Vec2.x=t*gScale;qyengine.g_b2Vec2.y=e*gScale;n&&n.SetTarget(qyengine.g_b2Vec2)};y.prototype.faceToward=function(t){if(this.currentSprite){var e;switch(t.toward){case"object":var i=n(t.objId);i&&(e=i.getPosition());break;case"coordinate":var r=t.relative_x,o=t.relative_y,s=t.x+(r?this.x:0),a=t.y+(o?this.y:0);e={x:s,y:a};break;case"mouse":e={x:window.mouseX,y:window.mouseY}}if(e){var h,u=this.getPosition(),d=t.delta||0,c=t.min_rotation||0,p=t.max_rotation?t.max_rotation:360,y=(qyengine.calAngle(e.x-u.x,e.y-u.y)+d)%360;h=0>c&&0>p?y>=c+360&&p+360>=y:0>c?y>=c+360||p>=y:y>=c&&p>=y;h&&this.setRotation(y)}}if(t.always){this.faceTowardAlways=t;if(current_game.mvListened)current_game.mvListenedCount++;else{current_game.mvListened=function(){};current_scene.listen("mousemove",current_game.mvListened);current_game.mvListenedCount=1}}else{this.faceTowardAlways=null;current_game.mvListenedCount--;if(0==current_game.mvListenedCount){current_scene.unlisten(current_game.mvListened);current_game.mvListened=null}}};y.prototype.faceForward=function(t,e){var i=this.animSpeed||this.getSpeed();if(i){t||(t=0);var n=qyengine.calAngle(i.x,i.y);this.setRotation(n+t)}if(e){this.faceForwardAlways||(this.faceForwardAlways={});this.faceForwardAlways.delta=t}else this.faceForwardAlways=null;return this};y.prototype.getGravityScale=function(){return this.b2dBody&&this.b2dBody.GetGravityScale()||0};y.prototype.setGravityScale=function(t){this.b2dBody||this.setupBody();var e=this.b2dBody;if(!e)return this;e.SetGravityScale(t);e.SetAwake(!0);return this};y.prototype.getRestitution=function(){return this.b2dBody&&this.b2dBody.GetFixtureList().GetRestitution()||0};y.prototype.setRestitution=function(t){this.b2dBody&&this.b2dBody.GetFixtureList().SetRestitution(t)};y.prototype.getFriction=function(){return this.b2dBody&&this.b2dBody.GetFixtureList().GetFriction()||0};y.prototype.setFriction=function(t){this.b2dBody&&this.b2dBody.GetFixtureList().SetFriction(t)};y.prototype.setRotationSpeed=function(t){this.b2dBody||this.setupBody();var e=this.b2dBody;if(!e)return this;e.m_angularVelocity=-t*qyengine.A2R;return this};y.prototype.getRotationSpeed=function(){this.b2dBody||this.setupBody();var t=this.b2dBody;return t?-t.m_angularVelocity*qyengine.R2A:0};y.prototype.getIsSensor=function(){return this.isSensor_};y.prototype.setIsSensor=function(t){if(this.b2dBody){for(var e=this.b2dBody.GetFixtureList();e;){e.SetSensor(t);e=e.m_next}this.isSensor_=t;this.fixtureDef&&(this.fixtureDef.isSensor=t)}};y.prototype.setType=function(t){var e=b2Body.b2_dynamicBody;if(this.b2dBody){switch(t){case"solid":e=b2Body.b2_staticBody;break;case"kinematic":e=b2Body.b2_kinematicBody}this.b2dBody.GetType()!=e&&this.b2dBody.SetType(e)}return this};y.prototype.getType=function(){var t;if(this.b2dBody)switch(this.b2dBody.GetType()){case b2Body.b2_staticBody:t="solid";break;case b2Body.b2_kinematicBody:t="kinematic";break;default:t="dynamic"}return t};y.prototype.initMouseJoint=function(t){if(this.mouseJoint_){t&&this.mouseJoint_.SetMaxForce(t);return this.mouseJoint_}this.b2dBody||this.setupBody();var e=this.b2dBody;if(!e)return null;var i=new b2MouseJointDef;i.bodyA=current_game.world.GetGroundBody();i.bodyB=e;var n=this.getPosition();i.target.Set(n.x*gScale,n.y*gScale);i.maxForce=(t||500)*e.m_mass;this.mouseJoint_=current_game.world.CreateJoint(i);
return this.mouseJoint_};y.prototype.releaseMouseJoint=function(){if(this.mouseJoint_){current_game.world.DestroyJoint(this.mouseJoint_);this.mouseJoint_=null}};y.prototype.releaseJointById=function(t){var e=this.joints_[t];if(!e)return this;var i=e.m_bodyA.qyobj,n=e.m_bodyB.qyobj;delete i.joints_[t];delete n.joints_[t];current_game.world.DestroyJoint(e);return this};y.prototype.releaseJoints=function(t){if(t)return this.releaseJointById(t);for(t in this.joints_)this.releaseJointById(t);return this};y.prototype.beforeCreateJoint=function(t){if(!t)return!1;this.b2dBody||this.setupBody();var e=[];if(!this.b2dBody)return e;var i;i="string"==typeof t?qyengine.getInstancesByType(t):[t];for(var n=0;n<i.length;n++){t=i[n];t.b2dBody||t.setupBody();t.b2dBody&&e.push(t.b2dBody)}return e};y.prototype.addJoint=function(t,e){var i=t.m_bodyA.qyobj,n=t.m_bodyB.qyobj;e||(e=i.jointCount_++ +":"+n.jointCount_++);i.releaseJointById(e);n.releaseJointById(e);i.joints_[e]=t;n.joints_[e]=t;return t};y.prototype.createDistanceJoint=function(t,e){var i=this.beforeCreateJoint(t),n=i.length;if(0>=n)return null;for(var r=this.b2dBody,o=0;n>o;o++){var s=i[o],a=new b2DistanceJointDef;a.Initialize(r,s,r.GetWorldCenter(),s.GetWorldCenter());this.addJoint(current_game.world.CreateJoint(a),e)}};y.prototype.createRopeJoint=function(t,e){var i=this.beforeCreateJoint(t),n=i.length;if(0>=n)return null;for(var r=this.b2dBody,o=0;n>o;o++){var s=i[o],a=new b2RopeJointDef;a.Initialize(r,s,r.GetWorldCenter(),s.GetWorldCenter());this.addJoint(current_game.world.CreateJoint(a),e)}};y.prototype.createRevoluteJoint=function(t,e){var i=this.beforeCreateJoint(t),n=i.length;if(0>=n)return null;for(var r=this.b2dBody,o=0;n>o;o++){var s=i[o],a=new b2RevoluteJointDef;a.Initialize(r,s,r.GetWorldCenter());this.addJoint(current_game.world.CreateJoint(a),e)}};y.prototype.createWeldJoint=function(t,e){var i=this.beforeCreateJoint(t),n=i.length;if(0>=n)return null;for(var r=this.b2dBody,o=0;n>o;o++){var s=i[o],a=new b2WeldJointDef;a.Initialize(r,s,s.GetWorldCenter());this.addJoint(current_game.world.CreateJoint(a),e)}};y.prototype.createPrismaticJoint=function(t,e){var i=this.beforeCreateJoint(t),n=i.length;if(0>=n)return null;for(var r=this.b2dBody,o=new b2Vec2(0,1),s=0;n>s;s++){var a=i[s],h=new b2PrismaticJointDef;h.Initialize(r,a,a.GetWorldCenter(),o);h.lowerTranslation=-5;h.upperTranslation=2.5;h.enableLimit=!0;this.addJoint(current_game.world.CreateJoint(h),e)}};y.prototype.applyForce=function(t,e,i){if(!t&&!e)return this;this.b2dBody||this.setupBody();var n=this.b2dBody,r=n.GetMass(),o=n.GetWorldCenter();qyengine.g_b2Vec2.x=r*t/gScale;qyengine.g_b2Vec2.y=r*e/gScale;n.SetBullet(!0);i?this.b2dBody.ApplyImpulse(qyengine.g_b2Vec2,o):this.b2dBody.ApplyForce(qyengine.g_b2Vec2,o);return this};y.prototype.applyForceWithAngle=function(t,e,i,n){var r=(n?e+180:e)*qyengine.A2R;return this.applyForce(t*Math.cos(r),-t*Math.sin(r),i)};y.prototype.applyForceTowardPos=function(t,e,i,n,r){if(null==t||null==e)return this;null!=i||(i=200);var o=this.getPosition(),s=t-o.x,a=e-o.y,h=qyengine.calAngle(s,a);return this.applyForceWithAngle(i,h,n,r)};y.prototype.applyForceTowardTap=function(t,e,i){return this.applyForceTowardPos(window.mouseX,window.mouseY,t,e,i)};y.prototype.applyForceTowardObject=function(t,e,i,r){var o=n(t),s=o&&o.getPosition();return s?this.applyForceTowardPos(s.x,s.y,e,i,r):void 0};y.prototype.applyTorque=function(t){if(!t)return this;t/=gScale;this.b2dBody||this.setupBody();var e=this.b2dBody,i=e.GetMass();this.b2dBody.ApplyTorque(i*t);return this}}();y.prototype.toObj=function(){var t={type:this.classId,position:{x:this.x,y:this.y},scale:{x:this.scaleX,y:this.scaleY},id:this.id};this.currentSprite&&(t.sprite=this.currentSprite.classId);return t};y.prototype.changeInstance=function(t,e){return instance_change(this,t,e)};y.prototype.shieldEvent=function(t,e){var i=this;t=r(t);t&&t.forEach&&t.forEach(function(t){var e="string"==typeof t?t:t.type;"mouseleave"===e&&(e="mouseout");if(qyengine.EventsOnQyObj.indexOf(e)>-1||["keydown","keyup"].indexOf(e)>-1){i.shieldedEvent||(i.shieldedEvent={});"string"==typeof t?i.shieldedEvent[t]=[]:i.shieldedEvent[e]?i.shieldedEvent[e].indexOf(t.data)<0&&i.shieldedEvent[e].push(t.data):i.shieldedEvent[e]=[t.data]}else i.currentSprite&&i.currentSprite.shieldEvent(e)});e>0&&qyengine.callAfter(function(){i.cancelShieldEvent(t)},this,e)};y.prototype.cancelShieldEvent=function(t){var e=this;t=r(t);t&&t.forEach&&t.forEach(function(t){var i=t.type||t;if(qyengine.EventsOnQyObj.indexOf(i)>-1||["keydown","keyup"].indexOf(i)>-1){e.shieldedEvent||(e.shieldedEvent={});if("string"==typeof t)delete e.shieldedEvent[t];else if(e.shieldedEvent[i]){var n=e.shieldedEvent[i].indexOf(t.data);n>-1&&e.shieldedEvent[i].splice(n,1)}}else e.currentSprite&&e.currentSprite.cancelShieldEvent(t)})};y.prototype.isShieldEvent=function(t){t=o(t);return this.shieldedEvent?"string"==typeof t?!!this.shieldedEvent[t]:this.shieldedEvent[t.type]&&this.shieldedEvent[t.type].indexOf(t.data)>-1:!1}}();
!function(){function e(e,t,i){if(e.getPosition){var s=e.getPosition();s.x+=t;s.y+=i;e.setPosition(s)}return e}function t(){return"qyNoNameScn_"+h++}function i(e,t){var i=0!=(e.maskBits&t.categoryBits)&&0!=(e.categoryBits&t.maskBits);return i}function s(e,t,i,s,r){return e.x>=t&&e.x<=t+s&&e.y>=i&&e.y<=i+r?!0:!1}function r(){var e=qyengine.guardType(current_game.pause_scene),t=window.pauseScene=new e({isPauseScene:!0,physics:{gravity:{x:0,y:0}}});t.hitArea=new PIXI.Rectangle(0,0,game.director.size.width,game.director.size.height);t.spriteListen(["mousedown","touchstart","mouseup","touchend","mousemove","touchmove"],function(e){(e.event||e.originalEvent||e).stopPropagation&&(e.event||e.originalEvent||e).stopPropagation()});current_game.director.pushScene(t)}function n(){var e=current_game.director.getCurrentScene();e.destroy();delete window.pauseScene;current_game.director.popScene();var t=current_scene.gravity;qyengine.setGravity(t.x,t.y)}function o(){a.call(this);var e=qyengine.getTextureFromFill("#ffffff",game.director.size.width,game.director.size.height,0),t=new PIXI.Sprite(e);t.setOpacity(.5);t.setSize(game.director.size.width,game.director.size.height);this.appendChild(t);var i=this.continueLabel=new PIXI.Text("Click To Continue");i.setSize(300,100);i.setPosition(100,100);i.setStyle({dropShadow:!1,fill:"yellow",font:"bold 32px Arial",fontSize:32});i.interactive=!0;this.appendChild(i);if(window.current_scene){var s=current_scene.getSize();i.setPosition(s.width/2-150,s.height/2-50);i.addEventListener(["mousedown","touchstart"],function(e){e.originalEvent.stopPropagation();current_scene.resume()})}}qyengine.getGravityWithAngle=function(){var e=qyengine.getGravity();return{gravity:magnitude(e),angle:azimuth(e)}};qyengine.getGravity=function(){return current_game.world.GetGravity()};qyengine.setGravity=function(e,t){var i=qyengine.getGravity();i.x=e;i.y=t};qyengine.setGravityWithAngle=function(e,t,i,s){var r=qyengine.getGravityWithAngle();i&&(e+=r.gravity);s&&(t+=r.angle);var n=t*qyengine.A2R;qyengine.setGravity(e*Math.cos(n),e*Math.sin(n))};Object.defineProperties(current_game,{rankTotal:{configurable:!0,get:function(){var e=qyengine.getRankList();if(e){var t=e.remoteData||e.getDataFromRemote();return t.length}}},rankSelf:{configurable:!0,get:function(){var e=qyengine.getRankList();if(e){var t=e.remoteData||e.getDataFromRemote(),i=current_scene.user&&current_scene.user.userid;if(t&&i)for(var s=0;s<t.length;s++)if(t[s].userid==i)return s+1;return 1}}},gravityX:{configurable:!0,get:function(){return qyengine.getGravity().x},set:function(e){qyengine.setGravity(e,current_game.gravityY)}},gravityY:{configurable:!0,get:function(){return qyengine.getGravity().y},set:function(e){qyengine.setGravity(current_game.gravityX,e)}}});var a=window.QyScene=function(e){PIXI.DisplayObjectContainer.call(this);this.scene_pos={x:0,y:0};this.viewOffset={x:0,y:0};this.isPaused_=!1;this.instances=[];this.instancesWithBody=[];this.objects_=[];e||(e={});this.setId(e.id);this.full_size=e.size;e.prev_scene&&(this.prev_scene=e.prev_scene);e.next_scene&&(this.next_scene=e.next_scene);this.persistent=!!e.persistent;this.is25D=!!e.is25D;e.isPauseScene||this.isPauseScene?this.isPauseScene=!0:window.scene=window.current_scene=this;this.initVars(e);this.setBackground(e);this.physics=e.physics;this.setupWorld(e.size,e.physics&&e.physics.gravity);e.speed&&this.setSpeed(e.speed);e.collisionShape&&this.setupBlockArea(e.collisionShape);this.setLayers(e);this.stickyLayer=new QyStickyLayer;this.appendChild(this.stickyLayer);e.isPauseScene||e.view&&this.setView(e.view);e.gesture&&this.setupHammer();this.hitArea=new PIXI.Rectangle(0,0,this.width,this.height);game.no_watermark||this.addWatermark()};inherits(a,PIXI.DisplayObjectContainer);addGenericProperties(a);addTimelineSupport(a);Object.defineProperties(a.prototype,{paused:{configurable:!0,get:function(){return current_scene.isPaused_},set:function(e){current_scene.setPaused(e)}},mute:{configurable:!0,get:function(){return qyengine.isMuted()},set:function(e){e?qyengine.mute():qyengine.unmute()}},volume:{configurable:!0,get:function(){return qyengine.getVolume()},set:function(e){qyengine.setVolume(e)}},speed:{configurable:!0,get:function(){return this.speed_||{x:0,y:0}},set:function(e){this.setSpeed&&this.setSpeed(e);return this}}});a.prototype.mirror={horizontal:1,vertical:1};a.prototype.setOpacity=function(e){this.background&&this.background.setOpacity&&this.background.setOpacity(e)};a.prototype.show=function(){this.background&&this.background.show&&this.background.show()};a.prototype.hide=function(){this.background&&this.background.hide&&this.background.hide()};var h=0;a.prototype.setId=function(e){e||(e=t());this.id=e;window[e]=this};a.prototype.initVars=QyObject.prototype.initVars;current_game.setVar=qyengine.setVar;a.prototype.setBackground=function(e){this.currentSprite=this;var t=e.background;if(!t||"no-background"==t)return this;var i=qyengine.guardType(t);if(i){e.repeat=!1;e.repeat_x=!1;e.repeat_y=!1;switch(e.background_repeat){case"repeat":case!0:e.repeat=!0;e.repeat_x=!0;e.repeat_y=!0;break;case"repeat-x":e.repeat_x=!0;break;case"repeat-y":e.repeat_y=!0}e.qyobj=this;var s=new i(e);e.qyobj=null;this.background=s.currentSprite||s;this.background.isBG=!0;this.appendChild(this.background)}return this};a.prototype.setLayers=function(e){var t=e.layers;if(!t||0==t.length)return this;var i=t.length;this.layers=new Array(i);for(var s=0;i>s;s++){this.layers[s]=new QyLayer(t[s]);this.appendChild(this.layers[s])}e.defaultLayer&&(this.defaultLayer=window[e.defaultLayer]);this.defaultLayer||(this.defaultLayer=this);for(s=0;i>s;s++)this.setOneLayer(this.layers[s],t[s]);return this};a.prototype.setOneLayer=function(e,t){if(t&&t.objects)for(var i=0;i<t.objects.length;i++){var s=t.objects[i];s.id||(s.id=s.type);s.sceneId=this.id;this.objects_.push(qyengine.createInstance(s,e,!0))}e.getHidden()&&e.hide();return this};a.prototype.setSpeed=QySprite.prototype.setSpeed;a.prototype.moveTo=function(e,t,i){i||(i=300);var s=pointAt(this.scene_pos,e,t);if(0==s.xRatio&&0==s.yRatio){this.dispatchEvent("moveend");return this}this.moveTarget_=s;this.setSpeed({x:s.xRatio*i,y:s.yRatio*i});this.dispatchEvent("movestart")};a.prototype.setView=function(t){this.view=t;t.x||(t.x=0);t.y||(t.y=0);for(var i=0;i<this.layers.length;i++){var s=this.layers[i];s.sticky&&e(s,-t.x,-t.y)}t.width||(t.width=this.full_size.width);t.height||(t.height=this.full_size.height);this.setSize(t.width,t.height);this.maxViewOffSet={x:t.width-this.full_size.width,y:t.height-this.full_size.height};t.follows&&this.setFollowView(t.follows);(0!=t.x||0!=t.y)&&this.viewAt(t.x,t.y)};a.prototype.setFollowView=function(e){this.view?this.followObj=e&&e.id||e:console.log("setting following obj but no view is set")};a.prototype.releaseFollowView=function(){this.followObj=null};a.prototype.viewAt=function(e,t){this.moveViewBy(-(e+this.viewOffset.x),-(t+this.viewOffset.y))};a.prototype.moveBySpeed=function(e){this.background&&this.background.moveBySpeed(e);this.speed_&&this.moveViewBy(-this.speed_.x*e,-this.speed_.y*e)};a.prototype.moveViewBy=function(t,i){if(0==t&&0==i||!this.maxViewOffSet)return this;if(0==t&&0==i){if(this.moveTarget_){this.setSpeed(0);delete this.moveTarget_;this.dispatchEvent("moveend")}return this}var s=this.viewOffset,r=s.x+t,n=s.y+i;r>0&&(r=0);n>0&&(n=0);r<this.maxViewOffSet.x&&(r=this.maxViewOffSet.x);n<this.maxViewOffSet.y&&(n=this.maxViewOffSet.y);t=r-s.x;i=n-s.y;if(0==t&&0==i){if(this.moveTarget_){this.setSpeed(0);delete this.moveTarget_;this.dispatchEvent("moveend")}return this}if(this.shouldMoveBgWithScene()){var o=this.background.texture.frame.x,a=this.background.texture.frame.y;this.background.moveBy(t,i);t=(o-this.background.texture.frame.x)*this.background.scale.x;i=(a-this.background.texture.frame.y)*this.background.scale.y}for(var h=0;h<this.layers.length;h++){var c=this.layers[h];c.sticky||e(c,t,i)}s.x=r;s.y=n;this.scene_pos.x=-r;this.scene_pos.y=-n;return this};a.prototype.shouldMoveBgWithScene=function(){return this.background&&this.view?this.background.speed&&this.background.speed.x&&this.background.speed.y?!1:!0:!1};a.prototype.resetView=function(){this.moveViewBy(-this.viewOffset.x,-this.viewOffset.y)};a.prototype.setupWorld=function(e,t){var i=this.background;this.full_size=e?e:i?i.getSize():current_game.director&&current_game.director.getSize();this.setSize(this.full_size.width,this.full_size.height);this.createWorld(t);return this};a.prototype.createWorld=function(e){var t=e&&e.x||0,i=e&&null!=e.y?e.y:e||0;this.gravity={x:t,y:i};if(current_game.world)qyengine.setGravity(t,i);else{var s=new b2Vec2(t,i);current_game.world=new b2World(s,!0);current_game.contactListener=new gmContactListener;current_game.world.SetContactListener(current_game.contactListener)}return current_game.world};a.prototype.setupBlockArea=function(e){this.physics={solid:!0,restitution:0,linearDamping:1,friction:1,collisionData:e,categoryBits:1,maskBits:4294967295};this.scene=this;this.setupBody()};a.prototype.setupBody=QyObject.prototype.setupBody;a.prototype.calShape=QyObject.prototype.calShape;a.prototype.calFixtureDef=QyObject.prototype.calFixtureDef;a.prototype.calBody=QyObject.prototype.calBody;a.prototype.genShape=QyObject.prototype.genShape;a.prototype.genPolygonShape=QyObject.prototype.genPolygonShape;a.prototype.genCircleShape=QyObject.prototype.genCircleShape;a.prototype.controlRotation=QyObject.prototype.controlRotation;a.prototype.setFixedRotation=QyObject.prototype.setFixedRotation;a.prototype.destroyBody=QyObject.prototype.destroyBody;a.prototype.releaseJoints=QyObject.prototype.releaseJoints;a.prototype.releaseMouseJoint=QyObject.prototype.releaseMouseJoint;a.prototype.setupHammer=function(){if(this.hammer||!this.background)return this;this.background.interactive=!0;this.hammer=Hammer(this.background);return this};a.prototype.spriteListen=QyObject.prototype.spriteListen;a.prototype.spriteUnlisten=QyObject.prototype.spriteUnlisten;a.prototype.selfListen=QyObject.prototype.selfListen;a.prototype.selfUnlisten=QyObject.prototype.selfUnlisten;a.prototype.objListen=QyObject.prototype.objListen;a.prototype.dispatchCreateEvent=function(){this.dispatchEvent("create");if(this.objects_){for(var e=0;e<this.objects_.length;e++)this.objects_[e].dispatchEvent("create");this.objects_=null}};var c=[];a.prototype.checkCollision=function(){for(var e=this.instances.length,t=0;e>t;t++)c.push(this.instances[t].getBoundingBox());for(var t=0;e-1>t;t++){var s=this.instances[t],r=s.physics;if(r)for(var n=t+1;e>n;n++){var o=this.instances[n],a=o.physics;if(a&&i(r,a)&&boxOverlap(c[t],c[n])){var h=r.isSensor||a.isSensor?"enterobject":"collision";dispatchCollision(s,o,h,"allFixs","allFixs")}}}c.length=0};a.prototype.setAlarm=QyObject.prototype.setAlarm;a.prototype.cancelAlarm=QyObject.prototype.cancelAlarm;a.prototype.cancelAllAlarms=QyObject.prototype.cancelAllAlarms;a.prototype.dispatchMessage=QyObject.prototype.dispatchMessage;a.prototype.checkTypeAt=QyObject.prototype.checkTypeAt;a.prototype.checkIfEmpty=QyObject.prototype.checkIfEmpty;a.prototype.destroy=function(){this.setPaused(!1);if(qyengine.insideGStep){for(var e=0;e<this.instances.length;e++)this.instances[e].destroy();this.instances.length=0}else for(;this.instances.length>0;)this.instances[0].destroy();this.dispatchEvent("destroy");this.destroyIsolate();this.destroyBody()};a.prototype.destroyIsolate=QyObject.prototype.destroyIsolate;var p={};a.prototype.viewFollowObj=function(e,t,i){if(!this.view)return this;var r=e.getPosition(),n=this.view.follows||p;if(!t){var o=n.hbor>=0?n.hbor:this.view.width/2,a=n.vbor>=0?n.vbor:this.view.height/2;if(s(r,this.scene_pos.x+o,this.scene_pos.y+a,this.view.width-2*o,this.view.height-2*a))return this}var h={x:Math.round(r.x-this.view.width/2),y:Math.round(r.y-this.view.height/2)};h.x<0&&(h.x=0);h.y<0&&(h.y=0);h.x+this.view.width>this.full_size.width&&(h.x=this.full_size.width-this.view.width);h.y+this.view.height>this.full_size.height&&(h.y=this.full_size.height-this.view.height);if(h.x==this.scene_pos.x&&h.y==this.scene_pos.y)return this;null==i?i=n.speed&&n.speed>0?n.speed:n.hsp&&n.hsp>0?n.hsp:n.vsp&&n.vsp>0?n.vsp:null:0>=i&&(i=null);i?this.moveTo(h.x,h.y,i):this.viewAt(h.x,h.y);return this};a.prototype.stepFollow=function(){if(this.followObj&&window[this.followObj]){var e=window[this.followObj];e.getPosition?this.viewFollowObj(e):this.followObj=null}};a.prototype.checkMoveTarget=function(){var e=this.moveTarget_;if(e&&isPassed(e.xRatio,e.x,this.scene_pos.x)&&isPassed(e.yRatio,e.y,this.scene_pos.y)){delete this.moveTarget_;this.viewAt(e.x,e.y);this.setSpeed(0);this.dispatchEvent("moveend")}};a.prototype.step_=function(e){for(var t=0;t<this.instances.length;t++){var i=this.instances[t];i.step_(e)}this.stepFollow();this.moveBySpeed(e);this.checkMoveTarget()};a.prototype.setPaused=function(e,t){e=!!e;if(this.isPaused_!=e)if(qyengine.insideGStep&&e){qyengine.scenePausedChange=e;keyframesContinue=t}else if(this.isPaused_!=e){this.isPaused_=e;keyframeShouldCont=t;qyengine.changeDirectorActivity&&qyengine.changeDirectorActivity(current_game.director,e);e?r():n()}};a.prototype.pause=function(e){this.setPaused(!0,e)};a.prototype.resume=function(){this.setPaused(!1)};a.prototype.restart=function(){qyengine.switchScene(this.classId)};a.prototype.endGame=function(){var e=current_game.end_scene&&"no-scene"!=current_game.end_scene?current_game.end_scene:current_game.start_scene;qyengine.switchScene(e)};a.prototype.restartGame=function(){qyengine.switchScene(current_game.start_scene)};a.prototype.drawLifeImage=function(e,t,i,s,r,n){this.stickyLayer.drawLifeImage(e,t,i,s,r,n)};a.prototype.addWatermark=function(){var e="/public/qiyun/preload/images/watermark.png";qyengine.isFileProtocol&&(e="assets/"+e);var t=this.watermark=PIXI.Sprite.fromImage(e);t.width=228;t.height=21;t.setAnchorPoint(1,1);var i=this.full_size||{};t.x=(i.width||1024)-21;t.y=(i.height||768)-15;this.addChild(t)};inherits(o,a);window.QyPauseScene=o;gmx_[qyengine.pause_scene]=o;o.prototype.isPauseScene=!0}();
!function(){function e(){if(!c){c=!0;requestAnimFrame(n)}}function n(e){var t=e-d;d=e;for(var s=0;s<l.length;s++){var r=l[s],i=r.paused,c=r.loop,o=r.fun,f=r.delay,g=r.context;if(!i&&!a(g))if(f&&f>=t)r.delay-=t;else{o&&o(t);c>0&&0==--c&&u(s)}}requestAnimFrame(n)}function t(e,n,t,s){var u=o.pop();if(u){l[u].fun=e;l[u].context=n;l[u].loop=t;l[u].paused=!1;l[u].delay=s}else{u=l.length;l.push({fun:e,loop:t,paused:!1,delay:s,context:n})}return u}function s(e,n,s){return t(e,n,1,s)}function u(e){l[e].paused=!0;l[e].fun=null;o.push(e)}function r(){l.length=0;o.length=0}function i(e,n){return}function a(e){return e?e.isPaused_?!0:e.scene&&e.scene.isPaused_?!0:e.target&&(e.target.isPaused_||e.target.scene&&e.target.scene.isPaused_||e.target.sprite&&e.target.sprite.qyobj&&e.target.sprite.qyobj.scene&&e.target.sprite.qyobj.scene.isPaused_)?!0:!1:!0}var c,l=[],o=[],d=0;window.startScheduler=qyengine.startScheduler=e;qyengine.stepScheduler=n;window.scheduleTask=qyengine.scheduleTask=t;window.callAfter=qyengine.callAfter=s;window.unscheduleTask=qyengine.unscheduleTask=u;qyengine.unscheduleAll=r;qyengine.changeDirectorActivity=i}();
!function(){window.QyAnimation=function(t){QyEventTarget.call(this);this.arg=t;this.target=null;this.duration=1;this.elapse=0};inherits(QyAnimation,QyEventTarget);QyAnimation.prototype.setTarget=function(t){this.target=t;return this};QyAnimation.prototype.setDuration=function(t){this.duration=t;return this};QyAnimation.prototype.getDuration=function(){return this.duration};QyAnimation.prototype.start=function(){if(null==this.scheduledIdx){this.scheduledIdx=scheduleTask(this.step_.bind(this),this);this.dispatchEvent("animationstart")}};QyAnimation.prototype.stop=function(){if(null!=this.scheduledIdx){this.scheduledIdx=unscheduleTask(this.scheduledIdx);this.scheduledIdx=null;this.elapse=0;this.dispatchEvent("animationend")}};QyAnimation.prototype.step_=function(t){t/=1e3;this.elapse+=t;this.elapse>this.duration&&(this.elapse=this.duration);this.update&&this.update(this.elapse);this.elapse>=this.duration&&this.stop()};var t=QyAnimation.MoveTo=function(t){QyAnimation.call(this,t)};inherits(t,QyAnimation);t.prototype.start=function(){if(this.target){this.duration||this.setSpeed(this.speed);var t=this.target.getPosition();this.startPos={x:t.x,y:t.y};this.deltaX=(this.arg.x-t.x)/this.duration;this.deltaY=(this.arg.y-t.y)/this.duration;QyAnimation.prototype.start.call(this)}};t.prototype.update=function(t){if(this.target){var i=this.startPos,n=this.deltaX*t,a=this.deltaY*t,o=this.target&&this.target.qyobj||this.target;o&&o.setPosition(i.x+n,i.y+a,!0)}};t.prototype.setSpeed=function(t){if(this.target){var i=this.target.getPosition();this.duration=Math.max(Math.abs(this.arg.x-i.x),Math.abs(this.arg.y-i.y))/t}else{this.speed=t;delete this.duration}};QyAnimation.moveTo=function(i){return new t(i)};var i=QyAnimation.MoveBy=function(i){t.call(this,i)};inherits(i,t);i.prototype.start=function(){var t=this.target.getPosition();this.startPos={x:t.x,y:t.y};this.deltaX=this.arg.x/this.duration;this.deltaY=this.arg.y/this.duration;QyAnimation.prototype.start.call(this)};QyAnimation.moveBy=function(t){return new i(t)};var n=QyAnimation.ScaleTo=function(t){QyAnimation.call(this,t)};inherits(n,QyAnimation);n.prototype.start=function(){if(this.target){var t=this.target.getScale();this.startScale={x:t.x,y:t.y};this.deltaX=(this.arg.x-t.x)/this.duration;this.deltaY=(this.arg.y-t.y)/this.duration;QyAnimation.prototype.start.call(this)}};n.prototype.update=function(t){if(this.target){var i=this.startScale,n=this.deltaX*t,a=this.deltaY*t;this.target.setScale(i.x+n,i.y+a)}};QyAnimation.scaleTo=function(t){return new n(t)};var a=QyAnimation.ScaleBy=function(t){n.call(this,t)};inherits(a,n);a.prototype.start=function(){var t=this.target.getScale();this.startScale={x:t.x,y:t.y};this.deltaX=this.arg.x/this.duration;this.deltaY=this.arg.y/this.duration;QyAnimation.prototype.start.call(this)};QyAnimation.scaleBy=function(t){return new a(t)};var o=QyAnimation.RotateTo=function(t){QyAnimation.call(this,t)};inherits(o,QyAnimation);o.prototype.start=function(){if(this.target){this.startRotation=this.target.getRotation();this.deltaRot=(this.arg-this.startRotation)/this.duration;QyAnimation.prototype.start.call(this)}};o.prototype.update=function(t){if(this.target){var i=this.startRotation,n=t*this.deltaRot,a=this.target&&this.target.qyobj||this.target;a.setRotation(i+n)}};QyAnimation.rotateTo=function(t){return new o(t)};var s=QyAnimation.RotateBy=function(t){o.call(this,t)};inherits(s,o);s.prototype.start=function(){this.startRotation=this.target.getRotation();this.deltaRot=this.arg/this.duration;QyAnimation.prototype.start.call(this)};QyAnimation.rotateBy=function(t){return new QyAnimation.RotateBy(t)};var e=QyAnimation.FadeTo=function(t){QyAnimation.call(this,t)};inherits(e,QyAnimation);e.prototype.start=function(){if(this.target){this.startOpacity=this.target.getOpacity();this.fade=(this.arg-this.startOpacity)/this.duration;QyAnimation.prototype.start.call(this)}};e.prototype.update=function(t){if(this.target){var i=this.startOpacity,n=t*this.fade,a=i+n;0>a&&(a=0);a>1&&(a=1);this.target.setOpacity(a)}};QyAnimation.fadeTo=function(t){return new e(t)};var r=QyAnimation.FadeBy=function(t){e.call(this,t)};inherits(r,e);r.prototype.start=function(){this.startOpacity=this.target.getOpacity();this.fade=this.arg/this.duration;QyAnimation.prototype.start.call(this)};QyAnimation.fadeBy=function(t){return new r(t)};var h=QyAnimation.Delay=function(t){QyAnimation.call(this,t);this.duration=t};inherits(h,QyAnimation);QyAnimation.delay=function(t){return new h(t)};var c=QyAnimation.Sequence=function(t){QyAnimation.call(this);this.actions=t;for(var i=0;i<this.actions.length;i++)this.duration+=this.actions[i].duration};inherits(c,QyAnimation);c.prototype.start=function(){var t=this;this.curActionIdx=0;this.stopped=!1;var i=function(){t.actions[t.curActionIdx].removeAllEventListeners("animationend");if(!t.stopped){var n=++t.curActionIdx;if(n<t.actions.length){t.actions[n].setTarget(t.target);t.actions[n].start();t.actions[n].addEventListener("animationend",i)}else t.stop()}};this.actions[0].setTarget(this.target);this.actions[0].addEventListener("animationend",i);this.actions[0].addEventListener("animationstart",function(){if(!t.startted){t.startted=!0;t.dispatchEvent("animationstart")}});this.actions[0].start()};c.prototype.stop=function(){if(!this.stopped){this.startted=!1;this.stopped=!0;this.curActionIdx<this.actions.length&&this.actions[this.curActionIdx].stop();this.curActionIdx=0;this.dispatchEvent("animationend")}};QyAnimation.sequence=function(t){return new c(t)};var p=QyAnimation.Loop=function(t,i){QyAnimation.call(this);this.action=t;this.loopTime=i;this.duration=this.loopTime*this.action.duration};inherits(p,QyAnimation);p.prototype.start=function(){var t=this,i=0;this.stopped=!1;var n=function(){if(!t.stopped&&(t.loopTime<=0||++i<t.loopTime))t.action.start();else{t.action.removeAllEventListeners("animationend");t.stop()}};t.action.setTarget(this.target);t.action.addEventListener("animationend",n);t.action.addEventListener("animationstart",function(){if(!t.startted){t.startted=!0;t.dispatchEvent("animationstart")}});t.action.start()};p.prototype.stop=function(){if(!this.stopped){this.startted=!1;this.stopped=!0;this.action.stop();this.dispatchEvent("animationend")}};QyAnimation.loop=function(t,i){return new p(t,i)};var l=QyAnimation.Spawn=function(t){QyAnimation.call(this);this.actions=t};inherits(l,QyAnimation);l.prototype.start=function(){for(var t=this,i=this.actions.length,n=function(){if(!t.startted){t.startted=!0;t.dispatchEvent("animationstart")}},a=function(){0==--i&&t.stop()},o=0;o<this.actions.length;o++){this.actions[o].setTarget(this.target);this.actions[o].addEventListener("animationend",a);this.actions[o].addEventListener("animationstart",n);this.actions[o].start()}};l.prototype.stop=function(){for(var t=0;t<this.actions.length;t++)this.actions[t].removeAllEventListeners("animationend");this.dispatchEvent("animationend");this.startted=!1};QyAnimation.spawn=function(t){return new l(t)};var d=QyAnimation.ColorTo=function(t){QyAnimation.call(this,t)};inherits(d,QyAnimation);d.prototype.start=function(){if(this.target){var t=this.parseColorToInt(this.target.fill_),i=this.parseColorToInt(this.arg);if(!t){t=i;this.target.fill_=this.arg}this.startColor=t;this.colorDelta={r:(i.r-t.r)/this.duration,g:(i.g-t.g)/this.duration,b:(i.b-t.b)/this.duration};QyAnimation.prototype.start.call(this)}};d.prototype.update=function(t){if(this.target){var i=this.startColor,n={r:t*this.colorDelta.r,g:t*this.colorDelta.g,b:t*this.colorDelta.b},a=this.parseIntToColor({r:Math.round(i.r+n.r),g:Math.round(i.g+n.g),b:Math.round(i.b+n.b)});this.target.setTexture(qyengine.getTextureFromFill(a,this.target.width,this.target.height));this.target.fill_=a}};d.prototype.parseColorToInt=function(t){if("string"==typeof t&&/^#/.test(t)){var i=t.slice(1);return{r:parseInt(i.slice(0,2),16),g:parseInt(i.slice(2,4),16),b:parseInt(i.slice(4,6),16)}}console.log(t+" is not supported in webgl mode at present")};d.prototype.parseIntToColor=function(t){var i=t.r.toString(16),n=t.g.toString(16),a=t.b.toString(16);return"#"+(t.r<16?"0"+i:i)+(t.g<16?"0"+n:n)+(t.b<16?"0"+a:a)};QyAnimation.colorTo=function(t){return new d(t)}}();
!function(){function t(t){QySprite.call(this);if("object"==typeof t){void 0!==t.radius&&this.setRadius(t.radius);void 0!==t.opacity&&this.setOpacity(t.opacity);void 0!==t.size&&this.setSize(t.size.width,t.size.height);void 0!==t.fill&&this.setFill(t.fill);void 0!==t.border&&this.setStroke(t.border.width,t.border.color);void 0!==t.scale&&this.setScale(t.scale.x,t.scale.y);void 0!==t.position&&this.setPosition(t.position.x,t.position.y)}}function e(t){var e={type:"",fill:""};switch(t.type){case"font":e.type="TEXT";break;case"picture":e.type="FILL";e.fill=""!==t["background-image"]?t["background-image"]:"transparent"!==t["background-color"]&&""!==t["background-color"]?t["background-color"]:"#";break;default:console.log("function getSpriteInfor arguments type invalid ")}return e}function i(t,i,o){function r(t,e){var i=new QyText;void 0!==e&&i.setText(e);void 0!==t.color&&i.setFontColor(t.color);void 0!==t["font-size"]&&i.setFontSize(t["font-size"]);void 0!==t.position&&i.setPosition(t.position.x,t.position.y,!0);void 0!==t.size&&i.setSize(t.size.width,t.size.height);return i.currentSprite}function n(t,e){var i=t.size?cloneObject(t.size):{width:0,height:0},o={width:t["border-width"]||0,color:t["border-color"]||"#ffffff"},r=new QySprite({fill:e,size:i,radius:t["border-radius"]||0,stroke:o});r.setAnchorPoint(0,0);void 0!==t.position&&r.setPosition(t.position.x,t.position.y);void 0!==t.opacity&&r.setOpacity(t.opacity);void 0!==t.scale&&r.setScale(t.scale.x,t.scale.y);return r}if("object"!=typeof i)return null;var s=e(i),a=null;switch(t){case"TEXT":o=void 0===o?i.content:o;a=r(i,o);break;case"FILL":a=n(i,o||s.fill);break;default:console.log("function spriteFactory_RL argument type invaild")}return a}function o(t){QyLayer.call(this,t);current_scene.ranklist=this;this.scene=current_scene;current_scene.user=null;this.initRanklistConfigInfor(t||(t={}));this.ranklist_dialog=null;this.nickname_dialog=null;this.login_dialog=null;current_scene.addChild(this)}t.prototype=new QySprite;inherits(o,QyLayer);o.prototype.IMAGES={LOGIN_BG:{path:"/public/qiyun/ranklist/loginBg.png",size:{width:515,height:456}},LOGIN:{path:"/public/qiyun/ranklist/login.png",size:{width:183,height:62}},CLOSE:{path:"/public/qiyun/ranklist/close.png",size:{width:31,height:31}},PK:{path:"/public/qiyun/ranklist/PK.png",size:{width:514,height:316}},GO:{path:"/public/qiyun/ranklist/GO.png",size:{width:144,height:61}}};if(qyengine.isFileProtocol)for(var r in o.prototype.IMAGES)o.prototype.IMAGES[r].path="assets"+o.prototype.IMAGES[r].path;o.prototype.preloadImages=function(){for(var t in this.IMAGES)new PIXI.ImageLoader(this.IMAGES[t])};o.prototype.destroy=function(){};o.prototype.displayRanklist=function(){var t=this;t.initRanklistZoom();t.ranklist_dialog&&t.removeChild(t.ranklist_dialog);t.ranklist_dialog=new QyLayer;t.addChild(t.ranklist_dialog);t.initCover(t.ranklist_dialog,function(){t.ranklist_dialog.setHidden(!0)});t.initWindow(t.window(),t.ranklist_dialog)};o.prototype.ranklistZoom=function(t){if(void 0===t)return cloneObject(this._ranklistZoom)||{x:1,y:1};this._ranklistZoom=t;return void 0};o.prototype.displayLoginDialog=function(t,e){this.login_dialog&&this.removeChild(this.login_dialog);this.login_dialog=new QyLayer;this.addChild(this.login_dialog);this.initCover(this.login_dialog);this.initLoginDialog(t,this.login_dialog,e)};o.prototype.displayNicknameDialog=function(t,e){this.nickname_dialog&&this.removeChild(this.nickname_dialog);this.nickname_dialog=new QyLayer;this.addChild(this.nickname_dialog);this.initCover(this.nickname_dialog);this.initNicknameDialog(t,this.nickname_dialog,e)};o.prototype.initCover=function(e,i){var o={fill:"#000000",opacity:.8,size:{width:current_scene.width,height:current_scene.height}},r=new t(o);r.interactive=!0;gmx_listen(r,["mousedown","touchstart"],function(t){i&&i();t.originalEvent.stopPropagation()});e.addChild(r);return r};o.prototype.initLoginDialog=function(t,e,i){var o=this,r=1;if(current_scene.width<=this.IMAGES.LOGIN_BG.size.width||current_scene.height<=this.IMAGES.LOGIN_BG.size.height){var n=this.IMAGES.LOGIN_BG.size.width/current_scene.width,s=this.IMAGES.LOGIN_BG.size.height/current_scene.height;r=.9/(n>s?n:s)}var a=PIXI.Texture.fromImage(this.IMAGES.LOGIN_BG.path),c=new PIXI.Sprite(a);c.width=this.IMAGES.LOGIN_BG.size.width;c.height=this.IMAGES.LOGIN_BG.size.height;c.position.x=parseInt(current_scene.width-c.width*r)/2;c.position.y=parseInt(current_scene.height-c.height*r)/2;c.scale.x=r;c.scale.y=r;c.interactive=!0;gmx_listen(c,["mousedown","touchstart"],function(t){t.originalEvent.stopPropagation()});e.addChild(c);var d=PIXI.Texture.fromImage(this.IMAGES.CLOSE.path),h=new PIXI.Sprite(d);h.width=this.IMAGES.CLOSE.size.width;h.height=this.IMAGES.CLOSE.size.height;h.scale.x=1.5*r;h.scale.y=1.5*r;h.position.x=c.position.x+(c.width-60)*r;h.position.y=c.position.y+60*r;h.interactive=!0;gmx_listen(h,["mousedown","touchstart"],function(t){o.login_dialog.hide();t.originalEvent.stopPropagation()});e.addChild(h);var l={defaultText:t,isPassword:!1,inputStyle:{backgroundColor:"#E06858",borderRadius:6*r},size:{width:280*r,height:35*r}},u=new QyInput(l);u.setFontColor("#ffffff");u.setFontSize(20);var p=c.position.x+186*r,g=c.position.y+175*r;u.setPosition(p,g);e.addChild(u.currentSprite);var m={isPassword:!0,inputStyle:{backgroundColor:"#E06858",borderRadius:6*r},size:{width:280*r,height:35*r}},f=new QyInput(m);f.setFontColor("#ffffff");f.setFontSize(20);var y=c.position.x+186*r,v=c.position.y+240*r;f.setPosition(y,v);f.setScale(r,r);e.addChild(f.currentSprite);var k=PIXI.Texture.fromImage(this.IMAGES.LOGIN.path),b=new PIXI.Sprite(k);b.width=this.IMAGES.LOGIN.size.width;b.height=this.IMAGES.LOGIN.size.height;b.position.x=c.position.x+(c.width-b.width)/2*r;b.position.y=c.position.y+(c.height-b.height/2)*r;b.scale.x=r;b.scale.y=r;b.interactive=!0;gmx_listen(b,["mousedown","touchstart"],function(t){function e(t){if(!/^([a-zA-Z_0-9\u4E00-\u9FA5]+)$/.test(t)){u.currentSprite.setBackgroundColor("#ff0000");return!1}return!0}function r(t){if(/^$/.test(t)){f.currentSprite.setBackgroundColor("#ff0000");return!1}return!0}var n=u.getValue().trim(),s=f.getValue();e(n)&&r(s)&&o.tryToLogin(n,s,function(t){if(t){i&&i();o.login_dialog.hide()}else{u.currentSprite.setBackgroundColor("#ff0000");f.currentSprite.setBackgroundColor("#ff0000")}});t.originalEvent.stopPropagation()});e.addChild(b)};o.prototype.initNicknameDialog=function(t,e,i){var o=this,r=1;if(current_scene.width<=this.IMAGES.PK.size.width||current_scene.height<=this.IMAGES.PK.size.height){var n=this.IMAGES.PK.size.width/current_scene.width,s=this.IMAGES.PK.size.height/current_scene.height;r=.9/(n>s?n:s)}var a=PIXI.Texture.fromImage(this.IMAGES.PK.path),c=new PIXI.Sprite(a);c.width=this.IMAGES.PK.size.width;c.height=this.IMAGES.PK.size.height;c.position.x=parseInt(current_scene.width-c.width*r)/2;c.position.y=parseInt(current_scene.height-c.height*r)/2;c.scale.x=r;c.scale.y=r;gmx_listen(c,["mousedown","touchstart"],function(t){t.originalEvent.stopPropagation()});e.addChild(c);var d=PIXI.Texture.fromImage(this.IMAGES.CLOSE.path),h=new PIXI.Sprite(d);h.width=this.IMAGES.CLOSE.size.width;h.height=this.IMAGES.CLOSE.size.height;h.scale.x=1.5*r;h.scale.y=1.5*r;h.position.x=c.position.x+(c.width-40)*r;h.position.y=c.position.y+50*r;h.scale.x=r;h.scale.y=r;h.interactive=!0;gmx_listen(h,["mousedown","touchstart"],function(t){o.nickname_dialog.hide();t.originalEvent.stopPropagation()});e.addChild(h);var l={defaultText:t,isPassword:!1,inputStyle:{backgroundColor:"#E06858",borderRadius:6*r},size:{width:200*r,height:34*r}},u=new QyInput(l);u.setFontColor("#ffffff");u.setFontSize(20);var p=c.position.x+186*r,g=c.position.y+170*r;u.setPosition(p,g);u.setScale(r,r);e.addChild(u.currentSprite);var m=PIXI.Texture.fromImage(this.IMAGES.GO.path),f=new PIXI.Sprite(m);f.width=this.IMAGES.GO.size.width;f.height=this.IMAGES.GO.size.height;f.position.x=c.position.x+(c.width-f.width)/2*r;f.position.y=c.position.y+(c.height-f.height/2)*r;f.scale.x=r;f.scale.y=r;f.interactive=!0;gmx_listen(f,["mousedown","touchstart"],function(e){function r(t){if(!/^([a-zA-Z_0-9\u4E00-\u9FA5]+)$/.test(t)){u.currentSprite.setBackgroundColor("#ff0000");return!1}return!0}var n=u.getValue().trim();if(r(n)){var s=localStorage.getItem("nickname")||"";s&&(s=JSON.parse(s));s||(s={});s[t]=n;localStorage.setItem("nickname",JSON.stringify(s));i&&i();o.nickname_dialog.hide()}e.originalEvent.stopPropagation()});e.addChild(f)};o.prototype.initRanklistZoom=function(){var t={x:1,y:1},e=this.window();if(e.size.width>current_scene.width||e.size.height>current_scene.height){var i=e.size.width/current_scene.width,o=e.size.height/current_scene.height;t.x=t.y=.9/(i>o?i:o)}this.ranklistZoom(t)};o.prototype.initWindow=function(t,e){var o=i("FILL",t);o.interactive=!0;gmx_listen(o,["mousedown","touchstart"],function(t){t.originalEvent.stopPropagation()});gmx_listen(o,["mousedown","touchstart"],function(t){t.originalEvent.stopPropagation()});o.setScale(this.ranklistZoom().x,this.ranklistZoom().y);o.setSize(t.size.width,t.size.height);var r=parseInt((current_scene.width-o.getSize().width*o.getScale().x)/2),n=parseInt((current_scene.height-o.getSize().height*o.getScale().y)/2);o.setPosition(r,n);e.addChild(o);this.initButton(this.button(),this.ranklist_dialog,o.getPosition());this.initContentArea(this.contentArea(),this.ranklist_dialog,o.getPosition());this.initScroller(this.contentArea(),this.ranklist_dialog,o.getPosition());return o};o.prototype.initButton=function(t,e,o){var r=this;t.position.x=o.x+t.position.x*this.ranklistZoom().x;t.position.y=o.y+t.position.y*this.ranklistZoom().y;t.size.width*=this.ranklistZoom().x;t.size.height*=this.ranklistZoom().y;var n=i("FILL",t);n.interactive=!0;gmx_listen(n,["mousedown","touchstart"],function(t){r.ranklist_dialog.setHidden(!0);t.originalEvent.stopPropagation()});e.addChild(n);return n};o.prototype.initContentArea=function(t,e,o){t.position.x=o.x+t.position.x*this.ranklistZoom().x;t.position.y=o.y+t.position.y*this.ranklistZoom().y;t.size.width*=this.ranklistZoom().x;t.size.height*=this.ranklistZoom().y;var r=i("FILL",t);""!=t["background-image"]||"transparent"!=t["background-color"]&&""!=t["background-color"]||r.setOpacity(0);e.addChild(r);return r};o.prototype.initScroller=function(t,e,i){var o=this;t.position.x=i.x+t.position.x*this.ranklistZoom().x;t.position.y=i.y+t.position.y*this.ranklistZoom().y;t.size.width*=this.ranklistZoom().x;t.size.height*=this.ranklistZoom().y;var r=new QyScroller;o.scroller_ranklist=r.currentSprite;e.addChild(r.currentSprite);r.checkZAxis=function(){};r.setPosition(t.position.x,t.position.y);r.setSize(t.size.width,t.size.height);r.setDirection(t.direction||"vertical");var n=20;"horizontal"===o.getRecordsDisplayDirection()&&(n=5*o.getRowsOfRecord_horizontal());var s=0;o.initRecordContainers(o.recordContainer(),r.currentSprite,{x:0,y:0},s,n);s+=n;var a="reachBottom";"vertical"!==o.getRecordsDisplayDirection()&&(a="reachRight");r.currentSprite.listen([a],function(){o.initRecordContainers(o.recordContainer(),r.currentSprite,{x:0,y:0},s,n);s+=n});return r};o.prototype.initRecordContainers=function(t,e,i,o,r){var n=this,s=n.getLengthOfRecords(),a=n.getRecordsDisplayDirection();t.position.x=i.x+t.position.x*this.ranklistZoom().x;t.position.y=i.y+t.position.y*this.ranklistZoom().y;t.size.width*=this.ranklistZoom().x;t.size.height*=this.ranklistZoom().y;t["margin-left"]*=this.ranklistZoom().x;t["margin-top"]*=this.ranklistZoom().x;for(var c=this.getRowsOfRecord_horizontal(),d=o;s>d&&r>d-o;++d){var h=0,l=0;if("vertical"===a){h=d;l=0}else{h=d%c;l=Math.floor(d/c)}n.initRecord(h,l,t,e)}};o.prototype.initRecord=function(t,e,o,r){var n=i("FILL",o);r.addChild(n);var s=o.position.x+(n.getSize().width+o["margin-left"])*e,a=o.position.y+(n.getSize().height+o["margin-top"])*t;n.setPosition(s,a);r.addChild(n);this.initFields(this.scroller_ranklist,this.getRowsOfRecord_horizontal()*e+t,n.getPosition())};o.prototype.initFields=function(t,o,r){for(var n=this,s=this.fields(),a=0;a<s.length;++a){{var c=s[a],d=!1;["rank","medal","photo","userName","score","time"].forEach(function(t){var e=new RegExp("^"+t+"$");e.test(c.name)&&!n["use"+c.name[0].toUpperCase()+c.name.substr(1)]()&&(d=!0)})}if(!d)if("medal"===c.name){var h=["gold","silver","bronze"];if(void 0!==h[o]){var l=this.getMedal(h[o]);l.position.x=r.x+l.position.x*this.ranklistZoom().x;l.position.y=r.y+l.position.y*this.ranklistZoom().y;l.size.width*=this.ranklistZoom().x;l.size.height*=this.ranklistZoom().y;var u=i("FILL",l);t.addChild(u)}}else{var l=c.attr;l.position.x=r.x+l.position.x*this.ranklistZoom().x;l.position.y=r.y+l.position.y*this.ranklistZoom().y;l.size.width*=this.ranklistZoom().x;l.size.height*=this.ranklistZoom().y;l["font-size"]&&(l["font-size"]*=this.ranklistZoom().x);var p=this.getData(o,c.name),u=i(e(c.attr).type,l,p);t.addChild(u)}}};o.prototype.tryToLogin=function(t,e,i){try{qyremote_async.login(t,e,function(e){if(e&&e.success){var o=current_scene.user;if(o){o.userid=t;o.verified=!0}i&&i(!0)}else i&&i(!1)})}catch(o){console.log(o)}};o.prototype.initRanklistConfigInfor=function(t){t=this.formatRanklistConfigInfor(t);this.scoreSort(t.config.scoreSort||"desc");this.timeSort(t.config.timeSort||"desc");this.usePhoto("boolean"==typeof t.config.isUsePhoto?t.config.isUsePhoto:!0);this.useMedal("boolean"==typeof t.config.isUseMedal?t.config.isUseMedal:!0);this.useRank("boolean"==typeof t.config.isUseRank?t.config.isUseRank:!0);this.useTime("boolean"==typeof t.config.isUseTime?t.config.isUseTime:!0);this.useUserName("boolean"==typeof t.config.isUseUserName?t.config.isUseUserName:!0);this.useScore("boolean"==typeof t.config.isUseScore?t.config.isUseScore:!0);this.window(t.window||{});this.button(t.button||{});this.contentArea(t.contentArea||{});this.recordContainer(t.recordContainer||{});this.fields(t.fields||[])};o.prototype.isConfigInforOfOldVersion=function(t){return void 0!==t.scroller?!0:!1};o.prototype.formatRanklistConfigInfor=function(t){var e={};if(this.isConfigInforOfOldVersion(t)){e.config={scoreSort:t.scoreSort||"desc",timeSort:t.timeSort||"asc",isUsePhoto:!!t.photo,isUseMedal:!!t.medal,isUseRank:!0,isUseScore:!!t.score,isUseTime:!!t.time,isUseUserName:!!t.userid};e.window={type:"picture",opacity:1,"border-color":"transparent","border-width":0,"border-style":"solid","border-radius":0,"background-color":"transparent","background-image":cloneObject(t.background.path),size:cloneObject(t.background.size),"background-size":cloneObject(t.background.size),position:{x:0,y:40}};e.button={type:"picture",opacity:1,"border-color":"transparent","border-width":0,"border-style":"solid","border-radius":0,"background-color":"transparent","background-image":"",size:{width:0,height:0},position:{x:760,y:0},"background-size":{width:0,height:0}};e.contentArea={type:"picture",opacity:1,direction:"vertical","border-color":"transparent","border-width":0,"border-style":"solid","border-radius":0,"background-color":"transparent","background-image":"",size:cloneObject(t.scroller.size),position:cloneObject(t.scroller.position),"background-size":{width:0,height:0}};e.recordContainer={type:"picture",opacity:1,"margin-top":10,"margin-left":10,"border-color":"transparent","border-width":0,"border-style":"solid","border-radius":0,"background-color":"transparent","background-image":cloneObject(t.listBg.path),size:cloneObject(t.listBg.size),"background-size":cloneObject(t.listBg.size),position:{x:30,y:0}};e.fields=[{name:"medal",isCustomed:!1,dataType:"string",attr:{type:"medal",opacity:1,"border-color":"transparent","border-width":0,"border-style":"solid","border-radius":0,"background-color":"transparent",gold:{path:t.medal?cloneObject(t.medal[0].path):"","background-size":t.medal?cloneObject(t.medal[0].size):{width:0,height:0}},silver:{path:t.medal?cloneObject(t.medal[1].path):"","background-size":t.medal?cloneObject(t.medal[1].size):{width:0,height:0}},bronze:{path:t.medal?cloneObject(t.medal[2].path):"","background-size":t.medal?cloneObject(t.medal[2].size):{width:0,height:0}},size:t.medal?cloneObject(t.medal[2].size):{width:0,height:0},position:{x:10,y:12}}},{name:"rank",isCustomed:!1,dataType:"int",attr:{type:"font",color:"#000",content:"排名",border:"none","background-color":"transparent","font-size":30,size:{width:70,height:40},position:{x:120,y:30}}},{name:"photo",isCustomed:!1,dataType:"string",attr:{type:"picture",opacity:1,"border-color":"transparent","border-width":0,"border-style":"solid","border-radius":0,"background-color":"transparent","background-image":t.photo?cloneObject(t.photo.path):"",size:t.photo?cloneObject(t.photo.size):{width:0,height:0},position:{x:220,y:10},"background-size":t.photo?cloneObject(t.photo.size):{width:0,height:0}}},{name:"userName",isCustomed:!1,dataType:"string",attr:{type:"font",color:"#000",content:"用户名","background-color":"transparent","font-size":30,size:{width:100,height:40},position:{x:330,y:30}}},{name:"score",isCustomed:!1,dataType:"int",attr:{type:"font",color:"#000",content:"分数","background-color":"transparent","font-size":30,size:{width:70,height:40},position:{x:450,y:30}}},{name:"time",isCustomed:!1,dataType:"int",attr:{type:"font",color:"#000",content:"时间","background-color":"transparent","font-size":30,size:{width:70,height:40},position:{x:570,y:30}}}];for(var i=0,o=0;o<e.fields.length;++o){e.fields[o].attr.position.x=10+110*i;e.config["isUse"+e.fields[o].name[0].toUpperCase()+e.fields[o].name.substr(1)]&&i++}}else{e=t;e.config.isUseUserName=!0;e.config.isUseScore=!0}return e};o.prototype.scoreSort=function(t){if(void 0===t)return this.sort_score||"desc";this.sort_score=t;return void 0};o.prototype.timeSort=function(t){if(void 0===t)return this.sort_time||"desc";this.sort_time=t;return void 0};o.prototype.usePhoto=function(t){if(void 0===t)return this.isUsePhoto;this.isUsePhoto=t;return void 0};o.prototype.useMedal=function(t){if(void 0===t)return this.isUseMedal;this.isUseMedal=t;return void 0};o.prototype.useRank=function(t){if(void 0===t)return this.isUseRank;this.isUseRank=t;return void 0};o.prototype.useTime=function(t){if(void 0===t)return this.isUseTime;this.isUseTime=t;return void 0};o.prototype.useUserName=function(t){if(void 0===t)return this.isUseUserName;this.isUseUserName=t;return void 0};o.prototype.useScore=function(t){if(void 0===t)return this.isUseScore;this.isUseScore=t;return void 0};o.prototype.window=function(t){if(void 0===t)return cloneObject(this.window_attr);this.window_attr=t;return void 0};o.prototype.button=function(t){if(void 0===t)return cloneObject(this.button_attr);this.button_attr=t;return void 0};o.prototype.contentArea=function(t){if(void 0===t)return cloneObject(this.contentArea_attr);this.contentArea_attr=t;return void 0};o.prototype.recordContainer=function(t){if(void 0===t)return cloneObject(this.recordContainer_attr);this.recordContainer_attr=t;return void 0};o.prototype.fields=function(t){if(void 0===t)return cloneObject(this.fields_attr);this.fields_attr=t;return void 0};o.prototype.getMedal=function(t){for(var e={},i=0;i<this.fields().length;++i)if("medal"===this.fields()[i].name){var o=this.fields()[i];for(var r in o.attr)e[r]=o.attr[r];["gold","silver","bronze","size","position"].forEach(function(t){delete e[t]});e.size={width:o.attr.size.width,height:o.attr.size.height};e.position={x:o.attr.position.x,y:o.attr.position.y};e["background-image"]=o.attr[t].path;e["background-size"]={width:o.attr[t]["background-size"].width,height:o.attr[t]["background-size"].height};e.type="picture";break}return cloneObject(e)};o.prototype.getCustomedFields=function(){for(var t=[],e=this.fields(),i=0;i<e.length;++i)e[i].isCustomed&&t.push(e[i]);return cloneObject(t)};o.prototype.getRecordsDisplayDirection=function(){var t=this.contentArea();return t.direction||"vertical"};o.prototype.getDataFromRemote=function(){var t=SelfModName();/previewGame$/.test(qyboot.getDomainApp)&&!/^debug\//.test(t)&&(t="debug/"+t);game.mod||(game.mod=using_rpc(t));if(!game.mod||!game.mod.remote||!game.mod.remote.getRankListData&&!game.mod.remote.get)return[];var e=null;if(game.mod.remote.getRankListData){var i={score:this.scoreSort(),time:this.timeSort()};e=game.mod.remote.getRankListData(i)}else game.mod.remote.get&&(e=game.mod.remote.get());return e&&e.success?e.result:[]};o.prototype.updateDataToRemote=function(t){var e=SelfModName();/previewGame$/.test(qyboot.getDomainApp)&&!/^debug\//.test(e)&&(e="debug/"+e);game.mod||(game.mod=using_rpc(e));if(!game.mod||!game.mod.remote||!game.mod.remote.updateRanklistData&&!game.mod.remote.addRankListData&&!game.mod.remote.add)return this.getRecords();var i=null;game.mod.remote.updateRanklistData?i=game.mod.remote.updateRanklistData(t):game.mod.remote.addRankListData?i=game.mod.remote.addRankListData(t.userid,t.nickname,t.score||0,t.time||0):game.mod.remote.add&&(i=game.mod.remote.add(t.userid,t.nickname,t.score||0));return i&&i.success?this.getDataFromRemote():[]};o.prototype.getRecords=function(){this.records||(this.records=this.getDataFromRemote());return cloneObject(this.records)};o.prototype.setRecords=function(t){this.records=cloneObject(t)};o.prototype.insertRankListData=function(t,e){if("object"==typeof t){var i=this,o=this.formatRecord(cloneObject(t));current_scene.user=qyboot.getCurrentUser(!0);if(current_scene.user.verified){o.userid=current_scene.user.userid;var r=localStorage.getItem("nickname");r=r?JSON.parse(r):{};o.nickname=r[current_scene.user.userid]||current_scene.user.userid;this.updateRecords(o);e&&this.displayRanklist()}else if("string"==typeof current_scene.user.userid&&""!==current_scene.user.userid)this.tryToLogin(current_scene.user.userid,current_scene.user.userid,function(o){o?i.insertRankListData(t,e):i.displayLoginDialog(current_scene.user.userid,function(){i.insertRankListData(t,e)})});else{var n=qyremote.createGuest();console.assert(!(!n||!n.success),"create guest error");n&&n.success&&this.displayNicknameDialog(qyboot.getCurrentUser(!0).userid,function(){i.insertRankListData(t,e)})}}};o.prototype.updateRecords=function(t){var e=this.getRecords();"asc"===this.scoreSort()&&e.reverse();for(var i=!1,o=0;o<e.length;++o)if(e[o].userid===t.userid){i=e[o].score<t.score?!0:!1;break}i=i?!0:o===e.length?!0:!1;if(i){var r=this.updateDataToRemote(t);this.setRecords(r);return!0}return!1};o.prototype.getLengthOfRecords=function(){var t=this.getRecords();return t.length};o.prototype.getRowsOfRecord_horizontal=function(){var t=this.contentArea();if("vertical"===t.direction)return-1;var e=this.recordContainer();return Math.ceil(t.size.height/(e.size.height+e["margin-top"]))-1};o.prototype.getData=function(t,e){for(var i={score:"score",time:"time",userName:"nickname"},o=this.getCustomedFields(),r=0;r<o.length;++r)i[o[r].name]=o[r].name;var n=this.getRecords(),s="";switch(e){case"rank":s=t+1;break;case"medal":{[this.getMedal("gold")["background-image"],this.getMedal("silver")["background-image"],this.getMedal("bronze")["background-image"]]}s=medals[t]||void 0;break;case"photo":s=null;break;case"time":s=n[t][i[e]];s=s?s:0;break;default:s=n[t][i[e]]}return s};o.prototype.getRankingOfUser=function(t){var e=this.getRecords();e="desc"===this.scoreSort()?e:e.reverse();for(var i=-1,o=0;o<e.length;++o)if(t===e[o].userid){i=o+1;break}return i};o.prototype.formatRecord=function(t){for(var e=this.getCustomedFields(),i=0,o=0;o<e.length;++o)if(e[o].isCustomed){i++;var r=t[e[o].name];delete t[e[o].name];t["field"+i]=r}return t};window.QyRanklist=o}();
!function(){PIXI.Scroller=function(){PIXI.DisplayObjectContainer.call(this);this.clipper=(new PIXI.Graphics).setSize(100,100);this.addChild(this.clipper);this.mask=this.clipper;this.setSize(100,100);this.moving_=new PIXI.DisplayObjectContainer;PIXI.DisplayObjectContainer.prototype.addChild.call(this,this.moving_);this.addEventListener(["mousedown","touchstart"],this.downHandler_.bind(this));this.interactive=!0;this.setDirection(PIXI.Scroller.Direction.HORIZONTAL)};inherits(PIXI.Scroller,PIXI.DisplayObjectContainer);PIXI.Scroller.OFFSET=250;PIXI.Scroller.OFFSET_LAG=.4;PIXI.Scroller.FRICTION=.95;PIXI.Scroller.Direction={HORIZONTAL:0,VERTICAL:1};PIXI.Scroller.prototype.dispose=function(){};PIXI.Scroller.prototype.getDirection=function(){return this.direction_};PIXI.Scroller.prototype.setDirection=function(t){this.direction_=t;return this};PIXI.Scroller.prototype.setAnchorPoint=function(){this.clipper&&this.clipper.setAnchorPoint.apply(this.clipper,arguments);return PIXI.DisplayObject.prototype.setAnchorPoint.apply(this,arguments)};PIXI.Scroller.prototype.addChild=function(){return this.moving_?this.moving_.addChild.apply(this.moving_,arguments):PIXI.DisplayObjectContainer.prototype.addChild.apply(this,arguments)};PIXI.Scroller.prototype.removeChild=function(){return this.moving_?this.moving_.removeChild.apply(this.moving_,arguments):PIXI.DisplayObjectContainer.prototype.removeChild.apply(this,arguments)};PIXI.Scroller.prototype.measureLimits=function(){for(var t,i={},e=this.moving_.getBounds(),o=new PIXI.Point(e.x,e.y),n=new PIXI.Point(e.x+e.width,e.y+e.height),r=this,s=r.getPosition().clone();r.parent;){r=r.parent;t=r.getPosition().clone();s.x+=t.x;s.y+=t.y;if(!r.parent)break}var h=this.scale,l=this.getSize(),c=new PIXI.Point(s.x,s.y),a=new PIXI.Point(s.x+l.width*h.x,s.y+l.height*h.y);i.left=Math.min(o.x,c.x,n.x,a.x);i.right=Math.max(o.x,c.x,n.x,a.x);i.top=Math.min(o.y,c.y,n.y,a.y);i.bottom=Math.max(o.y,c.y,n.y,a.y);var p=this.moving_.getPosition().clone();if(this.getDirection()===PIXI.Scroller.Direction.HORIZONTAL){this.low=p.x-Math.max(0,i.right-a.x);this.high=p.x+Math.max(0,c.x-i.left)}else{this.low=p.y-Math.max(0,i.bottom-a.y);this.high=p.y+Math.max(0,c.y-i.top)}this.low/=h.x;this.high/=h.y};PIXI.Scroller.prototype.scrollTo=function(t,i){var e=this.moving_.getPosition().clone();this.measureLimits();0>t&&(t=0);if(this.getDirection()==PIXI.Scroller.Direction.HORIZONTAL){e.x=this.HIGH-t;e.x<this.LOW&&(e.x=this.LOW)}else{e.y=this.HIGH-t;e.y<this.LOW&&(e.y=this.LOW)}this.moving_.setPosition(e)};PIXI.Scroller.prototype.downHandler_=function(t){if(!this.ismove){this.ismove=1;this.originalMovingPos=this.moving_.getPosition().clone();this.originalPos=t.global.clone();this.limit=this.measureLimits();var i=qyengine.gStage;if(i){this.moveHandler=this.moveHandler_.bind(this);this.upHandler=this.upHandler_.bind(this);i.addEventListener(["touchmove","mousemove"],this.moveHandler);i.addEventListener(["touchend","mouseup","touchcancel"],this.upHandler)}}};PIXI.Scroller.prototype.captureVelocity_=function(){if(this.ismove){this.v=1.05*(this.posvalue-this.oldvalue);this.oldvalue=this.posvalue}this.v*=PIXI.Scroller.FRICTION};PIXI.Scroller.prototype.cancelEvents=function(){var t=qyengine.gStage;if(t){t.unlisten(["touchmove","mousemove"],this.moveHandler);t.unlisten(["touchend","mouseup","touchcancel"],this.upHandler)}this.ismove=0};PIXI.Scroller.prototype.moveHandler_=function(t){var i=t.global.clone(),e=this.getDirection();if(e==PIXI.Scroller.Direction.HORIZONTAL){i.x+=this.originalMovingPos.x-this.originalPos.x;i.x<this.low&&(i.x=this.low);i.x>this.high&&(i.x=this.high);i.y=this.originalMovingPos.y;if(i.x<=this.low){if(!this.reachedRight){this.dispatchEvent("reachRight");this.reachedRight=!0}}else if(i.x>=this.high){if(!this.reachedLeft){this.dispatchEvent("reachLeft");this.reachedLeft=!0}}else{this.reachedLeft=!1;this.reachedRight=!1}}else{i.x=this.originalMovingPos.x;i.y+=this.originalMovingPos.y-this.originalPos.y;i.y<this.low&&(i.y=this.low);i.y>this.high&&(i.y=this.high);if(i.y<=this.low){if(!this.reachedBottom){this.dispatchEvent("reachBottom");this.reachedBottom=!0}}else if(i.y>=this.high){if(!this.reachedTop){this.dispatchEvent("reachTop");this.reachedTop=!0}}else{this.reachedTop=!1;this.reachedBottom=!1}}this.moving_.setPosition(i)};PIXI.Scroller.prototype.upHandler_=function(t){return this.cancelEvents()};PIXI.Scroller.prototype.setSize=function(t,i){PIXI.DisplayObjectContainer.prototype.setSize.call(this,t,i);this.clipper.clear();this.clipper.beginFill(9160191,.4);this.clipper.moveTo(0,0);this.clipper.lineTo(t,0);this.clipper.lineTo(t,i);this.clipper.lineTo(0,i);this.clipper.lineTo(0,0)}}();!function(){function t(t){t||(t={});QyObject.call(this,t);this.currentSprite=new PIXI.Scroller;this.currentSprite.setAnchorPoint(0,0);this.currentSprite.qyobj=this;t.position&&this.currentSprite.setPosition(t.position.x,t.position.y);this.setupContent(t)}inherits(t,QyObject);window.QyScroller=t;t.prototype.setupContent=function(t){this.autoClassify=t.autoClassify;this.cellWidth=t.cellWidth||100;this.cellHeight=t.cellHeight||100;this.margin=t.margin||0;this.cellBoundWidth=this.cellWidth+2*this.margin;this.cellBoundHeight=this.cellHeight+2*this.margin;this.setDirection(t.direction);this.contentArray=[];this.contentMap={};var i,e;if("vertical"===this.direction){i=t.height||100;this.columns=t.columns||1;e=this.cellBoundWidth*this.columns}else{e=t.width||100;this.rows=t.rows||1;i=this.cellBoundHeight*this.rows}this.currentSprite.setSize(e,i);for(var o in t.content){var n=o.split(","),r=parseInt(n[0]),s=parseInt(n[1]),h=t.content[o];"string"==typeof h?this.addOneInstance(h,r,s):this.addOneInstance(h.type,r,s,{id:h.id})}};t.prototype.addToLast=function(t,i){var e=0,o=0;if("vertical"===this.direction)for(;;){for(var o=0;o<this.columns;o++)if(!this.contentArray[e]||!this.contentArray[e][o])return this.addAt(t,e,o,i);e++}else for(;;){for(var e=0;e<this.rows;e++)if(!this.contentArray[e]||!this.contentArray[e][o])return this.addAt(t,e,o,i);o++}};t.prototype.addAt=function(t,i,e,o){o||(o={});o.allowMultiple||this.removeAt(void 0,i,e);void 0===o.px&&(o.px=this.cellWidth/2);void 0===o.py&&(o.py=this.cellHeight/2);var n=e*this.cellBoundWidth+this.margin,r=i*this.cellBoundHeight+this.margin,s=qyengine.guardType(t);if(s){var h=new s,l=h.getSize(),c=Math.min(this.cellWidth/l.width,this.cellHeight/l.height,1);h.setPosition(n+o.px,r+o.py,!0);h.setScale(c,c);o&&o.id&&(window[o.id]=h,h.id=o.id);var a=h.currentSprite;if(a){this.currentSprite.addChild(a);h.scroller=this;h.scrollerX=e+1;h.scrollerY=i+1;a.keyframe&&!a.keyframe.started&&a.keyframe.start()}this.contentMap[t]||(this.contentMap[t]=[]);this.contentMap[t].push({object:h,number:1,position:[i,e]});this.contentArray[i]||(this.contentArray[i]=[]);this.contentArray[i][e]||(this.contentArray[i][e]={});this.contentArray[i][e][t]||(this.contentArray[i][e][t]=[]);this.contentArray[i][e][t].push(h);h.dispatchEvent("create");var p=this;h.listen("destroy",function(){p.onDestroyObject(h,t,i,e)})}};t.prototype.addOneInstance=function(t,i,e,o){if(this.autoClassify){var n=this.contentMap[t];if(n&&n.length){o&&o.id&&(window[o.id]=n[0].object,n[0].object.id=o.id);n[0].object.setText({text:++n[0].number+"",position:{x:0,y:-10}})}else this.addToLast(t,o)}else null==i||null==e?this.addToLast(t,o):this.addAt(t,i,e,o)};t.prototype.removeAt=function(){this.removeContentArrayAt.apply(this,arguments);this.removeContentMapAt.apply(this,arguments)};t.prototype.removeOneType=function(t){for(var i=this.contentArray,e=0,o=i.length;o>e;e++)for(var n=0,r=i[e].length;r>n;n++)this.removeContentArrayAt(t,e,n);this.removeContentMapAt(t)};t.prototype.removeOneInstance=function(t,i,e){if(this.autoClassify){var o=this.contentMap[t];if(o&&o.length&&o[0].object){o[0].object.setText({text:--o[0].number+"",position:{x:0,y:-10}});if(o[0].number<=0){o[0].object.destroy(!0);delete this.contentMap[t];this.removeContentArrayAt(o[0].position[0],o[0].position[e])}}}else null!=i&&null!=e?this.removeAt(t,i,e):this.removeOneType(t)};t.prototype.removeById=function(t){var i=window[t]&&window[t].classId;if(i){var e=window[t].scrollerY-1,o=window[t].scrollerX-1;null!=e&&null!=o&&this.removeOneInstance(i,e,o)}};t.prototype.removeContentArrayAt=function(t,i,e){var o,n=this.contentArray;if(n[i]&&n[i][e]){o=n[i][e][t]||[];o&&o.forEach(function(t){t.destroy(!0)});delete n[i][e][t];Object.keys(n[i][e]).length||(n[i][e]=void 0)}};t.prototype.removeContentMapAt=function(t,i,e){for(var o,n,r=this.contentMap,s=r[t]||[],h=0,l=s.length;l>h;h++){if(s[h]){n=s[h].object;o=s[h].position;if(!(void 0===i&&void 0===e||o[0]===i&&o[1]===e))continue;n&&n.destroy(!0)}s.splice(h,1);h--;l--}s.length||delete r[t]};t.prototype.setDirection=function(t){if("vertical"==t){this.direction="vertical";this.currentSprite.setDirection(PIXI.Scroller.Direction.VERTICAL)}else{this.direction="horizontal";this.currentSprite.setDirection(PIXI.Scroller.Direction.HORIZONTAL)}};t.prototype.getDirection=function(){return this.direction};t.prototype.checkZAxis=function(){};t.prototype.onDestroyObject=function(t,i,e,o){if(t.isDestroyed()){var n=this.contentArray&&this.contentArray[e]&&this.contentArray[e][o]||[];n=this.contentArray[e][o][i];var r=n.indexOf(t);r>-1&&n.splice(r,1);if(!n.length){delete this.contentArray[e][o][i];Object.keys(this.contentArray[e][o]).length||(this.contentArray[e][o]=void 0)}var s=this.contentMap;n=s&&s[i];for(var h=0,l=n.length;l>h;h++)if(n[h]&&n[h].object===t){n.splice(h,1);break}}}}();
!function(){window.QyText=function(t){t||(t={});t.font||(t.font={});t.text||(t.text={});t.anchorPoint={x:0,y:0};QyObject.call(this,t);this.currentSprite=new PIXI.Text("");this.currentSprite.setAnchorPoint(t.anchorPoint.x,t.anchorPoint.y);var e=t.font;this.currentSprite.setStyle(getStyleFromFont(e));this.setupHammer();this.currentSprite.qyobj=this;var i=qyboot.getDefaultLocaleName();this.currentSprite.setText(void 0===t.text[i]?"":t.text[i]);t.position&&this.currentSprite.setPosition(t.position.x,t.position.y);t.size&&this.currentSprite.setSize(t.size.width,t.size.height);var r=t.position;t.position=null;this.origSize=t.size;t.position=r;t.hiddenAtStart&&this.hide()};inherits(QyText,QyObject);QyText.prototype.getText=function(){return this.currentSprite&&this.currentSprite.text};QyText.prototype.addText=function(t){this.currentSprite.setText(this.currentSprite.getText()+t)};QyText.prototype.setFontColor=function(t){if(this.currentSprite){var e=this.currentSprite.style;e.fill=t;this.currentSprite.setStyle(e)}};QyText.prototype.setFontSize=function(t){if(this.currentSprite){for(var e=this.currentSprite.style,i=e.font,r=i.split(" "),n=0,o=r.length;o>n;n++)(r[n].indexOf("px")>-1||r[n].indexOf("pt")>-1)&&(r[n]=t+"px");e.font=r.join(" ");this.currentSprite.setStyle(e)}}}();
!function(){function t(t){t||(t={});QyObject.call(this);var e=this.currentSprite=(new PIXI.input).setValue(t.defaultText||"").setPlaceHolder(t.emptyText||"").setType(t.isPassword?"password":"text").setLengthLimit(void 0===t.lengthLimit?null:t.lengthLimit).setRotation(t.rotation||0);e.qyobj=this;var i=t.inputStyle||{};i.backgroundColor&&e.setBackgroundColor(i.backgroundColor);e.setStroke(i.borderWidth||0,i.borderColor||"#000");e.setRadius(i.borderRadius||0);var o=t.position;o&&e.setPosition(o.x,o.y);var n=t.size;n&&e.setSize(n.width,n.height);var r=t.textStyle;for(var s in r){var h="set"+qyengine.toUpperFirst(s);"function"==typeof e[h]?e[h](r[s]):"fontStyle"===s?e.setStyle(r[s]):console.log(s+" when setting label font is ignored")}t.hiddenAtStart&&this.hide()}PIXI.input=function(){PIXI.DisplayObjectContainer.call(this);this._width=100;this._height=24};PIXI.input.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.input.prototype.constructor=PIXI.input;PIXI.input.prototype.removeFromParent=function(){var t=this.domElement&&this.domElement.parentNode;t&&t.removeChild(this.domElement)};PIXI.input.prototype.createDomElement=function(){var t=this,e="input",i=function(){this.domElement=this.rootElement=this.containerElement=document.createElement(e);this.domElement.onkeyup=function(){t.value=this.value};this.dirty=!0};if(this.domElement){var o=this.domElement.tagName.toLowerCase();if(o!=e){var n=this.rootElement;i.call(this);n.parentNode&&n.parentNode.replaceChild(this.rootElement,n)}}else i.call(this)};PIXI.input.prototype.setBackgroundColor=function(t){this.bgColor=t;this.dirty=!0;return this};PIXI.input.prototype.getBackgroundColor=function(){return this.bgColor};PIXI.input.prototype.setValue=function(t){this.value=t;this.dirty=!0;return this};PIXI.input.prototype.getValue=function(){return this.domElement&&this.domElement.value};PIXI.input.prototype.setPlaceHolder=function(t){this.placeHolder=t;this.dirty=!0;return this};PIXI.input.prototype.getPlaceHolder=function(){return this.placeHolder};PIXI.input.prototype.setStroke=function(t,e){this.borderWidth=t||0;this.borderColor=e||"#000000"};PIXI.input.prototype.setRadius=function(t){this.radius=t};PIXI.input.prototype.setType=function(t){this.type=t;this.dirty=!0;return this};PIXI.input.prototype.getType=function(){return this.type};PIXI.input.prototype.setLengthLimit=function(t){this.lengthLimit=t;this.dirty=!0;return this};PIXI.input.prototype.validValue=function(){var t=null===this.lengthLimit?1/0:this.lengthLimit,e=this.getValue();return e.length<=t};PIXI.input.prototype.setHidden=function(t){this.domElement&&(this.domElement.style.display=t?"none":"block");this.hidden_=t;this.visible=!t;this.dirty=!0};["FontFamily","FontColor","FontWeight","FontSize","Padding","LineHeight","Align","Style"].forEach(function(t){PIXI.input.prototype["set"+t]=function(e){this[t.toLowerCase()+"_"]=e;this.dirty=!0};PIXI.input.prototype["get"+t]=function(){return this[t.toLowerCase()+"_"]}});PIXI.input.prototype._renderWebGL=function(){if(this.dirty){this.createDomElement();this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement);game.director&&game.director.domElement&&game.director.domElement.appendChild(this.domElement);var t=this.domElement;this.maskTarget_=!0;this.update();t.focus();t.value=void 0===this.value?"":this.value;t.type=this.type||"text";t.setAttribute("placeholder",this.getPlaceHolder()||"");t.style.display=this.hidden_?"none":"block";var e=t.style;e.position="absolute";e.background=this.getBackgroundColor()||"transparent";e.border=(this.borderWidth||0)+"px solid "+(this.borderColor||"#000000");var i=[this.radius,this.radius],o=i.join("px ")+"px/"+i.join("px ")+"px";t.style.borderRadius=o;e.lineHeight=this.lineheight_;e.color=this.getFontColor();e.fontFamily=this.getFontFamily();e.fontSize=this.getFontSize()+"px";e.fontWeight=this.getFontWeight();e.textAlign=this.getAlign();e["font-style"]=this.getStyle();e.padding=this.getPadding();this.dirty=!1}};PIXI.input.prototype._renderCanvas=PIXI.input.prototype._renderWebGL;PIXI.input.prototype.update=function(){if(this.domElement&&!this.isMask){this.drawSizePosition.call(this);var t=this.domElement.style;"opacity"in t?t.opacity=this.opacity_:"MozOpacity"in t?t.MozOpacity=this.opacity_:"filter"in t&&(t.filter=""===this.opacity_?"":"alpha(opacity="+100*this.opacity_+")")}};PIXI.input.prototype.drawSizePosition=function(){var t=current_scene.getScale(),e=this.getSize(),i=this.getPosition(),o=this.getScale(),n=!0,r=e.width,s=e.height;o.x=1;o.y=1;var h=o.clone();h={x:h.x*t.x,y:h.y*t.y};this.domElement.style.width=r+"px";this.domElement.style.height=s+"px";this.domElement.style["-ms-transform-origin"]="0 0";this.domElement.style["-webkit-transform-origin"]="0 0";this.domElement.style["-o-transform-origin"]="0 0";this.domElement.style["-moz-transform-origin"]="0 0";this.domElement.style["transform-origin"]="0 0";this.domElement.style.position="absolute";var l=0,p=0,a=this.parent&&this.parent.getPosition()||{x:0,y:0},u=i.x-l+a.x,d=i.y-p+a.y;this.domElement.style.left=u*h.x+"px";this.domElement.style.top=d*h.y+"px";var c=(this.stroke_?this.stroke_.width_:0,(new PIXI.Transform).setPrecision(.1).set3DAllowed(n)),y=-this.getRotation();c.rotate(y).scale(h.x,h.y);var m=c.toString();this.domElement.style.transform=m};PIXI.Transform=function(t){this.values=[];this.precision=1;this.enable3D_=!0;this.opt_precision&&this.setPrecision(t)};PIXI.Transform.prototype.set3DAllowed=function(t){this.enable3D_=t;return this};PIXI.Transform.prototype.scale=function(t,e){this.values.push("scale("+t+","+e+")");return this};PIXI.Transform.prototype.rotate=function(t,e){var i;i=this.enable3D_?"rotate3d(0, 0, 1, "+t+(e?e:"deg")+")":"rotate("+t+(e?e:"deg")+")";0!=t&&this.values.push(i);return this};PIXI.Transform.prototype.translate=function(t,e,i){var o=1/this.precision,n="translate";this.enable3D_&&(n+="3d");n+="("+t*o+"px,"+e*o+"px";this.enable3D_&&(n+=","+(i?i:0)*o+"px");this.values.push(n+")");return this};PIXI.Transform.prototype.setPrecision=function(t){if(1!=this.precision){var e=1/this.precision;this.scale(e,e);this.precision=1}if(1!=t){this.scale(t,t);this.precision=t}return this};PIXI.Transform.prototype.toString=function(){1!=this.precision&&this.setPrecision(1);return this.values.join(" ")};inherits(t,QyObject);t.prototype.setValue=function(t){return this.currentSprite&&this.currentSprite.setValue&&this.currentSprite.setValue(t)};t.prototype.getValue=function(){return this.currentSprite&&this.currentSprite.getValue&&this.currentSprite.getValue()};t.prototype.validValue=function(){return this.currentSprite&&this.currentSprite.validValue&&this.currentSprite.validValue()};window.QyInput=t;qyengine.toUpperFirst=function(t){return t&&t[0].toUpperCase()+t.substr(1)}}();
!function(){function e(e,t,r){t||(t=r&&r.layer?guardId(r.layer):e.layerName?guardId(e.layerName):current_scene.defaultLayer);e.layer=t;var a=e.currentSprite;if(a){var o;if(e.scene.is25D&&!t.ignore25d){var c=e.getBoundingBox();o=i(t,c.ry,0,t.getNumberOfChildren()-1)}else o=n(t,e.zIndex,0,t.getNumberOfChildren()-1);t.addChildAt(a,o);a.keyframe&&!a.keyframe.started&&a.keyframe.start()}}function n(e,i,t,r){if(0>r)return 0;var a=e.children_||e.children;if(t>=r)return!a[r].qyobj||a[r].qyobj.zIndex>i?r:r+1;var o=Math.floor((t+r)/2),c=a[o],s=c.qyobj;if(!s){e.setChildIndex(c,a.length);return n(e,i,t,r-1)}var g=s.zIndex;return g>i?n(e,i,t,o-1):n(e,i,o+1,r)}function i(e,n,t,r){if(t>=r)return t;var a=e.children_||e.children,o=Math.floor((t+r)/2),c=a[o],s=c.qyobj;if(!s){e.setChildIndex(c,a.length);return i(e,n,t,r-1)}var g=s.getBoundingBox().ry;return g==n?o:g>n?i(e,n,t,o-1):i(e,n,o+1,r)}function t(){b2ContactListener.call(this);this.beginContacts=[];this.endContacts=[]}function r(e){if(e){var n=e.GetBody();return n&&n.qyobj}return null}function a(e,n,i,t,r,o){t||(t="allFixs");r||(r="allFixs");for(var c=0;c<e.length;c++){var s=e[c];if(s.obj1==n&&s.obj2==i&&s.fixName1==t&&s.fixName2==r)return;if(s.obj2==n&&s.obj1==i&&s.fixName2==t&&s.fixName1==r)return}e.push({obj1:n,obj2:i,fixName1:t,fixName2:r,isSensor:o});("allFixs"!=t||"allFixs"!=r)&&a(e,n,i,"allFixs","allFixs",o)}function o(e){return e&&!e.destroyBuffered&&!e.rebuildBuffered&&!e.destroyed_}function c(e,n,i,t,r){e.other_=n;e.dispatchEvent({type:i,myName:t,withName:r});n.other_=e;n.dispatchEvent({type:i,myName:r,withName:t})}function s(e,n,i,t){for(var r=0;r<D.length;r++){var a=D[r];if(a.obj1==e&&a.obj2==n&&(a.myNames==i||array_equal(a.myNames,i))&&(a.withNames==t||array_equal(a.withNames,t)))return!0}return!1}function g(){return qyengine.gRenderer}function d(){var e=qyengine.insideGStep;qyengine.insideGStep=!1;var n,i;for(i=0;i<I.length;i++){n=I[i];n.destroyBuffered=!1;n.destroy(!0)}I.length=0;for(i=0;i<E.length;i++){n=E[i];n.rebuildBuffered=!1;n.setupBody(!0)}E.length=0;qyengine.insideGStep=e}function l(){var e=qyengine.insideGStep;qyengine.insideGStep=!1;if(C){qyengine.switchScene(C);C=null}if(null!=qyengine.scenePausedChange){current_scene.setPaused(qyengine.scenePausedChange,L);qyengine.scenePausedChange=null;L=null}qyengine.insideGStep=e}function u(e){var n=1;if(e.children)for(var i=0;i<e.children.length;i++)n+=u(e.children[i]);return n}function m(e){e/=1e3;e>3&&(e=3);z+=e;if(!(.03125>z)){z-=.03125;current_scene.isPaused_||current_game.world.Step(.03125,current_game.velocityIterations,current_game.positionIterations);current_scene.isPaused_||current_game.world.ClearForces();current_scene.isPaused_||current_scene.step_(.03125);window.pauseScene&&window.pauseScene.step_&&window.pauseScene.step_(.03125);d();l();if(qyengine.gRenderer){qyengine.gRenderer.render(qyengine.gStage);var n=u(qyengine.gStage);if(n>j){console.log(n);j=n}}current_game.world.DrawDebugData&&current_game.world.DrawDebugData();current_game.contactListener.handleContacts()}}function y(e){if(current_game.sceneRes){var n=current_game.sceneRes[e],i=n&&n.usedScenes;if(i)for(var t=0;t<i.length;t++)q(i[t])}}function f(e,n){var i=window.current_scene,t=qyengine.guardType(e);if(!t)return i;y(e);i&&i.destroy();g();i=new t(n);qyengine.gStage.children.length>0&&qyengine.gStage.removeChildren();qyengine.gStage.addChild(i);qyengine.gStage.interactionManager.rebuildInteractiveGraph();var r=i.view;r?current_game.director.setSize(i.view.width,i.view.height):current_game.director.setSize(i.full_size.width,i.full_size.height);current_game.director.replaceScene(i);i.dispatchCreateEvent("create");if(!N){qyengine.scheduleTask(m,qyengine.gStage,-1);N=!0}qyengine.insideGStep=!0;current_game.debugDraw&&(/\/previewGame$/.test(qyboot.getDomainApp())||"debug/"==qyboot.getPrefix())&&current_game.enableDebugDraw();return i}function w(){qyengine.keyDispatcher=new QyEventTarget;qyengine.docKh=qyengine.keyDispatcher;document.addEventListener("keydown",function(e){if(!M[e.keyCode]){M[e.keyCode]=!0;qyengine.keyDispatcher.dispatchEvent(e)}});document.addEventListener("keyup",function(e){if(M[e.keyCode]){M[e.keyCode]=!1;qyengine.keyDispatcher.dispatchEvent(e)}})}function _(){qyengine.audioUnlocked=!0;F=document.body.addEventListener("touchstart",h)}function h(){qyboot.is_ios&&qyengine.unlockAudio_&&qyengine.unlockAudio_.play();document.body.removeEventListener("touchstart",h)}function p(e){for(var n=[],i=0;i<e.length;i++)if(!qyengine.preloadedFiles[e[i]]){qyengine.preloadedFiles[e[i]]=!0;n.push(e[i])}return n}function v(e){for(var n=[],i=0;i<e.length;i++)if(!qyengine.preloadedSounds[e[i]]){qyengine.preloadedSounds[e[i]]=!0;n.push(e[i])}return n}function q(e,n,i){if(qyengine.isRunningLocal)n&&n();else{var t=qyengine.preloadedScenes[e];if(null==t){qyengine.preloadedScenes[e]=n?[n]:[];i||(i=window.gamejson);var r=current_game.sceneRes[e],a=p(r.files),o=v(r.sounds),c={type:"loading",progress:0};qyengine.preloadFileList([a,o],function(n){c.progress=n;var i=qyengine.preloadedScenes[e],t=i.length,r=t>0;if(n>=100){r&&qyengine.loadingAgent.dispatchEvent(c);qyengine.preloadedScenes[e]=!0;for(var a=0;t>a;a++)i[a]&&i[a]()}else r&&qyengine.loadingAgent.dispatchEvent(c)})}else t===!0?n&&n():n&&t.push(n)}}function b(e,n){for(var i in n){var t=n[i].bind(e);gmx_foreach(i.split(","),function(n){switch(n){case"loading":case"loaded":e.objListen(qyengine.loadingAgent,n,t);break;case"keydown":case"keyup":t.target=e;e.objListen(qyengine.keyDispatcher,n,t);break;case"acceleration":e.objListen(qyengine.accelerationDispatcher,n,t);qyengine.watchAcceleration();break;case"mouseleave":e.spriteListen("mouseout",t);break;default:qyengine.EventsOnQyObj.indexOf(n)>=0?e.selfListen(n,t):e.spriteListen(n,t)}})}}function x(e,n){var i=qyengine.guardType(n);if(i){var t=i.baseType,r=i.evHandlers,a=i.defaultOpt;t&&t.call(this,qyengine.merge(a,e));r&&b(this,r)}}function S(){var e=current_game.director.size,n=game.director.domElement;e={width:e.width*qyengine.gRenderer.resolution,height:e.height*qyengine.gRenderer.resolution};game.screen_preference||(game.screen_preference="auto");var i=!qyengine.isApk&&(game.screen_preference.indexOf("horizontal")>-1&&e.width<e.height||game.screen_preference.indexOf("vertical")>-1&&e.width>e.height);i=!1;var t=i?game.screen_preference.indexOf("reverse")>-1?90:-90:0,r=i?"height":"width",a=i?"width":"height",o={width:n.parentElement.offsetWidth,height:n.parentElement.offsetHeight},c=o.width/e[r],s=o.height/e[a];qyengine.gRenderer.resize(e.width/qyengine.gRenderer.resolution,e.height/qyengine.gRenderer.resolution);n.style.width=e.width+"px";n.style.height=e.height+"px";var g,d=window.current_scene&&"qyDefaultLoadingScene"==current_scene.classId||current_game.isFullScreen&&void 0===current_game.screenSize||"full_screen"===current_game.screenSize,l=d?"max":"min",u=Math[l](c,s);if("scale_integer"===current_game.screenSize)if(u>=1)u=Math.floor(u);else for(var m=0;m&&u>1/m||1/(m+1)>u;){m++;(1/m>=u&&u>=1/(m+1)||m>10)&&(u=1/(m+1))}else"not_scale"===current_game.screenSize&&(u=1);var y=(o.height-e.height)/2,f=(o.width-e.width)/2;g="translate("+f+"px, "+y+"px) scale("+u+", "+u+") rotate("+t+"deg)";n.style["-ms-transform"]=g;n.style["-webkit-transform"]=g;n.style["-o-transform"]=g;n.style["-moz-transform"]=g;n.style.transform=g;n.style["transform-origin"]="50% 50%";n.style["-ms-transform-origin"]="50% 50%";n.style["-webkit-transform-origin"]="50% 50%";n.style["-o-transform-origin"]="50% 50%";n.style["-moz-transform-origin"]="50% 50%";if(qyengine.gRenderer&&qyengine.gRenderer.context&&"pixel"===game.filter){var w=qyengine.gRenderer.context;w.mozImageSmoothingEnabled=!1;w.imageSmoothingEnabled=!1;w.webkitImageSmoothingEnabled=!1;w.msImageSmoothingEnabled=!1}}function k(e){e||(e=document.body);this.domElement=document.createElement("div");this.domElement.className="pp-director";e.appendChild(this.domElement);this.installStyles();this.size=B;if(!qyengine.gRenderer){var n=document.createElement("canvas");this.domElement.appendChild(n);n.id="pcanvas";qyengine.gRenderer=PIXI.autoDetectRecommendedRenderer(window.innerWidth,window.innerHeight,{view:n,transparent:!1,antialias:!0});var i=qyengine.gStage=new PIXI.Stage(2371909);i.addEventListener(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"],qyengine.pixiMoveHandler);i.mousedown=i.mousemove=i.mouseup=qyengine.pixiMoveHandler;i.touchstart=i.touchmove=i.touchend=qyengine.pixiMoveHandler;window.addEventListener("resize",S)}}qyengine.createInstance=function(n,i,t){var r=qyengine.guardType(n.type);if(!r)return null;var a=new r(n),o=n.id;o&&(window[o]=a,a.id=o);e(a,i,n);t||n.no_c_d_evt||a.dispatchEvent("create");return a};qyengine.save=function(){return qyremote.uploadFile("dev",SelfModName()+"/gamecode.js",qyengine.gamecode)};inherits(t,b2ContactListener);window.gmContactListener=t;t.prototype.addContact=function(e,n){var i=n.GetFixtureA(),t=n.GetFixtureB(),c=r(i),s=r(t),g=n.IsSensor();o(c)&&o(s)&&a(e,c,s,i.fixName,t.fixName,g)};t.prototype.BeginContact=function(e){this.addContact(this.beginContacts,e)};t.prototype.EndContact=function(e){this.addContact(this.endContacts,e)};t.prototype.handleContacts=function(){this.handleContactList(this.beginContacts,"collision","enterobject");this.handleContactList(this.endContacts,"collisionend","leaveobject")};var D=[];qyengine.uniqueCollide=function(e,n,i,t){var r=n.other,a=n.myName,o=n.withName;if("allFixs"!=i&&i.indexOf(a)<0||"allFixs"!=t&&t.indexOf(o)<0)return!1;if(s(e,r,i,t)||s(r,e,t,i))return!1;D.push({obj1:e,obj2:r,myNames:i,withNames:t});return!0};t.prototype.handleContactList=function(e,n,i){for(var t=0;t<e.length;t++){var r=e[t],a=r.obj1,o=r.obj2,s=r.fixName1,g=r.fixName2,d=r.isSensor,l=d?i:n;c(a,o,l,s,g)}e.length=0;D.length=0};var I=[],E=[];qyengine.insideGStep=!1;qyengine.toDestroy=I;qyengine.toRebuild=E;var C,L;current_game.velocityIterations=1;current_game.positionIterations=1;var z=0,j=0,N=!1;qyengine.switchScene=function(e,n){qyengine.insideGStep?C=e:qyengine.preloadedScenes[e]===!0?f(e,n):q(e,function(){f(e,n)})};qyengine.generated=function(){};var A,R;current_game.disableDebugDraw=function(){R&&(R.style.visibility="hidden");current_game.world&&current_game.world.SetDebugDraw(null)};current_game.enableDebugDraw=function(){if(!R){var e=R=document.createElement("canvas");e.id="debug_canvas";e.style.border="1px dashed blue";document.body.appendChild(e);R=e;A||(A=new b2DebugDraw);A.SetSprite(e.getContext("2d"));A.SetFillAlpha(.3);A.SetLineThickness(1);A.SetFlags(b2DebugDraw.e_shapeBit|b2DebugDraw.e_jointBit)}R.style.visibility="visible";current_game.world.SetDebugDraw(A);var n=current_scene.full_size,i=n.width/n.height;if(i>1){R.width=300;R.height=R.width/i}else{R.height=300;R.width=R.height*i}A.SetDrawScale(R.width/n.width/gScale)};var M={};qyengine.isKeyDown=function(e){return M[e]};qyengine.reset=function(){qyengine.keyDispatcher||w();window.current_scene&&current_scene.destroy();d();clear_all_sounds();current_game.director&&current_game.director.popScene();current_game.disableDebugDraw();_();qyengine.preloadedScenes={};qyengine.preloadedSounds={};qyengine.unscheduleAll();qyengine.startScheduler()};var F;qyengine.preloadedFiles={};qyengine.preloadedSounds={};qyengine.loadingAgent=new QyEventTarget;qyengine.preloadedScenes={};qyengine.preloadLoadingScene=function(e){q(current_game.loading_scene,function(){qyengine.isRunningLocal||qyengine.isApk||f(current_game.loading_scene);q(current_game.start_scene,function(){qyengine.switchScene(current_game.start_scene)},e)},e)};qyengine.define_type=function(e,n,i,t,r){if(t instanceof Array){r=t;t=null}var a=qyengine.guardType(e);inherits(a,n);a.baseType=n;a.defaultOpt=i;a.evHandlers=t;a.prototype.classId=e;a.prototype.init_=x;a.classId=e;window[e]=a;if(r){r.sort(function(e,n){return e[0]>=n[0]?1:-1});a.prototype.stepDefs_=r;a.prototype.stepMax_=r[r.length-1][0]+1}};var B={width:1600,height:900};window.QyDirector=k;k.prototype.installStyles=function(){installStyles("html,body{margin:0;padding:0;height:100%;overflow:hidden;position:relative;}* { -webkit-tap-highlight-color: rgba(0, 0, 0, 0); }");installStyles(".pp-director{overflow: hidden;position: absolute;transform-origin: 0 0;-ms-transform-origin: 0 0;-webkit-transform-origin: 0 0;-o-transform-origin: 0 0;-moz-transform-origin: 0 0;}");installStyles("input:focus{outline:none;}");var e=document.createElement("meta");e.name="viewport";var n="initial-scale=1.0,minimum-scale=1,maximum-scale=1.0,user-scalable=no";/android/i.test(navigator.userAgent)&&(n+=",target-densityDpi=device-dpi");e.content=n;document.getElementsByTagName("head").item(0).appendChild(e)};k.prototype.setSize=function(e,n){this.size.width=e;this.size.height=n;S()};k.prototype.getSize=function(){return this.size};k.prototype.pushScene=function(e){this.sceneStack||(this.sceneStack=[]);this.sceneStack.push(e);qyengine.gStage.addChild(e);qyengine.gStage.interactionManager.rebuildInteractiveGraph();e.setSize(this.size.width,this.size.height);e.dispatchCreateEvent("create");qyengine.insideGStep=!0;return e};k.prototype.popScene=function(){if(this.sceneStack&&this.sceneStack.length){var e=this.sceneStack.pop();e&&e.destroy&&e.destroy();var n=qyengine.gStage&&qyengine.gStage.children&&qyengine.gStage.children.indexOf(e);n>-1&&qyengine.gStage.children.splice(n,1)}};k.prototype.getCurrentScene=function(){return this.sceneStack&&this.sceneStack.length?this.sceneStack[this.sceneStack.length-1]:null};k.prototype.replaceScene=function(e){this.sceneStack=[e]}}();!function(){function e(e,n){var i=g[e];i&&scene.stickyLayer.drawVariable(e,i.caption+n,i.x,i.y,i.font,i.other)}function n(e,n,i,t){e=null!=e?getText(e,!0):t+":";var r=null!=e.text?e.text:e;null!=e.text?e.text=current_game[t]:e=current_game[t];draw_variable(t,e,r,n,i)}function i(e){e&&(e.getActiveNode()||e.play())}function t(e){e&&e.getActiveNode()&&e.stop()}function r(e,n){var i,t=e.classId||e,r=l[t];if(r&&r.length>0){i=r[0];n&&object_extend(i,n);return i}return o(e,n)}function a(e){var n=e.classId||e,i=l[n];if(i){for(var t=[],r=0;r<i.length;r++){var a=i[r];a.getActiveNode()||t.push(a)}for(var r=0;r<t.length;r++)array_remove(i,t[r])}}function o(e,n){var i=e.classId||e;a(e);var t,r=qyengine.guardType(i);if(r){t=new r(n);l[i]?l[i].push(t):l[i]=[t];window[i]=t}return t}function c(e){window.gamejson&&window.gamejson.ranklists||e||(e="rank_1");if(!y[e]||y[e].scene!=current_scene){var n=qyengine.guardType(e);n&&(y[e]=new n)}return y[e]}qyengine.instance_create=window.instance_create=function(e,n,i,t){var r="string"==typeof t?t:t&&t.id,a=this.getRotation&&this.getRotation()||0;i instanceof Array&&(i=i[random(i.length-1)]);return qyengine.createInstance({type:i.classId||i,id:r,position:{x:e,y:n},rotation:a,zIndex:t.zIndex},t&&t.layer&&qyengine.guardId(t.layer))};qyengine.instance_change=window.instance_change=function(e,n,i){n.classId&&(n=n.classId);if(e.classId==n)return this;var t=e.getPosition();if(null==t)return null;if(e.destroyBuffered||e.rebuildBuffered||e.destroyed_)return null;var r=!i,a=e.layer,o={type:n.classId||n,id:e.id,position:{x:t.x,y:t.y},rotation:e.getRotation(),no_c_d_evt:r};e.destroy(r);return qyengine.createInstance(o,a)};qyengine.instance_destroy=window.instance_destroy=function(e){e.destroy()};var s=[];qyengine.pushRepeat=function(e){s.push(e);return 0};qyengine.popRepeat=function(){return s.pop()};qyengine.irandom_range=window.irandom_range=function(e,n){var i=Math.round(frandom_range(e,n+1));return i===n+1?e:i};qyengine.frandom_range=window.frandom_range=function(e,n){return Math.random()*(n-e)+e};qyengine.random_range=window.random_range=window.irandom_range;qyengine.random=window.random=function(e,n){if(null==n){n=e;e=0}return random_range(e,n)};qyengine.random_array=window.random_array=function(e){e>0||(e=10);for(var n=array_range(e),i=[],t=e-1;t>0;t--){var r=random(t);i.push(n[r]);n.splice(r,1)}i.push(n[0]);return i};qyengine.prev_scene=window.prev_scene=function(){scene&&scene.prev_scene&&qyengine.switchScene(scene.prev_scene)};qyengine.next_scene=window.next_scene=function(){scene&&scene.next_scene?qyengine.switchScene(scene.next_scene):console.log("next_scene is not defined")};qyengine.restart_scene=window.restart_scene=function(){scene&&qyengine.switchScene(scene.classId)};qyengine.different_scene=window.different_scene=function(e){e.classId&&(e=e.classId);qyengine.switchScene(e)};qyengine.check_prev_scene=window.check_prev_scene=function(){return!(!scene||!scene.prev_scene)};qyengine.check_next_scene=window.check_next_scene=function(){return!(!scene||!scene.next_scene)};var g={};qyengine.updateDraw=e;qyengine.draw_variable=window.draw_variable=function(e,n,i,t,r,a){if(null!=n){var o=n.font||i.font,c=n.size||i.size;c&&(a?a.size||(a.size=c):a={size:c});null!=n.text&&(n=n.text);null!=i.text?i=i.text:i&&"no-text"!=i||(i="");g[e]={caption:i,x:t,y:r,font:o,other:a};scene.stickyLayer.drawVariable(e,i+("string"==typeof n?n:JSON.stringify(n)),t,r,o,a)}};qyengine.draw_text=window.draw_text=draw_variable;qyengine.draw_score=window.draw_score=function(e,i,t){n(e,i,t,"score")};qyengine.draw_lives=window.draw_lives=function(e,i,t){n(e,i,t,"lives")};qyengine.draw_life_image=window.draw_life_image=function(e,n,i,t,r,a){current_scene.drawLifeImage(e,n,i,t,r,a)};qyengine.draw_health=window.draw_health=function(e,i,t){n(e,i,t,"health")};qyengine.draw_money=window.draw_money=function(e,i,t){n(e,i,t,"money")};qyengine.draw_experience=window.draw_experience=function(e,i,t){n(e,i,t,"experience")};qyengine.draw_level=window.draw_level=function(e,i,t){n(e,i,t,"level")};qyengine.set_score=window.set_score=function(n){current_game.score=n;e("score",n)};qyengine.set_lives=window.set_lives=function(n){current_game.lives=n;e("lives",n);qyengine.draw_life_image()};qyengine.set_health=window.set_health=function(n){current_game.health=n;e("health",n)};qyengine.set_money=window.set_money=function(n){current_game.money=n;e("money",n)};qyengine.set_experience=window.set_experience=function(n){current_game.experience=n;e("experience",n)};qyengine.set_level=window.set_level=function(n){current_game.level=n;e("level",n)};qyengine.stop_all_sounds=window.stop_all_sounds=function(){for(var e in l)for(var n=0;n<l[e].length;n++)t(l[e][n])};qyengine.stop_sounds=window.stop_sounds=function(){for(var e in l)for(var n=0;n<l[e].length;n++)l[e][n]!=d&&t(l[e][n])};qyengine.clear_all_sounds=window.clear_all_sounds=function(){for(var e in l)for(var n=0;n<l[e].length;n++)l[e][n].unload();l={};d=null};if(qyengine.isApk){qyengine.mute=window.mute=function(){if(!qyengine._muted){qyengine._muted=!0;for(var e in l)for(var n=0;n<l[e].length;n++)l[e][n].mute()}};qyengine.unmute=window.unmute=function(){if(qyengine._muted){qyengine._muted=!1;for(var e in l)for(var n=0;n<l[e].length;n++)l[e][n].unmute()}};qyengine.setVolume=window.setVolume=function(e){e>=0&&1>=e||(e=1);qyengine.volume_=e;for(var n in l)for(var i=0;i<l[n].length;i++)l[n][i].setVolume(e)};qyengine.getVolume=window.getVolume=function(){return null!=qyengine.volume_?qyengine.volume_:1};qyengine.isMuted=function(){return qyengine._muted}}else{qyengine.mute=window.mute=function(){Howler.mute()};qyengine.unmute=window.unmute=function(){Howler.unmute()};qyengine.setVolume=window.setVolume=function(e){e>=0&&1>=e||(e=1);Howler.volume(e)};qyengine.getVolume=window.getVolume=function(){return Howler.volume()};qyengine.isMuted=function(){return Howler._muted}}qyengine.set_cursor=window.set_cursor=function(e){current_game.director.domElement.style.cursor=e};qyengine.hide_cursor=window.hide_cursor=function(){set_cursor("none")};qyengine.restore_cursor=window.restore_cursor=function(){set_cursor("auto")};qyengine.get_time_text=window.get_time_text=function(e){var n,i,t,r="";if(e>59){i=Math.floor(e/60);n=e%60;if(i>59){t=Math.floor(i/60);i%=60;r=(t>9?t:"0"+t)+":"+(i>9?i:"0"+i)+":"+(n>9?n:"0"+n)}else r=(i>9?i:"0"+i)+":"+(n>9?n:"0"+n)}else r="00:"+(e>9?e:"0"+e);return r};qyengine.vibrate=function(e){navigator.notification&&navigator.notification.vibrate&&navigator.notification.vibrate(e)};qyengine.cancelVibration=function(){navigator.notification&&navigator.notification.cancelVibration&&navigator.notification.cancelVibration()};!function(){function e(){"window"==d?i():"navigator"==d?n():console.log("accelerometer not spported")}function n(){g&&navigator.accelerometer.clearWatch(g);g=null;l.frequency=null;u=0;m=0;y=0}function i(){window.removeEventListener("devicemotion",r,!0);w=!1;u=0;m=0;y=0}function t(e){if(e.x!=u||e.y!=m||e.z!=y){u=e.x;m=e.y;y=e.z;f.x=10*u;f.y=10*m;f.z=10*y;qyengine.accelerationDispatcher.dispatchEvent(f)}}function r(e){var n=e.accelerationIncludingGravity;if(n.x!=u||n.y!=m||n.z!=y){u=n.x;m=n.y;y=n.z;f.x=10*u;f.y=10*m;f.z=10*y;qyengine.accelerationDispatcher.dispatchEvent(f)}}function a(e){console.log("acceleration watch error",e)}function o(e){"window"==d?c():"navigator"==d?s(e):console.log("accelerometer not supported.")}function c(){if(!w){window.addEventListener("devicemotion",r,!0);w=!0}}function s(n){n||(n=100);if(l.frequency!=n||!g){e();l.frequency=n;g=navigator.accelerometer.watchAcceleration(t,a,l)}}var g,d=window.DeviceMotionEvent?"window":navigator.accelerometer?"navigator":null,l={frequency:null},u=0,m=0,y=0,f={type:"acceleration",x:0,y:0,z:0};qyengine.accelerationDispatcher=new QyEventTarget;var w;qyengine.stopWatchAcceleration=e;qyengine.watchAcceleration=o}();var d,l={};qyengine.getSound=r;qyengine.soundExist=function(e){var n=e.classId||e;return l[n]&&l[n].length>0};qyengine.play_sound=window.play_sound=function(e,n){e.classId&&(e=e.classId);var r=o(e,n);if(r.is_background){t(d);d=r}i(r)};qyengine.sound_play=window.sound_play=play_sound;qyengine.stop_bg_sound=window.stop_bg_sound=function(){t(d)};qyengine.stop_sound=window.stop_sound=function(e){var n=e.classId||e,i=l[n];if(i)for(var r=0;r<i.length;r++)t(i[r])};qyengine.sound_stop=window.sound_stop=stop_sound;qyengine.check_sound=window.check_sound=function(e){var n=e.classId||e,i=l[n];if(i)for(var t=0;t<i.length;t++)if(i[t].getActiveNode())return!0;return!1};qyengine.sound_check=window.sound_check=check_sound;var u,m;qyengine.getLogger=window.getLogger=function(e){if(!window.log4javascript)return console;if("inpage"==e){if(!u){u=log4javascript.getLogger("inpage");var n=new log4javascript.InPageAppender;u.addAppender(n)}return u}if("popup"==e){if(!m){m=log4javascript.getLogger("popup");var n=new log4javascript.PopUpAppender;m.addAppender(n)}return m}return console};var y={};qyengine.getRankList=c;qyengine.displayRanklist=window.displayRanklist=function(e){var n=c(e);n&&n.displayRanklist()};qyengine.insertRankListData=window.insertRankListData=function(e,n){var i=c();if(i){e=JSON.parse(JSON.stringify(e));delete e.actionIndex;delete e.comment;delete e.disabled_action;delete e.method;delete e.show;delete e.ranklist;i.insertRankListData(e,n)}};qyengine.execute_formula=window.execute_formula=function(e,n,i,t,r,a,o){return current_game.formulas&&current_game.formulas[e]?current_game.formulas[e].call(this,n,i,t,r,a,o):void 0}}();!function(){function e(e){var n=document.createElement("link");n.rel="shortcut icon";n.href=e;window.document&&document.head.appendChild(n)}qyengine.registerWeixinMenuEvent=function(){var e=window.document.createElement("script");e.src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js";window.document.head.appendChild(e);e.onload=function(){var e=window.location.href,n=qyboot.getBaseURI()+qyboot.getPrefix()+qyboot.getDomainApp(),i=game.game_icon||"favicon.ico",t=game.share_text||game.game_desc||"game",r=game.game_name,a="wxdd06a5845121307a";i="/"===i[0]?qyboot.getBaseURI()+i:n+"/"+i;qyremote_async.getWeiXinSignature(e,function(n){if(n&&n.success){n=n.result;window.wx.config({appId:a,timestamp:n.timestamp,nonceStr:n.noncestr,signature:n.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"]});window.wx.ready(function(){window.wx.onMenuShareTimeline({title:t,link:e,imgUrl:game.weixin_share_images||i,desc:t,success:function(){game.weixin_callback&&game.scripts[game.weixin_callback]&&game.scripts[game.weixin_callback]({err_msg:"share_timeline:ok"})},fail:function(){game.weixin_callback&&game.scripts[game.weixin_callback]&&game.scripts[game.weixin_callback]({err_msg:"share_timeline:fail"})},cancel:function(){game.weixin_callback&&game.scripts[game.weixin_callback]&&game.scripts[game.weixin_callback]({err_msg:"share_timeline:cancel"})}});window.wx.onMenuShareAppMessage({title:r,link:e,imgUrl:game.weixin_share_images||i,desc:t,success:function(){game.weixin_callback&&game.scripts[game.weixin_callback]&&game.scripts[game.weixin_callback]({err_msg:"share_app_msg:ok"})},fail:function(){game.weixin_callback&&game.scripts[game.weixin_callback]&&game.scripts[game.weixin_callback]({err_msg:"share_app_msg:fail"})},cancel:function(){game.weixin_callback&&game.scripts[game.weixin_callback]&&game.scripts[game.weixin_callback]({err_msg:"share_app_msg:cancel"})}});window.wx.onMenuShareQQ({title:r,link:e,imgUrl:game.weixin_share_images||i,desc:t,success:function(){game.weixin_callback&&game.scripts[game.weixin_callback]&&game.scripts[game.weixin_callback]({err_msg:"share_qq:ok"})},fail:function(){game.weixin_callback&&game.scripts[game.weixin_callback]&&game.scripts[game.weixin_callback]({err_msg:"share_qq:fail"})},cancel:function(){game.weixin_callback&&game.scripts[game.weixin_callback]&&game.scripts[game.weixin_callback]({err_msg:"share_qq:cancel"})}});window.wx.onMenuShareWeibo({title:r,link:e,imgUrl:game.weixin_share_images||i,desc:t,success:function(){game.weixin_callback&&game.scripts[game.weixin_callback]&&game.scripts[game.weixin_callback]({err_msg:"share_weibo:ok"})},fail:function(){game.weixin_callback&&game.scripts[game.weixin_callback]&&game.scripts[game.weixin_callback]({err_msg:"share_weibo:fail"})},cancel:function(){game.weixin_callback&&game.scripts[game.weixin_callback]&&game.scripts[game.weixin_callback]({err_msg:"share_weibo:cancel"})}})})}})}};qyengine.start=function(n,i){current_game.dataforms||qyengine.initDataforms();localStorage.setItem("QYLOCALE","zh-CN");var t=document.getElementById("qyLoadingDiv");t&&document.body.removeChild(t);qyengine.installFonts();qyengine.reset();window[qyengine.loading_scene]||qyengine.initLoadingScene();n||(n=window.json||window.gamejson);window.gamejson=n;i?"string"==typeof i&&(i=document.getElementById(i)):i=document.body;var r=current_game.director&&current_game.director.domElement;r!=i&&(current_game.director=new QyDirector(i));qyengine.generated&&qyengine.generated();current_game.loading_scene||(current_game.loading_scene=qyengine.loading_scene);current_game.pause_scene||(current_game.pause_scene=qyengine.pause_scene);if(!current_game.game_name){var a=qyboot.getDomainApp();current_game.game_name=a?qyboot.filename(a):"made by gamemei"}current_game.game_icon&&e(current_game.game_icon);current_game.extend&&qyengine.initVars(current_game,current_game.extend);qyengine.initBrowserVars();qyengine.loadAppUserData();window.document&&(window.document.title=current_game.game_name);current_game.start_scene?qyengine.preloadLoadingScene(n):console.log("current_game.start_scene is not defined.");!current_game.isFullScreen&&current_game.screenEmptyFill&&(i.style.backgroundColor=current_game.screenEmptyFill)}}();
!function(){function t(t){QyObject.call(this);var e=this.currentSprite=(new PIXI.Video).setAnchorPoint(0,0).setSrc(t.src||"").setAutoplay(!!t.autoplay).setControls(!!t.controls),o=t.position;o&&e.setPosition(o.x,o.y);var i=t.size;i&&e.setSize(i.width,i.height);t.hiddenAtStart&&this.hide();e.qyobj=this;this.loopTime=0;this.setLoop(t.loop||1);t.videoSkipBtn&&t.videoSkipBtn.isUse&&t.videoSkipBtn.data&&t.videoSkipBtn.data.picture&&e.setSkipButton(t.videoSkipBtn.data);var n=this;e.listen("video:ended",function(){n.loopTime++;"loop"===n.loop||n.loopTime<n.loop?n.play():n.ended=!0})}PIXI.Video=function(){PIXI.DisplayObjectContainer.call(this);this._width=100;this._height=24};PIXI.Video.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.Video.prototype.constructor=PIXI.Video;PIXI.Video.prototype.createDomElement=function(){var t="video",e=function(){this.domElement=this.rootElement=this.containerElement=document.createElement(t);this.registerEvents();this.dirty=!0};if(this.domElement){var o=this.domElement.tagName.toLowerCase();if(o!=t){var i=this.rootElement;e.call(this);i.parentNode&&i.parentNode.replaceChild(this.rootElement,i)}}else e.call(this)};PIXI.Video.prototype.removeFromParent=function(){var t=this.domElement&&this.domElement.parentNode;t&&t.removeChild(this.domElement);t=this.skipButton&&this.skipButton.parentNode;t&&t.removeChild(this.skipButton)};PIXI.Video.prototype.registerEvents=function(){var t=this,e=this.domElement;if(e){var o=["play","pause","progress","error","timeupdate","ended","abort","empty","emptied","waiting","loadedmetadata"];o.forEach(function(o){e.addEventListener(o,function(i){t.dispatchEvent(e.ended?{type:"video:ended",event:i}:{type:"video:"+o,event:i})})})}};PIXI.Video.prototype.setHidden=function(t){this.domElement&&(this.domElement.style.display=t?"none":"block");this.hidden_=t;this.visible=!t;this.dirty=!0;return this};PIXI.Video.prototype.setSrc=function(t){this.src=t;this.dirty=!0;return this};PIXI.Video.prototype.getSrc=function(){return this.src};PIXI.Video.prototype.setAutoplay=function(t){this.autoplay=!!t;this.dirty=!0;return this};PIXI.Video.prototype.getAutoplay=function(){return!!this.autoplay};PIXI.Video.prototype.setControls=function(t){this.controls=!!t;this.dirty=!0;return this};PIXI.Video.prototype.getControls=function(){return!!this.controls};PIXI.Video.prototype.play=function(){this.domElement&&this.domElement.play&&this.domElement.play()};PIXI.Video.prototype.pause=function(){this.domElement&&this.domElement.pause&&this.domElement.pause()};PIXI.Video.prototype.isEnded=function(){return this.domElement&&this.domElement.ended};PIXI.Video.prototype.setPosition=function(){PIXI.DisplayObjectContainer.prototype.setPosition.apply(this,arguments);this.dirty=!0};PIXI.Video.prototype.setOpacity=function(t){this.opacity_=t;this.dirty=!0};PIXI.Video.prototype.getOpacity=function(){return this.opacity_};PIXI.Video.prototype.replay=function(){var t=this.domElement;if(t){t.currentTime=0;t.play()}};PIXI.Video.prototype.skip=function(){var t=this.domElement;t&&(t.currentTime=t.duration)};PIXI.Video.prototype.setSkipButton=function(t){var e=this,o=this.skipButton;if(!o){o=this.skipButton=document.createElement("img");o.addEventListener("mousedown",function(){e.skip()});o.addEventListener("touchstart",function(){e.skip()});o.style.position="absolute"}o.src=t.picture;if(t.position){o.style.left=t.position.x+"px";o.style.top=t.position.y+"px"}};PIXI.Video.prototype.drawSkipButton=function(){this.skipButton&&game.director&&game.director.domElement&&game.director.domElement.appendChild(this.skipButton)};PIXI.Video.prototype._renderWebGL=function(){if(this.dirty){this.createDomElement();game.director&&game.director.domElement&&game.director.domElement.appendChild(this.domElement);var t=this.domElement;this.maskTarget_=!0;this.update();t.style.display=this.hidden_?"none":"block";t.setAttribute("src",this.getSrc());var e=this.getAutoplay();e?t.setAttribute("autoplay","autoplay"):t.removeAttribute("autoplay");var o=this.getControls();o?t.setAttribute("controls","controls"):t.removeAttribute("controls");this.drawSkipButton();this.dirty=!1}};PIXI.Video.prototype._renderCanvas=PIXI.Video.prototype._renderWebGL;PIXI.Video.prototype.update=PIXI.input.prototype.update;PIXI.Video.prototype.drawSizePosition=PIXI.input.prototype.drawSizePosition;inherits(t,QyObject);t.prototype.setLoop=function(t){this.loop=t};t.prototype.getLoop=function(){return this.loop};t.prototype.play=function(){if(this.ended){this.ended=!1;this.loopTime=0}this.currentSprite&&this.currentSprite.play()};t.prototype.pause=function(){this.currentSprite&&this.currentSprite.pause()};t.prototype.setSrc=function(t){this.currentSprite&&this.currentSprite.setSrc(t)};t.prototype.replay=function(){if(this.ended){this.ended=!1;this.loopTime=0}this.currentSprite&&this.currentSprite.replay()};window.QyVideo=t}();
window.QySkeleton=function(t){t||(t={});this.json=t.json;this.plist=t.plist;this.image=t.image;this.size=t.size;this.pivot=t.pivot;this.animation=t.animation;this.events=t.events;var e=[];e=e.concat(this.json);e=e.concat(this.plist);this.urls=e};inherits(QySkeleton,PIXI.Spine);QySkeleton.prototype.load=function(t){var e=this,o=this.assetLoader;o||(o=this.assetLoader=new PIXI.AssetLoader);o.assetURLs=this.urls;o.onComplete=function(){e.onLoad();t&&t()};o.load()};QySkeleton.prototype.onLoad=function(){var t=this.json;if(t.length){PIXI.Spine.call(this,t[0]);var e=this;this.state.onComplete=function(t,o){var i,n=e.getLoop();i=n===!0||isNaN(n-0)?1/0:n-0;if(o>=i){var s=e.state.getCurrent(0),a=s.animation.name;e.state.clearTracks();var p=new PIXI.Event(this,"skeletonEnd");p.animation=a;e.dispatchEvent(p)}}}};QySkeleton.prototype.setStartAnimation=function(t){this.state.setAnimationByName(0,t,!0)};QySkeleton.prototype.setLoop=function(t){this.loop=t};QySkeleton.prototype.getLoop=function(){return void 0===this.loop?1:this.loop};QySkeleton.prototype.setSpeed=function(t){t&&this.state&&(this.state.timeScale=t/100)};
!function(){function t(t){QyObject.call(this);var e=this.currentSprite=(new PIXI.Iframe).setAnchorPoint(0,0).setSrc(t.webLink||"").setRadius(t.radius).setStroke(t.border),r=t.position;r&&e.setPosition(r.x,r.y);var i=t.size;i&&e.setSize(i.width,i.height);t.hiddenAtStart&&this.hide();this.zIndex=t.zIndex||0;e.qyobj=this}PIXI.Iframe=function(){PIXI.DisplayObjectContainer.call(this);this._width=400;this._height=250};PIXI.Iframe.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.Iframe.prototype.constructor=PIXI.Iframe;PIXI.Iframe.prototype.createDomElement=function(){var t="iframe",e=function(){this.domElement=this.rootElement=this.containerElement=document.createElement(t);this.dirty=!0};if(this.domElement){var r=this.domElement.tagName.toLowerCase();if(r!=t){var i=this.rootElement;e.call(this);i.parentNode&&i.parentNode.replaceChild(this.rootElement,i)}}else e.call(this)};PIXI.Iframe.prototype.removeFromParent=function(){var t=this.domElement&&this.domElement.parentNode;t&&t.removeChild(this.domElement)};PIXI.Iframe.prototype.setHidden=function(t){this.domElement&&(this.domElement.style.display=t?"none":"block");this.hidden_=t;this.visible=!t;this.dirty=!0;return this};PIXI.Iframe.prototype.setRadius=function(t){this._radius=t;this.dirty=!0;return this};PIXI.Iframe.prototype.getRadius=function(){return this._radius||0};PIXI.Iframe.prototype.setStroke=function(t){if(t){this._stroke={width:t.stroke||0,color:t.color||"#000000"};this.dirty=!0;return this}};PIXI.Iframe.prototype.getStroke=function(){return this._stroke||{width:0,color:"#000000"}};PIXI.Iframe.prototype.setSrc=function(t){this._src=t;this.dirty=!0;return this};PIXI.Iframe.prototype.getSrc=function(){return this._src};PIXI.Iframe.prototype._renderWebGL=function(){if(this.dirty){this.createDomElement();game.director&&game.director.domElement&&game.director.domElement.appendChild(this.domElement);var t=this.domElement;this.maskTarget_=!0;this.update();t.style.display=this.hidden_?"none":"block";t.setAttribute("src",this.getSrc());t.style["border-radius"]=this.getRadius()+"px";var e=this.getStroke();t.style.border=e.width+"px solid "+e.color;this.dirty=!1}};PIXI.Iframe.prototype._renderCanvas=PIXI.Iframe.prototype._renderWebGL;PIXI.Iframe.prototype.update=PIXI.input.prototype.update;PIXI.Iframe.prototype.drawSizePosition=PIXI.input.prototype.drawSizePosition;inherits(t,QyObject);t.prototype.setSrc=function(t){this.currentSprite&&this.currentSprite.setSrc(t)};window.QyIframe=t}();

